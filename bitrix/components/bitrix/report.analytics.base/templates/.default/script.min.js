this.BX=this.BX||{};this.BX.Report=this.BX.Report||{};(function(e,t,a,s){"use strict";var i=babelHelpers.classPrivateFieldLooseKey("toolbar");var r=babelHelpers.classPrivateFieldLooseKey("setToolbarTitle");var o=babelHelpers.classPrivateFieldLooseKey("getToolbarContainer");var l=babelHelpers.classPrivateFieldLooseKey("getToolbarRightButtonsContainer");class n{constructor(e){var t,a;Object.defineProperty(this,l,{value:h});Object.defineProperty(this,o,{value:c});Object.defineProperty(this,r,{value:d});Object.defineProperty(this,i,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,i)[i]=(t=BX.UI)==null?void 0:(a=t.ToolbarManager)==null?void 0:a.getDefaultToolbar();this.scope=e.scope;this.menuScope=e.menuScope;this.changeBoardButtons=this.menuScope.querySelectorAll('[data-role="report-analytics-menu-item"]');this.contentContainer=this.scope.querySelector(".report-analytics-content");this.currentItem=this.menuScope.querySelector(".report-analytics-sidebar-submenu-item.report-analytics-sidebar-submenu-item-active");this.pageControlsContainer=babelHelpers.classPrivateFieldLooseBase(this,l)[l]();this.defaultBoardKey=e.defaultBoardKey;this.defaultBoardTitle=e.defaultBoardTitle;this.currentPageTitle=top.document.title;this.init()}init(){a.EventEmitter.subscribe("SidePanel.Slider:onClose",(()=>{this.sliderCloseHandler()}));top.document.title=this.defaultBoardTitle;this.changeBoardButtons.forEach((e=>{t.Event.bind(e,"click",this.handleItemClick.bind(this))}));this.loader=new s.Loader({size:80});top.onpopstate=this.handlerOnPopState.bind(this);this.openBoardWithKey(this.defaultBoardKey);const e=[...this.changeBoardButtons].find((e=>e.dataset.reportBoardKey===this.defaultBoardKey));this.tryOpenExternalUrl(e)}tryOpenExternalUrl(e){if(t.Type.isElementNode(e)&&e.dataset.isExternal==="Y"){if(e.dataset.isSliderSupport==="N"){this.openExternalUrlInNewTab(e.dataset.externalUrl)}else{this.openExternalUrl(e.dataset.externalUrl,e.dataset.sliderLoader)}return true}return false}handleItemClick(e){e.preventDefault();const t=e.currentTarget;this.activateButton(e);if(!this.tryOpenExternalUrl(t)){this.openBoardWithKey(t.dataset.reportBoardKey,t.href)}}openExternalUrl(e,t="report:analytics"){BX.SidePanel.Instance.open(e,{cacheable:false,loader:t})}openExternalUrlInNewTab(e){window.open(e,"_blank")}openBoardWithKey(e,a){this.cleanPageContent();this.showLoader();BX.Report.VC.Core.abortAllRunningRequests();BX.Report.VC.Core.ajaxPost("analytics.getBoardComponentByKey",{data:{IFRAME:"Y",boardKey:e},analyticsLabel:{boardKey:e},onFullSuccess:function(s){this.hideLoader();if(String(a)!==""){top.history.pushState(null,s.additionalParams.pageTitle,a);top.history.replaceState({reportBoardKey:e,href:a},s.additionalParams.pageTitle,a)}this.changePageTitle(s.additionalParams.pageTitle);this.changePageControls(s.additionalParams.pageControlsParams);t.Runtime.html(this.contentContainer,s.data)}.bind(this)})}cleanPageContent(){var e,a,s,i,o;babelHelpers.classPrivateFieldLooseBase(this,r)[r]("");t.Dom.clean(this.pageControlsContainer);t.Dom.clean(this.contentContainer);(e=BX.Report)==null?void 0:(a=e.Dashboard)==null?void 0:(s=a.BoardRepository)==null?void 0:s.destroyBoards();(i=BX.VisualConstructor)==null?void 0:(o=i.BoardRepository)==null?void 0:o.destroyBoards()}changePageControls(e){const a={};a.onFullSuccess=function(e){t.Runtime.html(this.pageControlsContainer,e.html)}.bind(this);BX.Report.VC.Core._successHandler(e,a)}changePageTitle(e){babelHelpers.classPrivateFieldLooseBase(this,r)[r](e);top.document.title=e}showLoader(){var e;const a=t.Dom.create("img",{attrs:{src:"/bitrix/images/report/visualconstructor/preview/view-without-menu.svg",height:"1200px",width:"100%"},style:{"margin-top":`-${(e=babelHelpers.classPrivateFieldLooseBase(this,o)[o]())==null?void 0:e.offsetHeight}px`}});t.Dom.append(a,this.contentContainer)}hideLoader(){this.loader.hide()}activateButton(e){const a=e.currentTarget;if(!this.currentItem){this.currentItem=a}t.Dom.removeClass(this.currentItem,"report-analytics-sidebar-submenu-item-active");this.currentItem=a;t.Dom.addClass(this.currentItem,"report-analytics-sidebar-submenu-item-active")}handlerOnPopState(e){let a=this.defaultBoardKey;if(!t.Type.isUndefined(e.state.reportBoardKey)){a=e.state.reportBoardKey}this.cleanPageContent();this.showLoader();BX.Report.VC.Core.ajaxPost("analytics.getBoardComponentByKey",{data:{IFRAME:"Y",boardKey:a},analyticsLabel:{boardKey:a},onFullSuccess:function(e){this.hideLoader();this.cleanPageContent();this.changePageTitle(e.additionalParams.pageTitle);this.changePageControls(e.additionalParams.pageControlsParams);t.Runtime.html(this.contentContainer,e.data)}.bind(this)})}sliderCloseHandler(){top.document.title=this.currentPageTitle}}function d(e){if(!babelHelpers.classPrivateFieldLooseBase(this,i)[i]){return}if(t.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,i)[i].setTitle)){babelHelpers.classPrivateFieldLooseBase(this,i)[i].setTitle(e)}else{const t=babelHelpers.classPrivateFieldLooseBase(this,i)[i].titleContainer.querySelector("#pagetitle");if(t){t.textContent=e}}}function c(){if(!babelHelpers.classPrivateFieldLooseBase(this,i)[i]){return null}if(t.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,i)[i].getContainer)){return babelHelpers.classPrivateFieldLooseBase(this,i)[i].getContainer()}return babelHelpers.classPrivateFieldLooseBase(this,i)[i].toolbarContainer}function h(){if(!babelHelpers.classPrivateFieldLooseBase(this,i)[i]){return null}if(t.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,i)[i].getRightButtonsContainer)){babelHelpers.classPrivateFieldLooseBase(this,i)[i].getRightButtonsContainer()}return babelHelpers.classPrivateFieldLooseBase(this,i)[i].rightButtons}e.Page=n})(this.BX.Report.Analytics=this.BX.Report.Analytics||{},BX,BX.Event,BX);
//# sourceMappingURL=script.map.js