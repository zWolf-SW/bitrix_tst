this.BX=this.BX||{};(function(e,s,t,a,i,l,r,o){"use strict";let n=e=>e,b;class c extends l.EventEmitter{constructor(){super();this.setEventNamespace("BX.Rest.EInvoiceInstaller.Page")}getContent(){throw new Error("Must be implemented in a child class")}getIcon(){return t.Tag.render(b||(b=n`
			<div class="bitrix-einvoice-installer-main-icon-wrapper">
				<div class="bitrix-einvoice-installer-main-icon"></div>
			</div>
		`))}static getType(){throw new Error("Must be implemented in a child class")}}let v=e=>e,d;var p=babelHelpers.classPrivateFieldLooseKey("content");var P=babelHelpers.classPrivateFieldLooseKey("button");var h=babelHelpers.classPrivateFieldLooseKey("getButton");class u extends c{constructor(){super();Object.defineProperty(this,h,{value:L});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});this.setEventNamespace("BX.Rest.EInvoiceInstaller.ErrorPage")}static getType(){return"error"}getContent(){if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p]){babelHelpers.classPrivateFieldLooseBase(this,p)[p]=t.Tag.render(d||(d=v`
				<div class="bitrix-einvoice-installer-content --error-content">
					<div class="bitrix-einvoice-installer-error-icon"></div>
					<div class="bitrix-einvoice-installer-title-install">${0}</div>
					${0}
				</div>
			`),t.Loc.getMessage("REST_EINVOICE_INSTALLER_ERROR_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,h)[h]())}return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}}function L(){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P]){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new i.Button({text:t.Loc.getMessage("REST_EINVOICE_INSTALLER_ERROR_BUTTON"),size:i.Button.Size.LARGE,color:i.Button.Color.SUCCESS,className:"bitrix-einvoice-installer-button-try-again",onclick:()=>{this.emit("go-back")}}).getContainer()}return babelHelpers.classPrivateFieldLooseBase(this,P)[P]}let F=e=>e,B,H;var y=babelHelpers.classPrivateFieldLooseKey("content");var f=babelHelpers.classPrivateFieldLooseKey("title");var g=babelHelpers.classPrivateFieldLooseKey("loader");var E=babelHelpers.classPrivateFieldLooseKey("onAfterUnsuccessfulInstallApplication");var T=babelHelpers.classPrivateFieldLooseKey("getTitle");var m=babelHelpers.classPrivateFieldLooseKey("getLoader");class O extends c{static getType(){return"install"}constructor(){super();Object.defineProperty(this,m,{value:j});Object.defineProperty(this,T,{value:w});Object.defineProperty(this,E,{value:I});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});this.setEventNamespace("BX.Rest.EInvoiceInstaller.InstallPage");this.subscribe("install-app",(e=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]().show();const s=e.data.source;e.data.install.then((e=>{if(!e.status){return Promise.reject()}return o.AppForm.buildByApp(e.data.id,o.EventType.INSTALL)})).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]().hide();e.show();s.render("selection")})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]().hide();babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}))}))}getContent(){if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=t.Tag.render(B||(B=F`
				<div class="bitrix-einvoice-installer-content">
					${0}
					<div class="bitrix-einvoice-installer-loader-wrapper-install"/>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,T)[T]())}return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}}function I(){this.emit("install-error")}function w(){if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f]){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=t.Tag.render(H||(H=F`
				<div class="bitrix-einvoice-installer-title-install">
					${0}
				</div>
			`),t.Loc.getMessage("REST_EINVOICE_INSTALLER_INSTALL_TITLE"))}return babelHelpers.classPrivateFieldLooseBase(this,f)[f]}function j(){if(!babelHelpers.classPrivateFieldLooseBase(this,g)[g]){babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new s.Loader({target:this.getContent().querySelector(".bitrix-einvoice-installer-loader-wrapper-install"),size:90,color:"#2FC6F6",mode:"inline"})}return babelHelpers.classPrivateFieldLooseBase(this,g)[g]}let K=e=>e,C,R;var _=babelHelpers.classPrivateFieldLooseKey("popup");var x=babelHelpers.classPrivateFieldLooseKey("apps");var N=babelHelpers.classPrivateFieldLooseKey("popupContent");var S=babelHelpers.classPrivateFieldLooseKey("formConfiguration");var A=babelHelpers.classPrivateFieldLooseKey("getPopup");var X=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var $=babelHelpers.classPrivateFieldLooseKey("showFormForOffer");class k extends l.EventEmitter{constructor(e,s){super();Object.defineProperty(this,$,{value:z});Object.defineProperty(this,X,{value:U});Object.defineProperty(this,A,{value:M});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,x,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,S,{writable:true,value:void 0});this.setEventNamespace("BX.Rest.EInvoiceAppButton");babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e;babelHelpers.classPrivateFieldLooseBase(this,S)[S]=s}getContent(){const e=new i.Button({text:t.Loc.getMessage("REST_EINVOICE_INSTALLER_SELECTION_BUTTON"),size:i.Button.Size.LARGE,color:i.Button.Color.SUCCESS,dropdown:true,className:"bitrix-einvoice-installer-button-select",onclick:e=>{const s=babelHelpers.classPrivateFieldLooseBase(this,A)[A](e.button);s.getPopup().setMaxWidth(e.button.offsetWidth);s.getPopup().toggle()}});return e.getContainer()}}function M(e){if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new a.PopupComponentsMaker({target:e,content:babelHelpers.classPrivateFieldLooseBase(this,X)[X](),useAngle:false});babelHelpers.classPrivateFieldLooseBase(this,_)[_].getPopup().setOffset({offsetLeft:0,offsetTop:0});this.subscribe("popup-close",(()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_].close()}));return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}function U(){if(babelHelpers.classPrivateFieldLooseBase(this,N)[N]){return babelHelpers.classPrivateFieldLooseBase(this,N)[N]}babelHelpers.classPrivateFieldLooseBase(this,N)[N]=[];babelHelpers.classPrivateFieldLooseBase(this,x)[x].forEach((e=>{const s=()=>{this.emit("popup-close");this.emit("click-app",new l.BaseEvent({data:{code:e.code,name:e.name}}))};babelHelpers.classPrivateFieldLooseBase(this,N)[N].push({html:t.Tag.render(C||(C=K`
					<div onclick="${0}" class="bitrix-einvoice-installer-app-wrapper">
						<div class="bitrix-einvoice-installer-app-name">
							${0}
						</div>
					</div>
				`),s,t.Text.encode(e.name))})}));const e=()=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$]();this.emit("popup-close")};babelHelpers.classPrivateFieldLooseBase(this,N)[N].push({html:t.Tag.render(R||(R=K`
				<div onclick="${0}" class="bitrix-einvoice-installer-app-wrapper --form">
					${0}
				</div>
			`),e,t.Loc.getMessage("REST_EINVOICE_INSTALLER_SELECTION_BUTTON_OFFER"))});return babelHelpers.classPrivateFieldLooseBase(this,N)[N]}function z(){BX.UI.Feedback.Form.open({id:"b5309667",forms:[{zones:["es"],id:676,lang:"es",sec:"uthphh"},{zones:["de"],id:670,lang:"de",sec:"gk89kt"},{zones:["com.br"],id:668,lang:"br",sec:"kuelnm"}],defaultForm:{id:674,lang:"en",sec:"5iorws"},presets:{...babelHelpers.classPrivateFieldLooseBase(this,S)[S],sender_page:document.location.href}})}let V=e=>e,D,G,W,q;var J=babelHelpers.classPrivateFieldLooseKey("content");var Q=babelHelpers.classPrivateFieldLooseKey("title");var Y=babelHelpers.classPrivateFieldLooseKey("description");var Z=babelHelpers.classPrivateFieldLooseKey("button");var ee=babelHelpers.classPrivateFieldLooseKey("apps");var se=babelHelpers.classPrivateFieldLooseKey("formConfiguration");var te=babelHelpers.classPrivateFieldLooseKey("moreInformation");var ae=babelHelpers.classPrivateFieldLooseKey("getTitle");var ie=babelHelpers.classPrivateFieldLooseKey("getDescription");var le=babelHelpers.classPrivateFieldLooseKey("getButton");var re=babelHelpers.classPrivateFieldLooseKey("getMoreInformation");class oe extends c{constructor(e,s){super();Object.defineProperty(this,re,{value:ve});Object.defineProperty(this,le,{value:ce});Object.defineProperty(this,ie,{value:be});Object.defineProperty(this,ae,{value:ne});Object.defineProperty(this,J,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:void 0});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,ee,{writable:true,value:void 0});Object.defineProperty(this,se,{writable:true,value:void 0});Object.defineProperty(this,te,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e;babelHelpers.classPrivateFieldLooseBase(this,se)[se]=s;this.setEventNamespace("BX.Rest.EInvoiceInstaller.SelectionPage")}static getType(){return"selection"}getContent(){if(!babelHelpers.classPrivateFieldLooseBase(this,J)[J]){babelHelpers.classPrivateFieldLooseBase(this,J)[J]=t.Tag.render(D||(D=V`
				<div class="bitrix-einvoice-installer-content">
					${0}
					${0}
					${0}
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](),babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](),babelHelpers.classPrivateFieldLooseBase(this,le)[le](),babelHelpers.classPrivateFieldLooseBase(this,re)[re]())}return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}}function ne(){if(!babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=t.Tag.render(G||(G=V`
				<div class="bitrix-einvoice-installer-title__wrapper">
					<div class="bitrix-einvoice-installer-title__main-text">
						${0}
					</div>
				</div>
			`),t.Loc.getMessage("REST_EINVOICE_INSTALLER_SELECTION_TITLE"))}return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]}function be(){if(!babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=t.Tag.render(W||(W=V`
				<div class="bitrix-einvoice-installer-description">
					${0}
				</div>
			`),t.Loc.getMessage("REST_EINVOICE_INSTALLER_SELECTION_DESCRIPTION"))}return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}function ce(){if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]}const e=new k(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee],babelHelpers.classPrivateFieldLooseBase(this,se)[se]);babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e.getContent();e.subscribe("click-app",(e=>{this.emit("start-install-app",e)}));return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]}function ve(){if(babelHelpers.classPrivateFieldLooseBase(this,te)[te]){return babelHelpers.classPrivateFieldLooseBase(this,te)[te]}const e=()=>{top.BX.Helper.show("redirect=detail&code=19312840")};babelHelpers.classPrivateFieldLooseBase(this,te)[te]=t.Tag.render(q||(q=V`
			<div class="bitrix-einvoice-installer-more-information-wrapper">
				<div onclick="${0}" class="bitrix-einvoice-installer-more-information-link">
					${0}
				</div>
			</div>
		`),e,t.Loc.getMessage("REST_EINVOICE_INSTALLER_MORE"));return babelHelpers.classPrivateFieldLooseBase(this,te)[te]}var de=babelHelpers.classPrivateFieldLooseKey("selectionPage");var pe=babelHelpers.classPrivateFieldLooseKey("installPage");var Pe=babelHelpers.classPrivateFieldLooseKey("errorPage");var he=babelHelpers.classPrivateFieldLooseKey("options");var ue=babelHelpers.classPrivateFieldLooseKey("types");var Le=babelHelpers.classPrivateFieldLooseKey("getSelectionPage");var Fe=babelHelpers.classPrivateFieldLooseKey("getInstallPage");var Be=babelHelpers.classPrivateFieldLooseKey("getErrorPage");var He=babelHelpers.classPrivateFieldLooseKey("registerPageHandlers");class ye extends l.EventEmitter{constructor(e){super();Object.defineProperty(this,He,{value:Te});Object.defineProperty(this,Be,{value:Ee});Object.defineProperty(this,Fe,{value:ge});Object.defineProperty(this,Le,{value:fe});Object.defineProperty(this,de,{writable:true,value:void 0});Object.defineProperty(this,pe,{writable:true,value:void 0});Object.defineProperty(this,Pe,{writable:true,value:void 0});Object.defineProperty(this,he,{writable:true,value:void 0});Object.defineProperty(this,ue,{writable:true,value:void 0});this.setEventNamespace("BX.Rest.EInvoiceInstaller.PageProvider");babelHelpers.classPrivateFieldLooseBase(this,he)[he]=e;babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=[oe.getType(),O.getType(),u.getType()]}exist(e){return babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].includes(e)}getPageByType(e){switch(e){case oe.getType():return babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]();case O.getType():return babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]();case u.getType():return babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();default:throw new Error("Incorrect page type")}}}function fe(){if(!babelHelpers.classPrivateFieldLooseBase(this,de)[de]){babelHelpers.classPrivateFieldLooseBase(this,de)[de]=new oe(babelHelpers.classPrivateFieldLooseBase(this,he)[he].apps,babelHelpers.classPrivateFieldLooseBase(this,he)[he].formConfiguration);babelHelpers.classPrivateFieldLooseBase(this,He)[He](babelHelpers.classPrivateFieldLooseBase(this,de)[de]);babelHelpers.classPrivateFieldLooseBase(this,de)[de].subscribe("start-install-app",(()=>{this.emit("render",new l.BaseEvent({data:{type:O.getType()}}))}))}return babelHelpers.classPrivateFieldLooseBase(this,de)[de]}function ge(){if(!babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=new O;babelHelpers.classPrivateFieldLooseBase(this,He)[He](babelHelpers.classPrivateFieldLooseBase(this,pe)[pe])}return babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]}function Ee(){if(!babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=new u;babelHelpers.classPrivateFieldLooseBase(this,He)[He](babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe])}return babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]}function Te(e){e.subscribe("go-back",(()=>{this.emit("render",new l.BaseEvent({data:{type:oe.getType()}}))}));e.subscribe("install-error",(()=>{this.emit("render",new l.BaseEvent({data:{type:u.getType()}}))}))}var me=babelHelpers.classPrivateFieldLooseKey("options");var Oe=babelHelpers.classPrivateFieldLooseKey("pageProvider");var Ie=babelHelpers.classPrivateFieldLooseKey("formListener");var we=babelHelpers.classPrivateFieldLooseKey("installApplicationByCode");var je=babelHelpers.classPrivateFieldLooseKey("onStartInstall");var Ke=babelHelpers.classPrivateFieldLooseKey("getPageProvider");class Ce extends l.EventEmitter{constructor(e){super();Object.defineProperty(this,Ke,{value:xe});Object.defineProperty(this,je,{value:_e});Object.defineProperty(this,we,{value:Re});Object.defineProperty(this,me,{writable:true,value:void 0});Object.defineProperty(this,Oe,{writable:true,value:void 0});Object.defineProperty(this,Ie,{writable:true,value:void 0});this.setEventNamespace("BX.Rest.EInvoiceInstaller");babelHelpers.classPrivateFieldLooseBase(this,me)[me]=e;this.render("selection");babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]().getPageByType("selection").subscribe("start-install-app",babelHelpers.classPrivateFieldLooseBase(this,je)[je].bind(this))}render(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]().exist(e)){t.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,me)[me].wrapper);const s=babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]().getPageByType(e);t.Dom.append(s.getContent(),babelHelpers.classPrivateFieldLooseBase(this,me)[me].wrapper);if(e!=="error"){t.Dom.append(s.getIcon(),babelHelpers.classPrivateFieldLooseBase(this,me)[me].wrapper)}}}}function Re(e){return t.ajax.runComponentAction("bitrix:rest.einvoice.installer","installApplicationByCode",{mode:"class",data:{code:e}})}function _e(e){babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]().getPageByType("install").emit("install-app",new l.BaseEvent({data:{source:this,code:e.data.code,name:e.data.name,install:babelHelpers.classPrivateFieldLooseBase(this,we)[we](e.data.code)}}))}function xe(){if(!babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]){babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=new ye(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe].subscribe("render",(e=>{this.render(e.data.type)}))}return babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]}e.EInvoiceInstaller=Ce})(this.BX.Rest=this.BX.Rest||{},BX,BX,BX.UI,BX.UI,BX.Event,BX.Rest,BX.Rest);
//# sourceMappingURL=script.map.js