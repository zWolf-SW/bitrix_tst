{"version":3,"file":"script.js","sources":["src/controls/controls.loc.js","src/device/device.data.js","src/device/device.ui.js","src/device/device.js","src/controls/controls.action.js","src/controls/controls.ui.js","src/controls/controls.js","src/slide-panel/block-generator.js","src/slide-panel/slide-panel.js"],"sourcesContent":["\n\nexport class Loc\n{\n\tstatic messages: {[type: string]: string};\n\n\tstatic loadMessages(messages: {[type: string]: string})\n\t{\n\t\tLoc.messages = messages;\n\t}\n\n\tstatic getMessage(code: string): string\n\t{\n\t\treturn Loc.messages[code];\n\t}\n}\n","export type DeviceItem = {\n\tname: string,\n\tcode: string,\n\tclassName: string,\n\tlangCode?: string,\n};\n\nexport const Devices = {\n\tdefaultDevice: {\n\t\ttablet: 'iphone14pro',\n\t\tmobile: 'iphone14pro',\n\t},\n\tdevices: {\n\t\tdelimiter1: {\n\t\t\tcode: 'delimiter',\n\t\t\tlangCode: 'LANDING_PREVIEW_DEVICE_MOBILES',\n\t\t},\n\t\tiphone14pro: {\n\t\t\tname: 'iPhone 14 Pro',\n\t\t\tcode: 'iphone14pro',\n\t\t\tclassName: '--iphone-14-pro',\n\t\t\twidth: 393,\n\t\t\theight: 852\n\t\t},\n\t\tiPhoneXR: {\n\t\t\tname: 'iPhone XR',\n\t\t\tcode: 'iPhoneXR',\n\t\t\tclassName: '--iphone-xr',\n\t\t\twidth: 414,\n\t\t\theight: 896\n\t\t},\n\t\tiPhoneSE: {\n\t\t\tname: 'iPhone SE',\n\t\t\tcode: 'iPhoneSE',\n\t\t\tclassName: '--iphone-se',\n\t\t\twidth: 375,\n\t\t\theight: 667\n\t\t},\n\t\tSamsungGalaxyNote10: {\n\t\t\tname: 'Samsung Galaxy Note10',\n\t\t\tcode: 'SamsungGalaxyNote10',\n\t\t\tclassName: '--samsung-galaxy-note10',\n\t\t\twidth: 412,\n\t\t\theight: 896\n\t\t},\n\t\tSamsungGalaxyS8: {\n\t\t\tname: 'Samsung Galaxy S8+',\n\t\t\tcode: 'SamsungGalaxyS8',\n\t\t\tclassName: '--samsung-galaxy-s8-plus',\n\t\t\twidth: 360,\n\t\t\theight: 740\n\t\t},\n\t\tGooglePixel4: {\n\t\t\tname: 'Google Pixel 4',\n\t\t\tcode: 'GooglePixel4',\n\t\t\tclassName: '--google-pixel-4',\n\t\t\twidth: 353,\n\t\t\theight: 745\n\t\t},\n\t\tdelimiter2: {\n\t\t\tcode: 'delimiter',\n\t\t\tlangCode: 'LANDING_PREVIEW_DEVICE_TABLETS',\n\t\t},\n\t\tiPad: {\n\t\t\tname: 'iPad',\n\t\t\tcode: 'iPad',\n\t\t\tclassName: '--ipad',\n\t\t\twidth: 810,\n\t\t\theight: 1080\n\t\t},\n\t\tiPadMini: {\n\t\t\tname: 'iPad Mini',\n\t\t\tcode: 'iPadMini',\n\t\t\tclassName: '--ipad-mini',\n\t\t\twidth: 744,\n\t\t\theight: 1133\n\t\t},\n\t\tSamsungGalaxyTabS8: {\n\t\t\tname: 'Samsung Galaxy Tab S8',\n\t\t\tcode: 'SamsungGalaxyTabS8',\n\t\t\tclassName: '--samsung-galaxy-tab-s8',\n\t\t\twidth: 800,\n\t\t\theight: 1280\n\t\t},\n\t}\n}\n","import { Dom, Tag } from 'main.core';\nimport { MenuItem, MenuManager } from 'main.popup';\n\nimport { DeviceItem } from './device.data';\n\ntype Options = {\n\tframeUrl: string,\n\tclickHandler: () => {},\n\tmessages: {[type: string]: string},\n};\n\nclass DeviceUI\n{\n\tstatic messages: {[type: string]: string};\n\n\t/**\n\t * Returns Landing Preview Block above the screen.\n\t *\n\t * @param {Options} options Preview options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getPreview(options: Options): HTMLElement\n\t{\n\t\tif (options.messages)\n\t\t{\n\t\t\tDeviceUI.messages = options.messages;\n\t\t}\n\n\t\tif (!localStorage.getItem('deviceOrientation'))\n\t\t{\n\t\t\tlocalStorage.setItem('deviceOrientation', 'portrait');\n\t\t}\n\n\t\tconst rotateClick = () => {\n\t\t\tif (localStorage.getItem('deviceOrientation') === 'portrait')\n\t\t\t{\n\t\t\t\tlocalStorage.setItem('deviceOrientation', 'landscape');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocalStorage.setItem('deviceOrientation', 'portrait');\n\t\t\t}\n\n\t\t\tDom.style(layout.wrapper, 'width', `${layout.wrapper.offsetHeight}px`);\n\t\t\tDom.style(layout.wrapper, 'height', `${layout.wrapper.offsetWidth}px`);\n\t\t\tDom.style(layout.frame, 'width', `${layout.frame.offsetHeight}px`);\n\t\t\tDom.style(layout.frame, 'height', `${layout.frame.offsetWidth}px`);\n\t\t\tlayout.wrapper.querySelector('[data-role=\"device-orientation\"]').innerHTML = localStorage.getItem('deviceOrientation');\n\t\t};\n\n\t\tconst hidden = localStorage.getItem('deviceHidden') === 'true';\n\n\t\tconst layout = {\n\t\t\twrapper: null,\n\t\t\trotate: Tag.render`<div class=\"landing-device-rotate\" onclick=\"${rotateClick}\" data-role=\"landing-device-rotate\"></div>`,\n\t\t\tframe: Tag.render`<iframe data-role=\"landing-device-preview-iframe\" src=\"${options.frameUrl}\"></iframe>`,\n\t\t};\n\n\t\tlayout.wrapper = Tag.render`\n\t\t\t<div class=\"landing-device-wrapper${hidden ? ' landing-device-wrapper-hidden' : ''}\">\n\t\t\t\t<div class=\"landing-device-name\" onclick=\"${options.clickHandler}\">\n\t\t\t\t\t<span data-role=\"device-name\">Device</span>\n\t\t\t\t\t<span data-role=\"device-orientation\" class=\"landing-device-orientation\">Orientation</span>\n\t\t\t\t</div>\n\t\t\t\t${layout.rotate}\n\t\t\t\t<div class=\"landing-device-preview\" data-role=\"landing-device-preview\">\n\t\t\t\t\t${layout.frame}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn layout.wrapper;\n\t}\n\n\t/**\n\t * Creates and open menu with list of devices.\n\t *\n\t * @param {HTMLElement} bindElement HTML element to bind position of menu.\n\t * @param {Array<DeviceItem>} devices List of devices.\n\t * @param {(device: DeviceItem) => {}} clickHandler Invokes when user clicked on the menu item.\n\t */\n\tstatic openDeviceMenu(bindElement: HTMLElement, devices: Array<DeviceItem>, clickHandler: (device: DeviceItem) => {})\n\t{\n\t\tconst menuId = 'device_selector';\n\t\tlet menu = MenuManager.getMenuById(menuId);\n\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItems = [];\n\n\t\tdevices.forEach((device) => {\n\t\t\tif (device.code === 'delimiter')\n\t\t\t{\n\t\t\t\tmenuItems.push(new MenuItem({\n\t\t\t\t\tdelimiter: true,\n\t\t\t\t\ttext: device.langCode ? DeviceUI.messages[device.langCode] : '',\n\t\t\t\t}));\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tmenuItems.push(new MenuItem({\n\t\t\t\tid: device.className,\n\t\t\t\thtml: String(device.name),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tMenuManager.getMenuById(menuId).close();\n\t\t\t\t\tclickHandler(device);\n\t\t\t\t},\n\t\t\t}));\n\t\t});\n\n\t\tconst bindNode = bindElement.parentNode || document.body;\n\n\t\tmenu = MenuManager.create({\n\t\t\tid: menuId,\n\t\t\tbindElement: bindNode,\n\t\t\tclassName: 'landing-ui-block-actions-popup',\n\t\t\titems: menuItems,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 40,\n\t\t\tminWidth: bindNode.offsetWidth,\n\t\t\tanimation: 'fading-slide',\n\t\t\tevents: {\n\t\t\t\tonPopupShow: () => {\n\t\t\t\t\tmenu.getPopupWindow().setMinWidth(bindNode.offsetWidth);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tmenu.show();\n\t}\n}\n\nexport default DeviceUI;\n","import { Dom, Tag, Event } from 'main.core';\nimport { Loc } from '../controls/controls.loc';\n\nimport { Devices, DeviceItem } from './device.data';\nimport DeviceUI from './device.ui';\n\ntype Options = {\n\teditorFrameWrapper: HTMLElement,\n\tframeUrl: string,\n\tmessages: {[type: string]: string},\n};\n\nexport class Device\n{\n\t#options;\n\t#frameUrl: string;\n\t#editorFrameWrapper: HTMLElement;\n\t#previewElement: HTMLDivElement;\n\t#previewWindow;// window object of iframe\n\t#previewLoader: HTMLDivElement;\n\t#currentDevice: ?DeviceItem = null;\n\t#editorEnabled: boolean = false;\n\t#pendingReload: boolean = false;\n\t#commandsToRefresh = [\n\t\t'Landing::upBlock',\n\t\t'Landing::downBlock',\n\t\t'Landing::showBlock',\n\t\t'Landing::hideBlock',\n\t\t'Landing::markDeletedBlock',\n\t\t'Landing::addBlock',\n\t\t'Landing::copyBlock',\n\t\t'Landing::moveBlock',\n\t\t'Block::changeNodeName',\n\t\t'Block::updateContent',\n\t\t'Block::getContent',\n\t\t'Landing\\\\Block::addCard',\n\t\t'Landing\\\\Block::cloneCard',\n\t\t'Landing\\\\Block::removeCard',\n\t\t'Landing\\\\Block::updateNodes',\n\t\t'Landing\\\\Block::updateStyles',\n\t\t'Landing\\\\Block::saveForm', // fake-action\n\t];\n\ttarget: HTMLElement;\n\n\t/**\n\t * Device constructor.\n\t *\n\t * @param {Options} options Constructor options.\n\t */\n\tconstructor(options: Options)\n\t{\n\t\tthis.target = options.target || document.body;\n\t\tthis.#frameUrl = options.frameUrl;\n\t\tthis.#editorFrameWrapper = options.editorFrameWrapper;\n\t\tthis.#options = options;\n\t\tthis.#registerListeners(options);\n\t\tthis.#buildPreview(options);\n\n\t\tthis.#showPreview();\n\t\tthis.#setDevice(this.#resolveDeviceByType('mobile'));\n\t}\n\n\t/**\n\t * Registers Handlers you need.\n\t *\n\t * @param {Options} options Constructor options.\n\t */\n\t#registerListeners(options: Options)\n\t{\n\t\t// when user click different window size\n\t\tBX.addCustomEvent('BX.Landing.Main:editorSizeChange', (deviceType: string) =>\n\t\t{\n\t\t\tthis.#setDevice(this.#resolveDeviceByType(deviceType));\n\t\t});\n\n\t\t// listen messages from editor frame\n\t\twindow.addEventListener('message', event => {\n\t\t\tconst data = event.data || {};\n\n\t\t\tif (data.action === 'editorenable')\n\t\t\t{\n\t\t\t\tif (!!data.payload.enable)\n\t\t\t\t{\n\t\t\t\t\tthis.#editorEnabled = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.#pendingReload)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#reloadPreviewWindow();\n\t\t\t\t\t}\n\t\t\t\t\tthis.#editorEnabled = false;\n\t\t\t\t\tthis.#pendingReload = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (data.action === 'backendaction')\n\t\t\t{\n\t\t\t\tthis.#backendAction(data.payload);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Invokes when backend request occurred.\n\t *\n\t * @param {{action: string, data: Object}} payload Payload data.\n\t */\n\t#backendAction(payload: {action: string, data: Object})\n\t{\n\t\tif (this.#commandsToRefresh.includes(payload.action))\n\t\t{\n\t\t\tif (this.#editorEnabled)\n\t\t\t{\n\t\t\t\tthis.#pendingReload = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet blockId = null;\n\n\t\t\t\tif (payload.data?.block)\n\t\t\t\t{\n\t\t\t\t\tblockId = payload.data?.block;\n\t\t\t\t}\n\n\t\t\t\tif (payload.data?.updateNodes?.data?.block)\n\t\t\t\t{\n\t\t\t\t\tblockId = payload.data?.updateNodes?.data?.block;\n\t\t\t\t}\n\n\t\t\t\tthis.#reloadPreviewWindow(blockId);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reloads preview window.\n\t * @param {number} blockId\n\t */\n\t#reloadPreviewWindow(blockId: ?number)\n\t{\n\t\tif (this.#previewWindow)\n\t\t{\n\t\t\tconst blockIdPrefix = 'editor';\n\t\t\tconst timestamp = Date.now();\n\n\t\t\tthis.#previewWindow.location.href = this.#frameUrl + '?ts=' + timestamp + '&scrollTo=' + blockIdPrefix + blockId;\n\t\t}\n\t}\n\n\t/**\n\t * Scrolls preview window for some percent.\n\t *\n\t * @param {number} topInPercent Percent from top to scroll.\n\t */\n\t#scrollDevice(topInPercent: number)\n\t{\n\t\tif (this.#previewWindow)\n\t\t{\n\t\t\tconst document = this.#previewWindow.document;\n\n\t\t\tconst scrollHeight = Math.max(\n\t\t\t\tdocument.body.scrollHeight, document.documentElement.scrollHeight,\n\t\t\t\tdocument.body.offsetHeight, document.documentElement.offsetHeight,\n\t\t\t\tdocument.body.clientHeight, document.documentElement.clientHeight\n\t\t\t);\n\n\t\t\tthis.#previewWindow.scroll(0, scrollHeight * topInPercent / 100);\n\t\t}\n\t}\n\n\t/**\n\t * Resolves and returns Device by its code.\n\t *\n\t * @param {string} deviceType Device type.\n\t * @return {DeviceItem}\n\t */\n\t#resolveDeviceByType(deviceType: string): DeviceItem\n\t{\n\t\tlet deviceCode = localStorage.getItem('deviceCode');\n\t\tif (deviceCode && Devices.devices[deviceCode])\n\t\t{\n\t\t\treturn Devices.devices[deviceCode];\n\t\t}\n\n\t\tdeviceCode = Devices.defaultDevice?.[deviceType];\n\t\tif (!deviceCode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn Devices.devices[deviceCode];\n\t}\n\n\t#getPreviewNode(): HTMLDivElement\n\t{\n\t\tif (!this.#previewLoader)\n\t\t{\n\t\t\tLoc.loadMessages(this.#options.messages);\n\n\t\t\tthis.#previewLoader = Tag.render`\n\t\t\t\t<div class=\"landing-device-loader\">\n\t\t\t\t\t<div class=\"landing-device-loader-icon\"></div>\n\t\t\t\t\t<div class=\"landing-device-loader-text\">${Loc.getMessage('LANDING_TPL_PREVIEW_LOADING')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#previewLoader;\n\t}\n\n\t#setPreview(target: HTMLElement)\n\t{\n\t\tif (!target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.append(this.#getPreviewNode(), target)\n\t}\n\n\t#removePreview()\n\t{\n\t\tDom.addClass(this.#getPreviewNode(), '--hide');\n\t\tEvent.bind(this.#getPreviewNode(), 'transitionend', () => {\n\t\t\tDom.remove(this.#getPreviewNode());\n\t\t});\n\t}\n\n\t/**\n\t * Sets new device.\n\t *\n\t * @param {DeviceItem|null} newDevice Device.\n\t */\n\t#setDevice(newDevice: ?DeviceItem)\n\t{\n\t\tif (!newDevice)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlocalStorage.setItem('deviceCode', newDevice.code);\n\n\t\t// remove old class within preview\n\t\tif (this.#currentDevice)\n\t\t{\n\t\t\tDom.removeClass(this.#previewElement, this.#currentDevice.className);\n\t\t\tthis.#previewElement.style.removeProperty(`top`);\n\t\t}\n\n\t\tthis.#currentDevice = newDevice;\n\t\tthis.#previewElement.querySelector('[data-role=\"device-name\"]').innerHTML = newDevice.name;\n\t\tthis.#previewElement.querySelector('[data-role=\"device-orientation\"]').innerHTML = localStorage.getItem('deviceOrientation');\n\t\tconst frame = this.#previewElement.querySelector('[data-role=\"landing-device-preview-iframe\"]');\n\t\tconst frameWrapper = this.#previewElement.querySelector('[data-role=\"landing-device-preview\"]');\n\n\t\tframe.onload = () => this.#removePreview();\n\n\t\t// scale for device\n\t\tif (frame\n\t\t\t&& frameWrapper\n\t\t\t&& this.#currentDevice.width\n\t\t\t&& this.#currentDevice.height)\n\t\t{\n\t\t\tconst scale = window.innerHeight / (this.#currentDevice.height + 300);\n\t\t\tconst padding = parseInt(window.getComputedStyle(frameWrapper).padding);\n\n\t\t\tlet param1 = this.#currentDevice.width;\n\t\t\tlet param2 = this.#currentDevice.height;\n\n\t\t\tif (localStorage.getItem('deviceOrientation') === 'landscape')\n\t\t\t{\n\t\t\t\tparam1 = this.#currentDevice.height;\n\t\t\t\tparam2 = this.#currentDevice.width;\n\t\t\t}\n\n\t\t\tframe.style.setProperty(`width`, `${param1}px`);\n\t\t\tframe.style.setProperty(`height`, `${param2}px`);\n\t\t\tframeWrapper.style.setProperty(`transform`, `scale(${scale})`);\n\t\t\tthis.#previewElement.style.setProperty(`width`, `${(param1 + (padding * 2)) * scale}px`);\n\t\t\tthis.#previewElement.style.setProperty(`height`, `${(param2 + (padding * 2)) * scale}px`);\n\t\t}\n\n\t\tDom.addClass(this.#previewElement, this.#currentDevice.className);\n\t}\n\n\t/**\n\t * Gets top scroll of editor window and adjusts device preview window.\n\t */\n\t#adjustPreviewScroll()\n\t{\n\t\tconst documentEditorFrame = this.#editorFrameWrapper.querySelector('iframe').contentWindow.document;\n\t\tconst scrollHeight = Math.max(\n\t\t\tdocumentEditorFrame.body.scrollHeight, documentEditorFrame.documentElement.scrollHeight,\n\t\t\tdocumentEditorFrame.body.offsetHeight, documentEditorFrame.documentElement.offsetHeight,\n\t\t\tdocumentEditorFrame.body.clientHeight, documentEditorFrame.documentElement.clientHeight\n\t\t);\n\t\tconst scrollTop = documentEditorFrame.documentElement.scrollTop || documentEditorFrame.body.scrollTop;\n\n\t\tthis.#scrollDevice(scrollTop / scrollHeight * 100);\n\t}\n\n\t/**\n\t * Creates Preview Popup.\n\t *\n\t * @param {Options} options Preview options.\n\t */\n\t#buildPreview(options: Options)\n\t{\n\t\tif (!this.#previewElement)\n\t\t{\n\t\t\tthis.#previewElement = DeviceUI.getPreview({\n\t\t\t\tframeUrl: options.frameUrl,\n\t\t\t\tclickHandler: this.#onClickDeviceSelector.bind(this),\n\t\t\t\tmessages: options.messages,\n\t\t\t});\n\t\t\tDom.hide(this.#previewElement);\n\t\t\tthis.target.appendChild(this.#previewElement);\n\n\t\t\t// #170065\n\t\t\t// this.#previewElement.querySelector('iframe').contentWindow.addEventListener('load', () => {\n\t\t\tif (!this.#previewWindow)\n\t\t\t{\n\t\t\t\tthis.#previewWindow = this.#previewElement.querySelector('iframe').contentWindow;\n\t\t\t\tconst previewDocument = this.#previewElement.querySelector('iframe').contentWindow.document\n\t\t\t\tDom.removeClass(previewDocument.querySelector('html'), 'bx-no-touch');\n\t\t\t\tDom.addClass(previewDocument.querySelector('html'), 'bx-touch');\n\t\t\t}\n\t\t\tthis.#adjustPreviewScroll();\n\t\t\t// });\n\t\t}\n\t}\n\n\t/**\n\t * Invokes by clicking on device selector.\n\t */\n\t#onClickDeviceSelector()\n\t{\n\t\tDeviceUI.openDeviceMenu(\n\t\t\tthis.#previewElement.querySelector('[data-role=\"device-name\"]'),\n\t\t\tObject.values(Devices.devices),\n\t\t\tthis.#setDevice.bind(this),\n\t\t);\n\t}\n\n\t/**\n\t * Creates and Shows Preview Popup.\n\t */\n\t#showPreview()\n\t{\n\t\tDom.show(this.#previewElement);\n\t\tthis.#setPreview(this.#previewElement);\n\t}\n\n\t/**\n\t * Hides Preview Popup.\n\t */\n\t#hidePreview()\n\t{\n\t\tDom.hide(this.#previewElement);\n\t}\n}\n","import { Type } from 'main.core';\n\ntype ActionOptions = {\n\tiframe: HTMLIFrameElement,\n};\n\nexport class Action\n{\n\t#iframe: HTMLIFrameElement;\n\n\tconstructor(options: ActionOptions)\n\t{\n\t\tthis.#iframe = options.iframe;\n\n\t\tif (!Type.isDomNode(this.#iframe))\n\t\t{\n\t\t\tthrow new Error(\"Missed 'frame' option as iFrame Element.\");\n\t\t}\n\t}\n\n\t/**\n\t * Sends action with payload to child window.\n\t *\n\t * @param {string} action Command to internal iframe.\n\t * @param {Object} payload Command's payload.\n\t */\n\t#postInternalCommand(action, payload)\n\t{\n\t\tthis.#iframe.contentWindow.postMessage({action, payload}, window.location.origin);\n\t}\n\n\t/**\n\t * Handles on Designer click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonDesignerBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onDesignerBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Style Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonStyleBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onStyleBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Edit Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonEditBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onEditBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Down Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonSortDownBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onSortDownBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Up Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonSortUpBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onSortUpBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Remove Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonRemoveBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onRemoveBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Change State Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonChangeStateBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onChangeStateBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Cut Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonCutBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onCutBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Copy Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonCopyBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onCopyBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Paste Block click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonPasteBlockClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onPasteBlockClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Feedback click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonFeedbackClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onFeedbackClick', {blockId});\n\t}\n\n\t/**\n\t * Handles on Save In Library click.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tonSaveInLibraryClick(blockId: number)\n\t{\n\t\tthis.#postInternalCommand('onSaveInLibraryClick', {blockId});\n\t}\n\n\t/**\n\t * Hide opened editor panel.\n\t */\n\tonHideEditorPanel()\n\t{\n\t\tthis.#postInternalCommand('onHideEditorPanel');\n\t}\n}\n","import { Event, Tag } from 'main.core';\nimport { Menu, MenuItem, MenuManager } from 'main.popup';\n\nimport { Loc } from './controls.loc';\n\ntype LeftContainerOptions = {\n\tdesignerBlockClick: ?() => {},\n\tstyleBlockClick: ?() => {},\n\teditBlockClick: ?() => {},\n};\n\ntype RightContainerOptions = {\n\tblockId: number,\n\tstate: boolean,\n\tsortDownBlockClick: ?() => {},\n\tsortUpBlockClick: ?() => {},\n\tremoveBlockClick: ?() => {},\n\tonOpenAdditionalMenu: ?() => {},\n\tchangeStateClick: ?() => {},\n\tcutClick: ?() => {},\n\tcopyClick: ?() => {},\n\tpasteClick: ?() => {},\n\tfeedbackClick: ?() => {},\n\tsaveInLibrary: ?() => {},\n};\n\ntype AdditionalActions = {\n\tstate: boolean,\n\tonOpenAdditionalMenu: ?() => {},\n\tchangeStateClick: ?() => {},\n\tcutClick: ?() => {},\n\tcopyClick: ?() => {},\n\tpasteClick: ?() => {},\n\tfeedbackClick: ?() => {},\n\tsaveInLibrary: ?() => {},\n};\n\nexport class UI\n{\n\tstatic pendingMenuItems = {};\n\n\t/**\n\t * Till Menu for this block not show, sets predefined prop value for menu item.\n\t *\n\t * @param {number} blockId\n\t * @param {string} itemCode\n\t * @param {string} itemProp\n\t * @param {mixed} value\n\t */\n\tstatic setPendingMenuItemValue(blockId: number, itemCode: string, itemProp: string, value)\n\t{\n\t\tif (!UI.pendingMenuItems[blockId])\n\t\t{\n\t\t\tUI.pendingMenuItems[blockId] = {};\n\t\t}\n\t\tif (!UI.pendingMenuItems[blockId][itemCode])\n\t\t{\n\t\t\tUI.pendingMenuItems[blockId][itemCode] = {};\n\t\t}\n\n\t\tUI.pendingMenuItems[blockId][itemCode][itemProp] = value;\n\t}\n\n\t/**\n\t * Returns predefined prop value for menu item (if exists).\n\t *\n\t * @param {number} blockId\n\t * @param {string} itemCode\n\t * @param {string} itemProp\n\t */\n\tstatic getPendingMenuItemValue(blockId: number, itemCode: string, itemProp: string)\n\t{\n\t\tif (UI.pendingMenuItems[blockId] && UI.pendingMenuItems[blockId][itemCode])\n\t\t{\n\t\t\treturn UI.pendingMenuItems[blockId][itemCode][itemProp] || null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns Designer Button.\n\t *\n\t * @param {() => {}} onClick Click handler.\n\t * @return {HTMLButtonElement}\n\t */\n\tstatic getDesignerBlockButton(onClick: ?() => {}): HTMLButtonElement\n\t{\n\t\tconst title = Loc.getMessage('LANDING_TPL_EXT_BUTTON_DESIGNER_BLOCK');\n\t\tconst button = Tag.render`\n\t\t\t<button class=\"landing-ui-button landing-ui-button-action --separate${onClick ? '' : ' landing-ui-disabled'}\" type=\"button\" title=\"${title}\">\n\t\t\t\t<span class=\"landing-ui-button-text\">${title}</span>\n\t\t\t</button>\n\t\t`;\n\n\t\tif (onClick)\n\t\t{\n\t\t\tEvent.bind(button, 'click', onClick);\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Returns Style Block Button.\n\t *\n\t * @param {() => {}} onClick Click handler.\n\t * @return {HTMLButtonElement}\n\t */\n\tstatic getStyleBlockButton(onClick: ?() => {}): HTMLButtonElement\n\t{\n\t\tconst label = Loc.getMessage('LANDING_TPL_EXT_BUTTON_STYLE_BLOCK');\n\t\tconst title = Loc.getMessage('LANDING_TPL_EXT_BUTTON_STYLE_BLOCK_TITLE');\n\t\tconst button = Tag.render`\n\t\t\t<button class=\"landing-ui-button landing-ui-button-action --separate${onClick ? '' : ' landing-ui-disabled'}\" type=\"button\" title=\"${title}\">\n\t\t\t\t<span class=\"landing-ui-button-text\">${label}</span>\n\t\t\t</button>\n\t\t`;\n\n\t\tif (onClick)\n\t\t{\n\t\t\tEvent.bind(button, 'click', onClick);\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Returns Edit Block Button.\n\t *\n\t * @param {() => {}} onClick Click handler.\n\t * @return {HTMLButtonElement}\n\t */\n\tstatic getEditBlockButton(onClick: ?() => {}): HTMLButtonElement\n\t{\n\t\t//data-id=\"content\"\n\t\tconst label = Loc.getMessage('LANDING_TPL_EXT_BUTTON_EDIT_BLOCK');\n\t\tconst title = Loc.getMessage('LANDING_TPL_EXT_BUTTON_EDIT_BLOCK_TITLE');\n\t\tconst button = Tag.render`\n\t\t\t<button class=\"landing-ui-button landing-ui-button-action --separate${onClick ? '' : ' landing-ui-disabled'}\" type=\"button\" title=\"${title}\" data-id=\"content\">\n\t\t\t\t<span class=\"landing-ui-button-text\">${label}</span>\n\t\t\t</button>\n\t\t`;\n\n\t\tif (onClick)\n\t\t{\n\t\t\tEvent.bind(button, 'click', onClick);\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Returns left container for block's actions.\n\t *\n\t * @param {LeftContainerOptions} options Options for left container.\n\t * @return {HTMLDivElement}\n\t */\n\tstatic getLeftContainer(options: LeftContainerOptions): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"landing-ui-external-left-container\">\n\t\t\t\t<div class=\"landing-ui-external-left-top-hr\"></div>\n\t\t\t\t<div class=\"landing-ui-external-body\">\n\t\t\t\t\t<div class=\"landing-ui-external-panel\">\n\t\t\t\t\t\t${UI.getDesignerBlockButton(options.designerBlockClick)}\n\t\t\t\t\t\t${UI.getStyleBlockButton(options.styleBlockClick)}\n\t\t\t\t\t\t${UI.getEditBlockButton(options.editBlockClick)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"landing-ui-external-left-bottom-hr\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns Sort Down Button.\n\t *\n\t * @param {() => {}} onClick Click handler.\n\t * @return {HTMLButtonElement}\n\t */\n\tstatic getSortDownBlockButton(onClick: ?() => {}): HTMLButtonElement\n\t{\n\t\tconst title = Loc.getMessage('LANDING_TPL_EXT_BUTTON_DOWN_BLOCK');\n\t\tconst button = Tag.render`\n\t\t\t<button class=\"landing-ui-button landing-ui-button-action${onClick ? '' : ' landing-ui-disabled'}\" type=\"button\" data-id=\"down\" title=\"${title}\"><span class=\"landing-ui-button-text\">&nbsp;</span></button>\n\t\t`;\n\n\t\tif (onClick)\n\t\t{\n\t\t\tEvent.bind(button, 'click', onClick);\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Returns Sort Up Button.\n\t *\n\t * @param {() => {}} onClick Click handler.\n\t * @return {HTMLButtonElement}\n\t */\n\tstatic getSortUpBlockButton(onClick: ?() => {}): HTMLButtonElement\n\t{\n\t\tconst title = Loc.getMessage('LANDING_TPL_EXT_BUTTON_UP_BLOCK');\n\t\tconst button = Tag.render`\n\t\t\t<button class=\"landing-ui-button landing-ui-button-action${onClick ? '' : ' landing-ui-disabled'}\" type=\"button\" data-id=\"up\" title=\"${title}\"><span class=\"landing-ui-button-text\">&nbsp;</span></button>\n\t\t`;\n\n\t\tif (onClick)\n\t\t{\n\t\t\tEvent.bind(button, 'click', onClick);\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Returns Additional Items Menu for Block.\n\t *\n\t * @param {number} blockId Block id.\n\t * @return {Menu}\n\t */\n\tstatic getBlockAdditionalMenu(blockId: number): Menu\n\t{\n\t\treturn MenuManager.getMenuById('block_actions_' + blockId);\n\t}\n\n\t/**\n\t * Closes Additional Items Menu for Block.\n\t *\n\t * @param {number} blockId Block id.\n\t */\n\tstatic closeBlockAdditionalMenu(blockId: number)\n\t{\n\t\tconst menu = UI.getBlockAdditionalMenu(blockId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\t/**\n\t * Change state for Additional Menu Item 'Activate'.\n\t *\n\t * @param {number} blockId Block id.\n\t * @param {boolean} state State.\n\t */\n\tstatic changeStateMenuItem(blockId: number, state: boolean)\n\t{\n\t\tconst menu = UI.getBlockAdditionalMenu(blockId);\n\t\tconst title = Loc.getMessage(\n\t\t\t!state\n\t\t\t\t? 'LANDING_TPL_EXT_BUTTON_ACTIONS_SHOW'\n\t\t\t\t: 'LANDING_TPL_EXT_BUTTON_ACTIONS_HIDE'\n\t\t);\n\n\t\tif (menu)\n\t\t{\n\t\t\tBX.Landing.Utils.setTextContent(menu.getMenuItem('show_hide').getLayout()['text'], title);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tUI.setPendingMenuItemValue(blockId, 'show_hide', 'state', state);\n\t\t}\n\t}\n\n\t/**\n\t * Enables/disables paste-item.\n\t *\n\t * @param {number} blockId Block id.\n\t * @param {boolean} enablePaste Flag.\n\t */\n\tstatic changePasteMenuItem(blockId: number, enablePaste: boolean)\n\t{\n\t\tconst menu = UI.getBlockAdditionalMenu(blockId);\n\t\tif (menu)\n\t\t{\n\t\t\tconst item = menu.getMenuItem('paste');\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tif (enablePaste)\n\t\t\t\t{\n\t\t\t\t\titem.enable();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\titem.disable();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tUI.setPendingMenuItemValue(blockId, 'paste', 'disabled', !enablePaste);\n\t\t}\n\t}\n\n\t/**\n\t * Returns List of Actions for Block.\n\t *\n\t * @param {number} blockId Block id.\n\t * @param {AdditionalActions} actions Additional actions for Block.\n\t * @return {HTMLButtonElement}\n\t */\n\tstatic getActionsList(blockId: number, actions: AdditionalActions): HTMLButtonElement\n\t{\n\t\tconst label = Loc.getMessage('LANDING_TPL_EXT_BUTTON_ACTIONS_BLOCK');\n\t\tconst title = Loc.getMessage('LANDING_TPL_EXT_BUTTON_ACTIONS_BLOCK_TITLE');\n\n\t\tconst actionButton = Tag.render`\n\t\t\t<button class=\"landing-ui-button landing-ui-button-action\" type=\"button\" data-id=\"actions\" title=\"${title}\">\n\t\t\t\t<span class=\"landing-ui-button-text\">${label}</span>\n\t\t\t</button>\n\t\t`;\n\n\t\t// when click is occurred open exists menu or create new one\n\t\tEvent.bind(actionButton, 'click', (event) => {\n\n\t\t\tif (actions.onOpenAdditionalMenu)\n\t\t\t{\n\t\t\t\tactions.onOpenAdditionalMenu(blockId);\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\n\t\t\tconst menu = UI.getBlockAdditionalMenu(blockId);\n\t\t\tif (menu)\n\t\t\t{\n\t\t\t\tmenu.show();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMenuManager.create({\n\t\t\t\tid: 'block_actions_' + blockId,\n\t\t\t\tbindElement: actionButton,\n\t\t\t\tclassName: 'landing-ui-block-actions-popup',\n\t\t\t\tangle: { position: 'top', offset: 95 },\n\t\t\t\toffsetTop: -6,\n\t\t\t\toffsetLeft: -26,\n\t\t\t\titems: [\n\t\t\t\t\tnew MenuItem({\n\t\t\t\t\t\tid: 'show_hide',\n\t\t\t\t\t\tdisabled: !actions.changeStateClick,\n\t\t\t\t\t\ttext: Loc.getMessage(\n\t\t\t\t\t\t\t(actions.state || UI.getPendingMenuItemValue(blockId, 'show_hide', 'state'))\n\t\t\t\t\t\t\t\t? 'LANDING_TPL_EXT_BUTTON_ACTIONS_HIDE'\n\t\t\t\t\t\t\t\t: 'LANDING_TPL_EXT_BUTTON_ACTIONS_SHOW'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tactions.changeStateClick();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew MenuItem({\n\t\t\t\t\t\tid: 'cut',\n\t\t\t\t\t\tdisabled: !actions.cutClick,\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_TPL_EXT_BUTTON_ACTIONS_CUT'),\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tactions.cutClick();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew MenuItem({\n\t\t\t\t\t\tid: 'copy',\n\t\t\t\t\t\tdisabled: !actions.copyClick,\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_TPL_EXT_BUTTON_ACTIONS_COPY'),\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tactions.copyClick();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew MenuItem({\n\t\t\t\t\t\tid: 'paste',\n\t\t\t\t\t\tdisabled: !actions.pasteClick || UI.getPendingMenuItemValue(blockId, 'paste', 'disabled'),\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_TPL_EXT_BUTTON_ACTIONS_PASTE'),\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tactions.pasteClick();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew MenuItem({\n\t\t\t\t\t\tid: 'feedback',\n\t\t\t\t\t\tdisabled: !actions.feedbackClick,\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_TPL_EXT_BUTTON_ACTIONS_FEEDBACK'),\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tactions.feedbackClick();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tactions.saveInLibrary\n\t\t\t\t\t\t? new MenuItem({ delimiter: true })\n\t\t\t\t\t\t: null,\n\t\t\t\t\tnew MenuItem({\n\t\t\t\t\t\tid: 'save_in_library',\n\t\t\t\t\t\tdisabled: !actions.saveInLibrary,\n\t\t\t\t\t\ttext: Loc.getMessage('LANDING_TPL_EXT_BUTTON_ACTIONS_SAVE_IN_LIBRARY'),\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tactions.saveInLibrary();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}).show();\n\t\t});\n\n\t\treturn actionButton;\n\t}\n\n\t/**\n\t * Returns Remove Button.\n\t *\n\t * @param {() => {}} onClick Click handler.\n\t * @return {HTMLButtonElement}\n\t */\n\tstatic getRemoveBlockButton(onClick: ?() => {}): HTMLButtonElement\n\t{\n\t\tconst title = Loc.getMessage('LANDING_TPL_EXT_BUTTON_REMOVE_BLOCK');\n\t\tconst button = Tag.render`\n\t\t\t<button class=\"landing-ui-button landing-ui-button-action${onClick ? '' : ' landing-ui-disabled'}\" type=\"button\" data-id=\"remove\" title=\"${title}\"><span class=\"landing-ui-button-text\">&nbsp;</span></button>\n\t\t`;\n\n\t\tif (onClick)\n\t\t{\n\t\t\tEvent.bind(button, 'click', onClick);\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Returns right container for block's actions.\n\t *\n\t * @param {RightContainerOptions} options Options for right container.\n\t * @return {HTMLDivElement}\n\t */\n\tstatic getRightContainer(options: RightContainerOptions): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"landing-ui-external-right-container\">\n\t\t\t\t<div class=\"landing-ui-external-right-top-hr\"></div>\n\t\t\t\t<div class=\"landing-ui-external-body\">\n\t\t\t\t\t<div class=\"landing-ui-external-panel\">\n\t\t\t\t\t\t${UI.getSortDownBlockButton(options.sortDownBlockClick)}\n\t\t\t\t\t\t${UI.getSortUpBlockButton(options.sortUpBlockClick)}\n\t\t\t\t\t\t${UI.getActionsList(options.blockId, options)}\n\t\t\t\t\t\t${UI.getRemoveBlockButton(options.removeBlockClick)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"landing-ui-external-right-bottom-hr\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { Dom, Type } from 'main.core';\n\nimport { Action } from './controls.action';\nimport { Loc } from './controls.loc';\nimport { UI } from './controls.ui';\n\ntype Block = {\n\tid: number,\n\tstate: boolean,\n\tpermissions: {\n\t\tallowDesignBlock: boolean,\n\t\tallowModifyStyles: boolean,\n\t\tallowEditContent: boolean,\n\t\tallowSorting: boolean,\n\t\tallowRemove: boolean,\n\t\tallowChangeState: boolean,\n\t\tallowPaste: boolean,\n\t\tallowSaveInLibrary: boolean,\n\t},\n\tleftContainer?: HTMLElement,\n\trightContainer?: HTMLElement,\n};\n\ntype ExternalControlsOptions = {\n\tcontainer: HTMLElement,\n\tiframeWrapper: HTMLElement,\n\tmessages: {[type: string]: string},\n};\n\nexport class ExternalControls\n{\n\n\t#action: Action;\n\t#externalBlocks: Map;\n\t#container: HTMLElement;\n\t#iframeWrapper: HTMLElement;\n\t#currentOpenBlockId: ?number;\n\t#currentOpenMenuBlock: ?number;\n\n\tconstructor(options: ExternalControlsOptions)\n\t{\n\t\toptions = options || {};\n\n\t\tthis.#container = options.container;\n\t\tthis.#iframeWrapper = options.iframeWrapper;\n\n\t\tif (!Type.isDomNode(this.#container))\n\t\t{\n\t\t\tthrow new Error(\"Missed 'container' option as Dom Node.\");\n\t\t}\n\t\tif (!Type.isDomNode(this.#iframeWrapper))\n\t\t{\n\t\t\tthrow new Error(\"Missed 'iframe' option as Dom Node.\");\n\t\t}\n\n\t\tthis.#externalBlocks = new Map();\n\t\tthis.#action = new Action({\n\t\t\tiframe: this.#iframeWrapper.querySelector('iframe'),\n\t\t});\n\n\t\tLoc.loadMessages(options.messages);\n\n\t\twindow.addEventListener('message', this.#listenChildFrame.bind(this));\n\n\t\tthis.#container.addEventListener('click', (event) => {\n\t\t\tthis.#action.onHideEditorPanel();\n\t\t});\n\n\t\twindow.addEventListener('storage', this.#onStorageChange.bind(this));\n\t}\n\n\t/**\n\t * Handler on listening child iframe commands.\n\t *\n\t * @param event\n\t */\n\t#listenChildFrame(event)\n\t{\n\t\tconst data = event.data || {};\n\n\t\tif (!data.payload)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.action === 'register')\n\t\t{\n\t\t\tthis.#registerBlocks(data.payload.blocks);\n\t\t}\n\t\telse if (data.action === 'showcontrols')\n\t\t{\n\t\t\tthis.#showControls(data.payload.blockId, data.payload.top, data.payload.height);\n\t\t}\n\t\telse if (data.action === 'changestate')\n\t\t{\n\t\t\tthis.#changeState(data.payload.blockId, data.payload.state);\n\t\t}\n\t\telse if (data.action === 'mode')\n\t\t{\n\t\t\tthis.#onChangeMode(data.payload);\n\t\t}\n\t\telse if (data.action === 'hideall')\n\t\t{\n\t\t\tthis.#hideAllControls();\n\t\t}\n\t\telse if (data.action === 'showblockcontrols')\n\t\t{\n\t\t\tthis.#hideAllControls();\n\t\t\tthis.#hideAndShowControls(data.payload.blockId);\n\t\t}\n\t}\n\n\t/**\n\t * Handler on listening Storage changing.\n\t */\n\t#onStorageChange()\n\t{\n\t\tconst blocks = this.#externalBlocks.values();\n\t\tconst allowPaste = !!window.localStorage.getItem('landingBlockId');\n\n\t\tfor (let i = 0, c = this.#externalBlocks.size; i < c; i++)\n\t\t{\n\t\t\tconst blockItem = blocks.next().value;\n\n\t\t\tUI.changePasteMenuItem(blockItem.id, allowPaste);\n\t\t\tthis.#updateBlock(\n\t\t\t\tblockItem.id,\n\t\t\t\t{...blockItem, permissions: {...blockItem.permissions, allowPaste}}\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Registers Block's controls for current page.\n\t *\n\t * @param {Array<Block>} blocks Array of Blocks.\n\t */\n\t#registerBlocks(blocks: Array<Block>)\n\t{\n\t\tblocks.map(block => {\n\n\t\t\tconst blockId = block.id;\n\n\t\t\t// left controls\n\t\t\tblock.leftContainer = UI.getLeftContainer({\n\t\t\t\tdesignerBlockClick: block.permissions.allowDesignBlock ? () => {\n\t\t\t\t\tthis.#action.onDesignerBlockClick(blockId);\n\t\t\t\t} : null,\n\t\t\t\tstyleBlockClick: block.permissions.allowModifyStyles ? () => {\n\t\t\t\t\tthis.#action.onStyleBlockClick(blockId);\n\t\t\t\t} : null,\n\t\t\t\teditBlockClick: block.permissions.allowEditContent ? () => {\n\t\t\t\t\tthis.#action.onEditBlockClick(blockId);\n\t\t\t\t} : null,\n\t\t\t});\n\n\t\t\t// right controls\n\t\t\tblock.rightContainer = UI.getRightContainer({\n\t\t\t\tblockId,\n\t\t\t\tstate: block.state,\n\t\t\t\tsortDownBlockClick: block.permissions.allowSorting ? () => {\n\t\t\t\t\tthis.#action.onSortDownBlockClick(blockId);\n\t\t\t\t\tthis.#hideAllControls();\n\t\t\t\t} : null,\n\t\t\t\tsortUpBlockClick: block.permissions.allowSorting ? () => {\n\t\t\t\t\tthis.#action.onSortUpBlockClick(blockId);\n\t\t\t\t\tthis.#hideAllControls();\n\t\t\t\t} : null,\n\t\t\t\tremoveBlockClick: block.permissions.allowRemove ? () => {\n\t\t\t\t\tthis.#action.onRemoveBlockClick(blockId);\n\t\t\t\t\tthis.#hideAllControls();\n\t\t\t\t}: null,\n\t\t\t\tonOpenAdditionalMenu: (blockId) => {\n\t\t\t\t\tthis.#currentOpenMenuBlock = blockId;\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.#action.onHideEditorPanel();\n\t\t\t\t\t}, 0);\n\t\t\t\t},\n\t\t\t\tchangeStateClick: block.permissions.allowChangeState ? () => {\n\t\t\t\t\tUI.closeBlockAdditionalMenu(blockId);\n\t\t\t\t\tthis.#action.onChangeStateBlockClick(blockId);\n\t\t\t\t\tthis.#hideAndShowControls(blockId);\n\t\t\t\t}: null,\n\t\t\t\tcutClick: block.permissions.allowRemove ? () => {\n\t\t\t\t\tthis.#action.onCutBlockClick(blockId);\n\t\t\t\t\tthis.#hideAllControls();\n\t\t\t\t}: null,\n\t\t\t\tcopyClick: () => {\n\t\t\t\t\tUI.closeBlockAdditionalMenu(blockId);\n\t\t\t\t\tthis.#action.onCopyBlockClick(blockId);\n\t\t\t\t\tthis.#hideAndShowControls(blockId);\n\t\t\t\t},\n\t\t\t\tpasteClick: () => {\n\t\t\t\t\tUI.closeBlockAdditionalMenu(blockId);\n\t\t\t\t\tthis.#action.onPasteBlockClick(blockId);\n\t\t\t\t\tthis.#hideAndShowControls(blockId);\n\t\t\t\t},\n\t\t\t\tfeedbackClick: () => {\n\t\t\t\t\tUI.closeBlockAdditionalMenu(blockId);\n\t\t\t\t\tthis.#action.onFeedbackClick(blockId);\n\t\t\t\t},\n\t\t\t\tsaveInLibrary: block.permissions.allowSaveInLibrary ? () => {\n\t\t\t\t\tUI.closeBlockAdditionalMenu(blockId);\n\t\t\t\t\tthis.#action.onSaveInLibraryClick(blockId);\n\t\t\t\t}: null,\n\t\t\t});\n\n\t\t\tDom.append(block.leftContainer, this.#container);\n\t\t\tDom.append(block.rightContainer, this.#container);\n\n\t\t\tDom.hide(block.leftContainer);\n\t\t\tDom.hide(block.rightContainer);\n\n\t\t\tthis.#externalBlocks.set(blockId, block);\n\t\t});\n\t}\n\n\t/**\n\t * Creates new block or takes it from Map.\n\t *\n\t * @param {number} blockId Block id.\n\t * @return {Block}\n\t */\n\t#getBlock(blockId: number): ?Block\n\t{\n\t\treturn this.#externalBlocks.get(parseInt(blockId));\n\t}\n\n\t/**\n\t * Updates Block.\n\t *\n\t * @param blockId Block id.\n\t * @param {Block} data New Block data.\n\t */\n\t#updateBlock(blockId: number, data: Block)\n\t{\n\t\tthis.#externalBlocks.set(parseInt(blockId), data);\n\t}\n\n\t/**\n\t * Changes state for the Block.\n\t *\n\t * @param {number} blockId Block id\n\t * @param state\n\t */\n\t#changeState(blockId: number, state: boolean)\n\t{\n\t\tconst block = this.#getBlock(blockId);\n\t\tif (block)\n\t\t{\n\t\t\tUI.changeStateMenuItem(blockId, state);\n\t\t\tthis.#updateBlock(blockId, {...block, state});\n\t\t}\n\t}\n\n\t/**\n\t * Hides all controls.\n\t */\n\t#hideAllControls()\n\t{\n\t\tif (this.#currentOpenBlockId)\n\t\t{\n\t\t\tconst blockItem = this.#externalBlocks.get(this.#currentOpenBlockId);\n\t\t\tDom.hide(blockItem.leftContainer);\n\t\t\tDom.hide(blockItem.rightContainer);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst blocks = this.#externalBlocks.values();\n\t\t\tfor (let i = 0, c = this.#externalBlocks.size; i < c; i++)\n\t\t\t{\n\t\t\t\tconst blockItem = blocks.next().value;\n\t\t\t\tDom.hide(blockItem.leftContainer);\n\t\t\t\tDom.hide(blockItem.rightContainer);\n\t\t\t}\n\t\t}\n\n\t\t// if some menu is opened, close it\n\t\tif (this.#currentOpenMenuBlock)\n\t\t{\n\t\t\tUI.closeBlockAdditionalMenu(this.#currentOpenMenuBlock);\n\t\t\tthis.#currentOpenMenuBlock = null;\n\t\t}\n\t}\n\n\t/**\n\t * Shows controls for block.\n\t *\n\t * @param {number} blockId Block's id.\n\t * @param {number} top Block's top position.\n\t * @param {number} height Block's height.\n\t */\n\t#showControls(blockId: number, top: number, height: number)\n\t{\n\t\tconst block = this.#getBlock(blockId);\n\n\t\tif (!block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst iframeRect = this.#iframeWrapper.getBoundingClientRect();\n\t\tthis.#hideAllControls();\n\t\tthis.#currentOpenBlockId = block.id;\n\t\tthis.#action.onHideEditorPanel();\n\t\ttop = parseInt(top);\n\n\t\t// adjust top and bottom borders\n\t\tif (top < 0 && height + top > 50)\n\t\t{\n\t\t\theight = height + top;\n\t\t\ttop = 0;\n\t\t\tDom.addClass(block.leftContainer, 'hide-top');\n\t\t\tDom.addClass(block.rightContainer, 'hide-top');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(block.leftContainer, 'hide-top');\n\t\t\tDom.removeClass(block.rightContainer, 'hide-top');\n\t\t}\n\n\t\tDom.show(block.leftContainer);\n\t\tDom.show(block.rightContainer);\n\n\t\t// adjust top and heights\n\t\tblock.leftContainer.style.width = iframeRect.left + 'px';\n\t\tblock.leftContainer.style.top = top + 'px';\n\t\tblock.leftContainer.style.height = height + 'px';\n\n\t\tblock.rightContainer.style.width = iframeRect.left + 'px';\n\t\tblock.rightContainer.style.left = iframeRect.left + iframeRect.width + 'px';\n\t\tblock.rightContainer.style.top = top + 'px';\n\t\tblock.rightContainer.style.height = height + 'px';\n\t}\n\n\t/**\n\t * Hides and shows controls (blink) for specific Block.\n\t *\n\t * @param {blockId} blockId Block id.\n\t */\n\t#hideAndShowControls(blockId: number)\n\t{\n\t\tconst block = this.#getBlock(blockId);\n\t\tif (block)\n\t\t{\n\t\t\tthis.#currentOpenBlockId = null;\n\t\t\tDom.hide(block.leftContainer);\n\t\t\tDom.hide(block.rightContainer);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.#currentOpenBlockId = block.id;\n\t\t\t\tDom.show(block.leftContainer);\n\t\t\t\tDom.show(block.rightContainer);\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\t/**\n\t * When user toggles mode (internal vs external controls).\n\t *\n\t * @param {{[type: string]: string}} data New mode data.\n\t */\n\t#onChangeMode(data: {[type: string]: string})\n\t{\n\t\tif (data.type === 'internal')\n\t\t{\n\t\t\tthis.#hideAllControls();\n\t\t}\n\t}\n}\n","import { Event, ajax as Ajax, Runtime, Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { PULL, PullClient } from 'pull.client';\nimport { type CopilotChat as CopilotChatInstance } from 'ai.copilot-chat.core';\nimport {\n\ttype CopilotChatEvents,\n\ttype CopilotChatMessageType,\n} from 'landing.copilot.chat';\nimport { PageObject } from 'landing.pageobject';\nimport { Highlight } from 'landing.ui.highlight';\nimport { Copilot as CopilotAnimation } from 'landing.animation.copilot';\nimport { Env } from 'landing.env';\nimport { History } from 'landing.history';\nimport { StylePanel } from 'landing.ui.panel.stylepanel';\n\ntype BlockGeneratorOptions = {\n\tchatId: ?number,\n\tcopilotChat: ?CopilotChatInstance,\n}\n\ntype SelectedBlock = {\n\tid: number,\n\tanchor: string,\n\tcontent: HTMLElement,\n};\n\nexport class BlockGenerator extends EventEmitter\n{\n\tstatic selectModeClass = 'landing-copilot-generation';\n\tstatic highlightColor = '#8e52ec';\n\tstatic highlightWidth = 4;\n\tstatic highlightBackground = 'rgba(142, 82, 236, 0.4)';\n\n\t#chatId: number;\n\t#copilotChat: CopilotChatInstance;\n\t#animationCopilot: ?CopilotAnimation = null;\n\t#copilotChatEvents: CopilotChatEvents;\n\t#copilotChatMessageType: CopilotChatMessageType;\n\n\t#generationId: ?number = null;\n\t#isGenerationProcessed: boolean = false;\n\n\t#blocks: Map<number, SelectedBlock>;\n\t#selectMode: boolean = false;\n\t#selectedBlock: ?SelectedBlock;\n\t#isSelectedBlockGeneratable: boolean;\n\n\t#editorWindow: ?Window;\n\t#highlight: Highlight;\n\t#highlightSelectable: Highlight;\n\n\tstatic async create(options: BlockGeneratorOptions): ?BlockGenerator\n\t{\n\t\tif (\n\t\t\t!options.copilotChat\n\t\t\t|| !options.chatId\n\t\t)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst generator = new BlockGenerator(options);\n\t\tawait generator.init();\n\n\t\treturn generator;\n\t}\n\n\tconstructor(options: BlockGeneratorOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.View.BlockGenerator');\n\n\t\tthis.#blocks = new Map();\n\t\tthis.#selectedBlock = null;\n\t\tthis.#isSelectedBlockGeneratable = false;\n\n\t\tthis.#highlight = (new Highlight())\n\t\t\t.setBorder(BlockGenerator.highlightColor, BlockGenerator.highlightWidth)\n\t\t\t.setBackground('transparent')\n\t\t\t.setSingleMode()\n\t\t;\n\t\tthis.#highlightSelectable = (new Highlight())\n\t\t\t.setBorder(BlockGenerator.highlightColor, 0)\n\t\t\t.setBackground(BlockGenerator.highlightBackground)\n\t\t\t.setSingleMode()\n\t\t;\n\n\t\tthis.#chatId = options.chatId;\n\t\tthis.#copilotChat = options.copilotChat;\n\n\t\tthis.onBlockMouseEnter = this.onBlockMouseEnter.bind(this);\n\t\tthis.onBlockClick = this.onBlockClick.bind(this);\n\t\tthis.onChatMessage = this.onChatMessage.bind(this);\n\t\tthis.onEditorLoad = this.onEditorLoad.bind(this);\n\n\t\tthis.#editorWindow = PageObject.getEditorWindow();\n\t\tif (!this.#editorWindow)\n\t\t{\n\t\t\tconsole.error('Can not load editor window');\n\t\t}\n\n\t\tif (this.#editorWindow.document.readyState === 'complete')\n\t\t{\n\t\t\tthis.onEditorLoad();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(this.#editorWindow, 'load', this.onEditorLoad);\n\t\t}\n\t}\n\n\tasync init()\n\t{\n\t\tconst exports = await Runtime.loadExtension('landing.copilot.chat');\n\n\t\tthis.#copilotChatEvents = exports.CopilotChatEvents;\n\t\tthis.#copilotChatMessageType = exports.CopilotChatMessageType;\n\t}\n\n\tonEditorLoad()\n\t{\n\t\tconst blocks = PageObject.getBlocks();\n\t\tblocks.forEach((block) => {\n\t\t\tthis.#blocks.set(block.id, {\n\t\t\t\tid: block.id,\n\t\t\t\tanchor: block.anchor,\n\t\t\t\tcontent: block.content,\n\t\t\t});\n\t\t});\n\n\t\tthis.#editorWindow.BX.addCustomEvent(this.#editorWindow, 'BX.Landing.Block:init', (event) => {\n\t\t\tthis.onBlockAdd(event.blockId, event.block.id, event.content);\n\t\t});\n\n\t\tif (this.#selectMode)\n\t\t{\n\t\t\tthis.#bindBlocksSelectEvents();\n\t\t}\n\t}\n\n\tonBlockAdd(blockId: number, anchor: string, content: HTMLElement): void\n\t{\n\t\tthis.#blocks.set(blockId, {\n\t\t\tid: blockId,\n\t\t\tanchor,\n\t\t\tcontent,\n\t\t});\n\t\tif (this.#selectMode)\n\t\t{\n\t\t\tthis.#bindBlocksSelectEvents();\n\t\t}\n\t}\n\n\tonBlockClick(event: MouseEvent)\n\t{\n\t\tconst target = event.currentTarget;\n\t\tlet selectedBlock: ?SelectedBlock = null;\n\t\tfor (const block of this.#blocks.values())\n\t\t{\n\t\t\tif (target === block.content)\n\t\t\t{\n\t\t\t\tselectedBlock = block;\n\t\t\t}\n\t\t}\n\n\t\tconst chatId = this.#chatId;\n\t\tif (selectedBlock === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#selectedBlock !== null && this.#selectedBlock.id === selectedBlock.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#selectedBlock = selectedBlock;\n\n\t\tAjax.runAction(\n\t\t\t'landing.api.copilot.checkBlockGeneratable',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tblockId: selectedBlock.id,\n\t\t\t\t\tchatId,\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\t\t\t.then((result) => {\n\t\t\t\tif (result.data)\n\t\t\t\t{\n\t\t\t\t\tthis.#isSelectedBlockGeneratable = true;\n\t\t\t\t\tthis.#highlightSelectable.show(this.#selectedBlock.content);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#isSelectedBlockGeneratable = false;\n\t\t\t\t\tthis.#highlightSelectable.hide();\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t.catch(() => {\n\t\t\t\tthis.#isSelectedBlockGeneratable = false;\n\t\t\t\tthis.#highlightSelectable.hide();\n\t\t\t})\n\t\t;\n\t}\n\n\tonChatMessage(event: BaseEvent): void\n\t{\n\t\tconst message = event.getData()?.message;\n\t\tif (\n\t\t\tmessage\n\t\t\t&& (message.authorId || 0) > 0\n\t\t\t&& message.type === this.#copilotChatMessageType.DEFAULT\n\t\t)\n\t\t{\n\t\t\tif (this.#selectedBlock === null)\n\t\t\t{\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'landing.api.copilot.sendBlockGenerationNeedSelectMessage',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tsiteId: Env.getInstance().getSiteId(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.#isSelectedBlockGeneratable)\n\t\t\t{\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'landing.api.copilot.sendBlockGenerationWrongSelectMessage',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tsiteId: Env.getInstance().getSiteId(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet loadAnimation: Promise = Promise.resolve();\n\n\t\t\tif (!this.#animationCopilot)\n\t\t\t{\n\t\t\t\tconst editorWindow = PageObject.getEditorWindow();\n\t\t\t\tloadAnimation = editorWindow.BX.Runtime\n\t\t\t\t\t.loadExtension('landing.animation.copilot')\n\t\t\t\t\t.then((exports) => {\n\t\t\t\t\t\tthis.#animationCopilot = new exports.Copilot();\n\t\t\t\t\t\tthis.#animationCopilot.subscribe(\n\t\t\t\t\t\t\t'onBlockFinish',\n\t\t\t\t\t\t\tthis.onBlockAnimateFinish.bind(this),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.#subscribePullEvents();\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tloadAnimation\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn Ajax.runAction(\n\t\t\t\t\t\t'landing.api.copilot.executeBlockGeneration',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tsiteId: Env.getInstance().getSiteId(),\n\t\t\t\t\t\t\t\tblockId: this.#selectedBlock.id,\n\t\t\t\t\t\t\t\twishes: message.content,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (result.status === 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#generationId = result.data;\n\n\t\t\t\t\t\tthis.#animationCopilot\n\t\t\t\t\t\t\t.setBlocksData([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid: this.#selectedBlock.id,\n\t\t\t\t\t\t\t\t\tanchor: this.#selectedBlock.anchor,\n\t\t\t\t\t\t\t\t\telement: this.#selectedBlock.content,\n\t\t\t\t\t\t\t\t\timages: [],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t.disableEditor()\n\t\t\t\t\t\t\t.showLoader()\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tthis.onBlockGenerationStart();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error('Error while execute block generation', err);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n\n\t#subscribePullEvents()\n\t{\n\t\tPULL.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'landing',\n\t\t\tcallback: event => {\n\t\t\t\tif (!this.#isGenerationProcessed)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tevent.params.generationId !== undefined\n\t\t\t\t\t&& this.#generationId !== null\n\t\t\t\t\t&& event.params.generationId !== this.#generationId\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst command = event.command;\n\n\t\t\t\tif (command === 'LandingCopilotGeneration:onGenerationFinish')\n\t\t\t\t{\n\t\t\t\t\tHistory.getInstance().push();\n\t\t\t\t}\n\n\t\t\t\tif (command === 'LandingCopilotGeneration:onGenerationError')\n\t\t\t\t{\n\t\t\t\t\tthis.#animationCopilot.stop();\n\t\t\t\t\tthis.#animationCopilot.hideLoader();\n\t\t\t\t\tthis.#animationCopilot.enableEditor();\n\t\t\t\t\tthis.onBlockAnimateFinish();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tonBlockGenerationStart(): void\n\t{\n\t\tthis.#isGenerationProcessed = true;\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.#isGenerationProcessed)\n\t\t\t{\n\t\t\t\tthis.emit('onGenerationStart');\n\t\t\t}\n\t\t}, 3000);\n\t}\n\n\tonBlockAnimateFinish(): void\n\t{\n\t\tthis.#isGenerationProcessed = false;\n\n\t\tsetTimeout(() => {\n\t\t\tthis.emit('onGenerationFinish');\n\t\t}, 3000);\n\t}\n\n\tsetSelectMode(): void\n\t{\n\t\tconst stylePanel = StylePanel.getInstance();\n\t\tif (stylePanel.isShown())\n\t\t{\n\t\t\tstylePanel.hide();\n\t\t}\n\n\t\tif (this.#selectMode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#selectMode = true;\n\t\tthis.#bindBlocksSelectEvents();\n\n\t\tif (this.#copilotChat && this.#copilotChatEvents && this.#copilotChatMessageType)\n\t\t{\n\t\t\tthis.#copilotChat.subscribe(this.#copilotChatEvents.NEW_MESSAGE, this.onChatMessage);\n\t\t}\n\n\t\tthis.disableEditor();\n\t}\n\n\tdisableEditor()\n\t{\n\t\tDom.addClass(this.#editorWindow.document.body, BlockGenerator.selectModeClass);\n\t}\n\n\t#bindBlocksSelectEvents(): void\n\t{\n\t\tfor (const block of this.#blocks.values())\n\t\t{\n\t\t\tconst node = block.content;\n\t\t\tEvent.bind(node, 'mouseenter', this.onBlockMouseEnter);\n\t\t\tEvent.bind(node, 'click', this.onBlockClick);\n\t\t}\n\t}\n\n\tunsetSelectMode(): void\n\t{\n\t\tif (!this.#selectMode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#selectMode = false;\n\t\tthis.#unbindBlocksSelectEvents();\n\t\tthis.#highlight.hide();\n\t\tthis.#highlightSelectable.hide();\n\n\t\tif (this.#copilotChat && this.#copilotChatEvents)\n\t\t{\n\t\t\tthis.#copilotChat.unsubscribe(this.#copilotChatEvents.NEW_MESSAGE, this.onChatMessage);\n\t\t}\n\n\t\tthis.enableEditor();\n\t}\n\n\tenableEditor()\n\t{\n\t\tDom.removeClass(this.#editorWindow.document.body, BlockGenerator.selectModeClass);\n\t}\n\n\t#unbindBlocksSelectEvents(): void\n\t{\n\t\tfor (const block of this.#blocks.values())\n\t\t{\n\t\t\tconst node = block.content;\n\t\t\tEvent.unbind(node, 'mouseenter', this.onBlockMouseEnter);\n\t\t\tEvent.unbind(node, 'click', this.onBlockClick);\n\t\t}\n\t}\n\n\tonBlockMouseEnter(event: MouseEvent)\n\t{\n\t\tthis.#highlight.show(event.currentTarget);\n\t}\n}\n","import { Dom, Tag, Event, Type, Runtime } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { type CopilotChat as CopilotChatInstance } from 'ai.copilot-chat.core';\nimport {\n\ttype Chat as LandingCopilotChat,\n\ttype CopilotChatEvents,\n\ttype CopilotChatMessageType,\n} from 'landing.copilot.chat';\n\nimport 'ui.design-tokens';\nimport { BlockGenerator } from './block-generator';\n\ntype CopilotChatOptions = {\n\tchatId?: number;\n\tentityId?: string;\n\tisSiteEditChat?: boolean;\n\tonChatCreate?: (data: {}) => void;\n\tisCopilotFeatureAvailable?: boolean;\n\tisCopilotFeatureEnabled?: boolean;\n\tisCopilotActive?: boolean;\n\tcopilotFeatureEnabledSlider: string;\n\tcopilotUnactiveSlider: string;\n}\n\nexport type SlidePanelOptions = {\n\tcopilotChatOptions: CopilotChatOptions;\n};\n\nexport class SlidePanel\n{\n\t#copilotChat: CopilotChatInstance;\n\t#copilotChatOptions: CopilotChatOptions;\n\t#blockGenerator: BlockGenerator;\n\n\tcopilotChatEvents: CopilotChatEvents;\n\tcopilotChatMessageType: CopilotChatMessageType;\n\n\tconstructor(options: SlidePanelOptions)\n\t{\n\t\tthis.layout = {\n\t\t\tcontainer: null,\n\t\t\tpulse: null,\n\t\t\tclose: null,\n\t\t\tswitcherPreview: null,\n\t\t\tswitcherChat: null,\n\t\t\tchat: null,\n\t\t\tpreview: null,\n\t\t};\n\t\tthis.switchers = [];\n\n\t\tthis.#copilotChatOptions = options.copilotChatOptions;\n\n\t\tthis.init();\n\t}\n\n\tgetSwitcherChat(): HTMLElement\n\t{\n\t\tif (!this.layout.switcherChat)\n\t\t{\n\t\t\tthis.layout.switcherChat = Tag.render`\n\t\t\t\t<div class=\"landing-slide-panel__navigation-item --chat\">\n\t\t\t\t\t<div class=\"ui-icon-set --copilot-ai\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.switchers.push(this.layout.switcherChat);\n\t\t\tEvent.bind(this.layout.switcherChat, 'click', () => {\n\t\t\t\tthis.showChat();\n\t\t\t\tthis.hidePreview();\n\t\t\t\tthis.adjustSwitcher(this.layout.switcherChat);\n\t\t\t});\n\t\t}\n\n\t\treturn this.layout.switcherChat;\n\t}\n\n\tgetSwitcherPreview(): HTMLElement\n\t{\n\t\tif (!this.layout.switcherPreview)\n\t\t{\n\t\t\tthis.layout.switcherPreview = Tag.render`\n\t\t\t\t<div class=\"landing-slide-panel__navigation-item --preview\">\n\t\t\t\t\t<div class=\"ui-icon-set --mobile-2\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.switchers.push(this.layout.switcherPreview);\n\t\t\tEvent.bind(this.layout.switcherPreview, 'click', () => {\n\t\t\t\tthis.showPreview();\n\t\t\t\tthis.hideChat();\n\t\t\t\tthis.adjustSwitcher(this.layout.switcherPreview);\n\t\t\t});\n\t\t}\n\n\t\treturn this.layout.switcherPreview;\n\t}\n\n\tasync showChat()\n\t{\n\t\tlet slider = null;\n\n\t\tif (!this.#copilotChatOptions.isCopilotFeatureEnabled)\n\t\t{\n\t\t\tslider = this.#copilotChatOptions.copilotFeatureEnabledSlider;\n\t\t}\n\t\telse if (!this.#copilotChatOptions.isCopilotActive)\n\t\t{\n\t\t\tslider = this.#copilotChatOptions.copilotUnactiveSlider;\n\t\t}\n\n\t\tif (slider)\n\t\t{\n\t\t\tBX.UI.InfoHelper.show(slider);\n\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tif (!this.#copilotChat)\n\t\t\t{\n\t\t\t\tthis.#copilotChat = await this.#initCopilotChat();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!this.#blockGenerator\n\t\t\t\t&& this.#copilotChat\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#blockGenerator = await BlockGenerator.create({\n\t\t\t\t\tchatId: this.#copilotChatOptions.chatId || null,\n\t\t\t\t\tcopilotChat: this.#copilotChat,\n\t\t\t\t});\n\n\t\t\t\tif (this.#blockGenerator)\n\t\t\t\t{\n\t\t\t\t\tthis.#blockGenerator.subscribe('onGenerationStart', () => {\n\t\t\t\t\t\tthis.hide();\n\t\t\t\t\t});\n\t\t\t\t\tthis.#blockGenerator.subscribe('onGenerationFinish', () => {\n\t\t\t\t\t\tthis.show();\n\t\t\t\t\t\tthis.showChat();\n\t\t\t\t\t\tthis.adjustSwitcher(this.layout.switcherChat);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.#copilotChat.isShown() === false)\n\t\t\t{\n\t\t\t\tthis.#copilotChat.show();\n\t\t\t}\n\n\t\t\tthis.#blockGenerator?.setSelectMode();\n\t\t\tDom.addClass(this.getChatContainer(), '--show');\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tasync #initCopilotChat(): Promise<CopilotChatInstance>\n\t{\n\t\tconst exports = await Runtime.loadExtension('landing.copilot.chat');\n\t\tconst Chat: LandingCopilotChat = exports.Chat;\n\n\t\tthis.copilotChatEvents = exports.CopilotChatEvents;\n\t\tthis.copilotChatMessageType = exports.CopilotChatMessageType;\n\n\t\tconst chat = await Chat.getCopilotChatInstance({\n\t\t\tentityId: this.#copilotChatOptions?.entityId,\n\t\t\tchatId: this.#copilotChatOptions?.chatId,\n\t\t\tscenario: 'site_with_ai_change_block',\n\t\t\tshowChatButtonElement: this.layout.switcherChat ?? null,\n\t\t\tisSiteEditChat: this.#copilotChatOptions?.isSiteEditChat === true,\n\t\t});\n\n\t\tif (\n\t\t\t!this.#copilotChatOptions?.chatId\n\t\t\t&& this.#copilotChatOptions?.onChatCreate\n\t\t)\n\t\t{\n\t\t\tchat.subscribe(this.copilotChatEvents.INIT_CHAT, (event: BaseEvent) => {\n\t\t\t\tthis.#copilotChatOptions.onChatCreate(event.getData());\n\t\t\t\tthis.#copilotChatOptions.chatId = event.getData().chatId;\n\t\t\t});\n\t\t}\n\n\t\treturn chat;\n\t}\n\n\thideChat()\n\t{\n\t\tthis.#copilotChat?.hide();\n\t\tthis.#blockGenerator?.unsetSelectMode();\n\t\tDom.removeClass(this.getChatContainer(), '--show');\n\t}\n\n\tshowPreview()\n\t{\n\t\tDom.addClass(this.getPreviewContainer(), '--show');\n\t}\n\n\thidePreview()\n\t{\n\t\tDom.removeClass(this.getPreviewContainer(), '--show');\n\t}\n\n\tgetClose(): HTMLElement\n\t{\n\t\tif (!this.layout.close)\n\t\t{\n\t\t\tthis.layout.close = Tag.render`\n\t\t\t\t<div class=\"landing-slide-panel__navigation-item --close\">\n\t\t\t\t\t<div class=\"ui-icon-set --cross-45\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tEvent.bind(this.layout.close, 'click', () => this.hide());\n\t\t}\n\n\t\treturn this.layout.close;\n\t}\n\n\tgetPulse(): HTMLElement\n\t{\n\t\tif (!this.layout.pulse)\n\t\t{\n\t\t\tif (this.#copilotChatOptions.isCopilotFeatureAvailable)\n\t\t\t{\n\t\t\t\tthis.layout.pulse = Tag.render`\n\t\t\t\t\t<div class=\"landing-slide-panel__navigation-item --pulse --animate\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --copilot-ai\"></div>\n\t\t\t\t\t\t<div class=\"ui-icon-set --mobile-2\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.layout.pulse = Tag.render`\n\t\t\t\t\t<div class=\"landing-slide-panel__navigation-item --pulse\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --mobile-2\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}\n\t\t\tEvent.bind(this.layout.pulse, 'click', () => this.show());\n\t\t}\n\n\t\treturn this.layout.pulse;\n\t}\n\n\tgetChatContainer(): HTMLElement\n\t{\n\t\tif (!this.layout.chat)\n\t\t{\n\t\t\tthis.layout.chat = Tag.render`\n\t\t\t\t<div class=\"landing-slide-panel__container-item --chat\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.chat;\n\t}\n\n\tgetPreviewContainer(): HTMLElement\n\t{\n\t\tif (!this.layout.preview)\n\t\t{\n\t\t\tthis.layout.preview = Tag.render`\n\t\t\t\t<div class=\"landing-slide-panel__container-item --preview\"></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.preview;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tif (!this.layout.container)\n\t\t{\n\t\t\tthis.layout.container = Tag.render`\n\t\t\t\t<div class=\"landing-slide-panel\">\n\t\t\t\t\t<div class=\"landing-slide-panel-inner\">\t\t\t\t\t\n\t\t\t\t\t\t<div class=\"landing-slide-panel__container\">\n\t\t\t\t\t\t\t${this.getChatContainer()}\n\t\t\t\t\t\t\t${this.getPreviewContainer()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"landing-slide-panel__navigation\">\n\t\t\t\t\t\t \t${this.#copilotChatOptions.isCopilotFeatureAvailable ? this.getSwitcherChat() : ''}\n\t\t\t\t\t\t\t${this.getSwitcherPreview()}\n\t\t\t\t\t\t\t${this.getClose()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getPulse()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.container;\n\t}\n\n\tadjustSwitcher(switcher: HTMLElement): void\n\t{\n\t\tthis.switchers.forEach((item) => Dom.removeClass(item, '--active'));\n\t\tif (Type.isDomNode(switcher))\n\t\t{\n\t\t\tDom.addClass(switcher, '--active');\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tDom.addClass(this.getContainer(), '--open');\n\t}\n\n\thide()\n\t{\n\t\tDom.removeClass(this.getContainer(), '--open');\n\t\tthis.hideChat();\n\t\tthis.hidePreview();\n\t\tthis.adjustSwitcher();\n\t}\n\n\tinit(): void\n\t{\n\t\tDom.append(this.getContainer(), document.body);\n\t}\n}\n"],"names":["Loc","messages","code","Devices","defaultDevice","tablet","mobile","devices","delimiter1","langCode","iphone14pro","name","className","width","height","iPhoneXR","iPhoneSE","SamsungGalaxyNote10","SamsungGalaxyS8","GooglePixel4","delimiter2","iPad","iPadMini","SamsungGalaxyTabS8","DeviceUI","options","localStorage","getItem","setItem","rotateClick","Dom","style","layout","wrapper","offsetHeight","offsetWidth","frame","querySelector","innerHTML","hidden","rotate","Tag","render","frameUrl","clickHandler","bindElement","menuId","menu","MenuManager","getMenuById","show","menuItems","forEach","device","push","MenuItem","delimiter","text","id","html","String","onclick","close","bindNode","parentNode","document","body","create","items","offsetTop","offsetLeft","minWidth","animation","events","onPopupShow","getPopupWindow","setMinWidth","Device","target","editorFrameWrapper","BX","addCustomEvent","deviceType","window","addEventListener","event","data","action","payload","enable","includes","blockId","block","updateNodes","blockIdPrefix","timestamp","Date","now","location","href","topInPercent","scrollHeight","Math","max","documentElement","clientHeight","scroll","deviceCode","loadMessages","getMessage","append","addClass","Event","bind","remove","newDevice","removeClass","removeProperty","frameWrapper","onload","scale","innerHeight","padding","parseInt","getComputedStyle","param1","param2","setProperty","documentEditorFrame","contentWindow","scrollTop","getPreview","hide","appendChild","previewDocument","openDeviceMenu","Object","values","Action","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","iframe","Type","isDomNode","Error","_classPrivateMethodGet","postMessage","origin","UI","itemCode","itemProp","value","pendingMenuItems","onClick","title","button","label","getDesignerBlockButton","designerBlockClick","getStyleBlockButton","styleBlockClick","getEditBlockButton","editBlockClick","getBlockAdditionalMenu","state","Landing","Utils","setTextContent","getMenuItem","getLayout","setPendingMenuItemValue","enablePaste","item","disable","actions","actionButton","onOpenAdditionalMenu","stopPropagation","angle","position","offset","disabled","changeStateClick","getPendingMenuItemValue","cutClick","copyClick","pasteClick","feedbackClick","saveInLibrary","getSortDownBlockButton","sortDownBlockClick","getSortUpBlockButton","sortUpBlockClick","getActionsList","getRemoveBlockButton","removeBlockClick","ExternalControls","container","iframeWrapper","Map","onHideEditorPanel","blocks","top","allowPaste","i","c","size","blockItem","next","changePasteMenuItem","permissions","map","leftContainer","getLeftContainer","allowDesignBlock","onDesignerBlockClick","allowModifyStyles","onStyleBlockClick","allowEditContent","onEditBlockClick","rightContainer","getRightContainer","allowSorting","onSortDownBlockClick","onSortUpBlockClick","allowRemove","onRemoveBlockClick","setTimeout","allowChangeState","closeBlockAdditionalMenu","onChangeStateBlockClick","onCutBlockClick","onCopyBlockClick","onPasteBlockClick","onFeedbackClick","allowSaveInLibrary","onSaveInLibraryClick","set","get","changeStateMenuItem","iframeRect","getBoundingClientRect","left","type","BlockGenerator","copilotChat","chatId","generator","init","setEventNamespace","Highlight","setBorder","highlightColor","highlightWidth","setBackground","setSingleMode","highlightBackground","onBlockMouseEnter","onBlockClick","onChatMessage","onEditorLoad","PageObject","getEditorWindow","console","error","readyState","Runtime","loadExtension","exports","CopilotChatEvents","CopilotChatMessageType","getBlocks","anchor","content","onBlockAdd","currentTarget","selectedBlock","Ajax","runAction","then","result","message","getData","authorId","DEFAULT","siteId","Env","getInstance","getSiteId","loadAnimation","Promise","resolve","editorWindow","Copilot","subscribe","onBlockAnimateFinish","wishes","status","setBlocksData","element","images","disableEditor","showLoader","onBlockGenerationStart","err","emit","stylePanel","StylePanel","isShown","NEW_MESSAGE","selectModeClass","unsubscribe","enableEditor","EventEmitter","PULL","PullClient","SubscriptionType","Server","moduleId","callback","params","generationId","undefined","command","History","stop","hideLoader","node","unbind","SlidePanel","pulse","switcherPreview","switcherChat","chat","preview","switchers","copilotChatOptions","showChat","hidePreview","adjustSwitcher","showPreview","hideChat","slider","isCopilotFeatureEnabled","copilotFeatureEnabledSlider","isCopilotActive","copilotUnactiveSlider","InfoHelper","setSelectMode","getChatContainer","unsetSelectMode","getPreviewContainer","isCopilotFeatureAvailable","getSwitcherChat","getSwitcherPreview","getClose","getPulse","switcher","getContainer","Chat","copilotChatEvents","copilotChatMessageType","getCopilotChatInstance","entityId","scenario","showChatButtonElement","isSiteEditChat","onChatCreate","INIT_CHAT"],"mappings":"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"}