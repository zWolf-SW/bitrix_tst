this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,t,s,i,o){"use strict";let r=e=>e,n;var a=babelHelpers.classPrivateFieldLooseKey("counters");var l=babelHelpers.classPrivateFieldLooseKey("action");var d=babelHelpers.classPrivateFieldLooseKey("onAfterGridUpdated");var c=babelHelpers.classPrivateFieldLooseKey("renderStartedByMeNow");class p{constructor(e){Object.defineProperty(this,c,{value:m});Object.defineProperty(this,d,{value:u});Object.defineProperty(this,a,{writable:true,value:new Map});this.onElementCreatedHandler=null;if(t.Type.isPlainObject(e)){this.gridId=e.gridId;if(t.Type.isArray(e.errors)){this.showErrors(e.errors)}}this.init()}init(){BX.UI.Hint.init(document);if(this.getGrid()){BX.Bizproc.Component.UserProcessesStart.colorPinnedRows(this.getGrid())}s.EventEmitter.subscribe("Grid::updated",babelHelpers.classPrivateFieldLooseBase(this,d)[d].bind(this));this.subscribeCustomEvents()}subscribeCustomEvents(){if(this.onElementCreatedHandler===null){this.onElementCreatedHandler=this.onElementCreated.bind(this);s.EventEmitter.subscribe("SidePanel.Slider:onMessage",this.onElementCreatedHandler)}}unsubscribeCustomEvents(){if(this.onElementCreatedHandler){s.EventEmitter.unsubscribe("SidePanel.Slider:onMessage",this.onElementCreatedHandler);this.onElementCreatedHandler=null}}destroy(){this.unsubscribeCustomEvents()}static changePin(e,s,i){const o=i.getData();const r=o.button;if(t.Dom.hasClass(r,BX.Grid.CellActionState.ACTIVE)){babelHelpers.classPrivateFieldLooseBase(BX.Bizproc.Component.UserProcessesStart,l)[l]("unpin",e,s);t.Dom.removeClass(r,BX.Grid.CellActionState.ACTIVE)}else{babelHelpers.classPrivateFieldLooseBase(BX.Bizproc.Component.UserProcessesStart,l)[l]("pin",e,s);t.Dom.addClass(r,BX.Grid.CellActionState.ACTIVE)}const n=BX.Main.gridManager.getInstanceById(s);if(n){BX.Bizproc.Component.UserProcessesStart.colorPinnedRows(n)}}static colorPinnedRows(e){e.getRows().getRows().forEach((e=>{const s=e.getNode();if(t.Type.isElementNode(s.querySelector(".main-grid-cell-content-action-pin.main-grid-cell-content-action-active"))){t.Dom.addClass(s,"bizproc-user-processes-start-item-pinned")}else{t.Dom.removeClass(s,"bizproc-user-processes-start-item-pinned")}}))}startWorkflow(e,s,i,o){e.preventDefault();t.Runtime.loadExtension("lists.element.creation-guide").then((({CreationGuide:e})=>{e==null?void 0:e.open({iBlockTypeId:s,iBlockId:i,analyticsP1:o})})).catch((()=>{})).finally((()=>{}))}onElementCreated(e){const[t]=e.getCompatData();if(t.getEventId()==="BX.Lists.Element.CreationGuide:onElementCreated"){const e=t.getData();if(!babelHelpers.classPrivateFieldLooseBase(this,a)[a].has(e.iBlockId)){babelHelpers.classPrivateFieldLooseBase(this,a)[a].set(e.iBlockId,0)}babelHelpers.classPrivateFieldLooseBase(this,a)[a].set(e.iBlockId,babelHelpers.classPrivateFieldLooseBase(this,a)[a].get(e.iBlockId)+1);this.reloadGrid();BX.SidePanel.Instance.getSliderByWindow(window).close()}else{this.reloadGrid()}}showErrors(e){if(!t.Type.isArrayFilled(e)){if(!t.Type.isArray(e)){console.error(e)}return}const s=document.getElementById("bp-user-processes-errors-container");if(s){let o=0;const r=()=>{if(o>0){t.Dom.style(s,{margin:"10px"})}else{t.Dom.style(s,{margin:"0px"})}};for(const n of e){o+=1;const e=new i.Alert({text:t.Text.encode(n.message),color:i.AlertColor.DANGER,closeBtn:true,animated:true});e.renderTo(s);if(e.getCloseBtn()){e.getCloseBtn().onclick=()=>{o-=1;r()}}}r()}}reloadGrid(){var e;(e=this.getGrid())==null?void 0:e.reload()}getGrid(){if(this.gridId){var e;return(e=BX.Main.gridManager)==null?void 0:e.getInstanceById(this.gridId)}return null}editTemplate(e,t,s){if(!s){this.showNoPermissionsHint(e.target);return}if(t.length===0){this.showNoEditorHint(e.target);return}top.window.location.href=t}editTemplateConstants(e,t){o.Router.openWorkflowChangeConstants({templateId:e,signedDocumentType:t})}showAngleHint(e,s){if(this.hintTimeout){clearTimeout(this.hintTimeout)}this.popupHint=BX.UI.Hint.createInstance({popupParameters:{width:334,height:104,closeByEsc:true,autoHide:true,angle:{offset:t.Dom.getPosition(e).width/2},bindOptions:{position:"top"}}});this.popupHint.close=function(){this.hide()};this.popupHint.show(e,s);this.timeout=setTimeout(this.hideHint.bind(this),5e3)}hideHint(){if(this.popupHint){this.popupHint.close()}this.popupHint=null}showNoPermissionsHint(e){this.showAngleHint(e,t.Loc.getMessage("BIZPROC_USER_PROCESSES_START_TEMPLATE_RIGHTS_ERROR"))}showNoEditorHint(e){this.showAngleHint(e,t.Loc.getMessage("BIZPROC_USER_PROCESSES_START_TEMPLATE_MODULE_ERROR"))}}function h(e,s,i){const o="bitrix:bizproc.user.processes.start";t.ajax.runComponentAction(o,e,{mode:"class",data:{iblockId:s}}).then((e=>{const t=BX.Main.gridManager.getInstanceById(i);if(t){t.reload()}})).catch((()=>{}))}function u(){if(this.getGrid()){BX.UI.Hint.init(this.getGrid().getContainer());BX.Bizproc.Component.UserProcessesStart.colorPinnedRows(this.getGrid())}babelHelpers.classPrivateFieldLooseBase(this,a)[a].forEach(((e,s)=>{const i=document.querySelector(`[data-role="iblock-${s}-counter"]`);if(t.Type.isElementNode(i)){t.Dom.clean(i);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,c)[c](s),i)}}))}function m(e){let s=t.Text.encode(t.Loc.getMessage("BIZPROC_USER_PROCESSES_START_COUNTER",{"#COUNTER#":babelHelpers.classPrivateFieldLooseBase(this,a)[a].get(e)}));s=s.replace("[bold]",'<span class="bizproc-user-processes-start-column-start-counter">');s=s.replace("[/bold]","</span>");return t.Tag.render(n||(n=r`<div class="ui-typography-text-xs">${0}</div>`),s)}Object.defineProperty(p,l,{value:h});e.UserProcessesStart=p})(this.BX.Bizproc.Component=this.BX.Bizproc.Component||{},BX,BX.Event,BX.UI,BX.Bizproc);
//# sourceMappingURL=script.map.js