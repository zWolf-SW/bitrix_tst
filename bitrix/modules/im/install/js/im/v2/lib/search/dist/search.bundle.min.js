this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,r,a,i,o){"use strict";const l="im-recent-v2";const n="IM_CHAT_SEARCH";const c="im-chat-search";const d=e=>{const s={id:l,dynamicLoad:true,dynamicSearch:true,options:u(e)};return{dialog:{entities:[s],preselectedItems:[],clearUnavailableItems:false,context:n,id:c}}};const u=e=>{const t={withChatByUsers:false};if(!e){return{...t,exclude:[]}}const r=[];if(s.Type.isBoolean(e.chats)&&!e.chats){r.push("chats")}if(s.Type.isBoolean(e.users)&&!e.users){r.push("users")}return{...t,exclude:r}};var b=babelHelpers.classPrivateFieldLooseKey("store");var h=babelHelpers.classPrivateFieldLooseKey("userManager");var g=babelHelpers.classPrivateFieldLooseKey("prepareDataForModels");class p{constructor(){Object.defineProperty(this,g,{value:v});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=a.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new t.UserManager}update(e){const{users:s,chats:t}=babelHelpers.classPrivateFieldLooseBase(this,g)[g](e);return Promise.all([babelHelpers.classPrivateFieldLooseBase(this,h)[h].setUsersToModel(s),babelHelpers.classPrivateFieldLooseBase(this,b)[b].dispatch("chats/set",t)])}}function v(e){const s={users:[],chats:[]};e.forEach((e=>{const r=e.customData.chat;if(e.entityType===i.SearchEntityIdTypes.imUser){s.users.push(e.customData.user)}if(e.entityType===i.SearchEntityIdTypes.chat){const a=Boolean(e.customData.user);const i=a?t.UserManager.getDialogForUser(e.customData.user):{};s.chats.push({...r,...i,dialogId:e.id})}}));return s}function f(e){const s=a.Core.getStore().getters["recent/getMessage"](e);if(!s){return""}return s.date.toISOString()}function y({withFakeUsers:e}){let s=a.Core.getStore().getters["recent/getSortedCollection"];s=s.filter((s=>{if(e&&s.isFakeElement){return true}return!s.isBirthdayPlaceholder&&!s.isFakeElement}));return s.map((({dialogId:e})=>({dialogId:e,dateMessage:f(e)})))}const P=new Intl.Collator(undefined,{sensitivity:"base"});var F=babelHelpers.classPrivateFieldLooseKey("searchConfig");var L=babelHelpers.classPrivateFieldLooseKey("store");var B=babelHelpers.classPrivateFieldLooseKey("search");var H=babelHelpers.classPrivateFieldLooseKey("getRecentListItems");var m=babelHelpers.classPrivateFieldLooseKey("prepareRecentItem");var I=babelHelpers.classPrivateFieldLooseKey("searchByQueryWords");var M=babelHelpers.classPrivateFieldLooseKey("searchByDialogFields");var C=babelHelpers.classPrivateFieldLooseKey("searchByUserFields");var U=babelHelpers.classPrivateFieldLooseKey("doesItemMatchQuery");var S=babelHelpers.classPrivateFieldLooseKey("getLocalItems");var w=babelHelpers.classPrivateFieldLooseKey("getLocalItemsFromDialogIds");var O=babelHelpers.classPrivateFieldLooseKey("mergeItems");var j=babelHelpers.classPrivateFieldLooseKey("filterByConfig");class K{constructor(e){Object.defineProperty(this,j,{value:V});Object.defineProperty(this,O,{value:Q});Object.defineProperty(this,w,{value:A});Object.defineProperty(this,S,{value:R});Object.defineProperty(this,U,{value:W});Object.defineProperty(this,C,{value:k});Object.defineProperty(this,M,{value:D});Object.defineProperty(this,I,{value:E});Object.defineProperty(this,m,{value:x});Object.defineProperty(this,H,{value:T});Object.defineProperty(this,B,{value:X});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=a.Core.getStore()}search(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,S)[S](s);const r=babelHelpers.classPrivateFieldLooseBase(this,B)[B](e,t);return babelHelpers.classPrivateFieldLooseBase(this,j)[j](r)}}function X(e,s){const t=o.Utils.text.getWordsFromString(e);const r=new Map;s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,t)){r.set(e.dialogId,{dialogId:e.dialogId,dateMessage:e.dateMessage})}}));return[...r.values()]}function T(){return y({withFakeUsers:true}).map((e=>babelHelpers.classPrivateFieldLooseBase(this,m)[m](e.dialogId,e.dateMessage)))}function x(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,L)[L].getters["chats/get"](e,true);const r=t.type===i.ChatType.user;const a={dialogId:e,dialog:t,dateMessage:s};if(r){a.user=babelHelpers.classPrivateFieldLooseBase(this,L)[L].getters["users/get"](e,true)}return a}function E(e,s){if(e.user){return babelHelpers.classPrivateFieldLooseBase(this,C)[C](e,s)}return babelHelpers.classPrivateFieldLooseBase(this,M)[M](e,s)}function D(e,s){const t=[];if(e.dialog.name){const s=o.Utils.text.getWordsFromString(e.dialog.name.toLowerCase());t.push(...s)}return babelHelpers.classPrivateFieldLooseBase(this,U)[U](t,s)}function k(e,s){const t=[];if(e.user.name){const s=o.Utils.text.getWordsFromString(e.user.name.toLowerCase());t.push(...s)}if(e.user.workPosition){const s=o.Utils.text.getWordsFromString(e.user.workPosition.toLowerCase());t.push(...s)}return babelHelpers.classPrivateFieldLooseBase(this,U)[U](t,s)}function W(e,s){let t=0;s.forEach((s=>{let r=0;e.forEach((e=>{const t=e.slice(0,s.length);if(P.compare(s,t)===0){r++}}));if(r>0){t++}}));return t>=s.length}function R(e){const s=babelHelpers.classPrivateFieldLooseBase(this,H)[H]();const t=babelHelpers.classPrivateFieldLooseBase(this,w)[w](e);return babelHelpers.classPrivateFieldLooseBase(this,O)[O](t,s)}function A(e){return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,m)[m](e.dialogId,e.dateMessage)))}function Q(e,s){const t=new Map;const r=[...e,...s];for(const e of r){if(!t.has(e.dialogId)){t.set(e.dialogId,e)}}return[...t.values()]}function V(e){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return e}return e.filter((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].chats&&e.dialogId.startsWith("chat")){return true}return!e.dialogId.startsWith("chat")&&babelHelpers.classPrivateFieldLooseBase(this,F)[F].users}))}const _=50;function q({withFakeUsers:e}){return y({withFakeUsers:e}).filter((({dialogId:e})=>{const s=a.Core.getStore().getters["chats/get"](e,true);const t=a.Core.getStore().getters["users/get"](e,true);return s.type===i.ChatType.user&&t.type!==i.UserType.bot&&t.id!==a.Core.getUserId()})).slice(0,_)}const z=e=>[...e].sort(((e,s)=>{if(e.dateMessage&&s.dateMessage){return o.Utils.date.cast(s.dateMessage)-o.Utils.date.cast(e.dateMessage)}if(e.dateMessage||s.dateMessage){return e.dateMessage?-1:1}const t=G(e.dialogId);const r=G(s.dialogId);if(t!==r){return t?1:-1}return 0}));const G=e=>{const s=a.Core.getStore().getters["chats/get"](e);if(!s){return false}if(s.type===i.ChatType.user){const s=a.Core.getStore().getters["users/get"](e);return s&&s.type===i.UserType.extranet}return s.extranet};e.getSearchConfig=d;e.EntityId=l;e.StoreUpdater=p;e.LocalSearch=K;e.getUsersFromRecentItems=q;e.getRecentListItems=y;e.sortByDate=z})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Messenger.v2.Lib,BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib);
//# sourceMappingURL=search.bundle.map.js