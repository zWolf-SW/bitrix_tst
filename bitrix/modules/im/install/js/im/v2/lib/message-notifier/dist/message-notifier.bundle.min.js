this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,i,t,a,o,r,l,n,c,b,v){"use strict";const d="im-chat";const p="im-copilot";const f="im-lines";const u="im-notify";const P="button_";const h={first:"1",second:"2"};var L=babelHelpers.classPrivateFieldLooseKey("instance");var B=babelHelpers.classPrivateFieldLooseKey("store");var F=babelHelpers.classPrivateFieldLooseKey("notificationService");var y=babelHelpers.classPrivateFieldLooseKey("prepareNotificationOptions");var g=babelHelpers.classPrivateFieldLooseKey("subscribeToNotifierEvents");var H=babelHelpers.classPrivateFieldLooseKey("onNotifierAction");var M=babelHelpers.classPrivateFieldLooseKey("onNotifierQuickAnswer");var N=babelHelpers.classPrivateFieldLooseKey("onNotifierButtonClick");var O=babelHelpers.classPrivateFieldLooseKey("sendButtonAction");var A=babelHelpers.classPrivateFieldLooseKey("isChatMessage");var I=babelHelpers.classPrivateFieldLooseKey("isCopilotMessage");var T=babelHelpers.classPrivateFieldLooseKey("isLinesMessage");var C=babelHelpers.classPrivateFieldLooseKey("isNotification");var X=babelHelpers.classPrivateFieldLooseKey("isConfirmButtonAction");var D=babelHelpers.classPrivateFieldLooseKey("extractDialogId");var m=babelHelpers.classPrivateFieldLooseKey("extractNotificationId");var w=babelHelpers.classPrivateFieldLooseKey("extractButtonNumber");var j=babelHelpers.classPrivateFieldLooseKey("extractButtonParams");class K{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,L)[L]){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=new this}return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}static init(){K.getInstance()}constructor(){Object.defineProperty(this,j,{value:G});Object.defineProperty(this,w,{value:z});Object.defineProperty(this,m,{value:q});Object.defineProperty(this,D,{value:U});Object.defineProperty(this,X,{value:Q});Object.defineProperty(this,C,{value:V});Object.defineProperty(this,T,{value:R});Object.defineProperty(this,I,{value:Y});Object.defineProperty(this,A,{value:S});Object.defineProperty(this,O,{value:$});Object.defineProperty(this,N,{value:W});Object.defineProperty(this,M,{value:x});Object.defineProperty(this,H,{value:E});Object.defineProperty(this,g,{value:_});Object.defineProperty(this,y,{value:k});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,B)[B]=o.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new v.NotificationService;babelHelpers.classPrivateFieldLooseBase(this,g)[g]()}showMessage(e){const{message:i,dialog:t,user:a,lines:o}=e;let n="";if(a&&t.type!==b.ChatType.user){n+=`${a.name}: `}n+=r.Parser.purifyMessage(i);let c=`${d}-${t.dialogId}-${i.id}`;if(o){c=`${f}-${t.dialogId}-${i.id}`}const v={id:c,title:t.name,icon:t.avatar||(a==null?void 0:a.avatar),text:n};const p=l.DesktopManager.isChatWindow()&&document.hasFocus();if(p){s.Notifier.notifyViaBrowserProvider(v)}else{s.Notifier.notify(v)}}showNotification(e,i){let a=t.Loc.getMessage("IM_LIB_NOTIFIER_NOTIFY_SYSTEM_TITLE");if(e.title){a=e.title}else if(i){a=i.name}const o=babelHelpers.classPrivateFieldLooseBase(this,y)[y](a,e,i);const r=l.DesktopManager.isChatWindow()&&document.hasFocus();if(r){s.Notifier.notifyViaBrowserProvider(o)}else{s.Notifier.notify(o)}}onNotifierClick(e){const{id:s}=e;if(babelHelpers.classPrivateFieldLooseBase(this,A)[A](s)){const e=babelHelpers.classPrivateFieldLooseBase(this,D)[D](s);void c.Messenger.openChat(e)}else if(babelHelpers.classPrivateFieldLooseBase(this,I)[I](s)){const e=babelHelpers.classPrivateFieldLooseBase(this,D)[D](s);void c.Messenger.openCopilot(e)}else if(babelHelpers.classPrivateFieldLooseBase(this,T)[T](s)){const e=babelHelpers.classPrivateFieldLooseBase(this,D)[D](s);void c.Messenger.openLines(e)}else if(babelHelpers.classPrivateFieldLooseBase(this,C)[C](s)){void c.Messenger.openNotifications()}}}function k(e,s,i){var a;const o={id:`${u}-${s.id}`,title:e,icon:i?i.avatar:"",text:r.Parser.purifyNotification(s)};if(s.sectionCode===b.NotificationTypesCodes.confirm){const[e,i]=s.notifyButtons;o.button1Text=e.TEXT;o.button2Text=i.TEXT}else if(((a=s.params)==null?void 0:a.canAnswer)==="Y"){o.inputPlaceholderText=t.Loc.getMessage("IM_LIB_NOTIFIER_NOTIFY_REPLY_PLACEHOLDER")}return o}function _(){s.Notifier.subscribe("click",(async e=>{if(!n.DesktopApi.isAirDesignEnabledInDesktop()){n.DesktopApi.activateWindow();this.onNotifierClick(e.getData());return}n.DesktopApi.showBrowserWindow();if(n.DesktopApi.isFeatureSupported(n.DesktopFeature.portalTabActivation.id)){await n.DesktopApi.handlePortalTabActivation()}setTimeout((()=>{l.DesktopBroadcastManager.getInstance().sendActionMessage({action:b.DesktopBroadcastAction.notification,params:e.getData()})}),b.WINDOW_ACTIVATION_DELAY)}));s.Notifier.subscribe("action",(e=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H](e.getData())}))}function E(e){const{id:s,action:i,userInput:t}=e;if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C](s)){return}const a=babelHelpers.classPrivateFieldLooseBase(this,m)[m](s);const o=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getters["notifications/getById"](a);if(t){babelHelpers.classPrivateFieldLooseBase(this,M)[M](o,t)}else if(babelHelpers.classPrivateFieldLooseBase(this,X)[X](i,o)){babelHelpers.classPrivateFieldLooseBase(this,N)[N](i,o)}}function x(e,s){babelHelpers.classPrivateFieldLooseBase(this,F)[F].sendQuickAnswer({id:e.id,text:s})}function W(e,s){const[i,t]=s.notifyButtons;const a=babelHelpers.classPrivateFieldLooseBase(this,w)[w](e);if(a===h.first){babelHelpers.classPrivateFieldLooseBase(this,O)[O](s,i)}else if(a===h.second){babelHelpers.classPrivateFieldLooseBase(this,O)[O](s,t)}}function $(e,s){const[i,t]=babelHelpers.classPrivateFieldLooseBase(this,j)[j](s);babelHelpers.classPrivateFieldLooseBase(this,F)[F].sendConfirmAction(i,t)}function S(e){return e.startsWith(d)}function Y(e){return e.startsWith(p)}function R(e){return e.startsWith(f)}function V(e){return e.startsWith(u)}function Q(e,s){const i=s.sectionCode;return e.startsWith(P)&&i===b.NotificationTypesCodes.confirm}function U(e){return e.split("-")[2]}function q(e){return e.split("-")[2]}function z(e){return e.split("_")[1]}function G(e){return e.COMMAND_PARAMS.split("|")}Object.defineProperty(K,L,{writable:true,value:void 0});e.MessageNotifierManager=K})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.UI.NotificationManager,BX.Vue3.Vuex,BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Service);
//# sourceMappingURL=message-notifier.bundle.map.js