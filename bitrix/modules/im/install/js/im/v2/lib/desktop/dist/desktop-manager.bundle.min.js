this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,o,n,a,r,l,c,p,d,b,u,v,h,k,g,L,f){"use strict";const P="icon.png";const D="internal.png";const B="http://127.0.0.1:20141";const y=500;const C="bx-im-messenger__out-of-view";const m={};const w={testImageLoad(e=P){let t=null;const s=new Promise((e=>{t=e}));const i=Date.now();let o=false;const n=h.Dom.create({tag:"img",attrs:{src:`${B}/${e}?${i}`,"data-id":i},props:{className:C},events:{error(){if(o){return}const e=this.dataset.id;t(false);clearTimeout(m[e]);h.Dom.remove(this)},load(){const e=this.dataset.id;t(true);clearTimeout(m[e]);h.Dom.remove(this)}}});document.body.append(n);m[i]=setTimeout((()=>{o=true;t(false);h.Dom.remove(n)}),y);return s},testInternetConnection(){const e=Date.now();const t=h.Extension.getSettings("im.v2.lib.desktop");const s=t.get("internetCheckUrl");return new Promise((t=>{fetch(`${s}.${e}`).then((e=>{if(e.status===200){t(true);return}t(false)})).catch((()=>{t(false)}))}))},IMAGE_DESKTOP_RUN:P,IMAGE_DESKTOP_TWO_WINDOW_MODE:D};let F=[];let H=0;const A={openConference(e){if(!u.Utils.conference.isValidCode(e)){return false}if(!f.DesktopApi.isDesktop()){return false}let t=null;const s=[{width:2560,height:1440},{width:2048,height:1152},{width:1920,height:1080},{width:1600,height:900},{width:1366,height:768},{width:1024,height:576}];for(const e of s){t=e;if(screen.width>e.width&&screen.height>e.height){break}}F=F.filter((e=>Boolean(f.DesktopApi.findWindow(e))));F.push(u.Utils.conference.getWindowNameByCode(e));f.DesktopApi.createWindow(u.Utils.conference.getWindowNameByCode(e),(s=>{s.SetProperty("title",h.Loc.getMessage("IM_LIB_DESKTOP_CONFERENCE_TITLE"));s.SetProperty("clientSize",{Width:t.width,Height:t.height});s.ExecuteCommand("center");s.SetProperty("minClientSize",{Width:940,Height:400});s.SetProperty("backgroundColor","#2B3038");s.ExecuteCommand("html.load",`<script>location.href="/desktop_app/router.php?alias=${e}&videoconf";<\/script>`);s.ExecuteCommand("show");s.ExecuteCommand("center")}));return true},toggleConference(){if(H>F.length-1){H=0;f.DesktopApi.showWindow();return true}F=F.filter((e=>Boolean(f.DesktopApi.findWindow(e))));for(let e=H;e<F.length;e++){H++;const t=f.DesktopApi.findWindow(F[e]);if(t){f.DesktopApi.activateWindow(t);break}}return true}};const x="!!";const I={encodeParams(e){if(!h.Type.isPlainObject(e)){return""}let t="";Object.entries(e).forEach((([e,s])=>{const i="";t+=`${i}${e}${x}${s}`}));return t},decodeParams(e){const t={};if(!h.Type.isStringFilled(e)){return t}const s=e.split(x);for(let e=0;e<s.length;e+=2){const i=s[e];const o=s[e+1];t[i]=o}return t},encodeParamsJson(e){if(!h.Type.isPlainObject(e)){return"{}"}let t="";try{t=encodeURIComponent(JSON.stringify(e))}catch(e){console.error("DesktopUtils: could not encode params.",e);t="{}"}return t},decodeParamsJson(e){let t={};if(!h.Type.isStringFilled(e)){return t}try{t=JSON.parse(decodeURIComponent(e))}catch(e){console.error("DesktopUtils: could not decode encoded params.",e)}return t}};const T={handleCommand(e,t){const s=t!=null?t:{};Object.entries(s).forEach((([e,t])=>{s[e]=decodeURIComponent(t)}));if(e!==k.DesktopBxLink.openPage&&!f.DesktopApi.isAirDesignEnabledInDesktop()){f.DesktopApi.activateWindow()}if(e===k.DesktopBxLink.chat){var i;const e=(i=s.messageId)!=null?i:0;void n.Messenger.openChat(s.dialogId,e)}else if(e===k.DesktopBxLink.lines){void n.Messenger.openLines(s.dialogId)}else if(e===k.DesktopBxLink.conference){void b.DesktopManager.getInstance().openConference(s.code)}else if(e===k.DesktopBxLink.call){const e=s.withVideo!=="N";void n.Messenger.startVideoCall(s.dialogId,e)}else if(e===k.DesktopBxLink.phone){const e=I.decodeParamsJson(s.phoneParams);void n.Messenger.startPhoneCall(s.number,e)}else if(e===k.DesktopBxLink.callList){const e=I.decodeParamsJson(s.callListParams);void n.Messenger.startCallList(s.callListId,e)}else if(e===k.DesktopBxLink.notifications){void n.Messenger.openNotifications()}else if(e===k.DesktopBxLink.recentSearch){void n.Messenger.openRecentSearch()}else if(e===k.DesktopBxLink.copilot){void n.Messenger.openCopilot(s.dialogId)}else if(e===k.DesktopBxLink.collab){void n.Messenger.openCollab(s.dialogId)}else if(e===k.DesktopBxLink.settings){void n.Messenger.openSettings({onlyPanel:s.section})}else if(e===k.DesktopBxLink.chatCreation){void n.Messenger.openChatCreation(s.chatType)}else if(e===k.DesktopBxLink.openLayout){const{id:e,entityId:t}=s;void n.Messenger.openNavigationItem({id:e,entityId:t})}else if(e===k.DesktopBxLink.timeManager){var o,a;(o=BX.Timeman)==null?void 0:(a=o.Monitor)==null?void 0:a.openReport()}else if(e===k.DesktopBxLink.openTab){f.DesktopApi.setActiveTab()}else if(e===k.DesktopBxLink.openPage){const e=I.decodeParamsJson(s.options);f.DesktopApi.openPage(e.url,e.options)}else if(e===k.DesktopBxLink.botContext){const{dialogId:e,context:t}=s;const i=I.decodeParamsJson(t);void n.Messenger.openChatWithBotContext(e,i)}},handleLegacyCommand(e,t){const s=t!=null?t:{};Object.entries(s).forEach((([e,t])=>{s[e]=decodeURIComponent(t)}));if(!f.DesktopApi.isAirDesignEnabledInDesktop()){f.DesktopApi.activateWindow()}if(e===k.LegacyDesktopBxLink.messenger){if(s.dialog){void n.Messenger.openChat(s.dialog)}else if(s.chat){void n.Messenger.openChat(`chat${s.chat}`)}else{void n.Messenger.openChat()}}else if(e===k.LegacyDesktopBxLink.chat&&s.id){void n.Messenger.openChat(`chat${s.id}`)}else if(e===k.LegacyDesktopBxLink.notify){void n.Messenger.openNotifications()}else if(e===k.LegacyDesktopBxLink.callTo){if(s.video){void n.Messenger.startVideoCall(s.video)}else if(s.audio){void n.Messenger.startVideoCall(s.audio,false)}else if(s.phone){void n.Messenger.startPhoneCall(s.phone)}}else if(e===k.LegacyDesktopBxLink.callList){void n.Messenger.openRecentSearch()}}};var E=babelHelpers.classPrivateFieldLooseKey("subscribeToBxProtocolEvent");var M=babelHelpers.classPrivateFieldLooseKey("subscribeToLegacyBxProtocolEvent");class O{static init(){return new O}constructor(){Object.defineProperty(this,M,{value:j});Object.defineProperty(this,E,{value:S});babelHelpers.classPrivateFieldLooseBase(this,E)[E]();babelHelpers.classPrivateFieldLooseBase(this,M)[M]()}}function S(){f.DesktopApi.subscribe(k.EventType.desktop.onBxLink,(async(e,t)=>{if(!f.DesktopApi.isAirDesignEnabledInDesktop()){T.handleCommand(e,t);return}f.DesktopApi.showBrowserWindow();if(f.DesktopApi.isFeatureSupported(f.DesktopFeature.portalTabActivation.id)){await f.DesktopApi.handlePortalTabActivation()}setTimeout((()=>{b.DesktopBroadcastManager.getInstance().sendActionMessage({action:k.DesktopBroadcastAction.bxLink,params:{command:e,rawParams:t}})}),k.WINDOW_ACTIVATION_DELAY)}))}function j(){f.DesktopApi.subscribe(k.EventType.desktop.onBxLink,((e,t)=>{T.handleLegacyCommand(e,t)}))}var $=babelHelpers.classPrivateFieldLooseKey("subscribeToLogoutEvent");var K=babelHelpers.classPrivateFieldLooseKey("onExit");class W{static init(){return new W}constructor(){Object.defineProperty(this,K,{value:R});Object.defineProperty(this,$,{value:U});babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}}function U(){f.DesktopApi.subscribe(k.EventType.desktop.onExit,babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this))}function R(){a.runAction(k.RestMethod.imV2DesktopLogout).finally((()=>{f.DesktopApi.shutdown()}))}var N=babelHelpers.classPrivateFieldLooseKey("subscribeToIconClickEvent");var X=babelHelpers.classPrivateFieldLooseKey("onIconClick");var V=babelHelpers.classPrivateFieldLooseKey("subscribeToAwayEvent");var _=babelHelpers.classPrivateFieldLooseKey("onUserAway");var J=babelHelpers.classPrivateFieldLooseKey("subscribeToFocusEvent");var G=babelHelpers.classPrivateFieldLooseKey("subscribeToBlurEvent");var q=babelHelpers.classPrivateFieldLooseKey("removeNativeNotifications");var z=babelHelpers.classPrivateFieldLooseKey("setInitialStatus");var Y=babelHelpers.classPrivateFieldLooseKey("subscribeToStatusChange");class Q{static init(){return new Q}constructor(){Object.defineProperty(this,Y,{value:re});Object.defineProperty(this,z,{value:ae});Object.defineProperty(this,q,{value:ne});Object.defineProperty(this,G,{value:oe});Object.defineProperty(this,J,{value:ie});Object.defineProperty(this,_,{value:se});Object.defineProperty(this,V,{value:te});Object.defineProperty(this,X,{value:ee});Object.defineProperty(this,N,{value:Z});babelHelpers.classPrivateFieldLooseBase(this,V)[V]();babelHelpers.classPrivateFieldLooseBase(this,J)[J]();babelHelpers.classPrivateFieldLooseBase(this,G)[G]();babelHelpers.classPrivateFieldLooseBase(this,N)[N]();babelHelpers.classPrivateFieldLooseBase(this,z)[z]();babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]()}}function Z(){f.DesktopApi.subscribe(k.EventType.desktop.onIconClick,babelHelpers.classPrivateFieldLooseBase(this,X)[X].bind(this))}function ee(){Lt.getInstance().toggleConference()}function te(){f.DesktopApi.subscribe(k.EventType.desktop.onUserAway,babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}function se(e){const t=e?k.RestMethod.imUserStatusIdleStart:k.RestMethod.imUserStatusIdleEnd;l.Core.getRestClient().callMethod(t).catch((e=>{console.error(`Desktop: error in ${t}  - ${e}`)}))}function ie(){h.Event.bind(window,"focus",babelHelpers.classPrivateFieldLooseBase(this,q)[q].bind(this))}function oe(){h.Event.bind(window,"blur",babelHelpers.classPrivateFieldLooseBase(this,q)[q].bind(this))}function ne(){if(!h.Browser.isWin()||!f.DesktopApi.isChatWindow()){return}f.DesktopApi.removeNativeNotifications()}function ae(){const e=l.Core.getStore().getters["application/settings/get"](k.Settings.user.status);f.DesktopApi.setIconStatus(e)}function re(){const e=(e,t)=>t["application/settings/get"](k.Settings.user.status);l.Core.getStore().watch(e,(e=>{f.DesktopApi.setIconStatus(e)}))}var le=babelHelpers.classPrivateFieldLooseKey("store");var ce=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var pe=babelHelpers.classPrivateFieldLooseKey("onCounterChange");class de{static init(){return new de}constructor(){Object.defineProperty(this,pe,{value:ue});Object.defineProperty(this,ce,{value:be});Object.defineProperty(this,le,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,le)[le]=l.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]();babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()}}function be(){r.EventEmitter.subscribe(k.EventType.counter.onNotificationCounterChange,babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].bind(this));r.EventEmitter.subscribe(k.EventType.counter.onChatCounterChange,babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].bind(this))}function ue(){const e=babelHelpers.classPrivateFieldLooseBase(this,le)[le].getters["counters/getTotalChatCounter"];const t=babelHelpers.classPrivateFieldLooseBase(this,le)[le].getters["notifications/getCounter"];const s=e>0;f.DesktopApi.setCounter(e+t,s)}var ve=babelHelpers.classPrivateFieldLooseKey("bindHotkeys");class he{static init(){return new he}constructor(){Object.defineProperty(this,ve,{value:ke});babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()}}function ke(){h.Event.bind(window,"keydown",(e=>{const t=u.Utils.key.isCombination(e,"Ctrl+R");if(t){f.DesktopApi.reloadWindow();v.Logger.desktop("NOTICE: User reload window (hotkey)");return}const s=u.Utils.key.isCombination(e,"Ctrl+Shift+L");if(s){f.DesktopApi.openLogsFolder();v.Logger.desktop("NOTICE: User open log folder (hotkey)");return}const i=u.Utils.key.isCombination(e,"Ctrl+Shift+D");if(i){f.DesktopApi.openDeveloperTools();v.Logger.desktop("NOTICE: User open developer tools (hotkey)")}}))}var ge=babelHelpers.classPrivateFieldLooseKey("subscribeToNewTabEvent");var Le=babelHelpers.classPrivateFieldLooseKey("onNewTabClick");class fe{static init(){return new fe}constructor(){Object.defineProperty(this,Le,{value:De});Object.defineProperty(this,ge,{value:Pe});babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}}function Pe(){f.DesktopApi.subscribe(k.EventType.desktop.onNewTabClick,babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].bind(this))}function De(){f.DesktopApi.createTab("/desktop/menu/")}const Be={init(){const e=f.DesktopApi.getSliderBindingsStatus();if(e){BX.SidePanel.Instance.enableAnchorBinding();return}BX.SidePanel.Instance.disableAnchorBinding()}};const ye={async reloadChatInfo(){await d.RecentService.getInstance().requestItems({firstPage:true});const e=p.LayoutManager.getInstance().getLayout();if(e.entityId){await this.reopenChat(e)}},async reopenChat(e){p.LayoutManager.getInstance().clearCurrentLayoutEntityId();const t=new c.ChatService;await t.resetChat(e.entityId);void p.LayoutManager.getInstance().setLayout(e)}};var Ce=babelHelpers.classPrivateFieldLooseKey("initDate");var me=babelHelpers.classPrivateFieldLooseKey("wakeUpTimer");var we=babelHelpers.classPrivateFieldLooseKey("onWakeUp");class Fe{static init(){return new Fe}constructor(){Object.defineProperty(this,we,{value:He});Object.defineProperty(this,Ce,{writable:true,value:void 0});Object.defineProperty(this,me,{writable:true,value:null});this.sidePanelManager=BX.SidePanel.Instance;babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=new Date;f.DesktopApi.subscribe(k.EventType.desktop.onWakeUp,babelHelpers.classPrivateFieldLooseBase(this,we)[we].bind(this))}}async function He(){const e=await w.testInternetConnection();if(!e){v.Logger.desktop("StatusHandler: onWakeUp event, no internet connection, delay 60 sec");clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);babelHelpers.classPrivateFieldLooseBase(this,me)[me]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,we)[we].bind(this),60*1e3);return}if(u.Utils.date.isSameHour(new Date,babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce])){v.Logger.desktop("StatusHandler: onWakeUp event, same hour - restart pull client");l.Core.getPullClient().restart()}else{if(this.sidePanelManager.opened){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);babelHelpers.classPrivateFieldLooseBase(this,me)[me]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,we)[we].bind(this),60*1e3);v.Logger.desktop("StatusHandler: onWakeUp event, slider is open, delay 60 sec");return}if(g.CallManager.getInstance().hasCurrentCall()){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);babelHelpers.classPrivateFieldLooseBase(this,me)[me]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,we)[we].bind(this),60*1e3);v.Logger.desktop("StatusHandler: onWakeUp event, call is active, delay 60 sec");return}v.Logger.desktop("StatusHandler: onWakeUp event, reload window");if(!b.DesktopManager.getInstance().canReloadWindow()){await ye.reloadChatInfo();return}f.DesktopApi.reloadWindow()}}const Ae=60*60*1e3;var xe=babelHelpers.classPrivateFieldLooseKey("initDate");var Ie=babelHelpers.classPrivateFieldLooseKey("sidePanelManager");var Te=babelHelpers.classPrivateFieldLooseKey("startReloadCheck");var Ee=babelHelpers.classPrivateFieldLooseKey("isReloadNeeded");var Me=babelHelpers.classPrivateFieldLooseKey("reloadWindow");class Oe{static init(){return new Oe}constructor(){Object.defineProperty(this,Me,{value:$e});Object.defineProperty(this,Ee,{value:je});Object.defineProperty(this,Te,{value:Se});Object.defineProperty(this,xe,{writable:true,value:void 0});Object.defineProperty(this,Ie,{writable:true,value:BX.SidePanel.Instance});babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=new Date;babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]()}}function Se(){setInterval((async()=>{const e=await babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]();if(!e){return}if(!b.DesktopManager.getInstance().canReloadWindow()){await ye.reloadChatInfo();return}babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]()}),Ae)}async function je(){if(u.Utils.date.isSameDay(new Date,babelHelpers.classPrivateFieldLooseBase(this,xe)[xe])){return false}if(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].opened){v.Logger.desktop("Checker: checkDayForReload, slider is open - delay reload");return false}if(g.CallManager.getInstance().hasCurrentCall()){v.Logger.desktop("Checker: checkDayForReload, call is active - delay reload");return false}return w.testInternetConnection()}function $e(){v.Logger.desktop("Checker: checkDayForReload, new day - reload window");f.DesktopApi.reloadWindow()}var Ke=babelHelpers.classPrivateFieldLooseKey("sendInitEvent");var We=babelHelpers.classPrivateFieldLooseKey("initComplete");var Ue=babelHelpers.classPrivateFieldLooseKey("subscribeOnErrorEvent");var Re=babelHelpers.classPrivateFieldLooseKey("handleInvalidAuthError");class Ne{static init(){return new Ne}constructor(){Object.defineProperty(this,Re,{value:Je});Object.defineProperty(this,Ue,{value:_e});Object.defineProperty(this,We,{value:Ve});Object.defineProperty(this,Ke,{value:Xe});Oe.init();Fe.init();Q.init();W.init();O.init();de.init();he.init();fe.init();Be.init();babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]();babelHelpers.classPrivateFieldLooseBase(this,We)[We]()}}function Xe(){const{currentUser:e}=l.Core.getApplicationData();f.DesktopApi.emit(k.EventType.desktop.onInit,[{userInfo:e!=null?e:{}}])}function Ve(){f.DesktopApi.setLogInfo=function(...e){v.Logger.desktop(...e)};window.BX.debugEnable(true);f.DesktopApi.printWelcomePrompt()}function _e(){r.EventEmitter.subscribe(k.EventType.request.onAuthError,(()=>babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]()))}function Je(){return f.DesktopApi.login()}var Ge=babelHelpers.classPrivateFieldLooseKey("initComplete");class qe{static init(){return new qe}constructor(){Object.defineProperty(this,Ge,{value:ze});if(f.DesktopApi.isAirDesignEnabledInDesktop()){Oe.init();Fe.init();he.init();Be.init()}fe.init();babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]()}}function ze(){f.DesktopApi.setLogInfo=function(...e){v.Logger.desktop(...e)}}const Ye="im-channel-desktop";var Qe=babelHelpers.classPrivateFieldLooseKey("actionHandlers");var Ze=babelHelpers.classPrivateFieldLooseKey("onNotifierClick");var et=babelHelpers.classPrivateFieldLooseKey("onAnswerButtonClick");var tt=babelHelpers.classPrivateFieldLooseKey("handleBxLinkCommand");class st{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){st.getInstance()}constructor(){Object.defineProperty(this,tt,{value:nt});Object.defineProperty(this,et,{value:ot});Object.defineProperty(this,Ze,{value:it});Object.defineProperty(this,Qe,{writable:true,value:{[k.DesktopBroadcastAction.notification]:babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].bind(this),[k.DesktopBroadcastAction.answerButtonClick]:babelHelpers.classPrivateFieldLooseBase(this,et)[et].bind(this),[k.DesktopBroadcastAction.bxLink]:babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].bind(this)}});this.initBroadcastHandler()}initBroadcastHandler(){this.channel=new BroadcastChannel(Ye);if(f.DesktopApi.isChatWindow()){return}h.Event.bind(this.channel,"message",(e=>{const{data:t}=e;if(!f.DesktopApi.isActiveTab()){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe][t.action];if(!s){return}s(t.params)}))}sendActionMessage(e){this.channel.postMessage(e)}}function it(e){L.MessageNotifierManager.getInstance().onNotifierClick(e)}function ot(e){const{mediaParams:t,callParams:s}=e;g.CallManager.getInstance().onAnswerButtonClick(t,s)}function nt(e){T.handleCommand(e.command,e.rawParams)}const at=2;const rt=1e3;const lt=17;const ct="update-banner";var pt=babelHelpers.classPrivateFieldLooseKey("desktopIsActive");var dt=babelHelpers.classPrivateFieldLooseKey("desktopActiveVersion");var bt=babelHelpers.classPrivateFieldLooseKey("locationChangedToBx");var ut=babelHelpers.classPrivateFieldLooseKey("enableRedirectCounter");var vt=babelHelpers.classPrivateFieldLooseKey("prepareBxUrl");var ht=babelHelpers.classPrivateFieldLooseKey("shouldShowDesktopUpdateBanner");var kt=babelHelpers.classPrivateFieldLooseKey("showDesktopUpdateBanner");var gt=babelHelpers.classPrivateFieldLooseKey("initDesktopStatus");class Lt{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){Lt.getInstance()}static isDesktop(){return f.DesktopApi.isDesktop()}static isChatWindow(){return f.DesktopApi.isChatWindow()}constructor(){Object.defineProperty(this,gt,{value:Bt});Object.defineProperty(this,kt,{value:Dt});Object.defineProperty(this,ht,{value:Pt});Object.defineProperty(this,vt,{value:ft});Object.defineProperty(this,pt,{writable:true,value:void 0});Object.defineProperty(this,dt,{writable:true,value:void 0});Object.defineProperty(this,bt,{writable:true,value:false});Object.defineProperty(this,ut,{writable:true,value:1});babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]();if(!Lt.isDesktop()){return}if(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]()){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]();return}if(f.DesktopApi.isAirDesignEnabledInDesktop()){st.init()}if(f.DesktopApi.isChatWindow()){Ne.init()}else{qe.init()}}isDesktopActive(){if(Lt.isDesktop()){return true}return babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]}setDesktopActive(e){babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=e}setDesktopVersion(e){babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=e}getDesktopVersion(){return babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]}isLocationChangedToBx(){return babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]}canReloadWindow(){return!f.DesktopApi.isAirDesignEnabledInDesktop()||p.LayoutManager.getInstance().isEmbeddedMode()}redirectToChat(e="",t=0){v.Logger.warn("Desktop: redirectToChat",e);let s=`bx://${k.DesktopBxLink.chat}/dialogId/${e}`;if(t>0){s+=`/messageId/${t}`}this.openBxLink(s);return Promise.resolve()}redirectToChatWithBotContext(e="",t={}){v.Logger.warn("Desktop: redirectToChatWithBotContext",e);let s=`bx://${k.DesktopBxLink.botContext}/dialogId/${e}`;if(!h.Type.isPlainObject(t)){return Promise.reject()}const i=I.encodeParamsJson(t);s+=`/context/${i}`;this.openBxLink(s);return Promise.resolve()}redirectToLines(e=""){v.Logger.warn("Desktop: redirectToLines",e);this.openBxLink(`bx://${k.DesktopBxLink.lines}/dialogId/${e}`);return Promise.resolve()}redirectToCopilot(e=""){v.Logger.warn("Desktop: redirectToCopilot",e);this.openBxLink(`bx://${k.DesktopBxLink.copilot}/dialogId/${e}`);return Promise.resolve()}redirectToCollab(e=""){v.Logger.warn("Desktop: redirectToCollab",e);this.openBxLink(`bx://${k.DesktopBxLink.collab}/dialogId/${e}`);return Promise.resolve()}redirectToNotifications(){v.Logger.warn("Desktop: redirectToNotifications");this.openBxLink(`bx://${k.DesktopBxLink.notifications}`);return Promise.resolve()}redirectToRecentSearch(){v.Logger.warn("Desktop: redirectToRecentSearch");this.openBxLink(`bx://${k.DesktopBxLink.recentSearch}`);return Promise.resolve()}redirectToConference(e){v.Logger.warn("Desktop: redirectToConference",e);this.openBxLink(`bx://${k.DesktopBxLink.conference}/code/${e}`);return Promise.resolve()}redirectToSettings(e){v.Logger.warn("Desktop: redirectToSettings",e);this.openBxLink(`bx://${k.DesktopBxLink.settings}/section/${e}`);return Promise.resolve()}openConference(e){v.Logger.warn("Desktop: openConference",e);const t=A.openConference(e);if(!t){return Promise.resolve(false)}return Promise.resolve(true)}toggleConference(){v.Logger.warn("Desktop: toggleConference");A.toggleConference()}redirectToChatCreation(e){v.Logger.warn("Desktop: redirectToChatCreation",e);this.openBxLink(`bx://${k.DesktopBxLink.chatCreation}/chatType/${e}/`);return Promise.resolve()}redirectToVideoCall(e="",t=true){v.Logger.warn("Desktop: redirectToVideoCall",e,t);const s=t?"Y":"N";this.openBxLink(`bx://${k.DesktopBxLink.call}/dialogId/${e}/withVideo/${s}`);return Promise.resolve()}redirectToPhoneCall(e,t){v.Logger.warn("Desktop: redirectToPhoneCall",e,t);const s=I.encodeParamsJson(t);this.openBxLink(`bx://${k.DesktopBxLink.phone}/number/${e}/phoneParams/${s}`);return Promise.resolve()}redirectToCallList(e,t){v.Logger.warn("Desktop: redirectToCallList",e,t);const s=I.encodeParamsJson(t);this.openBxLink(`bx://${k.DesktopBxLink.callList}/callListId/${e}/callListParams/${s}`);return Promise.resolve()}openAccountTab(e){this.openBxLink(`bx://v2/${e}/${k.DesktopBxLink.openTab}`)}openPage(e,t={}){const s=I.encodeParamsJson({url:e,options:t});this.openBxLink(`bx://${k.DesktopBxLink.openPage}/options/${s}`)}redirectToLayout({id:e,entityId:t}){v.Logger.warn("Desktop: redirectToLayout",e,t);const s=t!=null?t:"";this.openBxLink(`bx://${k.DesktopBxLink.openLayout}/id/${e}/entityId/${s}`);return Promise.resolve()}async checkStatusInDifferentContext(){if(!this.isDesktopActive()){return false}if(f.DesktopApi.isChatWindow()){return false}if(f.DesktopApi.isDesktop()&&!f.DesktopApi.isChatWindow()){return true}return w.testImageLoad()}checkForRedirect(){if(!this.isRedirectEnabled()||!this.isRedirectOptionEnabled()){return Promise.resolve(false)}if(f.DesktopApi.isAirDesignEnabledInDesktop()){return Promise.resolve(false)}return this.checkStatusInDifferentContext()}async checkForOpenBrowserPage(){await l.Core.ready();if(!this.isDesktopActive()||!this.isRedirectOptionEnabled()){return false}const e=this.getDesktopVersion();if(!f.DesktopApi.isFeatureSupportedInVersion(e,f.DesktopFeature.openPage.id)){return false}return w.testImageLoad(w.IMAGE_DESKTOP_TWO_WINDOW_MODE)}isRedirectEnabled(){return babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]>0}enableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]++}disableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]--}isRedirectOptionEnabled(){if(!o.FeatureManager.isFeatureAvailable(o.Feature.isDesktopRedirectAvailable)){return false}if(f.DesktopApi.isDesktop()&&!f.DesktopApi.isChatWindow()){return true}return l.Core.getStore().getters["application/settings/get"](k.Settings.desktop.enableRedirect)}openBxLink(e){const t=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt](e);babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]=true;setTimeout((()=>{const e=new r.BaseEvent({compatData:[]});r.EventEmitter.emit(window,"BXLinkOpened",e);babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]=false}),rt);location.href=t}}function ft(e){if(/^bx:\/\/v(\d)\//.test(e)){return e}return e.replace("bx://",`bx://v${at}/${location.hostname}/`)}function Pt(){const e=f.DesktopApi.getMajorVersion()<lt;return e&&f.DesktopApi.isAirDesignEnabledInDesktop()}function Dt(){const e=t.BitrixVue.createApp({name:ct,components:{DesktopUpdateBanner:s.DesktopUpdateBanner},template:"<DesktopUpdateBanner />"});e.mount(document.body);i.Analytics.getInstance().desktopUpdateBanner.onShow()}function Bt(){const e=h.Extension.getSettings("im.v2.lib.desktop");this.setDesktopActive(e.get("desktopIsActive"));this.setDesktopVersion(e.get("desktopActiveVersion"))}e.DesktopManager=Lt;e.DesktopBroadcastManager=st})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Vue3,BX.Messenger.v2.Component.Desktop,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=desktop-manager.bundle.map.js