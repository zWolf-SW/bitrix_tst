this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,n,s,i,r,a,o,l,d,c,g){"use strict";const h="im:slider";const u=1200;const m="bx-im-messenger__slider";class p{static init(){if(this.instance){return}this.instance=new this}static getInstance(){this.init();return this.instance}constructor(){this.instances={};this.sidePanelManager=n.SidePanel.Instance;a.Logger.warn("Slider: class created");this.bindEvents();this.store=i.Core.getStore()}bindEvents(){s.EventEmitter.subscribe("SidePanel.Slider:onCloseByEsc",this.onCloseByEsc.bind(this));s.EventEmitter.subscribe("SidePanel.Slider:onClose",this.onClose.bind(this));s.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.onDestroy.bind(this));t.Event.ready(this.initZIndex.bind(this));return true}openSlider(){if(this.isChatEmbeddedOnPage()){return Promise.resolve()}if(l.DesktopManager.isChatWindow()){this.sidePanelManager.closeAll(true);return Promise.resolve()}if(this.isOpened()){t.ZIndexManager.bringToFront(this.getCurrent().getOverlay());return Promise.resolve()}void this.launchMessengerApplication();return new Promise((e=>{if(this.isFocused()){e();return}const t=this.getNextId();this.sidePanelManager.open(`${h}:${t}`,{data:{rightBoundary:0},cacheable:false,animationDuration:100,hideControls:true,customLeftBoundary:0,customRightBoundary:0,loader:this.getLoaderPath(),contentCallback:()=>`<div class="${m}"></div>`,events:{onOpenComplete:async t=>{t.slider.showLoader();await this.initMessengerComponent();t.slider.closeLoader();return e()}}});this.instances[t]=this.sidePanelManager.getSlider(`${h}:${t}`)}))}launchMessengerApplication(){if(this.applicationPromise){return this.applicationPromise}this.applicationPromise=t.Runtime.loadExtension("im.v2.application.messenger").then((()=>o.Launch("messenger"))).then((e=>{a.Logger.warn("Slider: Messenger application launched",e);return e}));return this.applicationPromise}async initMessengerComponent(){const e=await this.applicationPromise;return e.initComponent(`.${m}`)}onDialogOpen(e){a.Logger.warn("Slider: onDialogOpen",e.data.dialogId)}async onClose({data:e}){[e]=e;const t=e.getSlider().getUrl().toString();if(!t.startsWith(h)){return}if(!this.canClose()){e.denyAction();return}const n=c.CallManager.getInstance().hasCurrentCall();if(n){e.denyAction();const t=await g.showCloseWithActiveCallConfirm();if(t){c.CallManager.getInstance().leaveCurrentCall();e.slider.close()}return}const i=this.getIdFromSliderId(t);delete this.instances[i];s.EventEmitter.emit(r.EventType.slider.onClose);d.LayoutManager.getInstance().setLayout({name:r.Layout.chat.name})}onCloseByEsc({data:e}){[e]=e;const t=e.getSlider().getUrl().toString();if(!t.startsWith(h)){return}if(!this.canCloseByEsc()){e.denyAction()}}onDestroy({data:e}){[e]=e;const t=e.getSlider().getUrl().toString();if(!t.startsWith(h)){return}const n=this.getIdFromSliderId(t);delete this.instances[n]}initZIndex(){if(!t.ZIndexManager){return}const e=t.ZIndexManager.getOrAddStack(document.body);e.baseIndex=u;e.sort()}getZIndex(){return u}isOpened(){return Object.keys(this.instances).length>0}isFocused(){if(!this.isOpened()){return false}const e=this.sidePanelManager.getTopSlider();if(!e){return false}return e.getUrl().toString().startsWith(h)}canClose(){return true}canCloseByEsc(){return false}getCurrent(){return this.instances[this.getCurrentId()]}getCurrentId(){return Object.keys(this.instances).length}getNextId(){return this.getCurrentId()+1}getIdFromSliderId(e){return Number.parseInt(e.slice(h.length+1),10)}getLoaderPath(){const e="/bitrix/js/im/v2/lib/slider/src/images/loader-chats.svg?v3";const t="/bitrix/js/im/v2/lib/slider/src/images/loader-chats-without-navigation.svg";const n=!d.LayoutManager.getInstance().isAirDesignEnabled();return n?e:t}isChatEmbeddedOnPage(){return d.LayoutManager.getInstance().isQuickAccessHidden()}}p.instance=null;e.MessengerSlider=p})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.SidePanel,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=slider.bundle.map.js