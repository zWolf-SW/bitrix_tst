this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,s,o,i,n,r){"use strict";const a={isDesktop(){return i.Type.isObject(window.BXDesktopSystem)},restart(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.Restart()},shutdown(){var t;(t=BXDesktopSystem)==null?void 0:t.Shutdown()}};const l={mask:{id:"mask",version:72},restart:{id:"restart",version:74},accountManagement:{id:"accountManagement",version:75},openNewTab:{id:"openNewTab",version:76},openPage:{id:"openPage",version:79},portalTabActivation:{id:"portalTabActivation",version:85}};const u={getMajorVersion(){if(!this.isDesktop()){return 0}const[t]=window.BXDesktopSystem.GetProperty("versionParts");return t},getApiVersion(){if(!this.isDesktop()){return 0}const[t,e,s,o]=window.BXDesktopSystem.GetProperty("versionParts");return o},isFeatureEnabled(t){var e;return Boolean((e=window.BXDesktopSystem)==null?void 0:e.FeatureEnabled(t))},isFeatureSupported(t){return this.isFeatureSupportedInVersion(this.getApiVersion(),t)},isFeatureSupportedInVersion(t,e){if(!l[e]){return false}return t>=l[e].version},getWindowsOSBuild(){var t,e;if(!i.Browser.isWin()){return 0}return(t=(e=window.BXDesktopSystem)==null?void 0:e.UserOsBuild())!=null?t:0}};const d={};const c={subscribe(t,e){if(!this.isDesktop()){return}const s=t=>{var s;const o=(s=t.detail)!=null?s:[];e.apply(window,o)};if(!d[t]){d[t]=[]}d[t].push(s);i.Event.bind(window,t,s)},unsubscribe(t,e){if(!i.Type.isFunction(e)){if(!i.Type.isArrayFilled(d[t])){return}d[t].forEach((e=>{i.Event.unbind(window,t,e)}));return}i.Event.unbind(window,t,e)},emit(t,e=[]){const s=opener||top;const o=s.BXWindows;o.forEach((s=>{var o;if(!s||s.name===""){return}s==null?void 0:(o=s.BXDesktopWindow)==null?void 0:o.DispatchCustomEvent(t,e)}));this.emitToMainWindow(t,e)},emitToMainWindow(t,e=[]){var s,o;const i=opener||top;(s=i.BXDesktopSystem)==null?void 0:(o=s.GetMainWindow())==null?void 0:o.DispatchCustomEvent(t,e)}};const p={hideImTab:"bxd_hide_im_tab",smoothing:"bxd_camera_smoothing",smoothing_v2:"bxd_camera_smoothing_v2",telemetry:"bxd_telemetry",sliderBindingsStatus:"sliderBindingsStatus"};const m={getSliderBindingsStatus(){const t=this.getCustomSetting(p.sliderBindingsStatus,"1");return t==="1"},isAirDesignEnabledInDesktop(){const t=i.Extension.getSettings("im.v2.lib.layout");return this.isDesktop()&&t.get("isAirDesignEnabled",true)},getCameraSmoothingStatus(){return this.getCustomSetting(p.smoothing,"0")==="1"},setCameraSmoothingStatus(t){const e=t===true?"1":"0";if(this.getApiVersion()>76){this.setCustomSetting(p.smoothing_v2,e);return}this.setCustomSetting(p.smoothing,e)},isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},setTwoWindowMode(t){var e;if(t===true){var s;(s=BXDesktopSystem)==null?void 0:s.V10();return}(e=BXDesktopSystem)==null?void 0:e.V8()},getAutostartStatus(){var t;return(t=BXDesktopSystem)==null?void 0:t.GetProperty("autostart")},setAutostartStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetProperty("autostart",t)},getTelemetryStatus(){return this.getCustomSetting(p.telemetry,"1")==="1"},setTelemetryStatus(t){this.setCustomSetting(p.telemetry,t?"1":"0")},setCustomSetting(t,e){var s;(s=BXDesktopSystem)==null?void 0:s.StoreSettings(t,e)},getCustomSetting(t,e){var s;return(s=BXDesktopSystem)==null?void 0:s.QuerySettings(t,e)}};const v={async handlePortalTabActivation(){const t=await this.hasActivePortalTab();if(t){return Promise.resolve()}this.activatePortalFirstTab();return Promise.resolve()},activatePortalFirstTab(){BXDesktopSystem.ActivateFirstTab()},hasActivePortalTab(){return BXDesktopSystem.HasActiveTab()},setTabWithChatPageActive(){this.setActiveTabUrl(`${location.origin}${n.Path.online}`)},isTabWithChatPageActive(){const t=this.getTabsList();return t.some((t=>t.visible&&t.url.includes(n.Path.online)))},hasTabWithChatPage(){const t=this.getTabsList();return t.some((t=>t.url.includes(n.Path.online)))},getTabsList(){return BXDesktopSystem.BrowserList()},isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},isChatWindow(){const t=i.Extension.getSettings("im.v2.lib.desktop-api");return this.isDesktop()&&t.get("isChatWindow")},isChatTab(){return this.isChatWindow()||this.isDesktop()&&location.href.includes("&IM_TAB=Y")},isActiveTab(){return this.isDesktop()&&BXDesktopSystem.IsActiveTab()},showBrowserWindow(){BXDesktopWindow.ExecuteCommand("show.main")},setActiveTab(t=window){var e;if(!i.Type.isObject(t)){return}(e=t.BXDesktopSystem)==null?void 0:e.SetActiveTab()},setActiveTabUrl(t){BXDesktopSystem.SetActiveTabUrl(t)},showWindow(t=window){var e;if(!i.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("show")},activateWindow(t=window){if(!e.DesktopApi.isAirDesignEnabledInDesktop()){this.setActiveTab(t)}this.showWindow(t)},hideWindow(t=window){var e;if(!i.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("hide")},closeWindow(t=window){var e;if(!i.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("close")},hideLoader(){i.Dom.remove(document.getElementById("bx-desktop-loader"))},reloadWindow(){BXDesktopSystem.Login({})},findWindow(t=""){const e=opener||top;return e.BXWindows.find((e=>(e==null?void 0:e.name)===t))},openPage(t,e={}){const o=new URL(t);if(o.host!==location.host){setTimeout((()=>this.hideWindow()),100);return Promise.resolve(false)}if(!m.isTwoWindowMode()){if(e.skipNativeBrowser===true){setTimeout((()=>this.hideWindow()),100);return Promise.resolve(false)}s.Utils.browser.openLink(o.href);setTimeout((()=>this.hideWindow()),100);return Promise.resolve(true)}this.createTab(o.href);return Promise.resolve(true)},openInBrowser(t){BXDesktopSystem.OpenInBrowser(t)},createTab(t){const e=i.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateTab(e)},createImTab(t){const e=i.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateImTab(e)},createWindow(t,e){BXDesktopSystem.GetWindow(t,e)},createTopmostWindow(t){return BXDesktopSystem.ExecuteCommand("topmost.show.html",t)},setWindowPosition(t){var e;const s={};Object.entries(t).forEach((([t,e])=>{const o=t[0].toUpperCase()+t.slice(1);s[o]=e}));(e=BXDesktopWindow)==null?void 0:e.SetProperty("position",s)},prepareHtml(t,e){let s="";if(i.Type.isDomNode(t)){s=t.outerHTML}else{s=t}let o="";if(i.Type.isDomNode(e)){o=e.outerHTML}else{o=e}i.Event.ready();if(i.Type.isStringFilled(o)){o=`\n\t\t\t\t<script>\n\t\t\t\t\tBX.ready(() => {\n\t\t\t\t\t\t${o}\n\t\t\t\t\t});\n\t\t\t\t<\/script>\n\t\t\t`}const n=document.head.outerHTML.replaceAll(/BX\.PULL\.start\([^)]*\);/g,"");return`\n\t\t\t<!DOCTYPE html>\n\t\t\t<html lang="">\n\t\t\t\t${n}\n\t\t\t\t<body class="im-desktop im-desktop-popup">\n\t\t\t\t\t${s}${o}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`},setWindowSize(t,e){BXDesktopWindow.SetProperty("clientSize",{Width:t,Height:e})},setMinimumWindowSize(t,e){BXDesktopWindow.SetProperty("minClientSize",{Width:t,Height:e})}};const g={setCounter(t,e=false){var s,o;const i=t.toString();(s=BXDesktopSystem)==null?void 0:s.SetIconBadge(i,e);(o=BXDesktopSystem)==null?void 0:o.SetTabBadge(0,i)},setBrowserIconBadge(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetBrowserIconBadge(t.toString())},setIconStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetIconStatus(t)},setOfflineIcon(){var t;(t=BXDesktopSystem)==null?void 0:t.SetIconStatus("offline")},flashIcon(){var t;if(!i.Browser.isWin()){return}(t=BXDesktopSystem)==null?void 0:t.FlashIcon()}};const S={prepareResourcePath(t){let e="";try{const s=new URL(t,location.origin);e=s.href}catch{}return e}};const h={changeTab(t){const e=i.Extension.getSettings("im.v2.lib.desktop-api");const s=e.get("v2");if(s){return}BX.desktop.changeTab(t)}};const B={removeNativeNotifications(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.NotificationRemoveAll()}};const k={writeToLogFile(t,e){var s;if(!i.Type.isStringFilled(t)){console.error("Desktop logger: filename is not defined");return}let o="";if(i.Type.isString(e)){o=e}else if(i.Type.isNumber(e)){o=e.toString()}else{o=JSON.stringify(e)}(s=BXDesktopSystem)==null?void 0:s.Log(t,o)},printWelcomePrompt(){const t=BXDesktopSystem.GetProperty("versionParts").join(".");let e="unknown";if(i.Browser.isMac()){e="MacOS"}else if(i.Browser.isWin()){e="Windows"}else if(i.Browser.isLinux()){e="Linux"}const s=i.Loc.getMessage("IM_LIB_DESKTOP_API_WELCOME_PROMPT",{"#VERSION#":t,"#OS#":e});o.Logger.desktop(s)},setLogInfo(t){BXDesktopSystem.LogInfo=t}};const w={getCallMask(){if(!this.isDesktop()){return{id:""}}return{id:BXDesktopSystem.QuerySettings("bxd_camera_3dbackground_id")||""}},setCallMaskLoadHandlers(t){this.subscribe("BX3dAvatarReady",t);this.subscribe("BX3dAvatarError",t)},setCallMask(t,e,s){if(this.getApiVersion()<72){return false}if(!t){BXDesktopSystem.Set3dAvatar("","");BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id","");return true}e=this.prepareResourcePath(e);s=this.prepareResourcePath(s);BXDesktopSystem.Set3dAvatar(e,s);BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id",t);return true}};const y={isBlur(t){return t.toString().toLowerCase().includes("blur")},getLimitationBackground(t){const e=BX.message("call_features");const s={enable:true};let o="";if(t&&t!=="none"){o=`${this.isBlur(t)?"blur_":""}background`}const i=o?e==null?void 0:e[`call_${o}`]:null;if(!i){return s}return{enable:i.enable,articleCode:i.articleCode}},openArticle(t){const e=BX.UI.InfoHelper;if(e.isOpen()){e.close()}e.show(t)},handleLimitationBackground(t,e){const{enable:s,articleCode:o}=t;if(s&&typeof e==="function"){e()}if(!s&&o){this.openArticle(o)}},getBackgroundImage(){var t;const e=BXDesktopSystem.QuerySettings("bxd_camera_background_id")||"none";if(!this.isDesktop()||!((t=this.getLimitationBackground(e))!=null&&t.enable)){return{id:"none",source:""}}return{id:e}},setCallBackground(t,e){if(e==="none"||e===""){e=""}else if(e==="blur");else if(e==="gaussianBlur"){e="GaussianBlur"}else{e=this.prepareResourcePath(e)}var s=new BX.Promise;const o=this.getLimitationBackground(e);let i="";let n="";this.handleLimitationBackground(o,(()=>{i=e;n=t}));setTimeout((()=>{this.setCallMask(false);BXDesktopSystem.StoreSettings("bxd_camera_background_id",n);BXDesktopSystem.StoreSettings("bxd_camera_background",i);s.resolve(n||"none")}),100);return s}};const D={openAddAccountTab(){var t;(t=BXDesktopSystem)==null?void 0:t.AccountAddForm()},deleteAccount(t,e){var s;(s=BXDesktopSystem)==null?void 0:s.AccountDelete(t,e)},connectAccount(t,e,s,o){var i;(i=BXDesktopSystem)==null?void 0:i.AccountConnect(t,e,s,o)},disconnectAccount(t){var e;(e=BXDesktopSystem)==null?void 0:e.AccountDisconnect(t)},getAccountList(){var t;return(t=BXDesktopSystem)==null?void 0:t.AccountList()},login(){return new Promise((t=>{var e;(e=BXDesktopSystem)==null?void 0:e.Login({success:()=>t()})}))},async logout(){try{var t;await i.ajax.runAction(n.RestMethod.imV2DesktopLogout);(t=BXDesktopSystem)==null?void 0:t.Logout(2)}catch(t){var e;console.error("DesktopApi logout error",t);(e=BXDesktopSystem)==null?void 0:e.Logout(3)}},async terminate(){try{await i.ajax.runAction(n.RestMethod.imV2DesktopLogout)}finally{a.shutdown()}}};const b={startDiskSync(){var t;(t=BXFileStorage)==null?void 0:t.SyncPause(false);const e=new r.BaseEvent({compatData:[true]});r.EventEmitter.emit(window,n.EventType.desktop.onSyncPause,e)},stopDiskSync(){var t;(t=BXFileStorage)==null?void 0:t.SyncPause(true);const e=new r.BaseEvent({compatData:[false]});r.EventEmitter.emit(window,n.EventType.desktop.onSyncPause,e)}};const X={openDeveloperTools(){var t;(t=BXDesktopWindow)==null?void 0:t.OpenDeveloperTools()},openLogsFolder(){var t;(t=BXDesktopSystem)==null?void 0:t.OpenLogsFolder()}};const f={...a,...S,...u,...c,...v,...g,...B,...m,...h,...y,...w,...k,...D,...b,...X};t.DesktopApi=f;t.DesktopFeature=l;t.DesktopSettingsKey=p})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Const,BX.Event);
//# sourceMappingURL=desktop-api.bundle.map.js