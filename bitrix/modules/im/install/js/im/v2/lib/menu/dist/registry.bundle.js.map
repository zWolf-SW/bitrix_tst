{"version":3,"file":"registry.bundle.js","sources":["../src/base/base.js","../src/recent/recent.js","../src/user/user.js","../src/message/classes/message-base.js","../src/message/classes/channel.js","../src/message/classes/comments.js","../src/message/classes/copilot.js","../src/message/message-menu-manager.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { MenuManager, Menu } from 'main.popup';\nimport { EventEmitter } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\n\nimport type { MenuOptions } from 'main.popup';\nimport type { MenuItem } from '../type/menu';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Lib.Menu';\n\nexport class BaseMenu extends EventEmitter\n{\n\tmenuInstance: Menu;\n\tcontext: Object;\n\ttarget: HTMLElement;\n\tstore: Store;\n\trestClient: RestClient;\n\tid: String = 'im-base-context-menu';\n\n\tstatic events = {\n\t\tonCloseMenu: 'onCloseMenu',\n\t};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\n\t\tthis.onClosePopupHandler = this.onClosePopup.bind(this);\n\t}\n\n\t// public\n\topenMenu(context: Object, target: HTMLElement)\n\t{\n\t\tif (this.menuInstance)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\tthis.context = context;\n\t\tthis.target = target;\n\t\tthis.menuInstance = this.getMenuInstance();\n\t\tthis.menuInstance.show();\n\n\t\t// EventEmitter.subscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t}\n\n\tgetMenuInstance(): Menu\n\t{\n\t\treturn MenuManager.create(this.getMenuOptions());\n\t}\n\n\tgetMenuOptions(): MenuOptions\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbindOptions: { forceBindPosition: true, position: 'bottom' },\n\t\t\ttargetContainer: document.body,\n\t\t\tbindElement: this.target,\n\t\t\tcacheable: false,\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\titems: this.#prepareMenuItems(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.emit(BaseMenu.events.onCloseMenu);\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [];\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn '';\n\t}\n\n\tonClosePopup()\n\t{\n\t\tthis.close();\n\t}\n\n\tclose()\n\t{\n\t\t// EventEmitter.unsubscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t\tif (!this.menuInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.menuInstance.destroy();\n\t\tthis.menuInstance = null;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.close();\n\t}\n\n\tgetCurrentUserId(): number\n\t{\n\t\treturn Core.getUserId();\n\t}\n\n\tisDelimiter(element: ?MenuItem): boolean\n\t{\n\t\treturn Type.isObjectLike(element) && element.delimiter === true;\n\t}\n\n\t#prepareMenuItems(): MenuItem[]\n\t{\n\t\treturn this.#filterExcessDelimiters(this.getMenuItems());\n\t}\n\n\t#filterExcessDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tconst menuItemsWithoutDuplicates = this.#filterDuplicateDelimiters(menuItems);\n\n\t\treturn this.#filterFinishingDelimiter(menuItemsWithoutDuplicates);\n\t}\n\n\t#filterDuplicateDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.filter((element) => {\n\t\t\tif (this.isDelimiter(previousElement) && this.isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\t#filterFinishingDelimiter(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.reverse().filter((element) => {\n\t\t\tif (previousElement === null && this.isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}).reverse();\n\t}\n}\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { Loc, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { Analytics as CallAnalytics } from 'call.lib.analytics';\n\nimport { Core } from 'im.v2.application.core';\nimport { ActionByRole, EventType, SidebarDetailBlock, ChatType, UserType, ActionByUserType } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { RecentService } from 'im.v2.provider.service.recent';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showLeaveChatConfirm } from 'im.v2.lib.confirm';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { Messenger } from 'im.public';\nimport { InviteManager } from 'im.v2.lib.invite';\n\nimport { BaseMenu } from '../base/base';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelRecentItem, ImModelUser, ImModelChat } from 'im.v2.model';\n\nexport class RecentMenu extends BaseMenu\n{\n\tcontext: ImModelRecentItem;\n\tcallManager: CallManager;\n\tpermissionManager: PermissionManager;\n\tchatService: ChatService;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-recent-context-menu';\n\t\tthis.chatService = new ChatService();\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 32,\n\t\t};\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn this.context.compactMode ? '' : super.getMenuClassName();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\tif (this.context.invitation.isActive)\n\t\t{\n\t\t\treturn this.getInviteItems();\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getMuteItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t];\n\t}\n\n\tgetSendMessageItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_WRITE_V2'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetUnreadMessageItem(): ?MenuItem\n\t{\n\t\tconst dialog = this.store.getters['chats/get'](this.context.dialogId, true);\n\t\tconst showReadOption = this.context.unread || dialog.counter > 0;\n\n\t\treturn {\n\t\t\ttext: showReadOption ? Loc.getMessage('IM_LIB_MENU_READ') : Loc.getMessage('IM_LIB_MENU_UNREAD'),\n\t\t\tonclick: () => {\n\t\t\t\tif (showReadOption)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.readDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unreadDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetPinMessageItem(): ?MenuItem\n\t{\n\t\tconst isPinned = this.context.pinned;\n\n\t\treturn {\n\t\t\ttext: isPinned ? Loc.getMessage('IM_LIB_MENU_UNPIN_MSGVER_1') : Loc.getMessage('IM_LIB_MENU_PIN_MSGVER_1'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isPinned)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unpinChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst dialog = this.store.getters['chats/get'](this.context.dialogId, true);\n\t\t\t\t\tthis.chatService.pinChat(this.context.dialogId);\n\t\t\t\t\tAnalytics.getInstance().onPinChat(dialog);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMuteItem(): ?MenuItem\n\t{\n\t\tconst canMute = this.permissionManager.canPerformActionByRole(ActionByRole.mute, this.context.dialogId);\n\t\tif (!canMute)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst dialog = this.store.getters['chats/get'](this.context.dialogId, true);\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\n\t\treturn {\n\t\t\ttext: isMuted ? Loc.getMessage('IM_LIB_MENU_UNMUTE_2') : Loc.getMessage('IM_LIB_MENU_MUTE_2'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isMuted)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unmuteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.muteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCallItem(): ?MenuItem\n\t{\n\t\tconst chatCanBeCalled = this.callManager.chatCanBeCalled(this.context.dialogId);\n\t\tconst chatIsAllowedToCall = this.permissionManager.canPerformActionByRole(ActionByRole.call, this.context.dialogId);\n\t\tif (!chatCanBeCalled || !chatIsAllowedToCall)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_CALL_2'),\n\t\t\tonclick: () => {\n\t\t\t\tCallAnalytics.getInstance().onRecentStartCallClick({\n\t\t\t\t\tisGroupChat: this.context.dialogId.includes('chat'),\n\t\t\t\t\tchatId: this.context.chatId,\n\t\t\t\t});\n\n\t\t\t\tthis.callManager.startCall(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE_V2'),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetHideItem(): ?MenuItem\n\t{\n\t\tif (this.context.invitation?.isActive || this.context.options?.default_user_record)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_HIDE_MSGVER_1'),\n\t\t\tonclick: () => {\n\t\t\t\tRecentService.getInstance().hideChat(this.context.dialogId);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetLeaveItem(): ?MenuItem\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn this.#leaveCollab();\n\t\t}\n\n\t\treturn this.#leaveChat();\n\t}\n\n\tgetChatsWithUserItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot() || this.isChatWithCurrentUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isAnyChatOpened = this.store.getters['application/getLayout'].entityId.length > 0;\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_FIND_SHARED_CHATS'),\n\t\t\tonclick: async () => {\n\t\t\t\tif (!isAnyChatOpened)\n\t\t\t\t{\n\t\t\t\t\tawait Messenger.openChat(this.context.dialogId);\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\t\tpanel: SidebarDetailBlock.chatsWithUser,\n\t\t\t\t\tstandalone: true,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t// region invitation\n\tgetInviteItems(): Array\n\t{\n\t\tconst items = [\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t];\n\n\t\tlet canInvite; // TODO change to APPLICATION variable\n\t\tif (Type.isUndefined(BX.MessengerProxy))\n\t\t{\n\t\t\tcanInvite = true;\n\t\t\tconsole.error('BX.MessengerProxy.canInvite() method not found in v2 version!');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcanInvite = BX.MessengerProxy.canInvite();\n\t\t}\n\n\t\tconst canManageInvite = canInvite && Core.getUserId() === this.context.invitation.originator;\n\t\tif (canManageInvite)\n\t\t{\n\t\t\titems.push(\n\t\t\t\tthis.getDelimiter(),\n\t\t\t\tthis.context.invitation.canResend ? this.getResendInviteItem() : null,\n\t\t\t\tthis.getCancelInviteItem(),\n\t\t\t);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetResendInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_INVITE_RESEND'),\n\t\t\tonclick: () => {\n\t\t\t\tInviteManager.resendInvite(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCancelInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_INVITE_CANCEL'),\n\t\t\tonclick: () => {\n\t\t\t\tMessageBox.show({\n\t\t\t\t\tmessage: Loc.getMessage('IM_LIB_INVITE_CANCEL_CONFIRM'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tInviteManager.cancelInvite(this.context.dialogId);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\t// endregion\n\n\tgetDelimiter(): Object\n\t{\n\t\treturn { delimiter: true };\n\t}\n\n\tgetChat(): ImModelChat\n\t{\n\t\treturn this.store.getters['chats/get'](this.context.dialogId, true);\n\t}\n\n\tisUser(): boolean\n\t{\n\t\treturn this.store.getters['chats/isUser'](this.context.dialogId);\n\t}\n\n\tisBot(): boolean\n\t{\n\t\tif (!this.isUser())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId);\n\n\t\treturn user.type === UserType.bot;\n\t}\n\n\tisChannel(): boolean\n\t{\n\t\treturn ChannelManager.isChannel(this.context.dialogId);\n\t}\n\n\tisCommentsChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialogId, true);\n\n\t\treturn type === ChatType.comment;\n\t}\n\n\tisCollabChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialogId, true);\n\n\t\treturn type === ChatType.collab;\n\t}\n\n\tisChatWithCurrentUser(): boolean\n\t{\n\t\treturn this.getCurrentUserId() === Number.parseInt(this.context.dialogId, 10);\n\t}\n\n\t#leaveChat(): ?MenuItem\n\t{\n\t\tconst canLeaveChat = this.permissionManager.canPerformActionByRole(ActionByRole.leave, this.context.dialogId);\n\t\tif (!canLeaveChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst text = this.isChannel()\n\t\t\t? Loc.getMessage('IM_LIB_MENU_LEAVE_CHANNEL')\n\t\t\t: Loc.getMessage('IM_LIB_MENU_LEAVE_MSGVER_1')\n\t\t;\n\n\t\treturn {\n\t\t\ttext,\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveChatConfirm(this.context.dialogId);\n\t\t\t\tif (userChoice === true)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.leaveChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\t#leaveCollab(): ?MenuItem\n\t{\n\t\tconst canLeaveChat = this.permissionManager.canPerformActionByRole(ActionByRole.leave, this.context.dialogId);\n\t\tconst canLeaveCollab = this.permissionManager.canPerformActionByUserType(ActionByUserType.leaveCollab);\n\t\tif (!canLeaveChat || !canLeaveCollab)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_LEAVE_MSGVER_1'),\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveChatConfirm(this.context.dialogId);\n\t\t\t\tif (!userChoice)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.chatService.leaveCollab(this.context.dialogId);\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { showKickUserConfirm } from 'im.v2.lib.confirm';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { ActionByRole, ChatType, EventType, UserType } from 'im.v2.const';\n\nimport { BaseMenu } from '../base/base';\n\nimport type { MenuItem } from '../type/menu';\n\nimport type { ImModelUser, ImModelChat } from 'im.v2.model';\n\ntype UserMenuContext = {\n\tuser: ImModelUser,\n\tdialog: ImModelChat\n};\n\nexport class UserMenu extends BaseMenu\n{\n\tcontext: UserMenuContext;\n\tpermissionManager: PermissionManager;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-user-context-menu';\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetKickItem(): ?MenuItem\n\t{\n\t\tconst canKick = this.permissionManager.canPerformActionByRole(ActionByRole.kick, this.context.dialog.dialogId);\n\t\tif (!canKick)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: this.#getKickItemText(),\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showKickUserConfirm(this.context.dialog.dialogId);\n\t\t\t\tif (userChoice !== true)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvoid this.#kickUser();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMentionItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_USER_MENTION'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.textarea.insertMention, {\n\t\t\t\t\tmentionText: this.context.user.name,\n\t\t\t\t\tmentionReplacement: Utils.text.getMentionBbCode(this.context.user.id, this.context.user.name),\n\t\t\t\t\tdialogId: this.context.dialog.dialogId,\n\t\t\t\t\tisMentionSymbol: false,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetSendItem(): ?MenuItem\n\t{\n\t\tif (this.context.dialog.type === ChatType.user)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_USER_WRITE'),\n\t\t\tonclick: () => {\n\t\t\t\tvoid Messenger.openChat(this.context.user.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetProfileItem(): ?MenuItem\n\t{\n\t\tif (this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.user.id);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE_V2'),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tisCollabChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialog.dialogId, true);\n\n\t\treturn type === ChatType.collab;\n\t}\n\n\tisBot(): boolean\n\t{\n\t\treturn this.context.user.type === UserType.bot;\n\t}\n\n\t#getKickItemText(): string\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn Loc.getMessage('IM_LIB_MENU_USER_KICK_FROM_COLLAB');\n\t\t}\n\n\t\treturn Loc.getMessage('IM_LIB_MENU_USER_KICK_FROM_CHAT');\n\t}\n\n\t#kickUser(): Promise\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn (new ChatService()).kickUserFromCollab(this.context.dialog.dialogId, this.context.user.id);\n\t\t}\n\n\t\treturn (new ChatService()).kickUserFromChat(this.context.dialog.dialogId, this.context.user.id);\n\t}\n}\n","import { Loc, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { Core } from 'im.v2.application.core';\nimport { Parser } from 'im.v2.lib.parser';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { MessageService } from 'im.v2.provider.service.message';\nimport { DiskService } from 'im.v2.provider.service.disk';\nimport { EventType, PlacementType, ActionByRole, PromoId } from 'im.v2.const';\nimport { MarketManager } from 'im.v2.lib.market';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showDeleteChannelPostConfirm, showDownloadAllFilesConfirm } from 'im.v2.lib.confirm';\nimport { Notifier } from 'im.v2.lib.notifier';\n\n// noinspection ES6PreferShortImport\nimport { BaseMenu } from '../../base/base';\n\nimport '../css/message-menu.css';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelMessage, ImModelChat, ImModelFile } from 'im.v2.model';\nimport type { MenuOptions } from 'main.popup';\nexport type MessageMenuContext = ImModelMessage & { dialogId: string };\n\nexport class MessageMenu extends BaseMenu\n{\n\tcontext: MessageMenuContext;\n\tdiskService: DiskService;\n\n\tmaxPins: number = 20;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-message-context-menu';\n\t\tthis.diskService = new DiskService();\n\t\tthis.marketManager = MarketManager.getInstance();\n\t}\n\n\tgetMenuOptions(): MenuOptions\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 11,\n\t\t\tminWidth: 178,\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getReplyItem(),\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getEditItem(),\n\t\t\tthis.getPinItem(),\n\t\t\tthis.getForwardItem(),\n\t\t\t...this.getAdditionalItems(),\n\t\t\tthis.getDeleteItem(),\n\t\t\tthis.getDelimiter(),\n\t\t\tthis.getSelectItem(),\n\t\t];\n\t}\n\n\tgetSelectItem(): ?MenuItem\n\t{\n\t\tif (this.#isDeletedMessage() || !this.#isRealMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_SELECT'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.openBulkActionsMode, {\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetReplyItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_REPLY'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.textarea.replyMessage, {\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetForwardItem(): ?MenuItem\n\t{\n\t\tif (this.#isDeletedMessage() || !this.#isRealMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_FORWARD'),\n\t\t\tonclick: () => {\n\t\t\t\tAnalytics.getInstance().messageForward.onClickForward({ dialogId: this.context.dialogId });\n\t\t\t\tEventEmitter.emit(EventType.dialog.showForwardPopup, {\n\t\t\t\t\tmessagesIds: [this.context.id],\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCopyItem(): ?MenuItem\n\t{\n\t\tif (this.#isDeletedMessage() || this.context.text.trim().length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_COPY'),\n\t\t\tonclick: async () => {\n\t\t\t\tconst textToCopy = Parser.prepareCopy(this.context);\n\n\t\t\t\tawait Utils.text.copyToClipboard(textToCopy);\n\t\t\t\tNotifier.message.onCopyComplete();\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCopyLinkItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_COPY_LINK_MSGVER_1'),\n\t\t\tonclick: () => {\n\t\t\t\tconst textToCopy = Utils.text.getMessageLink(this.context.dialogId, this.context.id);\n\t\t\t\tif (BX.clipboard?.copy(textToCopy))\n\t\t\t\t{\n\t\t\t\t\tNotifier.message.onCopyLinkComplete();\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCopyFileItem(): ?MenuItem\n\t{\n\t\tif (this.context.files.length !== 1)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_COPY_FILE'),\n\t\t\tonclick: () => {\n\t\t\t\tconst textToCopy = Parser.prepareCopyFile(this.context);\n\t\t\t\tif (BX.clipboard?.copy(textToCopy))\n\t\t\t\t{\n\t\t\t\t\tNotifier.file.onCopyComplete();\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetPinItem(): ?MenuItem\n\t{\n\t\tconst canPin = PermissionManager.getInstance().canPerformActionByRole(\n\t\t\tActionByRole.pinMessage,\n\t\t\tthis.context.dialogId,\n\t\t);\n\n\t\tif (this.#isDeletedMessage() || !canPin)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isPinned = this.store.getters['messages/pin/isPinned']({\n\t\t\tchatId: this.context.chatId,\n\t\t\tmessageId: this.context.id,\n\t\t});\n\n\t\treturn {\n\t\t\ttext: isPinned ? Loc.getMessage('IM_DIALOG_CHAT_MENU_UNPIN') : Loc.getMessage('IM_DIALOG_CHAT_MENU_PIN'),\n\t\t\tonclick: () => {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tif (isPinned)\n\t\t\t\t{\n\t\t\t\t\tmessageService.unpinMessage(this.context.chatId, this.context.id);\n\t\t\t\t\tAnalytics.getInstance().messagePins.onUnpin(this.context.chatId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.#arePinsExceedLimit())\n\t\t\t\t\t{\n\t\t\t\t\t\tNotifier.chat.onMessagesPinLimitError(this.maxPins);\n\t\t\t\t\t\tAnalytics.getInstance().messagePins.onReachingLimit(this.context.chatId);\n\t\t\t\t\t\tthis.menuInstance.close();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tmessageService.pinMessage(this.context.chatId, this.context.id);\n\t\t\t\t\tAnalytics.getInstance().messagePins.onPin(this.context.chatId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetFavoriteItem(): MenuItem\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isInFavorite = this.store.getters['sidebar/favorites/isFavoriteMessage'](this.context.chatId, this.context.id);\n\n\t\tconst menuItemText = isInFavorite\n\t\t\t? Loc.getMessage('IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED')\n\t\t\t: Loc.getMessage('IM_DIALOG_CHAT_MENU_SAVE')\n\t\t;\n\n\t\treturn {\n\t\t\ttext: menuItemText,\n\t\t\tonclick: () => {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tif (isInFavorite)\n\t\t\t\t{\n\t\t\t\t\tmessageService.removeMessageFromFavorite(this.context.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmessageService.addMessageToFavorite(this.context.id);\n\t\t\t\t}\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMarkItem(): ?MenuItem\n\t{\n\t\tconst canUnread = this.context.viewed && !this.#isOwnMessage();\n\n\t\tconst dialog: ImModelChat = this.store.getters['chats/getByChatId'](this.context.chatId);\n\t\tconst isMarked = this.context.id === dialog.markedId;\n\t\tif (!canUnread || isMarked)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_MARK'),\n\t\t\tonclick: () => {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tmessageService.markMessage(this.context.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCreateTaskItem(): ?MenuItem\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_CREATE_TASK_MSGVER_1'),\n\t\t\tonclick: () => {\n\t\t\t\tconst entityCreator = new EntityCreator(this.context.chatId);\n\t\t\t\tvoid entityCreator.createTaskForMessage(this.context.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCreateMeetingItem(): ?MenuItem\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_CREATE_MEETING_MSGVER_1'),\n\t\t\tonclick: () => {\n\t\t\t\tconst entityCreator = new EntityCreator(this.context.chatId);\n\t\t\t\tvoid entityCreator.createMeetingForMessage(this.context.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetEditItem(): ?MenuItem\n\t{\n\t\tif (!this.#isOwnMessage() || this.#isDeletedMessage() || this.#isForwardedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_EDIT'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.textarea.editMessage, {\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetDeleteItem(): ?MenuItem\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst permissionManager = PermissionManager.getInstance();\n\t\tconst canDeleteOthersMessage = permissionManager.canPerformActionByRole(\n\t\t\tActionByRole.deleteOthersMessage,\n\t\t\tthis.context.dialogId,\n\t\t);\n\t\tif (!this.#isOwnMessage() && !canDeleteOthersMessage)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_DELETE'),\n\t\t\tclassName: 'menu-popup-no-icon bx-im-dialog-chat__message-menu_delete',\n\t\t\tonclick: this.#onDelete.bind(this),\n\t\t};\n\t}\n\n\tgetMarketItems(): MenuItem[]\n\t{\n\t\tconst { dialogId, id } = this.context;\n\t\tconst placements = this.marketManager.getAvailablePlacementsByType(PlacementType.contextMenu, dialogId);\n\t\tconst marketMenuItem = [];\n\t\tif (placements.length > 0)\n\t\t{\n\t\t\tmarketMenuItem.push(this.getDelimiter());\n\t\t}\n\n\t\tconst context = { messageId: id, dialogId };\n\n\t\tplacements.forEach((placement) => {\n\t\t\tmarketMenuItem.push({\n\t\t\t\ttext: placement.title,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tMarketManager.openSlider(placement, context);\n\t\t\t\t\tthis.menuInstance.close();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\t// (10 items + 1 delimiter), because we don't want to show long context menu.\n\t\tconst itemLimit = 11;\n\n\t\treturn marketMenuItem.slice(0, itemLimit);\n\t}\n\n\tgetDownloadFileItem(): ?MenuItem\n\t{\n\t\tif (!Type.isArrayFilled(this.context.files))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.#isSingleFile())\n\t\t{\n\t\t\treturn this.#getDownloadSingleFileItem();\n\t\t}\n\n\t\treturn this.#getDownloadSeveralFilesItem();\n\t}\n\n\tgetSaveToDiskItem(): ?MenuItem\n\t{\n\t\tif (!Type.isArrayFilled(this.context.files))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst menuItemText = this.#isSingleFile()\n\t\t\t? Loc.getMessage('IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_MSGVER_1')\n\t\t\t: Loc.getMessage('IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK');\n\n\t\treturn {\n\t\t\ttext: menuItemText,\n\t\t\tonclick: async function() {\n\t\t\t\tAnalytics.getInstance().messageFiles.onClickSaveOnDisk({\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tawait this.diskService.save(this.context.files);\n\t\t\t\tNotifier.file.onDiskSaveComplete(this.#isSingleFile());\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetDelimiter(): MenuItem\n\t{\n\t\treturn {\n\t\t\tdelimiter: true,\n\t\t};\n\t}\n\n\tgetAdditionalItems(): MenuItem[]\n\t{\n\t\tconst additionalItems = this.getNestedItems();\n\t\tif (this.#needNestedMenu(additionalItems))\n\t\t{\n\t\t\treturn [{\n\t\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_MORE'),\n\t\t\t\titems: additionalItems,\n\t\t\t}];\n\t\t}\n\n\t\treturn additionalItems;\n\t}\n\n\tgetNestedItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getCopyLinkItem(),\n\t\t\tthis.getCopyFileItem(),\n\t\t\tthis.getMarkItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getSaveToDiskItem(),\n\t\t\tthis.getDelimiter(),\n\t\t\tthis.getCreateTaskItem(),\n\t\t\tthis.getCreateMeetingItem(),\n\t\t\t...this.getMarketItems(),\n\t\t];\n\t}\n\n\t#needNestedMenu(additionalItems: MenuItem[]): boolean\n\t{\n\t\tconst NESTED_MENU_MIN_ITEMS = 3;\n\t\tconst onlyMenuItems = additionalItems.filter((item) => item && !this.isDelimiter(item));\n\n\t\treturn onlyMenuItems.length >= NESTED_MENU_MIN_ITEMS;\n\t}\n\n\t#isOwnMessage(): boolean\n\t{\n\t\treturn this.context.authorId === Core.getUserId();\n\t}\n\n\t#isDeletedMessage(): boolean\n\t{\n\t\treturn this.context.isDeleted;\n\t}\n\n\t#getFirstFile(): ?ImModelFile\n\t{\n\t\treturn this.store.getters['files/get'](this.context.files[0]);\n\t}\n\n\t#isSingleFile(): boolean\n\t{\n\t\treturn this.context.files.length === 1;\n\t}\n\n\t#isForwardedMessage(): boolean\n\t{\n\t\treturn Type.isStringFilled(this.context.forward.id);\n\t}\n\n\t#isRealMessage(): boolean\n\t{\n\t\treturn this.store.getters['messages/isRealMessage'](this.context.id);\n\t}\n\n\tasync #onDelete()\n\t{\n\t\tconst { id: messageId, dialogId, chatId } = this.context;\n\t\tAnalytics.getInstance().messageDelete.onClickDelete({ messageId, dialogId });\n\t\tthis.menuInstance.close();\n\n\t\tif (await this.#isDeletionCancelled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst messageService = new MessageService({ chatId });\n\t\tmessageService.deleteMessages([messageId]);\n\t}\n\n\tasync #isDeletionCancelled(): Promise<boolean>\n\t{\n\t\tconst { id: messageId, dialogId } = this.context;\n\t\tif (!ChannelManager.isChannel(dialogId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst confirmResult = await showDeleteChannelPostConfirm();\n\t\tif (!confirmResult)\n\t\t{\n\t\t\tAnalytics.getInstance().messageDelete.onCancel({ messageId, dialogId });\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#getDownloadSingleFileItem(): MenuItem\n\t{\n\t\tconst file = this.#getFirstFile();\n\n\t\treturn {\n\t\t\thtml: Utils.file.createDownloadLink(\n\t\t\t\tLoc.getMessage('IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE'),\n\t\t\t\tfile.urlDownload,\n\t\t\t\tfile.name,\n\t\t\t),\n\t\t\tonclick: function() {\n\t\t\t\tAnalytics.getInstance().messageFiles.onClickDownload({\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\t#getDownloadSeveralFilesItem(): MenuItem\n\t{\n\t\tconst files: ImModelFile[] = this.context.files.map((fileId) => {\n\t\t\treturn this.store.getters['files/get'](fileId);\n\t\t});\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_DIALOG_CHAT_MENU_DOWNLOAD_FILES'),\n\t\t\tonclick: async () => {\n\t\t\t\tAnalytics.getInstance().messageFiles.onClickDownload({\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tUtils.file.downloadFiles(files);\n\n\t\t\t\tconst needToShowPopup = PromoManager.getInstance().needToShow(PromoId.downloadSeveralFiles);\n\t\t\t\tif (needToShowPopup && Utils.browser.isChrome() && !Utils.platform.isBitrixDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.menuInstance?.close();\n\t\t\t\t\tawait showDownloadAllFilesConfirm();\n\t\t\t\t\tvoid PromoManager.getInstance().markAsWatched(PromoId.downloadSeveralFiles);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance?.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#arePinsExceedLimit(): string\n\t{\n\t\tconst pins = this.store.getters['messages/pin/getPinned'](this.context.chatId);\n\n\t\treturn pins.length >= this.maxPins;\n\t}\n}\n","import { MessageMenu } from './message-base';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nexport class ChannelMessageMenu extends MessageMenu\n{\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getCopyLinkItem(),\n\t\t\tthis.getCopyFileItem(),\n\t\t\tthis.getPinItem(),\n\t\t\tthis.getForwardItem(),\n\t\t\tthis.getDelimiter(),\n\n\t\t\tthis.getMarkItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getDelimiter(),\n\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getSaveToDiskItem(),\n\t\t\tthis.getDelimiter(),\n\n\t\t\tthis.getEditItem(),\n\t\t\tthis.getDeleteItem(),\n\t\t\tthis.getDelimiter(),\n\n\t\t\tthis.getSelectItem(),\n\t\t];\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport { MessageMenu } from './message-base';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nexport class CommentsMessageMenu extends MessageMenu\n{\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\tconst message = this.context;\n\t\tconst contextDialogId = this.context.dialogId;\n\t\tif (ChannelManager.isCommentsPostMessage(message, contextDialogId))\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.getCopyItem(),\n\t\t\t\tthis.getCopyFileItem(),\n\t\t\t\tthis.getDelimiter(),\n\n\t\t\t\tthis.getDownloadFileItem(),\n\t\t\t\tthis.getSaveToDiskItem(),\n\t\t\t\tthis.getDelimiter(),\n\n\t\t\t\tthis.getOpenInChannelItem(),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getReplyItem(),\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getEditItem(),\n\t\t\t...this.getAdditionalItems(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetNestedItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getCopyFileItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getSaveToDiskItem(),\n\t\t\tthis.getDelimiter(),\n\t\t\tthis.getCreateTaskItem(),\n\t\t\tthis.getCreateMeetingItem(),\n\t\t];\n\t}\n\n\tgetOpenInChannelItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_COMMENTS_OPEN_IN_CHANNEL'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.closeComments);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Loc, Runtime } from 'main.core';\n\nimport { CopilotManager } from 'im.v2.lib.copilot';\n\nimport { MessageMenu } from './message-base';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { MenuItem } from 'im.v2.lib.menu';\n\nconst CopilotChatContext = Object.freeze({\n\tpersonal: 'chat_copilot_tab_one_by_one',\n\tgroup: 'chat_copilot_tab_multi',\n});\n\nexport class CopilotMessageMenu extends MessageMenu\n{\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getMarkItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getForwardItem(),\n\t\t\tthis.getSendFeedbackItem(),\n\t\t\tthis.getDeleteItem(),\n\t\t\tthis.getSelectItem(),\n\t\t];\n\t}\n\n\tgetSendFeedbackItem(): MenuItem\n\t{\n\t\tconst copilotManager = new CopilotManager();\n\t\tif (!copilotManager.isCopilotBot(this.context.authorId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_COPILOT_FEEDBACK'),\n\t\t\tonclick: () => {\n\t\t\t\tvoid this.openForm();\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tasync openForm()\n\t{\n\t\tconst formId = Math.round(Math.random() * 1000);\n\n\t\tawait Runtime.loadExtension(['ui.feedback.form']);\n\t\tBX.UI.Feedback.Form.open({\n\t\t\tid: `im.copilot.feedback-${formId}`,\n\t\t\tforms: [\n\t\t\t\t{ zones: ['es'], id: 684, lang: 'es', sec: 'svvq1x' },\n\t\t\t\t{ zones: ['en'], id: 686, lang: 'en', sec: 'tjwodz' },\n\t\t\t\t{ zones: ['de'], id: 688, lang: 'de', sec: 'nrwksg' },\n\t\t\t\t{ zones: ['com.br'], id: 690, lang: 'com.br', sec: 'kpte6m' },\n\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 692, lang: 'ru', sec: 'jbujn0' },\n\t\t\t],\n\t\t\tpresets: {\n\t\t\t\tsender_page: this.getCopilotChatContext(),\n\t\t\t\tlanguage: Loc.getMessage('LANGUAGE_ID'),\n\t\t\t\tcp_answer: this.context.text,\n\t\t\t},\n\t\t});\n\t}\n\n\tgetCopilotChatContext(): $Values<typeof CopilotChatContext>\n\t{\n\t\tconst chat: ImModelChat = this.store.getters['chats/get'](this.context.dialogId);\n\t\tif (chat.userCounter <= 2)\n\t\t{\n\t\t\treturn CopilotChatContext.personal;\n\t\t}\n\n\t\treturn CopilotChatContext.group;\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { ChatType, MessageComponent } from 'im.v2.const';\n\n// noinspection ES6PreferShortImport\nimport { MessageMenu } from './classes/message-base';\nimport { ChannelMessageMenu } from './classes/channel';\nimport { CommentsMessageMenu } from './classes/comments';\nimport { CopilotMessageMenu } from './classes/copilot';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { MessageMenuContext } from 'im.v2.lib.menu';\n\ntype MenuCheckFunction = (context: MessageMenuContext) => boolean;\ntype MessageType = $Values<typeof MessageComponent>;\n\nexport class MessageMenuManager\n{\n\tstatic #instance = null;\n\n\t#defaultMenuByCallback: Map<MenuCheckFunction, MessageMenu> = new Map();\n\t#customMenuByCallback: Map<MenuCheckFunction, MessageMenu> = new Map();\n\t#menuByMessageType: Map<MessageType, MessageMenu> = new Map();\n\n\tstatic getInstance(): MessageMenuManager\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new MessageMenuManager();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#registerDefaultMenus();\n\t}\n\n\topenMenu(context: MessageMenuContext, bindElement: HTMLElement): void\n\t{\n\t\tconst DefaultMenuClass = this.#getDefaultMenuClass(context);\n\t\tif (!this.#contextCanBeCustomized(context))\n\t\t{\n\t\t\t(new DefaultMenuClass()).openMenu(context, bindElement);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst CustomMenuClass = this.#getCustomMenuClass(context);\n\t\tif (CustomMenuClass)\n\t\t{\n\t\t\t(new CustomMenuClass()).openMenu(context, bindElement);\n\n\t\t\treturn;\n\t\t}\n\n\t\t(new DefaultMenuClass()).openMenu(context, bindElement);\n\t}\n\n\tregisterMenuByCallback(callback: MenuCheckFunction, menuClass: MessageMenu): void\n\t{\n\t\tthis.#customMenuByCallback.set(callback, menuClass);\n\t}\n\n\tregisterMenuByMessageType(messageType: MessageType, menuClass: MessageMenu): void\n\t{\n\t\tif (this.#hasMenuForMessageType(messageType))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#menuByMessageType.set(messageType, menuClass);\n\t}\n\n\t#registerDefaultMenus()\n\t{\n\t\tthis.#defaultMenuByCallback.set(this.#isChannel.bind(this), ChannelMessageMenu);\n\t\tthis.#defaultMenuByCallback.set(this.#isComment.bind(this), CommentsMessageMenu);\n\t\tthis.#defaultMenuByCallback.set(this.#isCopilot.bind(this), CopilotMessageMenu);\n\t}\n\n\t#contextCanBeCustomized(context: MessageMenuContext): boolean\n\t{\n\t\treturn !ChannelManager.isCommentsPostMessage(context, context.dialogId);\n\t}\n\n\t#getDefaultMenuClass(context: MessageMenuContext): MessageMenu\n\t{\n\t\tconst MenuClass = this.#getClassByMap(this.#defaultMenuByCallback, context);\n\n\t\treturn MenuClass ?? MessageMenu;\n\t}\n\n\t#getCustomMenuClass(context: MessageMenuContext): MessageMenu | null\n\t{\n\t\tif (this.#hasMenuForMessageType(context.componentId))\n\t\t{\n\t\t\treturn this.#getMenuForMessageType(context.componentId);\n\t\t}\n\n\t\treturn this.#getClassByMap(this.#customMenuByCallback, context);\n\t}\n\n\t#getClassByMap(menuMap: Map<MenuCheckFunction, MessageMenu>, context: MessageMenuContext): MessageMenu | null\n\t{\n\t\tconst menuMapEntries = menuMap.entries();\n\t\tfor (const [callback, MenuClass] of menuMapEntries)\n\t\t{\n\t\t\tif (callback(context))\n\t\t\t{\n\t\t\t\treturn MenuClass;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getDialog(dialogId: string): ImModelChat\n\t{\n\t\treturn Core.getStore().getters['chats/get'](dialogId, true);\n\t}\n\n\t#isChannel(context: MessageMenuContext): boolean\n\t{\n\t\treturn ChannelManager.isChannel(context.dialogId);\n\t}\n\n\t#isComment(context: MessageMenuContext): boolean\n\t{\n\t\tconst chat = this.#getDialog(context.dialogId);\n\n\t\treturn chat.type === ChatType.comment;\n\t}\n\n\t#isCopilot(context: MessageMenuContext): boolean\n\t{\n\t\treturn (new CopilotManager()).isCopilotChat(context.dialogId);\n\t}\n\n\t#hasMenuForMessageType(messageType: MessageType): boolean\n\t{\n\t\treturn this.#menuByMessageType.has(messageType);\n\t}\n\n\t#getMenuForMessageType(messageType: MessageType): MessageMenu\n\t{\n\t\treturn this.#menuByMessageType.get(messageType);\n\t}\n}\n"],"names":["EVENT_NAMESPACE","BaseMenu","EventEmitter","constructor","id","setEventNamespace","store","Core","getStore","restClient","getRestClient","onClosePopupHandler","onClosePopup","bind","openMenu","context","target","menuInstance","close","getMenuInstance","show","MenuManager","create","getMenuOptions","bindOptions","forceBindPosition","position","targetContainer","document","body","bindElement","cacheable","className","getMenuClassName","items","events","onClose","emit","onCloseMenu","getMenuItems","destroy","getCurrentUserId","getUserId","isDelimiter","element","Type","isObjectLike","delimiter","menuItems","menuItemsWithoutDuplicates","previousElement","filter","reverse","RecentMenu","chatService","ChatService","callManager","CallManager","getInstance","permissionManager","PermissionManager","angle","offsetLeft","compactMode","invitation","isActive","getInviteItems","getUnreadMessageItem","getPinMessageItem","getMuteItem","getOpenProfileItem","getChatsWithUserItem","getHideItem","getLeaveItem","getSendMessageItem","text","Loc","getMessage","onclick","Messenger","openChat","dialogId","getOpenItem","dialog","getters","showReadOption","unread","counter","readDialog","unreadDialog","isPinned","pinned","unpinChat","pinChat","Analytics","onPinChat","canMute","canPerformActionByRole","ActionByRole","mute","isMuted","muteList","includes","unmuteChat","muteChat","getCallItem","chatCanBeCalled","chatIsAllowedToCall","call","CallAnalytics","onRecentStartCallClick","isGroupChat","chatId","startCall","isUser","isBot","profileUri","Utils","user","getProfileLink","href","options","default_user_record","RecentService","hideChat","isCollabChat","isChatWithCurrentUser","isAnyChatOpened","entityId","length","EventType","sidebar","open","panel","SidebarDetailBlock","chatsWithUser","standalone","canInvite","isUndefined","BX","MessengerProxy","console","error","canManageInvite","originator","push","getDelimiter","canResend","getResendInviteItem","getCancelInviteItem","InviteManager","resendInvite","MessageBox","message","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","cancelInvite","onCancel","getChat","type","UserType","bot","isChannel","ChannelManager","isCommentsChat","ChatType","comment","collab","Number","parseInt","canLeaveChat","leave","userChoice","showLeaveChatConfirm","leaveChat","canLeaveCollab","canPerformActionByUserType","ActionByUserType","leaveCollab","UserMenu","getKickItem","canKick","kick","showKickUserConfirm","getMentionItem","textarea","insertMention","mentionText","name","mentionReplacement","getMentionBbCode","isMentionSymbol","getSendItem","getProfileItem","kickUserFromCollab","kickUserFromChat","MessageMenu","maxPins","diskService","DiskService","marketManager","MarketManager","minWidth","getReplyItem","getCopyItem","getEditItem","getPinItem","getForwardItem","getAdditionalItems","getDeleteItem","getSelectItem","openBulkActionsMode","messageId","replyMessage","messageForward","onClickForward","showForwardPopup","messagesIds","trim","textToCopy","Parser","prepareCopy","copyToClipboard","Notifier","onCopyComplete","getCopyLinkItem","getMessageLink","clipboard","copy","onCopyLinkComplete","getCopyFileItem","files","prepareCopyFile","file","canPin","pinMessage","messageService","MessageService","unpinMessage","messagePins","onUnpin","chat","onMessagesPinLimitError","onReachingLimit","onPin","getFavoriteItem","isInFavorite","menuItemText","removeMessageFromFavorite","addMessageToFavorite","getMarkItem","canUnread","viewed","isMarked","markedId","markMessage","getCreateTaskItem","entityCreator","EntityCreator","createTaskForMessage","getCreateMeetingItem","createMeetingForMessage","editMessage","canDeleteOthersMessage","deleteOthersMessage","getMarketItems","placements","getAvailablePlacementsByType","PlacementType","contextMenu","marketMenuItem","forEach","placement","title","openSlider","itemLimit","slice","getDownloadFileItem","isArrayFilled","getSaveToDiskItem","messageFiles","onClickSaveOnDisk","save","onDiskSaveComplete","additionalItems","getNestedItems","NESTED_MENU_MIN_ITEMS","onlyMenuItems","item","authorId","isDeleted","isStringFilled","forward","messageDelete","onClickDelete","deleteMessages","confirmResult","showDeleteChannelPostConfirm","html","createDownloadLink","urlDownload","onClickDownload","map","fileId","downloadFiles","needToShowPopup","PromoManager","needToShow","PromoId","downloadSeveralFiles","browser","isChrome","platform","isBitrixDesktop","showDownloadAllFilesConfirm","markAsWatched","pins","ChannelMessageMenu","CommentsMessageMenu","contextDialogId","isCommentsPostMessage","getOpenInChannelItem","closeComments","CopilotChatContext","Object","freeze","personal","group","CopilotMessageMenu","getSendFeedbackItem","copilotManager","CopilotManager","isCopilotBot","openForm","formId","Math","round","random","Runtime","loadExtension","UI","Feedback","Form","forms","zones","lang","sec","presets","sender_page","getCopilotChatContext","language","cp_answer","userCounter","MessageMenuManager","Map","DefaultMenuClass","CustomMenuClass","registerMenuByCallback","callback","menuClass","set","registerMenuByMessageType","messageType","MenuClass","componentId","menuMap","menuMapEntries","entries","isCopilotChat","has","get"],"mappings":"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"}