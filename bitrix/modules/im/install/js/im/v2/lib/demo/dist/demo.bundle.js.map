{"version":3,"file":"demo.bundle.js","sources":["../src/classes/id-generator.js","../src/demo.js"],"sourcesContent":["import { Utils } from 'im.v2.lib.utils';\n\nlet nextChatId = Number.MIN_SAFE_INTEGER;\nlet nextUserId = Number.MIN_SAFE_INTEGER;\nlet nextMessageId = Number.MIN_SAFE_INTEGER;\nlet nextFileId = Number.MIN_SAFE_INTEGER;\n\nexport const IdGenerator = {\n\tgetDialogId(): string\n\t{\n\t\treturn Utils.text.getUuidV4();\n\t},\n\n\tgetNextChatId(): number\n\t{\n\t\tnextChatId++;\n\n\t\treturn nextChatId;\n\t},\n\n\tgetNextUserId(): number\n\t{\n\t\tnextUserId++;\n\n\t\treturn nextUserId;\n\t},\n\n\tgetNextMessageId(): number\n\t{\n\t\tnextMessageId++;\n\n\t\treturn nextMessageId;\n\t},\n\n\tgetNextFileId(): number\n\t{\n\t\tnextFileId++;\n\n\t\treturn nextFileId;\n\t},\n};\n","import { Core } from 'im.v2.application.core';\nimport { ChatType, UserRole } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { IdGenerator } from './classes/id-generator';\n\nimport type { ImModelChat, ImModelMessage, ImModelUser, ImModelFile } from 'im.v2.model';\n\nexport class DemoChatBuilder\n{\n\t#chat: Partial<ImModelChat> = {};\n\t#messages: Partial<ImModelMessage>[] = [];\n\t#users: Partial<ImModelUser>[] = [];\n\t#files: Partial<ImModelFile>[] = [];\n\n\tstatic isDemoDialogId(dialogId: string): boolean\n\t{\n\t\treturn Utils.text.isUuidV4(dialogId);\n\t}\n\n\taddChat(fields: Partial<ImModelChat>): Partial<ImModelChat>\n\t{\n\t\tthis.#chat = {\n\t\t\t...this.#getDefaultChatFields(),\n\t\t\t...fields,\n\t\t\tdialogId: IdGenerator.getDialogId(),\n\t\t\tchatId: IdGenerator.getNextChatId(),\n\t\t};\n\n\t\treturn this.#chat;\n\t}\n\n\taddMessage(fields: Partial<ImModelMessage>): Partial<ImModelMessage>\n\t{\n\t\tconst newMessage = {\n\t\t\tid: IdGenerator.getNextMessageId(),\n\t\t\tchatId: this.#chat.chatId ?? 0,\n\t\t\t...fields,\n\t\t};\n\t\tthis.#messages.push(newMessage);\n\n\t\treturn newMessage;\n\t}\n\n\taddUser(fields: Partial<ImModelUser>): Partial<ImModelUser>\n\t{\n\t\tconst newUser = {\n\t\t\tid: IdGenerator.getNextUserId(),\n\t\t\t...fields,\n\t\t};\n\t\tthis.#users.push(newUser);\n\n\t\treturn newUser;\n\t}\n\n\taddFile(fields: Partial<ImModelFile>): Partial<ImModelUser>\n\t{\n\t\tconst newFile = {\n\t\t\tid: IdGenerator.getNextFileId(),\n\t\t\tchatId: this.#chat.chatId ?? 0,\n\t\t\t...fields,\n\t\t};\n\t\tthis.#files.push(newFile);\n\n\t\treturn newFile;\n\t}\n\n\tsave(): void\n\t{\n\t\tif (this.#messages.length > 0)\n\t\t{\n\t\t\tconst [newestMessage] = this.#messages.slice(-1);\n\t\t\tthis.#chat.lastMessageId = newestMessage.id;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('chats/set', this.#chat);\n\n\t\tconst userManager = new UserManager();\n\t\tvoid userManager.addUsersToModel(this.#users);\n\n\t\tvoid Core.getStore().dispatch('files/set', this.#files);\n\t\tvoid Core.getStore().dispatch('messages/setChatCollection', { messages: this.#messages });\n\t}\n\n\tgetChat(): Partial<ImModelChat>\n\t{\n\t\treturn this.#chat;\n\t}\n\n\tgetUsers(): Partial<ImModelUser>[]\n\t{\n\t\treturn this.#users;\n\t}\n\n\tgetMessages(): Partial<ImModelMessage>[]\n\t{\n\t\treturn this.#messages;\n\t}\n\n\tgetFiles(): Partial<ImModelFile>[]\n\t{\n\t\treturn this.#files;\n\t}\n\n\t#getDefaultChatFields(): Partial<ImModelChat>\n\t{\n\t\treturn {\n\t\t\ttype: ChatType.chat,\n\t\t\tinited: true,\n\t\t\trole: UserRole.member,\n\t\t\tpermissions: {\n\t\t\t\tmanageUi: UserRole.member,\n\t\t\t\tmanageSettings: UserRole.member,\n\t\t\t\tmanageUsersAdd: UserRole.member,\n\t\t\t\tmanageUsersDelete: UserRole.member,\n\t\t\t\tmanageMessages: UserRole.member,\n\t\t\t},\n\t\t};\n\t}\n}\n"],"names":["nextChatId","Number","MIN_SAFE_INTEGER","nextUserId","nextMessageId","nextFileId","IdGenerator","getDialogId","Utils","text","getUuidV4","getNextChatId","getNextUserId","getNextMessageId","getNextFileId","DemoChatBuilder","isDemoDialogId","dialogId","isUuidV4","addChat","fields","chatId","addMessage","newMessage","id","push","addUser","newUser","addFile","newFile","save","length","newestMessage","slice","lastMessageId","Core","getStore","dispatch","userManager","UserManager","addUsersToModel","messages","getChat","getUsers","getMessages","getFiles","type","ChatType","chat","inited","role","UserRole","member","permissions","manageUi","manageSettings","manageUsersAdd","manageUsersDelete","manageMessages"],"mappings":"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"}