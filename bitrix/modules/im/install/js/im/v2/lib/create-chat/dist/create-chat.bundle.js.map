{"version":3,"file":"create-chat.bundle.js","sources":["../src/create-chat.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\n\nimport { LayoutManager } from 'im.v2.lib.layout';\n\nimport { UserRole, ChatType, Layout } from 'im.v2.const';\nimport type { PreselectedMemberItem } from 'im.v2.component.content.chat-forms.forms';\nimport { Core } from 'im.v2.application.core';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.CreateChatManager';\n\ntype UserRoleItem = $Values<typeof UserRole>;\ntype ChatFields = {\n\tchatTitle: string,\n\tavatarFile: ?File,\n\tchatMembers: number[],\n\tsettings: {\n\t\tisAvailableInSearch: boolean,\n\t\tdescription: string,\n\t},\n\trights: {\n\t\townerId: number,\n\t\tmanagerIds: number[],\n\t\tmanageUsers: UserRoleItem,\n\t\tmanageSettings: UserRoleItem,\n\t\tmanageUi: UserRoleItem,\n\t},\n};\ntype ChatTypeItem = $Values<typeof ChatType>;\n\nexport class CreateChatManager extends EventEmitter\n{\n\tstatic events = {\n\t\tcreationStatusChange: 'creationStatusChange',\n\t\ttitleChange: 'titleChange',\n\t\tavatarChange: 'avatarChange',\n\t\tchatTypeChange: 'chatTypeChange',\n\t};\n\n\tstatic #instance: CreateChatManager;\n\n\t#isCreating: boolean = false;\n\t#chatType: ChatTypeItem = ChatType.chat;\n\t#chatTitle: string = '';\n\t#chatAvatarFile: File = null;\n\t#chatFields: ChatFields;\n\t#preselectedMembers: PreselectedMemberItem[] = [];\n\t#includeCurrentUser: boolean = true;\n\t#ownerId: number;\n\n\tstatic getInstance(): CreateChatManager\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\t}\n\n\tstartChatCreation(chatTypeToCreate: ChatTypeItem, params: { clearCurrentCreation: boolean } = {})\n\t{\n\t\tconst { clearCurrentCreation = true } = params;\n\t\tif (clearCurrentCreation)\n\t\t{\n\t\t\tthis.setCreationStatus(false);\n\t\t}\n\t\tvoid LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.createChat.name,\n\t\t\tentityId: chatTypeToCreate,\n\t\t});\n\t}\n\n\tisCreating(): boolean\n\t{\n\t\treturn this.#isCreating;\n\t}\n\n\tgetChatType(): ChatTypeItem\n\t{\n\t\treturn this.#chatType;\n\t}\n\n\tgetChatTitle(): string\n\t{\n\t\treturn this.#chatTitle;\n\t}\n\n\tgetChatAvatar(): ?File\n\t{\n\t\treturn this.#chatAvatarFile;\n\t}\n\n\tsetChatType(type: ChatTypeItem)\n\t{\n\t\tthis.#chatType = type;\n\t\tthis.emit(CreateChatManager.events.chatTypeChange, type);\n\t}\n\n\tsetCreationStatus(flag: boolean)\n\t{\n\t\tthis.#isCreating = flag;\n\t\tthis.clearFields();\n\t\tthis.emit(CreateChatManager.events.creationStatusChange, flag);\n\t}\n\n\tsetChatTitle(chatTitle: string)\n\t{\n\t\tthis.#chatTitle = chatTitle;\n\t\tthis.emit(CreateChatManager.events.titleChange, chatTitle);\n\t}\n\n\tsetChatAvatar(chatAvatarFile: ?File)\n\t{\n\t\tthis.#chatAvatarFile = chatAvatarFile;\n\t\tthis.emit(CreateChatManager.events.avatarChange, chatAvatarFile);\n\t}\n\n\tsaveFields(chatFields: ChatFields)\n\t{\n\t\tthis.#chatFields = chatFields;\n\t}\n\n\tgetFields(): ?ChatFields\n\t{\n\t\treturn this.#chatFields;\n\t}\n\n\tclearFields()\n\t{\n\t\tthis.#chatFields = null;\n\t\tthis.setChatTitle('');\n\t\tthis.setChatAvatar(null);\n\t}\n\n\tsetPreselectedMembers(preselectedMembers: PreselectedMemberItem[])\n\t{\n\t\tthis.#preselectedMembers = preselectedMembers;\n\t}\n\n\tgetChatMembers(): [[string, number | string]]\n\t{\n\t\tconst mappedMembers = this.#preselectedMembers.map((item) => [item.type, item.id]);\n\t\tif (this.#includeCurrentUser)\n\t\t{\n\t\t\tmappedMembers.push(['user', Core.getUserId()]);\n\t\t}\n\n\t\treturn mappedMembers;\n\t}\n\n\tsetIncludeCurrentUser(value: boolean)\n\t{\n\t\tthis.#includeCurrentUser = value;\n\t}\n\n\tsetOwnerId(ownerId: number)\n\t{\n\t\tthis.#ownerId = ownerId;\n\t}\n\n\tgetOwnerId(): boolean\n\t{\n\t\treturn this.#ownerId ?? Core.getUserId();\n\t}\n\n\tgetUndeselectedItems(): [[string, number | string]]\n\t{\n\t\tif (this.#includeCurrentUser)\n\t\t{\n\t\t\treturn [['user', Core.getUserId()]];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tclearExternalFields()\n\t{\n\t\tthis.setOwnerId(null);\n\t\tthis.setIncludeCurrentUser(true);\n\t\tthis.setPreselectedMembers([]);\n\t}\n}\n"],"names":["EVENT_NAMESPACE","CreateChatManager","EventEmitter","getInstance","constructor","props","ChatType","chat","setEventNamespace","startChatCreation","chatTypeToCreate","params","clearCurrentCreation","setCreationStatus","LayoutManager","setLayout","name","Layout","createChat","entityId","isCreating","getChatType","getChatTitle","getChatAvatar","setChatType","type","emit","events","chatTypeChange","flag","clearFields","creationStatusChange","setChatTitle","chatTitle","titleChange","setChatAvatar","chatAvatarFile","avatarChange","saveFields","chatFields","getFields","setPreselectedMembers","preselectedMembers","getChatMembers","mappedMembers","map","item","id","push","Core","getUserId","setIncludeCurrentUser","value","setOwnerId","ownerId","getOwnerId","getUndeselectedItems","clearExternalFields"],"mappings":"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"}