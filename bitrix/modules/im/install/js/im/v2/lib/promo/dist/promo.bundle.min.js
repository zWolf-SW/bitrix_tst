this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,a,r,t){"use strict";var i=babelHelpers.classPrivateFieldLooseKey("isParamsEqual");class o{constructor(e,s){Object.defineProperty(this,i,{value:l});this.id=e;this.params=s}static createFromRawPromoData(e){return new o(e.id,e.params)}isEmptyParams(){return Object.keys(this.params).length===0}isEqual(e){return this.id===e.id&&babelHelpers.classPrivateFieldLooseBase(this,i)[i](e.params)}}function l(e){var s,a;return Number((s=this.params.chatId)!=null?s:null)===Number((a=e.chatId)!=null?a:null)}class n{static markAsWatched(e){a.Logger.warn("PromoService: markAsWatched:",e);const s={data:{id:e.id,params:e.params}};r.runAction(t.RestMethod.imV2PromotionRead,s).catch((([e])=>{console.error("PromoService: markAsWatched error:",e)}))}}var c=babelHelpers.classPrivateFieldLooseKey("instance");var b=babelHelpers.classPrivateFieldLooseKey("promoList");var d=babelHelpers.classPrivateFieldLooseKey("init");var v=babelHelpers.classPrivateFieldLooseKey("get");var p=babelHelpers.classPrivateFieldLooseKey("remove");var h=babelHelpers.classPrivateFieldLooseKey("removeByPromotionList");class P{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,c)[c]){babelHelpers.classPrivateFieldLooseBase(this,c)[c]=new this}return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}static init(){P.getInstance()}constructor(){Object.defineProperty(this,h,{value:B});Object.defineProperty(this,p,{value:L});Object.defineProperty(this,v,{value:u});Object.defineProperty(this,d,{value:m});Object.defineProperty(this,b,{writable:true,value:void 0});const{promoList:e}=s.Core.getApplicationData();a.Logger.warn("PromoManager: promoList",e);babelHelpers.classPrivateFieldLooseBase(this,d)[d](e)}needToShow(e,s={}){const a=new o(e,s);return Boolean(babelHelpers.classPrivateFieldLooseBase(this,v)[v](a))}async markAsWatched(e,s={}){const a=new o(e,s);if(babelHelpers.classPrivateFieldLooseBase(this,v)[v](a)){await n.markAsWatched(a);babelHelpers.classPrivateFieldLooseBase(this,p)[p](a)}}onPromotionUpdated(e){const s=e.deletedPromotions.map((e=>o.createFromRawPromoData(e)));babelHelpers.classPrivateFieldLooseBase(this,h)[h](s);const a=e.addedPromotions.map((e=>o.createFromRawPromoData(e)));babelHelpers.classPrivateFieldLooseBase(this,b)[b]=[...babelHelpers.classPrivateFieldLooseBase(this,b)[b],...a]}}function m(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.map((e=>o.createFromRawPromoData(e)))}function u(e){return babelHelpers.classPrivateFieldLooseBase(this,b)[b].find((s=>s.isEqual(e)))}function L(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=babelHelpers.classPrivateFieldLooseBase(this,b)[b].filter((s=>!s.isEqual(e)))}function B(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=babelHelpers.classPrivateFieldLooseBase(this,b)[b].filter((s=>{const a=e.find((e=>e.id===s.id));if(!a){return true}if(a.isEmptyParams()){return false}return!s.isEqual(a)}))}Object.defineProperty(P,c,{writable:true,value:void 0});e.PromoManager=P})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=promo.bundle.map.js