{"version":3,"file":"comments.bundle.js","sources":["../src/comments.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { runAction } from 'im.v2.lib.rest';\nimport { RestMethod } from 'im.v2.const';\n\nimport type { ImModelChat } from 'im.v2.model';\n\nexport const CommentsService = {\n\tsubscribe(messageId: number): void\n\t{\n\t\tvoid Core.getStore().dispatch('messages/comments/subscribe', messageId);\n\n\t\treturn runAction(RestMethod.imV2ChatCommentSubscribe, {\n\t\t\tdata: {\n\t\t\t\tpostId: messageId,\n\t\t\t\tcreateIfNotExists: true,\n\t\t\t\tautoJoin: true,\n\t\t\t},\n\t\t}).catch(([error]) => {\n\t\t\tconsole.error('CommentsService: subscribe error', error);\n\t\t});\n\t},\n\n\tunsubscribe(messageId: number): void\n\t{\n\t\tvoid Core.getStore().dispatch('messages/comments/unsubscribe', messageId);\n\n\t\treturn runAction(RestMethod.imV2ChatCommentUnsubscribe, {\n\t\t\tdata: {\n\t\t\t\tpostId: messageId,\n\t\t\t\tcreateIfNotExists: true,\n\t\t\t\tautoJoin: true,\n\t\t\t},\n\t\t}).catch(([error]) => {\n\t\t\tconsole.error('CommentsService: unsubscribe error', error);\n\t\t});\n\t},\n\n\treadAllChannelComments(channelDialogId: string): void\n\t{\n\t\tconst chat: ImModelChat = Core.getStore().getters['chats/get'](channelDialogId, true);\n\t\tconst currentChannelCounter: number = Core.getStore().getters['counters/getChannelCommentsCounter'](chat.chatId);\n\t\tif (currentChannelCounter === 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('counters/readAllChannelComments', chat.chatId);\n\n\t\treturn runAction(RestMethod.imV2ChatCommentReadAll, {\n\t\t\tdata: { dialogId: channelDialogId },\n\t\t}).catch(([error]) => {\n\t\t\tconsole.error('CommentsService: readAllChannelComments error', error);\n\t\t});\n\t},\n};\n"],"names":["CommentsService","subscribe","messageId","Core","getStore","dispatch","runAction","RestMethod","imV2ChatCommentSubscribe","data","postId","createIfNotExists","autoJoin","catch","error","console","unsubscribe","imV2ChatCommentUnsubscribe","readAllChannelComments","channelDialogId","chat","getters","currentChannelCounter","chatId","Promise","resolve","imV2ChatCommentReadAll","dialogId"],"mappings":";;;;;;;OAMaA,eAAe,GAAG;GAC9BC,SAAS,CAACC,SAAiB,EAC3B;KACC,KAAKC,2BAAI,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,6BAA6B,EAAEH,SAAS,CAAC;KAEvE,OAAOI,wBAAS,CAACC,sBAAU,CAACC,wBAAwB,EAAE;OACrDC,IAAI,EAAE;SACLC,MAAM,EAAER,SAAS;SACjBS,iBAAiB,EAAE,IAAI;SACvBC,QAAQ,EAAE;;MAEX,CAAC,CAACC,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,KAAK;OACrBC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;MACxD,CAAC;IACF;GAEDE,WAAW,CAACd,SAAiB,EAC7B;KACC,KAAKC,2BAAI,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,+BAA+B,EAAEH,SAAS,CAAC;KAEzE,OAAOI,wBAAS,CAACC,sBAAU,CAACU,0BAA0B,EAAE;OACvDR,IAAI,EAAE;SACLC,MAAM,EAAER,SAAS;SACjBS,iBAAiB,EAAE,IAAI;SACvBC,QAAQ,EAAE;;MAEX,CAAC,CAACC,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,KAAK;OACrBC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MAC1D,CAAC;IACF;GAEDI,sBAAsB,CAACC,eAAuB,EAC9C;KACC,MAAMC,IAAiB,GAAGjB,2BAAI,CAACC,QAAQ,EAAE,CAACiB,OAAO,CAAC,WAAW,CAAC,CAACF,eAAe,EAAE,IAAI,CAAC;KACrF,MAAMG,qBAA6B,GAAGnB,2BAAI,CAACC,QAAQ,EAAE,CAACiB,OAAO,CAAC,oCAAoC,CAAC,CAACD,IAAI,CAACG,MAAM,CAAC;KAChH,IAAID,qBAAqB,KAAK,CAAC,EAC/B;OACC,OAAOE,OAAO,CAACC,OAAO,EAAE;;KAGzB,KAAKtB,2BAAI,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,iCAAiC,EAAEe,IAAI,CAACG,MAAM,CAAC;KAE7E,OAAOjB,wBAAS,CAACC,sBAAU,CAACmB,sBAAsB,EAAE;OACnDjB,IAAI,EAAE;SAAEkB,QAAQ,EAAER;;MAClB,CAAC,CAACN,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,KAAK;OACrBC,OAAO,CAACD,KAAK,CAAC,+CAA+C,EAAEA,KAAK,CAAC;MACrE,CAAC;;CAEJ,CAAC;;;;;;;;"}