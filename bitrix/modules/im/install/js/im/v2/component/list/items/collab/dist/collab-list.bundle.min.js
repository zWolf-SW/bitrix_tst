this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(e,t,s,i,a,r,n,l,o,c,d,g,h){"use strict";const b={name:"EmptyState",methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-list-collab__empty">\n\t\t\t<div class="bx-im-list-collab__empty_icon"></div>\n\t\t\t<div class="bx-im-list-collab__empty_text">\n\t\t\t\t{{ loc('IM_LIST_COLLAB_EMPTY_V2') }}\n\t\t\t</div>\n\t\t</div>\n\t`};var v=babelHelpers.classPrivateFieldLooseKey("itemsPerPage");var u=babelHelpers.classPrivateFieldLooseKey("isLoading");var m=babelHelpers.classPrivateFieldLooseKey("pagesLoaded");var p=babelHelpers.classPrivateFieldLooseKey("hasMoreItemsToLoad");var L=babelHelpers.classPrivateFieldLooseKey("lastMessageDate");var f=babelHelpers.classPrivateFieldLooseKey("requestItems");var P=babelHelpers.classPrivateFieldLooseKey("updateModels");var M=babelHelpers.classPrivateFieldLooseKey("getChatsWithCounters");var B=babelHelpers.classPrivateFieldLooseKey("getLastMessageDate");var I=babelHelpers.classPrivateFieldLooseKey("filterPinnedItemsMessages");class y{constructor(){Object.defineProperty(this,I,{value:x});Object.defineProperty(this,B,{value:_});Object.defineProperty(this,M,{value:H});Object.defineProperty(this,P,{value:F});Object.defineProperty(this,f,{value:C});this.firstPageIsLoaded=false;Object.defineProperty(this,v,{writable:true,value:50});Object.defineProperty(this,u,{writable:true,value:false});Object.defineProperty(this,m,{writable:true,value:0});Object.defineProperty(this,p,{writable:true,value:true});Object.defineProperty(this,L,{writable:true,value:0})}async loadFirstPage(){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=true;const e=await babelHelpers.classPrivateFieldLooseBase(this,f)[f]({firstPage:true});this.firstPageIsLoaded=true;return e}loadNextPage(){if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]||!babelHelpers.classPrivateFieldLooseBase(this,p)[p]){return Promise.resolve()}babelHelpers.classPrivateFieldLooseBase(this,u)[u]=true;return babelHelpers.classPrivateFieldLooseBase(this,f)[f]()}hasMoreItemsToLoad(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}}async function C({firstPage:e=false}={}){const t={data:{limit:babelHelpers.classPrivateFieldLooseBase(this,v)[v],filter:{lastMessageDate:e?null:babelHelpers.classPrivateFieldLooseBase(this,L)[L]}}};const s=await n.runAction(d.RestMethod.imV2RecentCollabTail,t).catch((([e])=>{console.error("Im.CollabList: page request error",e)}));babelHelpers.classPrivateFieldLooseBase(this,m)[m]++;l.Logger.warn(`Im.CollabList: ${e?"First":babelHelpers.classPrivateFieldLooseBase(this,m)[m]} page request result`,s);const{hasNextPage:i}=s;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=babelHelpers.classPrivateFieldLooseBase(this,B)[B](s);if(!i){babelHelpers.classPrivateFieldLooseBase(this,p)[p]=false}babelHelpers.classPrivateFieldLooseBase(this,u)[u]=false;return babelHelpers.classPrivateFieldLooseBase(this,P)[P](s)}function F(e){const{users:t,chats:s,messages:i,files:a,recentItems:n,messagesAutoDeleteConfigs:l}=e;const c=babelHelpers.classPrivateFieldLooseBase(this,M)[M](s,n);const d=(new o.UserManager).setUsersToModel(t);const g=r.Core.getStore().dispatch("chats/set",c);const h=r.Core.getStore().dispatch("chats/autoDelete/set",l);const b=r.Core.getStore().dispatch("messages/store",i);const v=r.Core.getStore().dispatch("files/set",a);const u=r.Core.getStore().dispatch("recent/setCollab",n);return Promise.all([d,g,b,v,u,h])}function H(e,t){const s={};e.forEach((e=>{s[e.id]=e}));t.forEach((e=>{const{counter:t,chatId:i}=e;if(t===0){return}s[i]={...s[i],counter:t}}));return Object.values(s)}function _(e){const t=babelHelpers.classPrivateFieldLooseBase(this,I)[I](e);if(t.length===0){return""}let s=t[0].date;t.forEach((e=>{if(e.date<s){s=e.date}}));return s}function x(e){const{messages:t,recentItems:s}=e;return t.filter((e=>{const t=e.chat_id;const i=s.find((e=>e.chatId===t));return i.pinned===false}))}class S extends h.RecentMenu{getMenuItems(){return[this.getUnreadMessageItem(),this.getPinMessageItem(),this.getMuteItem()]}getOpenItem(){return{text:c.Loc.getMessage("IM_LIB_MENU_OPEN"),onclick:()=>{g.LayoutManager.getInstance().setLayout({name:d.Layout.collab.name,entityId:this.context.dialogId});this.menuInstance.close()}}}}const X={name:"CollabList",components:{EmptyState:b,LoadingState:i.ListLoadingState,RecentItem:a.RecentItem},emits:["chatClick"],data(){return{isLoading:false,isLoadingNextPage:false,firstPageLoaded:false}},computed:{collection(){return this.$store.getters["recent/getCollabCollection"]},preparedItems(){return[...this.collection].sort(((e,t)=>{const s=this.$store.getters["recent/getSortDate"](e.dialogId);const i=this.$store.getters["recent/getSortDate"](t.dialogId);return i-s}))},pinnedItems(){return this.preparedItems.filter((e=>e.pinned===true))},generalItems(){return this.preparedItems.filter((e=>e.pinned===false))},isEmptyCollection(){return this.collection.length===0}},created(){this.contextMenuManager=new S;void t.DraftManager.getInstance().initDraftHistory()},beforeUnmount(){this.contextMenuManager.destroy()},async activated(){this.isLoading=true;await this.getRecentService().loadFirstPage();this.firstPageLoaded=true;this.isLoading=false},methods:{async onScroll(e){this.contextMenuManager.close();if(!s.Utils.dom.isOneScreenRemaining(e.target)||!this.getRecentService().hasMoreItemsToLoad){return}this.isLoadingNextPage=true;await this.getRecentService().loadNextPage();this.isLoadingNextPage=false},onClick(e){this.$emit("chatClick",e.dialogId)},onRightClick(e,t){t.preventDefault();this.contextMenuManager.openMenu(e,t.currentTarget)},getRecentService(){if(!this.service){this.service=new y}return this.service},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-list-collab__container">\n\t\t\t<LoadingState v-if="isLoading && !firstPageLoaded" />\n\t\t\t<div v-else @scroll="onScroll" class="bx-im-list-collab__scroll-container">\n\t\t\t\t<EmptyState v-if="isEmptyCollection" />\n\t\t\t\t<div v-if="pinnedItems.length > 0" class="bx-im-list-collab__pinned_container">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for="item in pinnedItems"\n\t\t\t\t\t\t:key="item.dialogId"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t@click="onClick(item)"\n\t\t\t\t\t\t@click.right="onRightClick(item, $event)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-list-collab__general_container">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for="item in generalItems"\n\t\t\t\t\t\t:key="item.dialogId"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t@click="onClick(item)"\n\t\t\t\t\t\t@click.right="onRightClick(item, $event)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<LoadingState v-if="isLoadingNextPage" />\n\t\t\t</div>\n\t\t</div>\n\t`};e.CollabList=X})(this.BX.Messenger.v2.Component.List=this.BX.Messenger.v2.Component.List||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.List,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=collab-list.bundle.map.js