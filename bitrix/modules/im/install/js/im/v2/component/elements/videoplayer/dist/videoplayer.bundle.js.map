{"version":3,"file":"videoplayer.bundle.js","sources":["../src/videoplayer.js"],"sourcesContent":["import 'ui.fonts.opensans';\nimport 'main.polyfill.intersectionobserver';\nimport { lazyload } from 'ui.vue3.directives.lazyload';\n\nimport { FadeAnimation } from 'im.v2.component.animation';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport './css/videoplayer.css';\n\nimport type { JsonObject } from 'main.core';\n\nconst State = Object.freeze({\n\tplay: 'play',\n\tpause: 'pause',\n\tstop: 'stop',\n\tnone: 'none',\n});\n\nconst PreloadAttribute = Object.freeze({\n\tnone: 'none',\n\tmetadata: 'metadata',\n\tauto: 'auto',\n});\n\n// @vue/component\nexport const VideoPlayer = {\n\tname: 'VideoPlayer',\n\tdirectives: { lazyload },\n\tcomponents: { FadeAnimation },\n\tprops:\n\t{\n\t\tfileId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tsrc: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tpreviewImageUrl: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\twithAutoplay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\telementStyle: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\twithPlayerControls: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tviewerAttributes: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => {},\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tpreloadAttribute: PreloadAttribute.none,\n\t\t\tloaded: false,\n\t\t\tloading: false,\n\t\t\tstate: State.none,\n\t\t\ttimeCurrent: 0,\n\t\t\ttimeTotal: 0,\n\t\t\tisMuted: true,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tState: () => State,\n\t\tisAutoPlayDisabled(): boolean\n\t\t{\n\t\t\treturn !this.withAutoplay && this.state === State.none;\n\t\t},\n\t\tshowStartButton(): boolean\n\t\t{\n\t\t\treturn this.withPlayerControls && this.isAutoPlayDisabled;\n\t\t},\n\t\tshowInterface(): boolean\n\t\t{\n\t\t\treturn this.withPlayerControls && !this.showStartButton;\n\t\t},\n\t\tformattedTime(): string\n\t\t{\n\t\t\tif (!this.loaded && !this.timeTotal)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\tlet time = 0;\n\t\t\tif (this.state === State.play)\n\t\t\t{\n\t\t\t\ttime = this.timeTotal - this.timeCurrent;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttime = this.timeTotal;\n\t\t\t}\n\n\t\t\treturn Utils.date.formatMediaDurationTime(time);\n\t\t},\n\t\tcontrolButtonClass(): string\n\t\t{\n\t\t\tif (this.loading)\n\t\t\t{\n\t\t\t\treturn '--loading';\n\t\t\t}\n\n\t\t\treturn this.state === State.play ? '--pause' : '--play';\n\t\t},\n\t\tsource(): HTMLVideoElement\n\t\t{\n\t\t\treturn this.$refs.source;\n\t\t},\n\t\thasViewerAttributes(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tif (!this.previewImageUrl)\n\t\t{\n\t\t\tthis.preloadAttribute = PreloadAttribute.metadata;\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tthis.getObserver().observe(this.$refs.body);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getObserver().unobserve(this.$refs.body);\n\t},\n\tmethods:\n\t{\n\t\tloadFile()\n\t\t{\n\t\t\tif (this.loaded || this.loading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.preloadAttribute = PreloadAttribute.auto;\n\n\t\t\tthis.loading = true;\n\t\t\tthis.playAfterLoad = true;\n\t\t},\n\t\thandleControlClick()\n\t\t{\n\t\t\tif (this.state === State.play)\n\t\t\t{\n\t\t\t\tthis.getObserver().unobserve(this.$refs.body);\n\t\t\t\tthis.pause();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.play();\n\t\t\t}\n\t\t},\n\t\thandleMuteClick()\n\t\t{\n\t\t\tif (this.isMuted)\n\t\t\t{\n\t\t\t\tthis.unmute();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.mute();\n\t\t\t}\n\t\t},\n\t\thandleContainerClick()\n\t\t{\n\t\t\tif (this.hasViewerAttributes)\n\t\t\t{\n\t\t\t\tthis.pause();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.handleControlClick();\n\t\t},\n\t\tplay()\n\t\t{\n\t\t\tif (!this.loaded)\n\t\t\t{\n\t\t\t\tthis.loadFile();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.source.play();\n\t\t},\n\t\tpause()\n\t\t{\n\t\t\tthis.source.pause();\n\t\t},\n\t\tmute()\n\t\t{\n\t\t\tthis.isMuted = true;\n\t\t\tthis.source.muted = true;\n\t\t},\n\t\tunmute()\n\t\t{\n\t\t\tthis.isMuted = false;\n\t\t\tthis.source.muted = false;\n\t\t},\n\t\thandleError(event: Event)\n\t\t{\n\t\t\tconsole.error('Im.VideoPlayer: loading failed', this.fileId, event);\n\n\t\t\tthis.loading = false;\n\t\t\tthis.state = State.none;\n\t\t\tthis.timeTotal = 0;\n\t\t\tthis.preloadAttribute = PreloadAttribute.none;\n\t\t},\n\t\thandleAbort(event: Event)\n\t\t{\n\t\t\tthis.handleError(event);\n\t\t},\n\t\thandlePlay()\n\t\t{\n\t\t\tthis.state = State.play;\n\t\t},\n\t\thandleLoadedData()\n\t\t{\n\t\t\tthis.timeTotal = this.source.duration;\n\t\t},\n\t\thandleDurationChange()\n\t\t{\n\t\t\tthis.handleLoadedData();\n\t\t},\n\t\thandleLoadedMetaData()\n\t\t{\n\t\t\tthis.timeTotal = this.source.duration;\n\t\t\tthis.loaded = true;\n\t\t\tthis.play();\n\t\t},\n\t\thandleCanPlayThrough()\n\t\t{\n\t\t\tthis.loading = false;\n\t\t\tthis.loaded = true;\n\t\t\tthis.play();\n\t\t},\n\t\thandlePause()\n\t\t{\n\t\t\tif (this.state === State.stop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.state = State.pause;\n\t\t},\n\t\thandleVolumeChange()\n\t\t{\n\t\t\tif (this.source.muted)\n\t\t\t{\n\t\t\t\tthis.mute();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unmute();\n\t\t\t}\n\t\t},\n\t\thandleTimeUpdate()\n\t\t{\n\t\t\tthis.timeCurrent = this.source.currentTime;\n\t\t},\n\t\tgetObserver(): IntersectionObserver\n\t\t{\n\t\t\tif (this.observer)\n\t\t\t{\n\t\t\t\treturn this.observer;\n\t\t\t}\n\n\t\t\tthis.observer = new IntersectionObserver((entries) => {\n\t\t\t\tif (this.isAutoPlayDisabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.play();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, {\n\t\t\t\tthreshold: [0, 1],\n\t\t\t});\n\n\t\t\treturn this.observer;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-video-player__container\" @click.stop=\"handleContainerClick\">\n\t\t\t<FadeAnimation :duration=\"500\">\n\t\t\t\t<div v-if=\"showStartButton\" class=\"bx-im-video-player__start-play_button\" @click.stop=\"handleControlClick\">\n\t\t\t\t\t<span class=\"bx-im-video-player__start-play_icon\"></span>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t\t<FadeAnimation :duration=\"500\">\n\t\t\t\t<div v-if=\"showInterface\" class=\"bx-im-video-player__control-button_container\" @click.stop=\"handleControlClick\">\n\t\t\t\t\t<button class=\"bx-im-video-player__control-button\" :class=\"controlButtonClass\"></button>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t\t<FadeAnimation :duration=\"500\">\n\t\t\t\t<div \n\t\t\t\t\tv-if=\"showInterface\" \n\t\t\t\t\tclass=\"bx-im-video-player__info-container\" \n\t\t\t\t\t@click.stop=\"handleMuteClick\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"bx-im-video-player__time\">{{ formattedTime }}</span>\n\t\t\t\t\t<span class=\"bx-im-video-player__sound\" :class=\"{'--muted': isMuted}\"></span>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t\t<div class=\"bx-im-video-player__video-container\" ref=\"body\">\n\t\t\t\t<video\n\t\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\t\t:src=\"src\"\n\t\t\t\t\tclass=\"bx-im-video-player__video\"\n\t\t\t\t\t:poster=\"previewImageUrl\"\n\t\t\t\t\tref=\"source\"\n\t\t\t\t\t:preload=\"preloadAttribute\"\n\t\t\t\t\tplaysinline\n\t\t\t\t\tloop\n\t\t\t\t\tmuted\n\t\t\t\t\t:style=\"elementStyle\"\n\t\t\t\t\t@abort=\"handleAbort\"\n\t\t\t\t\t@error=\"handleError\"\n\t\t\t\t\t@canplaythrough=\"handleCanPlayThrough\"\n\t\t\t\t\t@durationchange=\"handleDurationChange\"\n\t\t\t\t\t@loadeddata=\"handleLoadedData\"\n\t\t\t\t\t@loadedmetadata=\"handleLoadedMetaData\"\n\t\t\t\t\t@volumechange=\"handleVolumeChange\"\n\t\t\t\t\t@timeupdate=\"handleTimeUpdate\"\n\t\t\t\t\t@play=\"handlePlay\"\n\t\t\t\t\t@pause=\"handlePause\"\n\t\t\t\t></video>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["State","Object","freeze","play","pause","stop","none","PreloadAttribute","metadata","auto","VideoPlayer","name","directives","lazyload","components","FadeAnimation","props","fileId","type","Number","String","default","src","required","previewImageUrl","withAutoplay","Boolean","elementStyle","withPlayerControls","viewerAttributes","data","preloadAttribute","loaded","loading","state","timeCurrent","timeTotal","isMuted","computed","isAutoPlayDisabled","showStartButton","showInterface","formattedTime","time","Utils","date","formatMediaDurationTime","controlButtonClass","source","$refs","hasViewerAttributes","keys","length","created","mounted","getObserver","observe","body","beforeUnmount","unobserve","methods","loadFile","playAfterLoad","handleControlClick","handleMuteClick","unmute","mute","handleContainerClick","muted","handleError","event","console","error","handleAbort","handlePlay","handleLoadedData","duration","handleDurationChange","handleLoadedMetaData","handleCanPlayThrough","handlePause","handleVolumeChange","handleTimeUpdate","currentTime","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","threshold","template"],"mappings":"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"}