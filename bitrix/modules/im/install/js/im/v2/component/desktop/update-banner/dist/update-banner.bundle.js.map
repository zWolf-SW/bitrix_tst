{"version":3,"file":"update-banner.bundle.js","sources":["../src/update-banner.js"],"sourcesContent":["import { Browser, Extension, Loc } from 'main.core';\n\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { getHelpdeskStringCallback } from 'im.v2.lib.helpdesk';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport './css/update-banner.css';\n\n// @vue/component\nexport const DesktopUpdateBanner = {\n\tname: 'DesktopUpdateBanner',\n\tcomputed:\n\t{\n\t\tdesktopDownloadUrl(): string\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.desktop.update-banner');\n\n\t\t\treturn settings.get('desktopDownloadUrl');\n\t\t},\n\t\theaderText(): string\n\t\t{\n\t\t\tconst messageCode = this.isSupportedOs\n\t\t\t\t? 'IM_DESKTOP_UPDATE_BANNER_HEADING'\n\t\t\t\t: 'IM_DESKTOP_UPDATE_BANNER_HEADING_NOT_SUPPORTED_OS'\n\t\t\t;\n\n\t\t\treturn this.loc(messageCode);\n\t\t},\n\t\tdescriptionText(): string\n\t\t{\n\t\t\tconst messageCode = this.isSupportedOs\n\t\t\t\t? 'IM_DESKTOP_UPDATE_BANNER_DESCRIPTION'\n\t\t\t\t: 'IM_DESKTOP_UPDATE_BANNER_DESCRIPTION_NOT_SUPPORTED_OS'\n\t\t\t;\n\n\t\t\treturn Loc.getMessage(messageCode, {\n\t\t\t\t'[helpdesk]': `<span onclick=\"${this.showHelpArticle()}\" class=\"bx-im-desktop-update-banner__description-more\">`,\n\t\t\t\t'[/helpdesk]': '</span>',\n\t\t\t\t'[br]': '<br>',\n\t\t\t});\n\t\t},\n\t\tshowBrowserLink(): boolean\n\t\t{\n\t\t\treturn DesktopApi.getMajorVersion() > 15;\n\t\t},\n\t\tisSupportedOs(): boolean\n\t\t{\n\t\t\tif (!Browser.isWin())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (DesktopApi.getWindowsOSBuild() > 0)\n\t\t\t{\n\t\t\t\tconst MIN_SUPPORTED_WINDOWS_BUILD = 10000;\n\n\t\t\t\treturn DesktopApi.getWindowsOSBuild() > MIN_SUPPORTED_WINDOWS_BUILD;\n\t\t\t}\n\n\t\t\treturn this.isSupportedWindowsVersion;\n\t\t},\n\t\t/**\n\t\t * Old Windows versions (NT 6x) are not supported.\n\t\t * Windows NT 6.2 - Windows 8\n\t\t * Windows NT 6.3 - Windows 8.1\n\t\t * Windows NT 6.1 - Windows 7\n\t\t * Detection relies on checking for the substring \"Windows NT 6\" in the user agent.\n\t\t * This method is not fully reliable and may cause issues with future Windows versions (e.g., Windows NT 6x).\n\t\t * @returns {boolean}\n\t\t */\n\t\tisSupportedWindowsVersion(): boolean\n\t\t{\n\t\t\tconst userAgent = navigator.userAgent.toLowerCase();\n\n\t\t\treturn !userAgent.includes('windows nt 6');\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tshowHelpArticle(): string\n\t\t{\n\t\t\tconst ARTICLE_CODE = '25374968';\n\n\t\t\tconst analyticsHandler = 'BX.Messenger.v2.Lib.Analytics.getInstance().desktopUpdateBanner.onClickMoreInformation()';\n\t\t\tconst helpdeskArticleHandler = getHelpdeskStringCallback(ARTICLE_CODE);\n\n\t\t\treturn `\n\t\t\t\t${analyticsHandler}\n\t\t\t\t${helpdeskArticleHandler}\n\t\t\t`;\n\t\t},\n\t\topenRootDomain()\n\t\t{\n\t\t\tAnalytics.getInstance().desktopUpdateBanner.onOpenWebVersion();\n\t\t\tDesktopApi.openInBrowser(location.origin);\n\t\t},\n\t\topenDesktopDownloadPage()\n\t\t{\n\t\t\tAnalytics.getInstance().desktopUpdateBanner.onClickUpdate();\n\t\t\tUtils.browser.openLink(this.desktopDownloadUrl);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-messenger__scope bx-im-desktop-update-banner__container\">\n\t\t\t<div class=\"bx-im-desktop-update-banner__logo\">\n\t\t\t\t<h1 class=\"bx-im-desktop-update-banner__logo-heading\">{{ loc('IM_DESKTOP_UPDATE_BANNER_LOGO') }}</h1>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-desktop-update-banner__content-container\">\n\t\t\t\t<div class=\"bx-im-desktop-update-banner__image\"></div>\n\t\t\t\t<div class=\"bx-im-desktop-update-banner__content\">\n\t\t\t\t\t<h2 class=\"bx-im-desktop-update-banner__heading\">{{ loc('IM_DESKTOP_UPDATE_BANNER_HEADING') }}</h2>\n\t\t\t\t\t<p v-html=\"descriptionText\" class=\"bx-im-desktop-update-banner__description\"></p>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"isSupportedOs\" class=\"bx-im-desktop-update-banner__buttons\">\n\t\t\t\t\t<button @click=\"openDesktopDownloadPage\" class=\"bx-im-desktop-update-banner__update\">\n\t\t\t\t\t\t{{ loc('IM_DESKTOP_UPDATE_BANNER_UPDATE') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button v-if=\"showBrowserLink\" @click=\"openRootDomain\" class=\"bx-im-desktop-update-banner__version\">\n\t\t\t\t\t\t{{ loc('IM_DESKTOP_UPDATE_BANNER_VERSION') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["DesktopUpdateBanner","name","computed","desktopDownloadUrl","settings","Extension","getSettings","get","headerText","messageCode","isSupportedOs","loc","descriptionText","Loc","getMessage","showHelpArticle","showBrowserLink","DesktopApi","getMajorVersion","Browser","isWin","getWindowsOSBuild","MIN_SUPPORTED_WINDOWS_BUILD","isSupportedWindowsVersion","userAgent","navigator","toLowerCase","includes","methods","ARTICLE_CODE","analyticsHandler","helpdeskArticleHandler","getHelpdeskStringCallback","openRootDomain","Analytics","getInstance","desktopUpdateBanner","onOpenWebVersion","openInBrowser","location","origin","openDesktopDownloadPage","onClickUpdate","Utils","browser","openLink","phraseCode","$Bitrix","template"],"mappings":";;;;;;;;CASA;AACA,OAAaA,mBAAmB,GAAG;GAClCC,IAAI,EAAE,qBAAqB;GAC3BC,QAAQ,EACR;KACCC,kBAAkB,GAClB;OACC,MAAMC,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,uCAAuC,CAAC;OAE/E,OAAOF,QAAQ,CAACG,GAAG,CAAC,oBAAoB,CAAC;MACzC;KACDC,UAAU,GACV;OACC,MAAMC,WAAW,GAAG,IAAI,CAACC,aAAa,GACnC,kCAAkC,GAClC,mDAAmD;OAGtD,OAAO,IAAI,CAACC,GAAG,CAACF,WAAW,CAAC;MAC5B;KACDG,eAAe,GACf;OACC,MAAMH,WAAW,GAAG,IAAI,CAACC,aAAa,GACnC,sCAAsC,GACtC,uDAAuD;OAG1D,OAAOG,aAAG,CAACC,UAAU,CAACL,WAAW,EAAE;SAClC,YAAY,EAAG,kBAAiB,IAAI,CAACM,eAAe,EAAG,0DAAyD;SAChH,aAAa,EAAE,SAAS;SACxB,MAAM,EAAE;QACR,CAAC;MACF;KACDC,eAAe,GACf;OACC,OAAOC,+BAAU,CAACC,eAAe,EAAE,GAAG,EAAE;MACxC;KACDR,aAAa,GACb;OACC,IAAI,CAACS,iBAAO,CAACC,KAAK,EAAE,EACpB;SACC,OAAO,IAAI;;OAGZ,IAAIH,+BAAU,CAACI,iBAAiB,EAAE,GAAG,CAAC,EACtC;SACC,MAAMC,2BAA2B,GAAG,KAAK;SAEzC,OAAOL,+BAAU,CAACI,iBAAiB,EAAE,GAAGC,2BAA2B;;OAGpE,OAAO,IAAI,CAACC,yBAAyB;MACrC;;CAEH;CACA;CACA;CACA;CACA;CACA;CACA;CACA;KACEA,yBAAyB,GACzB;OACC,MAAMC,SAAS,GAAGC,SAAS,CAACD,SAAS,CAACE,WAAW,EAAE;OAEnD,OAAO,CAACF,SAAS,CAACG,QAAQ,CAAC,cAAc,CAAC;;IAE3C;GACDC,OAAO,EACP;KACCb,eAAe,GACf;OACC,MAAMc,YAAY,GAAG,UAAU;OAE/B,MAAMC,gBAAgB,GAAG,0FAA0F;OACnH,MAAMC,sBAAsB,GAAGC,4CAAyB,CAACH,YAAY,CAAC;OAEtE,OAAQ;MACLC,gBAAiB;MACjBC,sBAAuB;IACzB;MACD;KACDE,cAAc,GACd;OACCC,6BAAS,CAACC,WAAW,EAAE,CAACC,mBAAmB,CAACC,gBAAgB,EAAE;OAC9DpB,+BAAU,CAACqB,aAAa,CAACC,QAAQ,CAACC,MAAM,CAAC;MACzC;KACDC,uBAAuB,GACvB;OACCP,6BAAS,CAACC,WAAW,EAAE,CAACC,mBAAmB,CAACM,aAAa,EAAE;OAC3DC,qBAAK,CAACC,OAAO,CAACC,QAAQ,CAAC,IAAI,CAAC1C,kBAAkB,CAAC;MAC/C;KACDQ,GAAG,CAACmC,UAAkB,EACtB;OACC,OAAO,IAAI,CAACC,OAAO,CAAClC,GAAG,CAACC,UAAU,CAACgC,UAAU,CAAC;;IAE/C;GACDE,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;CAsBZ,CAAC;;;;;;;;"}