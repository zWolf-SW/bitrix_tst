this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(e,t,i,n,l,s){"use strict";const a=488;const o=340;const r=200;const m=100;const d={name:"ImageItem",directives:{lazyload:i.lazyload},components:{ProgressBar:s.ProgressBar},props:{file:{type:Object,required:true},isGallery:{type:Boolean,default:true},handleLoading:{type:Boolean,default:false},allowRemove:{type:Boolean,default:false}},emits:["remove","cancelClick"],computed:{imageSize(){if(this.isGallery){return{}}let e=this.file.image.width;let t=this.file.image.height;if(this.file.image.width>a||this.file.image.height>o){const i=this.file.image.width/this.file.image.height;if(this.file.image.width>a){e=a;t=Math.round(a/i)}if(t>o){e=Math.round(o*i);t=o}}const i={width:Math.max(e,r),height:Math.max(t,m)};return{width:`${i.width}px`,height:`${i.height}px`,"object-fit":i.width<100||i.height<100?"cover":"contain"}},viewerAttributes(){return l.Utils.file.getViewerDataAttributes({viewerAttributes:this.file.viewerAttrs,previewImageSrc:this.file.urlPreview,context:n.FileViewerContext.dialog})},canBeOpenedWithViewer(){var e;return this.file.viewerAttrs&&((e=BX.UI)==null?void 0:e.Viewer)},imageTitle(){const e=l.Utils.file.formatFileSize(this.file.size);return this.loc("IM_ELEMENTS_MEDIA_IMAGE_TITLE",{"#NAME#":this.file.name,"#SIZE#":e})},isLoaded(){return this.file.progress===100},isVideo(){return this.file.type===n.FileType.video},showPlayIcon(){return this.isVideo&&(this.isLoaded||!this.handleLoading)},isAnimated(){return this.file.extension==="gif"||this.file.extension==="webp"},previewSourceLink(){if(this.isAnimated){return this.file.urlShow||this.file.urlDownload}return this.file.urlPreview},allowLazyLoad(){return!this.previewSourceLink.startsWith("blob:")},withoutPreview(){return!t.Type.isStringFilled(this.previewSourceLink)}},methods:{download(){if(this.file.progress!==100||this.canBeOpenedWithViewer){return}window.open(this.file.urlDownload,"_blank")},loc(e,t={}){return this.$Bitrix.Loc.getMessage(e,t)},onRemoveClick(){this.$emit("remove",{file:this.file})},onCancelClick(e){this.$emit("cancelClick",e)}},template:`\n\t\t<div \n\t\t\tv-bind="viewerAttributes" \n\t\t\tclass="bx-im-elements-media-gallery-image-item__container" \n\t\t\t:class="{'--without-preview': withoutPreview}"\n\t\t\t@click="download"\n\t\t\t:style="imageSize"\n\t\t>\n\t\t\t<img\n\t\t\t\tv-if="allowLazyLoad"\n\t\t\t\tv-lazyload\n\t\t\t\tdata-lazyload-dont-hide\n\t\t\t\t:data-lazyload-src="previewSourceLink"\n\t\t\t\t:title="imageTitle"\n\t\t\t\t:alt="file.name"\n\t\t\t\tclass="bx-im-elements-media-gallery-image-item__source"\n\t\t\t/>\n\t\t\t<img\n\t\t\t\tv-else\n\t\t\t\t:src="previewSourceLink"\n\t\t\t\t:title="imageTitle"\n\t\t\t\t:alt="file.name"\n\t\t\t\tclass="bx-im-elements-media-gallery-image-item__source"\n\t\t\t/>\n\t\t\t<ProgressBar \n\t\t\t\tv-if="handleLoading && !isLoaded" \n\t\t\t\t:item="file" \n\t\t\t\t:withLabels="!isGallery" \n\t\t\t\t@cancelClick="onCancelClick"\n\t\t\t/>\n\t\t\t<div v-if="showPlayIcon" class="bx-im-elements-media-gallery-image-item__play-icon-container">\n\t\t\t\t<div class="bx-im-elements-media-gallery-image-item__play-icon"></div>\n\t\t\t</div>\n\t\t\t<div v-if="allowRemove" class="bx-im-elements-media-gallery-image-item__remove" @click="onRemoveClick">\n\t\t\t\t<div class="bx-im-elements-media-gallery-image-item__remove-icon"></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const c=Object.freeze({image:"ImageItem",video:"ImageItem"});const h={name:"MediaItem",components:{ImageItem:d},props:{file:{type:Object,required:true},allowRemove:{type:Boolean,default:false},handleLoading:{type:Boolean,default:false}},emits:["remove","cancelClick"],computed:{componentName(){return c[this.file.type]}},methods:{onRemove(e){this.$emit("remove",e)},onCancel(e){this.$emit("cancelClick",e)}},template:`\n\t\t<component\n\t\t\t:is="componentName"\n\t\t\t:file="file"\n\t\t\t:allowRemove="allowRemove"\n\t\t\t:handleLoading="handleLoading"\n\t\t\t@remove="onRemove"\n\t\t\t@cancelClick="onCancel"\n\t\t/>\n\t`};const v={name:"MediaGallery",components:{MediaItem:h},props:{files:{type:Array,required:true},allowRemoveItem:{type:Boolean,default:false},handleLoading:{type:Boolean,default:false}},emits:["removeItem","cancelClick"],computed:{firstFile(){return this.files[0]},filesCount(){return this.files.length},isGallery(){return this.filesCount>1},isSingleFile(){return this.filesCount===1},isError(){return this.filesCount===0},templateRows(){if(this.filesCount>=7){return"140px 80px 80px 58px"}if(this.filesCount>=3){return"140px 80px 80px"}return"140px 80px"},galleryStyles(){return{gridTemplateRows:this.templateRows}}},methods:{onRemoveItem(e){this.$emit("removeItem",e)},onCancel(e){this.$emit("cancelClick",e)},getMediaItemStyles(e){var t,i;const n={10:["1-4","1-1","1-2","1-1","1-1","1-2","1-1","1-1","1-2","1-1"],9:["1-4","1-1","1-2","1-1","1-2","1-2","1-1","1-2","1-1"],8:["1-4","1-2","1-2","1-1","1-2","1-1","1-2","1-2"],7:["1-4","1-2","1-2","1-2","1-2","1-2","1-2"],6:["1-4","1-2","1-2","1-1","1-2","1-1"],5:["1-4","1-2","1-2","1-2","1-2"],4:["2-4","1-1","1-2","1-1"],3:["2-4","1-2","1-2"],2:["2-2","2-2"]};const l=(t=(i=n[this.filesCount])==null?void 0:i[e])!=null?t:"1-1";const[s,a]=l.split("-");return{"grid-row-end":`span ${s}`,"grid-column-end":`span ${a}`}}},template:`\n\t\t<div class="bx-im-elements-media-gallery__container">\n\t\t\t<div v-if="isGallery" class="bx-im-elements-media-gallery__items" :style="galleryStyles">\n\t\t\t\t<MediaItem\n\t\t\t\t\tv-for="(file, index) in files"\n\t\t\t\t\t:key="file.id"\n\t\t\t\t\t:file="file"\n\t\t\t\t\t:allowRemove="allowRemoveItem"\n\t\t\t\t\t:handleLoading="handleLoading"\n\t\t\t\t\t:style="getMediaItemStyles(index)"\n\t\t\t\t\t@remove="onRemoveItem"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-else-if="isSingleFile" class="bx-im-elements-media-gallery__single-file">\n\t\t\t\t<MediaItem\n\t\t\t\t\t:file="firstFile"\n\t\t\t\t\t:allowRemove="allowRemoveItem"\n\t\t\t\t\t:handleLoading="handleLoading"\n\t\t\t\t\t:isGallery="false"\n\t\t\t\t\t@remove="onRemoveItem"\n\t\t\t\t\t@cancelClick="onCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-else-if="isError" class="bx-im-elements-media-gallery__error">\n\n\t\t\t</div>\n\t\t</div>\n\t`};e.MediaGallery=v;e.MediaItem=h})(this.BX.Messenger.v2.Component.Elements=this.BX.Messenger.v2.Component.Elements||{},BX,BX.Vue3.Directives,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements);
//# sourceMappingURL=media-gallery.bundle.map.js