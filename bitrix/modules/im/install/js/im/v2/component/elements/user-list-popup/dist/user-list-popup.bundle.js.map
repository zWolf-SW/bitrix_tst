{"version":3,"file":"user-list-popup.bundle.js","sources":["../src/classes/user-list-service.js","../src/components/user-item.js","../src/components/user-list-content.js","../src/user-list-popup.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { RestClient } from 'rest.client';\n\nexport class UserListService\n{\n\t#restClient: RestClient;\n\t#userManager: UserManager;\n\n\tconstructor()\n\t{\n\t\tthis.#restClient = Core.getRestClient();\n\t\tthis.#userManager = new UserManager();\n\t}\n\n\tasync loadUsers(userIds: number[]): Promise\n\t{\n\t\tconst result: RestResult = await this.#restClient.callMethod(RestMethod.imUserListGet, { ID: userIds })\n\t\t\t.catch((errorResult: RestResult) => {\n\t\t\t\tconsole.error('UserListService: loadUsers error', errorResult.error());\n\t\t\t});\n\n\t\treturn this.#userManager.setUsersToModel(Object.values(result.data()));\n\t}\n}","import { Messenger } from 'im.public';\nimport { ImModelUser } from 'im.v2.model';\nimport { AvatarSize, ChatAvatar } from 'im.v2.component.elements.avatar';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\n\n// @vue/component\nexport const UserItem = {\n\tname: 'UserItem',\n\tcomponents: { ChatAvatar, ChatTitle },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcontextDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.userId, true);\n\t\t},\n\t\tuserDialogId(): string\n\t\t{\n\t\t\treturn this.userId.toString();\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonUserClick()\n\t\t{\n\t\t\tvoid Messenger.openChat(this.userDialogId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-user-list-content__user-container\" @click=\"onUserClick\">\n\t\t\t<div class=\"bx-im-user-list-content__avatar-container\">\n\t\t\t\t<ChatAvatar\n\t\t\t\t\t:avatarDialogId=\"userDialogId\"\n\t\t\t\t\t:contextDialogId=\"contextDialogId\"\n\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<ChatTitle \n\t\t\t\t:dialogId=\"userDialogId\" \n\t\t\t\t:showItsYou=\"false\" \n\t\t\t\tclass=\"bx-im-user-list-content__chat-title-container\" \n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { ImModelUser } from 'im.v2.model';\nimport { Loader } from 'im.v2.component.elements.loader';\n\nimport { UserListService } from '../classes/user-list-service';\n\nimport { UserItem } from './user-item';\n\nimport '../css/user-list-content.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const UserListContent = {\n\tcomponents: { UserItem, Loader },\n\tprops: {\n\t\tuserIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tadjustPopupFunction: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\tcontextDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\thasError: false,\n\t\t\tisLoadingUsers: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tisLoading(): boolean\n\t\t{\n\t\t\treturn this.loading || this.isLoadingUsers;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tuserIds()\n\t\t{\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.adjustPopupFunction();\n\t\t\t});\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tif (this.needUserRequest())\n\t\t{\n\t\t\tthis.requestUserData();\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tgetUserListService(): UserListService\n\t\t{\n\t\t\tif (!this.userListService)\n\t\t\t{\n\t\t\t\tthis.userListService = new UserListService();\n\t\t\t}\n\n\t\t\treturn this.userListService;\n\t\t},\n\t\tgetUser(userId): ?ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](userId);\n\t\t},\n\t\tneedUserRequest(): boolean\n\t\t{\n\t\t\treturn this.userIds.some((userId) => !this.getUser(userId));\n\t\t},\n\t\tasync requestUserData()\n\t\t{\n\t\t\tthis.isLoadingUsers = true;\n\t\t\tawait this.getUserListService().loadUsers(this.userIds)\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.hasError = true;\n\t\t\t\t});\n\n\t\t\tthis.isLoadingUsers = false;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-user-list-content__container bx-im-user-list-content__scope\">\n\t\t\t<template v-if=\"!isLoading && !hasError\">\n\t\t\t\t<UserItem v-for=\"userId in userIds\" :userId=\"userId\" :contextDialogId=\"contextDialogId\" />\n\t\t\t</template>\n\t\t\t<div v-else-if=\"isLoading\" class=\"bx-im-user-list-content__loader-container\">\n\t\t\t\t<Loader />\n\t\t\t</div>\n\t\t\t<div v-else-if=\"hasError\">\n\t\t\t\t{{ loc('IM_ELEMENTS_CHAT_INFO_POPUP_NO_ACCESS') }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { MessengerPopup } from 'im.v2.component.elements.popup';\n\nimport { UserListContent } from './components/user-list-content';\n\nimport type { PopupOptions } from 'main.popup';\n\nconst POPUP_ID = 'im-user-list-popup';\n\n// @vue/component\nexport const UserListPopup = {\n\tname: 'UserListPopup',\n\tcomponents: { MessengerPopup, UserListContent },\n\tprops:\n\t{\n\t\tshowPopup: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: POPUP_ID,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tuserIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcontextDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\twithAngle: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\tforceTop: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\toffsetLeft: {\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\temits: ['close'],\n\tcomputed:\n\t{\n\t\tPOPUP_ID: () => POPUP_ID,\n\t\tconfig(): PopupOptions\n\t\t{\n\t\t\tconst config = {\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\toffsetTop: 4,\n\t\t\t\toffsetLeft: this.offsetLeft,\n\t\t\t\tpadding: 0,\n\t\t\t\tangle: this.withAngle,\n\t\t\t};\n\n\t\t\tif (this.forceTop)\n\t\t\t{\n\t\t\t\tconfig.bindOptions = { position: 'top' };\n\t\t\t}\n\n\t\t\treturn config;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<MessengerPopup\n\t\t\tv-if=\"showPopup\"\n\t\t\tv-slot=\"{adjustPosition}\"\n\t\t\t:config=\"config\"\n\t\t\t@close=\"$emit('close')\"\n\t\t\t:id=\"id\"\n\t\t>\n\t\t\t<UserListContent \n\t\t\t\t:userIds=\"userIds\"\n\t\t\t\t:contextDialogId=\"contextDialogId\"\n\t\t\t\t:loading=\"loading\" \n\t\t\t\t:adjustPopupFunction=\"adjustPosition\"\n\t\t\t/>\n\t\t</MessengerPopup>\n\t`,\n};\n"],"names":["UserListService","constructor","Core","getRestClient","UserManager","loadUsers","userIds","result","callMethod","RestMethod","imUserListGet","ID","catch","errorResult","console","error","setUsersToModel","Object","values","data","UserItem","name","components","ChatAvatar","ChatTitle","props","userId","type","Number","required","contextDialogId","String","computed","AvatarSize","user","$store","getters","userDialogId","toString","methods","onUserClick","Messenger","openChat","template","UserListContent","Loader","Array","adjustPopupFunction","Function","loading","Boolean","default","hasError","isLoadingUsers","isLoading","watch","$nextTick","created","needUserRequest","requestUserData","getUserListService","userListService","getUser","some","loc","phraseCode","$Bitrix","Loc","getMessage","POPUP_ID","UserListPopup","MessengerPopup","showPopup","id","bindElement","withAngle","forceTop","offsetLeft","emits","config","targetContainer","document","body","offsetTop","padding","angle","bindOptions","position"],"mappings":"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"}