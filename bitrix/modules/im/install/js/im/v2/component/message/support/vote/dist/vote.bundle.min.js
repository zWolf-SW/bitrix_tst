this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(e,t,s,i,o,r){"use strict";const l={like:"like",dislike:"dislike",none:"none"};const a={voteText:"imolVoteText",likeText:"imolVoteLike",dislikeText:"imolVoteDislike",currentVote:"imolVote",timeLimit:"imolTimeLimitVote",voteCloseDate:"imolDateCloseVote"};var n=babelHelpers.classPrivateFieldLooseKey("messageId");var c=babelHelpers.classPrivateFieldLooseKey("dialogId");var d=babelHelpers.classPrivateFieldLooseKey("updateModel");class v{constructor(e,t){Object.defineProperty(this,d,{value:h});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=t}like(){babelHelpers.classPrivateFieldLooseBase(this,d)[d]({vote:l.like});const e={MESSAGE_ID:babelHelpers.classPrivateFieldLooseBase(this,n)[n],DIALOG_ID:babelHelpers.classPrivateFieldLooseBase(this,c)[c],RATING:l.like};o.Core.getRestClient().callMethod(r.RestMethod.imBotDialogVote,e).catch((e=>{console.error("VoteService: error in dialog vote",e.error())}))}dislike(){babelHelpers.classPrivateFieldLooseBase(this,d)[d]({vote:l.dislike});const e={MESSAGE_ID:babelHelpers.classPrivateFieldLooseBase(this,n)[n],DIALOG_ID:babelHelpers.classPrivateFieldLooseBase(this,c)[c],RATING:l.dislike};o.Core.getRestClient().callMethod(r.RestMethod.imBotDialogVote,e).catch((e=>{console.error("VoteService: error in dialog vote",e.error())}))}}function h(e){const{vote:t}=e;const s=o.Core.getStore().getters["messages/getById"](babelHelpers.classPrivateFieldLooseBase(this,n)[n]);const i={...s.componentParams,[a.currentVote]:t};void o.Core.getStore().dispatch("messages/update",{id:babelHelpers.classPrivateFieldLooseBase(this,n)[n],fields:{componentParams:i}})}const m={name:"SupportVote",components:{BaseMessage:s.BaseMessage},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withTitle:{type:Boolean,default:true}},computed:{message(){return this.item},currentVote(){return this.message.componentParams[a.currentVote]||l.none},voteText(){if(this.currentVote===l.none){return this.message.componentParams[a.voteText]}if(this.currentVote===l.like){return this.message.componentParams[a.likeText]}return this.message.componentParams[a.dislikeText]},voteClosed(){const e=this.message.componentParams[a.voteCloseDate];if(!t.Type.isStringFilled(e)){return false}return new Date(e).getTime()<Date.now()},likeClasses(){return{"--active":this.currentVote===l.like,"--disabled":this.currentVote===l.dislike}},dislikeClasses(){return{"--active":this.currentVote===l.dislike,"--disabled":this.currentVote===l.like}}},methods:{onLike(){if(this.currentVote===l.like){return}if(this.voteClosed){this.showVoteClosedNotification();return}this.getVoteService().like()},onDislike(){if(this.currentVote===l.dislike){return}if(this.voteClosed){this.showVoteClosedNotification();return}this.getVoteService().dislike()},showVoteClosedNotification(){i.Notifier.support.onVoteClosedError()},getVoteService(){if(!this.voteService){this.voteService=new v(this.message.id,this.dialogId)}return this.voteService},loc(e,t={}){return this.$Bitrix.Loc.getMessage(e,t)}},template:`\n\t\t<BaseMessage\n\t\t\t:item="item"\n\t\t\t:dialogId="dialogId"\n\t\t\t:withTitle="withTitle"\n\t\t\t:withContextMenu="false"\n\t\t\t:withReactions="false"\n\t\t>\n\t\t\t<div class="bx-im-message-support-vote__container">\n\t\t\t\t<div class="bx-im-message-support-vote__title">{{ loc('IM_MESSAGE_SUPPORT_VOTE_TITLE') }}</div>\n\t\t\t\t<div class="bx-im-message-support-vote__subtitle">{{ voteText }}</div>\n\t\t\t\t<div class="bx-im-message-support-vote__actions">\n\t\t\t\t\t<div class="bx-im-message-support-vote__action_item --like" :class="likeClasses" @click="onLike"></div>\n\t\t\t\t\t<div class="bx-im-message-support-vote__action_item --dislike" :class="dislikeClasses" @click="onDislike"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BaseMessage>\n\t`};e.SupportVoteMessage=m})(this.BX.Messenger.v2.Component.Message=this.BX.Messenger.v2.Component.Message||{},BX,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Const);
//# sourceMappingURL=vote.bundle.map.js