this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,n,i,a,s,o,r,d,l,c,h,g,u,p,m,v,C,_,T,b,E,I,B,S,A,M,f){"use strict";const y={name:"CallHeaderButton",props:{dialogId:{type:String,required:true},compactMode:{type:Boolean,default:false}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},componentToRender(){return e.CallButton}},template:`\n\t\t<component v-if="componentToRender" :is="componentToRender" :dialog="dialog" :compactMode="compactMode" />\n\t`};const L={[I.ChatEntityLinkType.tasks]:{className:"--task",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_TASK")},[I.ChatEntityLinkType.calendar]:{className:"--calendar",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_MEETING_MSGVER_1")},[I.ChatEntityLinkType.sonetGroup]:{className:"--group",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_GROUP_MSGVER_1")},[I.ChatEntityLinkType.mail]:{className:"--mail",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_MAIL_MSGVER_1")},[I.ChatEntityLinkType.contact]:{className:"--crm",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_CONTACT")},[I.ChatEntityLinkType.deal]:{className:"--crm",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_DEAL")},[I.ChatEntityLinkType.lead]:{className:"--crm",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_LEAD")},[I.ChatEntityLinkType.dynamic]:{className:"--crm",loc:m.Loc.getMessage("IM_CONTENT_CHAT_HEADER_OPEN_DYNAMIC_ELEMENT")}};const x={name:"EntityLink",props:{dialogId:{type:String,required:true}},data(){return{}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},entityType(){return this.dialog.entityLink.type},entityUrl(){return this.dialog.entityLink.url},containerClassName(){var t,e;return(t=(e=L[this.entityType])==null?void 0:e.className)!=null?t:""},linkText(){var t,e;return(t=(e=L[this.entityType])==null?void 0:e.loc)!=null?t:"Open entity"}},template:`\n\t\t<a :href="entityUrl" class="bx-im-chat-header-entity-link__container" :class="containerClassName" target="_blank">\n\t\t\t<div class="bx-im-chat-header-entity-link__icon"></div>\n\t\t\t<div class="bx-im-chat-header-entity-link__text --ellipsis">{{ linkText }}</div>\n\t\t\t<div class="bx-im-chat-header-entity-link__arrow"></div>\n\t\t</a>\n\t`};const N={[I.ChatType.openChannel]:"IM_CONTENT_CHAT_HEADER_CHANNEL_USER_COUNT",[I.ChatType.channel]:"IM_CONTENT_CHAT_HEADER_CHANNEL_USER_COUNT",[I.ChatType.generalChannel]:"IM_CONTENT_CHAT_HEADER_CHANNEL_USER_COUNT",default:"IM_CONTENT_CHAT_HEADER_USER_COUNT"};const O={name:"UserCounter",inject:["currentSidebarPanel","withSidebar"],props:{dialogId:{type:String,required:true}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},sidebarTooltipText(){return this.withSidebar?this.loc("IM_CONTENT_CHAT_HEADER_OPEN_MEMBERS"):""},isMembersPanelActive(){return this.currentSidebarPanel===I.SidebarDetailBlock.members},needShowSubtitleCursor(){return this.withSidebar},userCounterPhraseCode(){var t;return(t=N[this.dialog.type])!=null?t:N.default},userCounterText(){return m.Loc.getMessagePlural(this.userCounterPhraseCode,this.dialog.userCounter,{"#COUNT#":this.dialog.userCounter})}},methods:{onMembersClick(){if(this.isMembersPanelActive){_.EventEmitter.emit(I.EventType.sidebar.close,{panel:I.SidebarDetailBlock.members});return}_.EventEmitter.emit(I.EventType.sidebar.open,{panel:I.SidebarDetailBlock.members,dialogId:this.dialogId})},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\t:title="sidebarTooltipText"\n\t\t\t@click="onMembersClick"\n\t\t\tclass="bx-im-chat-header__subtitle_content"\n\t\t\t:class="{'--click': needShowSubtitleCursor}"\n\t\t>\n\t\t\t{{ userCounterText }}\n\t\t</div>\n\t`};const k={name:"GroupChatTitle",components:{EditableChatTitle:a.EditableChatTitle,EntityLink:x,LineLoader:n.LineLoader,FadeAnimation:i.FadeAnimation,UserCounter:O},inject:["withSidebar"],props:{dialogId:{type:String,required:true}},emits:["newTitle"],computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},hasEntityLink(){var t;return Boolean((t=this.dialog.entityLink)==null?void 0:t.url)}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-chat-header__info">\n\t\t\t<EditableChatTitle :dialogId="dialogId" @newTitleSubmit="$emit('newTitle', $event)" />\n\t\t\t<LineLoader v-if="!dialog.inited" :width="50" :height="16" />\n\t\t\t<FadeAnimation :duration="100">\n\t\t\t\t<div v-if="dialog.inited" class="bx-im-chat-header__subtitle_container">\n\t\t\t\t\t<UserCounter :dialogId="dialogId" />\n\t\t\t\t\t<EntityLink v-if="hasEntityLink" :dialogId="dialogId" />\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t</div>\n\t`};const w=60*1e3;const P={name:"UserTitle",components:{ChatTitle:a.ChatTitle},props:{dialogId:{type:String,required:true}},data(){return{userLastOnlineText:""}},computed:{userPosition(){return this.$store.getters["users/getPosition"](this.dialogId)},userLastOnline(){return this.$store.getters["users/getLastOnline"](this.dialogId)},userLink(){return o.Utils.user.getProfileLink(this.dialogId)}},watch:{userLastOnline(t){this.userLastOnlineText=t}},created(){this.updateUserOnline();this.userLastOnlineInterval=setInterval(this.updateUserOnline,w)},beforeUnmount(){clearInterval(this.userLastOnlineInterval)},methods:{updateUserOnline(){this.userLastOnlineText=this.$store.getters["users/getLastOnline"](this.dialogId)}},template:`\n\t\t<div class="bx-im-chat-header__info">\n\t\t\t<div class="bx-im-chat-header__title --user">\n\t\t\t\t<a :href="userLink" target="_blank" class="bx-im-chat-header__title_container">\n\t\t\t\t\t<ChatTitle :dialogId="dialogId" :withAutoDelete="true" />\n\t\t\t\t</a>\n\t\t\t\t<span class="bx-im-chat-header__user-status">{{ userLastOnlineText }}</span>\n\t\t\t</div>\n\t\t\t<div class="bx-im-chat-header__subtitle_container">\n\t\t\t\t<div class="bx-im-chat-header__subtitle_content">{{ userPosition }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const D={name:"HeaderAvatar",components:{ChatAvatar:s.ChatAvatar},props:{dialogId:{type:String,required:true}},emits:["avatarClick"],computed:{AvatarSize:()=>s.AvatarSize,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isUser(){return this.dialog.type===I.ChatType.user},canChangeAvatar(){return B.PermissionManager.getInstance().canPerformActionByRole(I.ActionByRole.avatar,this.dialogId)},isNotes(){return Number.parseInt(this.dialogId,10)===b.Core.getUserId()},userLink(){return o.Utils.user.getProfileLink(this.dialogId)},avatarType(){return this.isNotes?s.ChatAvatarType.notes:""},needProfileLink(){return this.isUser&&!this.isNotes}},methods:{onAvatarClick(){if(this.isUser||!this.canChangeAvatar){return}this.$refs.avatarInput.click()},async onAvatarSelect(t){const e=t.target;const n=e.files[0];if(!n){return}const i=await this.getChatService().prepareAvatar(n);if(!i){return}void this.getChatService().changeAvatar(this.dialog.chatId,i)},getChatService(){if(!this.chatService){this.chatService=new C.ChatService}return this.chatService}},template:`\n\t\t<div class="bx-im-chat-header__avatar" :class="{'--can-change': canChangeAvatar}" @click="onAvatarClick">\n\t\t\t<a v-if="needProfileLink" :href="userLink" target="_blank">\n\t\t\t\t<ChatAvatar\n\t\t\t\t\t:avatarDialogId="dialogId"\n\t\t\t\t\t:contextDialogId="dialogId"\n\t\t\t\t\t:size="AvatarSize.L"\n\t\t\t\t/>\n\t\t\t</a>\n\t\t\t<ChatAvatar v-else :avatarDialogId="dialogId" :contextDialogId="dialogId" :size="AvatarSize.L" :customType="avatarType" />\n\t\t</div>\n\t\t<input\n\t\t\ttype="file"\n\t\t\taccept="image/*"\n\t\t\tclass="bx-im-chat-header__avatar_input"\n\t\t\tref="avatarInput"\n\t\t\t@change="onAvatarSelect"\n\t\t>\n\t`};const R={name:"AddToChatButton",components:{AddToChat:A.AddToChat},props:{dialogId:{type:String,default:""}},data(){return{showInviteButton:false,showAddToChatPopup:false}},methods:{openAddToChatPopup(){E.Analytics.getInstance().userAdd.onChatHeaderClick(this.dialogId);this.showAddToChatPopup=true},closeAddToChatPopup(){this.showAddToChatPopup=false},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\t:title="loc('IM_CONTENT_CHAT_HEADER_OPEN_INVITE_POPUP_TITLE')"\n\t\t\t:class="{'--active': showAddToChatPopup}"\n\t\t\tclass="bx-im-chat-header__icon --add-people"\n\t\t\t@click="openAddToChatPopup"\n\t\t\tref="add-members"\n\t\t></div>\n\t\t<AddToChat\n\t\t\tv-if="showAddToChatPopup"\n\t\t\t:bindElement="$refs['add-members'] ?? {}"\n\t\t\t:dialogId="dialogId"\n\t\t\t:popupConfig="{ offsetTop: 15, offsetLeft: -300 }"\n\t\t\t@close="closeAddToChatPopup"\n\t\t/>\n\t`};const H={name:"SearchButton",inject:["currentSidebarPanel"],props:{dialogId:{type:String,default:""}},computed:{isMessageSearchActive(){return this.currentSidebarPanel===I.SidebarDetailBlock.messageSearch}},methods:{toggleSearchPanel(){if(this.isMessageSearchActive){_.EventEmitter.emit(I.EventType.sidebar.close,{panel:I.SidebarDetailBlock.messageSearch});return}_.EventEmitter.emit(I.EventType.sidebar.open,{panel:I.SidebarDetailBlock.messageSearch,dialogId:this.dialogId})},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\t:title="loc('IM_CONTENT_CHAT_HEADER_OPEN_SEARCH')"\n\t\t\t:class="{'--active': isMessageSearchActive}"\n\t\t\tclass="bx-im-chat-header__icon --search"\n\t\t\t@click="toggleSearchPanel"\n\t\t></div>\n\t`};const U={name:"SidebarButton",inject:["currentSidebarPanel"],props:{dialogId:{type:String,default:""}},computed:{isSidebarOpened(){return m.Type.isStringFilled(this.currentSidebarPanel)}},methods:{toggleRightPanel(){if(this.isSidebarOpened){_.EventEmitter.emit(I.EventType.sidebar.close,{panel:""});return}_.EventEmitter.emit(I.EventType.sidebar.open,{panel:I.SidebarDetailBlock.main,dialogId:this.dialogId})},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\tclass="bx-im-chat-header__icon --panel"\n\t\t\t:title="loc('IM_CONTENT_CHAT_HEADER_OPEN_SIDEBAR')"\n\t\t\t:class="{'--active': isSidebarOpened}"\n\t\t\t@click="toggleRightPanel"\n\t\t></div>\n\t`};const z=700;const $={name:"ChatHeader",components:{ChatAvatar:s.ChatAvatar,CallHeaderButton:y,GroupChatTitle:k,UserChatTitle:P,LineLoader:n.LineLoader,FadeAnimation:i.FadeAnimation,HeaderAvatar:D,AddToChatButton:R,SearchButton:H,SidebarButton:U},inject:["withSidebar"],props:{dialogId:{type:String,default:""},withCallButton:{type:Boolean,default:true},withSearchButton:{type:Boolean,default:true},withAddToChatButton:{type:Boolean,default:true}},emits:["buttonPanelReady","compactModeChange"],data(){return{compactMode:false}},computed:{user(){return this.$store.getters["users/get"](this.dialogId,true)},dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isInited(){return this.dialog.inited},isUser(){return this.dialog.type===I.ChatType.user},isBot(){if(!this.isUser){return false}return this.user.type===I.UserType.bot},showCallButton(){if(this.isBot||!this.withCallButton){return false}return B.PermissionManager.getInstance().canPerformActionByRole(I.ActionByRole.call,this.dialogId)},showAddToChatButton(){if(this.isBot||!this.withAddToChatButton){return false}const t=B.PermissionManager.getInstance().canPerformActionByUserType(I.ActionByUserType.createChat);if(this.isUser&&!t){return false}return B.PermissionManager.getInstance().canPerformActionByRole(I.ActionByRole.extend,this.dialogId)},showSearchButton(){return this.withSearchButton},showSidebarButton(){if(!this.withSidebar){return false}return B.PermissionManager.getInstance().canPerformActionByRole(I.ActionByRole.openSidebar,this.dialogId)},chatTitleComponent(){return this.isUser?P:k},containerClasses(){return{"--compact":this.compactMode}}},created(){if(this.isInited){this.emitButtonPanelReady()}},mounted(){this.initResizeObserver()},beforeUnmount(){this.getResizeObserver().disconnect()},methods:{initResizeObserver(){this.resizeObserver=new ResizeObserver((([t])=>{this.onContainerResize(t.contentRect.width)}));this.resizeObserver.observe(this.$refs.container)},onContainerResize(t){const e=t<=z;if(e!==this.compactMode){this.$emit("compactModeChange",e);this.compactMode=e}},onNewTitleSubmit(t){void this.getChatService().renameChat(this.dialogId,t)},getChatService(){if(!this.chatService){this.chatService=new C.ChatService}return this.chatService},getResizeObserver(){return this.resizeObserver},emitButtonPanelReady(){this.$emit("buttonPanelReady")},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-chat-header__scope bx-im-chat-header__container" :class="containerClasses" ref="container">\n\t\t\t<div class="bx-im-chat-header__left">\n\t\t\t\t<slot name="left">\n\t\t\t\t\t<HeaderAvatar :dialogId="dialogId" />\n\t\t\t\t\t<slot name="title" :onNewTitleHandler="onNewTitleSubmit">\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is="chatTitleComponent"\n\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t@newTitle="onNewTitleSubmit"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</slot>\n\t\t\t\t</slot>\n\t\t\t</div>\n\t\t\t<LineLoader v-if="!isInited" :width="45" :height="22" />\n\t\t\t<FadeAnimation @afterEnter="emitButtonPanelReady" :duration="100">\n\t\t\t\t<div v-if="isInited" class="bx-im-chat-header__right">\n\t\t\t\t\t<slot name="before-actions"></slot>\n\t\t\t\t\t<CallHeaderButton v-if="showCallButton" :dialogId="dialogId" :compactMode="compactMode" />\n\t\t\t\t\t<slot v-if="showAddToChatButton" name="add-to-chat-button">\n\t\t\t\t\t\t<AddToChatButton :dialogId="dialogId" />\n\t\t\t\t\t</slot>\n\t\t\t\t\t<SearchButton v-if="showSearchButton" :dialogId="dialogId" />\n\t\t\t\t\t<SidebarButton v-if="showSidebarButton" :dialogId="dialogId" />\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t</div>\n\t`};const X={chatHeader:64,pinnedMessages:53,blockedTextarea:64,dropAreaOffset:16};const F={props:{dialogId:{type:String,required:true},container:{type:Object,required:true}},data(){return{showDropArea:false,lastDropAreaEnterTarget:null}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},hasPinnedMessages(){return this.$store.getters["messages/pin/getPinned"](this.dialog.chatId).length>0},dropAreaStyles(){let t=X.dropAreaOffset+X.chatHeader;if(this.hasPinnedMessages){t+=X.pinnedMessages}return{top:`${t}px`}}},watch:{container:{immediate:true,handler(t){if(!m.Type.isElementNode(t)){return}this.bindEvents()}}},beforeUnmount(){this.unbindEvents()},methods:{bindEvents(){m.Event.bind(this.container,"dragenter",this.onDragEnter);m.Event.bind(this.container,"dragleave",this.onDragLeave);m.Event.bind(this.container,"dragover",this.onDragOver);m.Event.bind(this.container,"drop",this.onDrop)},unbindEvents(){m.Event.unbind(this.container,"dragenter",this.onDragEnter);m.Event.unbind(this.container,"dragleave",this.onDragLeave);m.Event.unbind(this.container,"dragover",this.onDragOver);m.Event.unbind(this.container,"drop",this.onDrop)},async onDragEnter(t){t.stopPropagation();t.preventDefault();const e=await p.hasDataTransferOnlyFiles(t.dataTransfer,false);if(!e){return}this.lastDropAreaEnterTarget=t.target;this.showDropArea=true},onDragLeave(t){t.stopPropagation();t.preventDefault();if(this.lastDropAreaEnterTarget!==t.target){return}this.showDropArea=false},onDragOver(t){t.preventDefault()},async onDrop(t){t.preventDefault();const e=this.getMultiUploadingService();const n=await e.uploadFromDragAndDrop({event:t,dialogId:this.dialogId,sendAsFile:false,autoUpload:false});if(m.Type.isArrayFilled(n.uploaderIds)){_.EventEmitter.emit(I.EventType.textarea.openUploadPreview,{multiUploadingResult:n})}this.showDropArea=false},getMultiUploadingService(){if(!this.multiUploadingService){this.multiUploadingService=new v.MultiUploadingService}return this.multiUploadingService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<Transition name="drop-area-fade">\n\t\t\t<div v-if="showDropArea" :style="dropAreaStyles" class="bx-im-content-chat-drop-area__container bx-im-content-chat-drop-area__scope">\n\t\t\t\t<div class="bx-im-content-chat-drop-area__box">\n\t\t\t\t\t<span class="bx-im-content-chat-drop-area__icon"></span>\n\t\t\t\t\t<label class="bx-im-content-chat-drop-area__label-text">\n\t\t\t\t\t\t{{ loc('IM_CONTENT_DROP_AREA') }}\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Transition>\n\t`};const G="rgba(0, 0, 0, 0.1)";const q="rgba(0, 0, 0, 0.2)";const K="#fff";const j={components:{ChatButton:S.ChatButton},props:{dialogId:{type:String,required:true}},data(){return{}},computed:{ButtonSize:()=>S.ButtonSize,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isMuted(){return this.dialog.muteList.includes(b.Core.getUserId())},buttonText(){const t=this.loc("IM_CONTENT_BLOCKED_TEXTAREA_ENABLE_NOTIFICATIONS");const e=this.loc("IM_CONTENT_BLOCKED_TEXTAREA_DISABLE_NOTIFICATIONS");return this.isMuted?t:e},buttonColorScheme(){return{borderColor:I.Color.transparent,backgroundColor:G,iconColor:K,textColor:K,hoverColor:q}}},methods:{onButtonClick(){if(this.isMuted){this.getChatService().unmuteChat(this.dialogId);return}this.getChatService().muteChat(this.dialogId)},getChatService(){if(!this.chatService){this.chatService=new C.ChatService}return this.chatService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-chat__textarea_placeholder">\n\t\t\t<ChatButton\n\t\t\t\t:size="ButtonSize.XL"\n\t\t\t\t:customColorScheme="buttonColorScheme"\n\t\t\t\t:text="buttonText"\n\t\t\t\t:isRounded="true"\n\t\t\t\t@click="onButtonClick"\n\t\t\t/>\n\t\t</div>\n\t`};const V={components:{ChatButton:S.ChatButton},props:{dialogId:{type:String,required:true}},computed:{ButtonSize:()=>S.ButtonSize,ButtonColor:()=>S.ButtonColor},methods:{onButtonClick(){this.getChatService().joinChat(this.dialogId)},getChatService(){if(!this.chatService){this.chatService=new C.ChatService}return this.chatService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-chat__textarea_placeholder">\n\t\t\t<ChatButton\n\t\t\t\t:size="ButtonSize.XL"\n\t\t\t\t:color="ButtonColor.Primary"\n\t\t\t\t:text="loc('IM_CONTENT_BLOCKED_TEXTAREA_JOIN_CHAT')"\n\t\t\t\t:isRounded="true"\n\t\t\t\t@click="onButtonClick"\n\t\t\t/>\n\t\t</div>\n\t`};const J={name:"BulkActionsPanel",components:{ChatButton:S.ChatButton,ForwardPopup:A.ForwardPopup},directives:{hint:T.hint},props:{dialogId:{type:String,default:""}},data(){return{showForwardPopup:false,messagesIds:[]}},computed:{ButtonSize:()=>S.ButtonSize,ButtonIcon:()=>S.ButtonIcon,ButtonColor:()=>S.ButtonColor,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},selectedMessages(){return this.$store.getters["messages/select/getCollection"](this.dialogId)},messagesAuthorId(){return[...this.selectedMessages].map((t=>this.$store.getters["messages/getById"](t).authorId))},hasOthersMessages(){const t=b.Core.getUserId();return this.messagesAuthorId.some((e=>e!==t))},canDeleteMessage(){const t=B.PermissionManager.getInstance();return t.canPerformActionByRole(I.ActionByRole.deleteOthersMessage,this.dialogId)},selectedMessagesSize(){return this.selectedMessages.size},formattedMessagesCounter(){if(!this.selectedMessagesSize){return""}return`(${this.selectedMessagesSize})`},isBlockedDeletion(){if(this.canDeleteMessage){return false}return this.hasOthersMessages},messageCounterText(){if(!this.selectedMessagesSize){return this.loc("IM_CONTENT_BULK_ACTIONS_SELECT_MESSAGES")}return this.loc("IM_CONTENT_BULK_ACTIONS_COUNT_MESSAGES")},confirmTitle(){return this.loc("IM_CONTENT_BULK_ACTIONS_CONFIRM_TITLE",{"#COUNT#":this.selectedMessagesSize})},tooltipSettings(){return{text:this.loc("IM_CONTENT_BULK_ACTIONS_DELETE_NOT_CAN_DELETE"),popupOptions:{angle:true,targetContainer:document.body,offsetTop:-13,offsetLeft:65,bindOptions:{position:"top"}}}}},methods:{onForwardButtonClick(){E.Analytics.getInstance().messageForward.onClickForward({dialogId:this.dialogId});this.messagesIds=[...this.selectedMessages];this.showForwardPopup=true},closeForwardPopup(){this.messagesIds=[];this.showForwardPopup=false},async onDeleteButtonClick(){const t=await M.showDeleteMessagesConfirm(this.confirmTitle);if(!t){return false}this.getMessageService().deleteMessages([...this.selectedMessages]);this.closeBulkActionsMode();return true},closeBulkActionsMode(){_.EventEmitter.emit(I.EventType.dialog.closeBulkActionsMode,{dialogId:this.dialogId})},getMessageService(){if(!this.messageService){this.messageService=new f.MessageService({chatId:this.dialog.chatId})}return this.messageService},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-content-bulk-actions-panel">\n\t\t\t<div class="bx-im-content-bulk-actions-panel__container">\n\t\t\t\t<div class="bx-im-content-bulk-actions-panel__left-section">\n\t\t\t\t\t<div @click="closeBulkActionsMode" class="bx-im-content-bulk-actions-panel__cancel"></div>\n\t\t\t\t\t<div class="bx-im-content-bulk-actions-panel__counter-container">\n\t\t\t\t\t\t<span class="bx-im-content-bulk-actions-panel__counter-name">{{ messageCounterText }}</span>\n\t\t\t\t\t\t<span class="bx-im-content-bulk-actions-panel__counter-number">{{ formattedMessagesCounter }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-bulk-actions-panel__right-section">\n\t\t\t\t\t<div class="bx-im-content-bulk-actions-panel__delete-button">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="isBlockedDeletion"\n\t\t\t\t\t\t\tv-hint="tooltipSettings"\n\t\t\t\t\t\t\tclass="bx-im-content-bulk-actions-panel__tooltip"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t\t\t:icon="ButtonIcon.Delete"\n\t\t\t\t\t\t\t:color="ButtonColor.Delete"\n\t\t\t\t\t\t\t:isDisabled="!selectedMessagesSize || isBlockedDeletion"\n\t\t\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t\t\t:isUppercase="false"\n\t\t\t\t\t\t\t:text="loc('IM_CONTENT_BULK_ACTIONS_PANEL_DELETE')"\n\t\t\t\t\t\t\t@click="onDeleteButtonClick"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t\t\t:icon="ButtonIcon.Forward"\n\t\t\t\t\t\t:color="ButtonColor.Forward"\n\t\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t\t:isUppercase="false"\n\t\t\t\t\t\t:isDisabled="!selectedMessagesSize"\n\t\t\t\t\t\t:text="loc('IM_CONTENT_BULK_ACTIONS_PANEL_FORWARD')"\n\t\t\t\t\t\t@click="onForwardButtonClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<ForwardPopup\n\t\t\t\t\tv-if="showForwardPopup"\n\t\t\t\t\t:messagesIds="messagesIds"\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t@close="closeForwardPopup"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const W={name:"LoadingBar",data(){return{}},template:`\n\t\t<div class="bx-im-content-chat__loading-bar"></div>\n\t`};const Y={mounted(t,e){e.instance.textareaResizeManager.observeTextarea(t)},beforeUnmount(t,e){e.instance.textareaResizeManager.unobserveTextarea(t)}};const Q={name:"BaseChatContent",components:{ChatHeader:$,ChatDialog:d.ChatDialog,ChatTextarea:l.ChatTextarea,ChatSidebar:g.ChatSidebar,DropArea:F,MutePanel:j,JoinPanel:V,BulkActionsPanel:J,LoadingBar:W},directives:{"textarea-observer":Y},provide(){return{currentSidebarPanel:r.computed((()=>this.currentSidebarPanel)),withSidebar:r.computed((()=>this.withSidebar))}},props:{dialogId:{type:String,default:""},withSidebar:{type:Boolean,default:true},withHeader:{type:Boolean,default:true}},data(){return{textareaHeight:0,showLoadingBar:false,currentSidebarPanel:""}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},canSend(){if(!this.dialog.isTextareaEnabled){return false}return B.PermissionManager.getInstance().canPerformActionByRole(I.ActionByRole.send,this.dialog.dialogId)},isGuest(){return this.dialog.role===I.UserRole.guest},isBulkActionsMode(){return this.$store.getters["messages/select/isBulkActionsModeActive"](this.dialogId)},hasCommentsOnTop(){return this.$store.getters["messages/comments/areOpenedForChannel"](this.dialogId)},containerClasses(){const t=this.$store.getters["application/settings/get"](I.Settings.appearance.alignment);return[`--${t}-align`]},backgroundStyle(){return c.ThemeManager.getCurrentBackgroundStyle(this.dialogId)},dialogContainerStyle(){let t=this.textareaHeight;if(!this.canSend||this.isBulkActionsMode){t=X.blockedTextarea}const e=this.withHeader?X.chatHeader:0;return{height:`calc(100% - ${e}px - ${t}px)`}}},watch:{textareaHeight(t,e){if(!this.dialog.inited||e===0){return}_.EventEmitter.emit(I.EventType.dialog.scrollToBottom,{chatId:this.dialog.chatId,animation:false})}},created(){this.initTextareaResizeManager();this.bindEvents();u.BulkActionsManager.init()},beforeUnmount(){this.unbindEvents()},methods:{initTextareaResizeManager(){this.textareaResizeManager=new h.ResizeManager;this.textareaResizeManager.subscribe(h.ResizeManager.events.onHeightChange,this.onTextareaHeightChange)},onTextareaMount(){const t=this.$refs["textarea-container"];this.textareaHeight=t.clientHeight},onTextareaHeightChange(t){const{newHeight:e}=t.getData();this.textareaHeight=e},onShowLoadingBar(t){const{dialogId:e}=t.getData();if(e!==this.dialogId){return}this.showLoadingBar=true},onHideLoadingBar(t){const{dialogId:e}=t.getData();if(e!==this.dialogId){return}this.showLoadingBar=false},onChangeSidebarPanel({panel:t}){this.currentSidebarPanel=t},bindEvents(){_.EventEmitter.subscribe(I.EventType.dialog.showLoadingBar,this.onShowLoadingBar);_.EventEmitter.subscribe(I.EventType.dialog.hideLoadingBar,this.onHideLoadingBar)},unbindEvents(){_.EventEmitter.unsubscribe(I.EventType.dialog.showLoadingBar,this.onShowLoadingBar);_.EventEmitter.unsubscribe(I.EventType.dialog.hideLoadingBar,this.onHideLoadingBar)},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-chat__scope bx-im-content-chat__container" :class="containerClasses" :style="backgroundStyle">\n\t\t\t<div class="bx-im-content-chat__content" ref="content">\n\t\t\t\t<slot v-if="withHeader" name="header">\n\t\t\t\t\t<ChatHeader :dialogId="dialogId" :key="dialogId" />\n\t\t\t\t</slot>\n\t\t\t\t<div :style="dialogContainerStyle" class="bx-im-content-chat__dialog_container">\n\t\t\t\t\t<Transition name="loading-bar-transition">\n\t\t\t\t\t\t<LoadingBar v-if="showLoadingBar" />\n\t\t\t\t\t</Transition>\n\t\t\t\t\t<div class="bx-im-content-chat__dialog_content">\n\t\t\t\t\t\t<slot name="dialog">\n\t\t\t\t\t\t\t<ChatDialog :dialogId="dialogId" :key="dialogId"/>\n\t\t\t\t\t\t</slot>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Textarea --\x3e\n\t\t\t\t<Transition name="bx-im-panel-transition">\n\t\t\t\t\t<BulkActionsPanel v-if="isBulkActionsMode" :dialogId="dialogId"/>\n\t\t\t\t\t<div v-else-if="canSend" v-textarea-observer class="bx-im-content-chat__textarea_container" ref="textarea-container">\n\t\t\t\t\t\t<slot name="textarea" :onTextareaMount="onTextareaMount">\n\t\t\t\t\t\t\t<ChatTextarea\n\t\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t\t:key="dialogId"\n\t\t\t\t\t\t\t\t:withAudioInput="false"\n\t\t\t\t\t\t\t\t@mounted="onTextareaMount"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</slot>\n\t\t\t\t\t</div>\n\t\t\t\t\t<slot v-else-if="isGuest" name="join-panel">\n\t\t\t\t\t\t<JoinPanel :dialogId="dialogId" />\n\t\t\t\t\t</slot>\n\t\t\t\t\t<MutePanel v-else :dialogId="dialogId" />\n\t\t\t\t</Transition>\n\t\t\t\t<DropArea :dialogId="dialogId" :container="$refs.content || {}" :key="dialogId" />\n\t\t\t\t\x3c!-- End textarea --\x3e\n\t\t\t</div>\n\t\t\t<ChatSidebar\n\t\t\t\tv-if="dialogId && withSidebar" \n\t\t\t\t:originDialogId="dialogId"\n\t\t\t\t:isActive="!hasCommentsOnTop"\n\t\t\t\t@changePanel="onChangeSidebarPanel"\n\t\t\t/>\n\t\t</div>\n\t`};t.ChatHeader=$;t.UserCounter=O;t.BaseChatContent=Q})(this.BX.Messenger.v2.Component.Content=this.BX.Messenger.v2.Component.Content||{},BX.Call.Component,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Animation,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Lib,BX.Vue3,BX.Messenger.v2.Component.Dialog,BX.Messenger.v2.Component,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Component,BX.Messenger.v2.Lib,BX.UI.Uploader,BX,BX.Messenger.v2.Service,BX.Messenger.v2.Service,BX.Event,BX.Vue3.Directives,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.EntitySelector,BX.Messenger.v2.Lib,BX.Messenger.v2.Service);
//# sourceMappingURL=registry.bundle.map.js