{"version":3,"file":"launch.bundle.js","sources":["../src/const.js","../src/launch.js"],"sourcesContent":["export const ChatEmbeddedApplication = {\n\ttask: 'task',\n};\n\nexport type ChatEmbeddedApplicationType = $Values<typeof ChatEmbeddedApplication>;\nexport type ChatEmbeddedApplicationInstance = {\n\trender: (element: HTMLElement | string) => Promise,\n};\n","import { Text, Runtime } from 'main.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport type { JsonObject } from 'main.core';\n\nexport { ChatEmbeddedApplication } from './const';\nexport type { ChatEmbeddedApplicationType, ChatEmbeddedApplicationInstance } from './const';\n\nconst RESERVED_NAMES = new Set(['Launch', 'Core']);\n\ntype LaunchParams = JsonObject & { embedded: boolean };\n\nexport const Launch = async (applicationName: string, params: LaunchParams = {}): Promise => {\n\tconst { embedded = false } = params;\n\n\tif (!validateApplicationName(applicationName))\n\t{\n\t\tLogger.error('BX.Messenger.Application.Launch: specified name is forbidden');\n\n\t\treturn Promise.reject();\n\t}\n\n\tif (!isApplicationLoaded(applicationName))\n\t{\n\t\tawait loadExtension(applicationName, embedded);\n\t}\n\n\tconst capitalizedName = Text.capitalize(applicationName);\n\tconst className = `${capitalizedName}Application`;\n\n\tconst preparedApplicationName = prepareApplicationName(applicationName, embedded);\n\ttry\n\t{\n\t\tBX.Messenger.v2.Application[preparedApplicationName] = new BX.Messenger.v2.Application[className](params);\n\n\t\treturn BX.Messenger.v2.Application[preparedApplicationName].ready();\n\t}\n\tcatch (error)\n\t{\n\t\tconst errorMessage = `BX.Messenger.Application.Launch: application \"${capitalizedName}\" is not initialized.`;\n\t\tLogger.error(errorMessage, error);\n\n\t\treturn Promise.reject(errorMessage);\n\t}\n};\n\nconst validateApplicationName = (applicationName: string): boolean => {\n\tconst capitalizedName = Text.capitalize(applicationName);\n\n\treturn !RESERVED_NAMES.has(capitalizedName) && !capitalizedName.endsWith('Application');\n};\n\nconst isApplicationLoaded = (applicationName: string): boolean => {\n\tconst capitalizedName = Text.capitalize(applicationName);\n\tconst className = `${capitalizedName}Application`;\n\n\treturn Boolean(BX.Messenger.v2.Application[className]);\n};\n\nconst loadExtension = async (applicationName: string, embedded: boolean) => {\n\tconst extensionName = embedded ? `im.v2.application.integration.${applicationName}` : `im.v2.application.${applicationName}`;\n\n\treturn Runtime?.loadExtension(extensionName);\n};\n\nconst prepareApplicationName = (applicationName: string, embedded: boolean): string => {\n\tif (embedded)\n\t{\n\t\treturn `${applicationName}_${Utils.text.getUuidV4()}`;\n\t}\n\n\treturn applicationName;\n};\n"],"names":["ChatEmbeddedApplication","task","RESERVED_NAMES","Set","Launch","applicationName","params","embedded","validateApplicationName","Logger","error","Promise","reject","isApplicationLoaded","loadExtension","capitalizedName","Text","capitalize","className","preparedApplicationName","prepareApplicationName","BX","Messenger","v2","Application","ready","errorMessage","has","endsWith","Boolean","extensionName","Runtime","Utils","text","getUuidV4"],"mappings":";;;;;;;OAAaA,uBAAuB,GAAG;GACtCC,IAAI,EAAE;CACP,CAAC;;CCQD,MAAMC,cAAc,GAAG,IAAIC,GAAG,CAAC,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;AAIlD,OAAaC,MAAM,GAAG,OAAOC,eAAuB,EAAEC,MAAoB,GAAG,EAAE,KAAc;GAC5F,MAAM;KAAEC,QAAQ,GAAG;IAAO,GAAGD,MAAM;GAEnC,IAAI,CAACE,uBAAuB,CAACH,eAAe,CAAC,EAC7C;KACCI,uBAAM,CAACC,KAAK,CAAC,8DAA8D,CAAC;KAE5E,OAAOC,OAAO,CAACC,MAAM,EAAE;;GAGxB,IAAI,CAACC,mBAAmB,CAACR,eAAe,CAAC,EACzC;KACC,MAAMS,aAAa,CAACT,eAAe,EAAEE,QAAQ,CAAC;;GAG/C,MAAMQ,eAAe,GAAGC,cAAI,CAACC,UAAU,CAACZ,eAAe,CAAC;GACxD,MAAMa,SAAS,GAAI,GAAEH,eAAgB,aAAY;GAEjD,MAAMI,uBAAuB,GAAGC,sBAAsB,CAACf,eAAe,EAAEE,QAAQ,CAAC;GACjF,IACA;KACCc,EAAE,CAACC,SAAS,CAACC,EAAE,CAACC,WAAW,CAACL,uBAAuB,CAAC,GAAG,IAAIE,EAAE,CAACC,SAAS,CAACC,EAAE,CAACC,WAAW,CAACN,SAAS,CAAC,CAACZ,MAAM,CAAC;KAEzG,OAAOe,EAAE,CAACC,SAAS,CAACC,EAAE,CAACC,WAAW,CAACL,uBAAuB,CAAC,CAACM,KAAK,EAAE;IACnE,CACD,OAAOf,KAAK,EACZ;KACC,MAAMgB,YAAY,GAAI,iDAAgDX,eAAgB,uBAAsB;KAC5GN,uBAAM,CAACC,KAAK,CAACgB,YAAY,EAAEhB,KAAK,CAAC;KAEjC,OAAOC,OAAO,CAACC,MAAM,CAACc,YAAY,CAAC;;CAErC,CAAC;CAED,MAAMlB,uBAAuB,GAAIH,eAAuB,IAAc;GACrE,MAAMU,eAAe,GAAGC,cAAI,CAACC,UAAU,CAACZ,eAAe,CAAC;GAExD,OAAO,CAACH,cAAc,CAACyB,GAAG,CAACZ,eAAe,CAAC,IAAI,CAACA,eAAe,CAACa,QAAQ,CAAC,aAAa,CAAC;CACxF,CAAC;CAED,MAAMf,mBAAmB,GAAIR,eAAuB,IAAc;GACjE,MAAMU,eAAe,GAAGC,cAAI,CAACC,UAAU,CAACZ,eAAe,CAAC;GACxD,MAAMa,SAAS,GAAI,GAAEH,eAAgB,aAAY;GAEjD,OAAOc,OAAO,CAACR,EAAE,CAACC,SAAS,CAACC,EAAE,CAACC,WAAW,CAACN,SAAS,CAAC,CAAC;CACvD,CAAC;CAED,MAAMJ,aAAa,GAAG,OAAOT,eAAuB,EAAEE,QAAiB,KAAK;GAC3E,MAAMuB,aAAa,GAAGvB,QAAQ,GAAI,iCAAgCF,eAAgB,EAAC,GAAI,qBAAoBA,eAAgB,EAAC;GAE5H,OAAO0B,iBAAO,oBAAPA,iBAAO,CAAEjB,aAAa,CAACgB,aAAa,CAAC;CAC7C,CAAC;CAED,MAAMV,sBAAsB,GAAG,CAACf,eAAuB,EAAEE,QAAiB,KAAa;GACtF,IAAIA,QAAQ,EACZ;KACC,OAAQ,GAAEF,eAAgB,IAAG2B,qBAAK,CAACC,IAAI,CAACC,SAAS,EAAG,EAAC;;GAGtD,OAAO7B,eAAe;CACvB,CAAC;;;;;;;;;"}