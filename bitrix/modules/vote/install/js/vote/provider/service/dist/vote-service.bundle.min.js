this.BX=this.BX||{};this.BX.Vote=this.BX.Vote||{};(function(e,s,t,a){"use strict";const r="im";const l="Bitrix\\Vote\\Attachment\\ImMessageConnector";var i=babelHelpers.classPrivateFieldLooseKey("app");var o=babelHelpers.classPrivateFieldLooseKey("load");var c=babelHelpers.classPrivateFieldLooseKey("notifyAjaxError");var n=babelHelpers.classPrivateFieldLooseKey("getManyVotes");var d=babelHelpers.classPrivateFieldLooseKey("setLoading");var b=babelHelpers.classPrivateFieldLooseKey("sendVoteStopRequest");var v=babelHelpers.classPrivateFieldLooseKey("sendVoteRevokeRequest");var h=babelHelpers.classPrivateFieldLooseKey("sendBackendVote");var p=babelHelpers.classPrivateFieldLooseKey("getEntityParams");var u=babelHelpers.classPrivateFieldLooseKey("updateStore");class P{static init(){return P.getInstance()}static getInstance(){if(!P.instance){P.instance=new P}return P.instance}constructor(){Object.defineProperty(this,u,{value:I});Object.defineProperty(this,p,{value:j});Object.defineProperty(this,h,{value:V});Object.defineProperty(this,v,{value:f});Object.defineProperty(this,b,{value:H});Object.defineProperty(this,d,{value:F});Object.defineProperty(this,n,{value:B});Object.defineProperty(this,c,{value:L});Object.defineProperty(this,o,{value:y});Object.defineProperty(this,i,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,i)[i]=a.VoteApplication.init();babelHelpers.classPrivateFieldLooseBase(this,i)[i].subscribe("loadVotes",(({data:e})=>{const{entityIds:s,voteIds:t}=e;babelHelpers.classPrivateFieldLooseBase(this,o)[o](s,t)}))}async sendVote(e,s,t){babelHelpers.classPrivateFieldLooseBase(this,d)[d]([s],true);try{var a;const r=await babelHelpers.classPrivateFieldLooseBase(this,h)[h](e,t);if(!(r!=null&&(a=r.data)!=null&&a.attach)){babelHelpers.classPrivateFieldLooseBase(this,d)[d]([s],false);return}babelHelpers.classPrivateFieldLooseBase(this,u)[u](r.data.attach)}catch(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d]([s],false);throw e}}async revokeVote(e,s){babelHelpers.classPrivateFieldLooseBase(this,d)[d]([s],true);try{var t;const s=await babelHelpers.classPrivateFieldLooseBase(this,v)[v](e);babelHelpers.classPrivateFieldLooseBase(this,u)[u](s==null?void 0:(t=s.data)==null?void 0:t.attach);return true}catch(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d]([s],false);console.error(e.errors[0].code);throw e}}completeVote(e){return new Promise(((s,t)=>{babelHelpers.classPrivateFieldLooseBase(this,b)[b](e).then((()=>{s(true)})).catch((e=>{console.error(e.errors[0].code);t(e)}))}))}}async function y(e,s){try{var t;const a=await babelHelpers.classPrivateFieldLooseBase(this,n)[n](e);if(!(a!=null&&(t=a.data)!=null&&t.items)){babelHelpers.classPrivateFieldLooseBase(this,d)[d](s,false);return}a.data.items.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)}))}catch(t){babelHelpers.classPrivateFieldLooseBase(this,i)[i].handleLoadError(e);babelHelpers.classPrivateFieldLooseBase(this,c)[c](t);babelHelpers.classPrivateFieldLooseBase(this,d)[d](s,false)}}function L(e){if(s.Type.isObject(e)&&s.Type.isArrayFilled(e.errors)){var a,r;const s=(a=e==null?void 0:(r=e.errors[0])==null?void 0:r.message)!=null?a:"Unexpected error";t.UI.Notification.Center.notify({content:s,autoHideDelay:4e3})}else{console.error(e)}}function B(e){return s.ajax.runAction("vote.AttachedVote.getMany",{data:{...babelHelpers.classPrivateFieldLooseBase(this,p)[p](),entityIds:e}})}function F(e,s){e.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,i)[i].getStore().dispatch("vote/setLoadingStatus",{isLoading:s,voteId:e})}))}function H(e){return s.ajax.runAction("vote.AttachedVote.stop",{data:{...babelHelpers.classPrivateFieldLooseBase(this,p)[p](),entityId:e}})}function f(e){return s.ajax.runAction("vote.AttachedVote.recall",{data:{...babelHelpers.classPrivateFieldLooseBase(this,p)[p](),entityId:e}})}function V(e,t){return s.ajax.runAction("vote.AttachedVote.vote",{data:{...babelHelpers.classPrivateFieldLooseBase(this,p)[p](),entityId:t,ballot:e}})}function j(){return{moduleId:r,entityType:l}}function I(e){if(!e){return}babelHelpers.classPrivateFieldLooseBase(this,i)[i].getStore().dispatch("vote/setCurrentUserVotes",e.userAnswerMap);babelHelpers.classPrivateFieldLooseBase(this,i)[i].getStore().dispatch("vote/addVote",e);babelHelpers.classPrivateFieldLooseBase(this,i)[i].getStore().dispatch("vote/addQuestion",e.QUESTIONS);babelHelpers.classPrivateFieldLooseBase(this,i)[i].getStore().dispatch("vote/addAnswer",e.QUESTIONS)}e.BackendModuleId=r;e.BackendEntityType=l;e.ImVoteService=P})(this.BX.Vote.Service=this.BX.Vote.Service||{},BX,BX,BX.Vote);
//# sourceMappingURL=vote-service.bundle.map.js