{"version":3,"file":"result.bundle.js","sources":["../src/result.js"],"sourcesContent":["import { Type, Dom, Tag, Loc, Text } from 'main.core';\nimport { WorkflowResultStatus } from 'bizproc.types';\nimport type { ResultData } from './types';\n\nimport 'ui.hint';\n\nimport './css/style.css';\n\nexport class WorkflowResult\n{\n\tstatic #LENGTH_LIMIT = 74; // 80 symbols without length of \"...etc.\"\n\t#status: string;\n\t#text: string;\n\t#node: ?HTMLElement = null;\n\n\tconstructor(data: ResultData)\n\t{\n\t\tthis.#status = data.status;\n\t\tthis.#text = Type.isStringFilled(data.text) ? data.text : '';\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!Type.isNil(this.#node))\n\t\t{\n\t\t\treturn this.#node;\n\t\t}\n\n\t\tlet result = '';\n\t\tswitch (this.#status)\n\t\t{\n\t\t\tcase WorkflowResultStatus.BB_CODE_RESULT:\n\t\t\t\tresult = this.#renderBBCodeResult();\n\t\t\t\tbreak;\n\t\t\tcase WorkflowResultStatus.NO_RIGHTS_RESULT:\n\t\t\t\tresult = this.#renderNoRightResult();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult = this.#text;\n\t\t}\n\n\t\tconst cleanedResult = this.#replaceNewLine(this.#clearTags(this.#replaceBrTag(result)));\n\n\t\tthis.#node = Tag.render`\n\t\t\t<div class=\"bp-workflow-result\">\n\t\t\t\t${this.#isNeedCollapse(cleanedResult) ? this.#renderCollapsedResult(cleanedResult) : null}\n\t\t\t\t<span class=\"bp-workflow-result-full\">\n\t\t\t\t\t${result}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (this.#isNoRightResult())\n\t\t{\n\t\t\tDom.addClass(this.#node, 'no-rights');\n\t\t}\n\n\t\tif (!this.#isNeedCollapse(cleanedResult))\n\t\t{\n\t\t\tthis.#handleExpandResult();\n\t\t}\n\n\t\tBX.UI.Hint.init(this.#node);\n\n\t\treturn this.#node;\n\t}\n\n\trenderTo(container: HTMLElement): void\n\t{\n\t\tif (Type.isDomNode(container))\n\t\t{\n\t\t\tDom.append(this.render(), container);\n\t\t}\n\t}\n\n\t#renderBBCodeResult(): string\n\t{\n\t\treturn `${Loc.getMessage('BP_JS_WF_RESULT_VALUE')}<br>${this.#text}`;\n\t}\n\n\t#renderNoRightResult(): string\n\t{\n\t\treturn `\n\t\t\t${Loc.getMessage('BP_JS_WF_RESULT_NO_RIGHTS_VIEW')} \n\t\t\t<span data-hint=\"${Loc.getMessage('BP_JS_WF_RESULT_NO_RIGHTS_TOOLTIP')}\"></span>\n\t\t`;\n\t}\n\n\t#renderCollapsedResult(result: string): HTMLElement\n\t{\n\t\tconst collapsedResult = result.slice(0, this.constructor.#LENGTH_LIMIT);\n\n\t\treturn Tag.render`\n\t\t\t<span class=\"bp-workflow-result-collapsed\">\n\t\t\t\t${Text.encode(collapsedResult)}\n\t\t\t\t...\n\t\t\t\t<a href=\"#\" onclick=\"${this.#handleExpandResult.bind(this)}\">\n\t\t\t\t\t${Loc.getMessage('BP_JS_WF_RESULT_MORE')}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t#replaceBrTag(text: string): string\n\t{\n\t\treturn text.replaceAll(/(<br\\s?\\/?>)+/gm, ' ');\n\t}\n\n\t#clearTags(text: string): string\n\t{\n\t\treturn Tag.render`<span>${text}</span>`.textContent;\n\t}\n\n\t#replaceNewLine(text: string): string\n\t{\n\t\treturn text.replaceAll(/\\n+/gm, ' ');\n\t}\n\n\t#handleExpandResult(event: PointerEvent): boolean\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tDom.addClass(this.#node, '--expanded');\n\t}\n\n\t#isNoRightResult(): boolean\n\t{\n\t\treturn this.#status === WorkflowResultStatus.NO_RIGHTS_RESULT;\n\t}\n\n\t#isNeedCollapse(result: string): boolean\n\t{\n\t\treturn result.length > this.constructor.#LENGTH_LIMIT;\n\t}\n}\n"],"names":["WorkflowResult","constructor","data","status","Type","isStringFilled","text","render","isNil","result","WorkflowResultStatus","BB_CODE_RESULT","NO_RIGHTS_RESULT","cleanedResult","Tag","Dom","addClass","BX","UI","Hint","init","renderTo","container","isDomNode","append","Loc","getMessage","collapsedResult","slice","Text","encode","bind","replaceAll","textContent","event","preventDefault","length"],"mappings":";;;;;;;;;;;AAAA,CAMyB;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEzB,CAAO,MAAMA,cAAc,CAC3B;;;GAMCC,WAAW,CAACC,IAAgB,EAC5B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAHsB;;KAIrB,4CAAI,sBAAWA,IAAI,CAACC,MAAM;KAC1B,4CAAI,kBAASC,cAAI,CAACC,cAAc,CAACH,IAAI,CAACI,IAAI,CAAC,GAAGJ,IAAI,CAACI,IAAI,GAAG,EAAE;;GAG7DC,MAAM,GACN;KACC,IAAI,CAACH,cAAI,CAACI,KAAK,yCAAC,IAAI,gBAAO,EAC3B;OACC,+CAAO,IAAI;;KAGZ,IAAIC,MAAM,GAAG,EAAE;KACf,gDAAQ,IAAI;OAEX,KAAKC,kCAAoB,CAACC,cAAc;SACvCF,MAAM,2CAAG,IAAI,6CAAsB;SACnC;OACD,KAAKC,kCAAoB,CAACE,gBAAgB;SACzCH,MAAM,2CAAG,IAAI,+CAAuB;SACpC;OACD;SACCA,MAAM,2CAAG,IAAI,eAAM;;KAGrB,MAAMI,aAAa,2CAAG,IAAI,4EAAiB,IAAI,kEAAY,IAAI,gCAAeJ,MAAM,GAAG;KAEvF,4CAAI,kBAASK,aAAG,CAACP,MAAM,cAAC;;MAEtB,CAA0F;;OAEzF,CAAS;;;GAGZ,GALI,4CAAI,oCAAiBM,aAAa,4CAAI,IAAI,kDAAwBA,aAAa,IAAI,IAAI,EAEtFJ,MAAM,CAGV;KAED,4CAAI,IAAI,yCACR;OACCM,aAAG,CAACC,QAAQ,yCAAC,IAAI,iBAAQ,WAAW,CAAC;;KAGtC,IAAI,yCAAC,IAAI,oCAAiBH,aAAa,CAAC,EACxC;OACC,4CAAI;;KAGLI,EAAE,CAACC,EAAE,CAACC,IAAI,CAACC,IAAI,yCAAC,IAAI,gBAAO;KAE3B,+CAAO,IAAI;;GAGZC,QAAQ,CAACC,SAAsB,EAC/B;KACC,IAAIlB,cAAI,CAACmB,SAAS,CAACD,SAAS,CAAC,EAC7B;OACCP,aAAG,CAACS,MAAM,CAAC,IAAI,CAACjB,MAAM,EAAE,EAAEe,SAAS,CAAC;;;CAkEvC;CAAC,gCA7DA;GACC,OAAQ,GAAEG,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAE,OAAI,wCAAE,IAAI,eAAO,EAAC;CACrE;CAAC,iCAGD;GACC,OAAQ;KACLD,aAAG,CAACC,UAAU,CAAC,gCAAgC,CAAE;sBAChCD,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAE;GACvE;CACF;CAAC,iCAEsBjB,MAAc,EACrC;GACC,MAAMkB,eAAe,GAAGlB,MAAM,CAACmB,KAAK,CAAC,CAAC,0CAAE,IAAI,CAAC3B,WAAW,gCAAe;GAEvE,OAAOa,aAAG,CAACP,MAAM,gBAAC;;MAEhB,CAA+B;;2BAEV,CAAsC;OAC1D,CAAyC;;;GAG5C,GANIsB,cAAI,CAACC,MAAM,CAACH,eAAe,CAAC,EAEP,4CAAI,4CAAqBI,IAAI,CAAC,IAAI,CAAC,EACvDN,aAAG,CAACC,UAAU,CAAC,sBAAsB,CAAC;CAI5C;CAAC,wBAEapB,IAAY,EAC1B;GACC,OAAOA,IAAI,CAAC0B,UAAU,CAAC,iBAAiB,EAAE,GAAG,CAAC;CAC/C;CAAC,qBAEU1B,IAAY,EACvB;GACC,OAAOQ,aAAG,CAACP,MAAM,gBAAC,SAAM,CAAO,SAAO,GAAZD,IAAI,EAAU2B,WAAW;CACpD;CAAC,0BAEe3B,IAAY,EAC5B;GACC,OAAOA,IAAI,CAAC0B,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC;CACrC;CAAC,8BAEmBE,KAAmB,EACvC;GACC,IAAIA,KAAK,EACT;KACCA,KAAK,CAACC,cAAc,EAAE;;GAGvBpB,aAAG,CAACC,QAAQ,yCAAC,IAAI,iBAAQ,YAAY,CAAC;CACvC;CAAC,6BAGD;GACC,OAAO,4CAAI,wBAAaN,kCAAoB,CAACE,gBAAgB;CAC9D;CAAC,0BAEeH,MAAc,EAC9B;GACC,OAAOA,MAAM,CAAC2B,MAAM,2CAAG,IAAI,CAACnC,WAAW,+BAAc;CACtD;CAAC,sBAhIWD,cAAc;GAAA;GAAA,OAEH;CAAE;;;;;;;;"}