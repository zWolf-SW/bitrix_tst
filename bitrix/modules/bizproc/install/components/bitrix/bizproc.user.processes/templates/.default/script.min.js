this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,t,r,a,l,o,i,n,d,c,p){"use strict";var b=babelHelpers.classPrivateFieldLooseKey("runComponentAction");class u{constructor(){Object.defineProperty(this,b,{value:v})}loadWorkflows(e){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]("loadWorkflows",{ids:e})}}function v(e,s={}){return new Promise(((t,r)=>{c.ajax.runComponentAction("bitrix:bizproc.user.processes",e,{mode:"class",data:s}).catch((e=>{r(e)})).then((e=>{t(e)}))}))}let h=e=>e,P,f,m,B,w;var g=babelHelpers.classPrivateFieldLooseKey("currentUserId");var L=babelHelpers.classPrivateFieldLooseKey("targetUserId");var F=babelHelpers.classPrivateFieldLooseKey("data");var T=babelHelpers.classPrivateFieldLooseKey("task");var k=babelHelpers.classPrivateFieldLooseKey("inlineTaskView");var E=babelHelpers.classPrivateFieldLooseKey("faces");var S=babelHelpers.classPrivateFieldLooseKey("getWorkflowInfoUrl");class I{constructor(e){Object.defineProperty(this,S,{value:H});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.workflow;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=c.Type.isNumber(e.currentUserId)?e.currentUserId:0;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=babelHelpers.classPrivateFieldLooseBase(this,F)[F].userId;if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].task){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=new l.Task(babelHelpers.classPrivateFieldLooseBase(this,F)[F].task);if(c.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,T)[T].controls.buttons)){babelHelpers.classPrivateFieldLooseBase(this,T)[T].setButtons(babelHelpers.classPrivateFieldLooseBase(this,T)[T].buttons.map((s=>({onclick:()=>e.userProcesses.doTask({taskId:babelHelpers.classPrivateFieldLooseBase(this,T)[T].id,workflowId:babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowId,taskName:babelHelpers.classPrivateFieldLooseBase(this,T)[T].name,taskRequest:{[s.NAME]:s.VALUE}}),...s}))))}babelHelpers.classPrivateFieldLooseBase(this,k)[k]=new l.InlineTaskView({task:babelHelpers.classPrivateFieldLooseBase(this,T)[T],responsibleUser:babelHelpers.classPrivateFieldLooseBase(this,L)[L]})}}renderProcess(){var e,s,t,r;const a=c.Type.isString((e=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:e.name)?babelHelpers.classPrivateFieldLooseBase(this,F)[F].name:"";const l=c.Type.isString((s=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:s.typeName)?babelHelpers.classPrivateFieldLooseBase(this,F)[F].typeName:"";const o=((t=babelHelpers.classPrivateFieldLooseBase(this,F)[F].task)==null?void 0:t.url)||babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowUrl||babelHelpers.classPrivateFieldLooseBase(this,S)[S]();const i=c.Type.isString((r=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:r.description)?babelHelpers.classPrivateFieldLooseBase(this,F)[F].description:"";const n=80;const d=c.Dom.create("span",{html:i==null?void 0:i.replace(/(<br \/>)+/gm," ")}).textContent.replace(/\n+/," ").slice(0,n);const p=(i==null?void 0:i.length)>n;const b=c.Tag.render(P||(P=h`
			<span class="bp-user-processes__description">
				${0}
			</span>
		`),i);BX.UI.Hint.init(b);return c.Tag.render(f||(f=h`
				<div class="bp-user-processes">
					<a class="bp-user-processes__title-link ui-typography-text-lg"
						href="${0}">${0}
					</a>
					<div class="bp-user-processes__appointment">${0}</div>
					<div class="bp-user-processes__description-box ${0}">
						<span class="bp-user-processes__short_description">
							${0}
							...<a href="#" onclick="this.closest('div').classList.add('--expanded'); return false;" class="bp-user-processes__description-link">${0}</a>
						</span>
						${0}
					</div>
			</div>
		`),c.Text.encode(o),c.Text.encode(a),c.Text.encode(l.toUpperCase()),p?"":"--expanded",c.Text.encode(d),c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_DESCRIPTION_MORE"),b)}renderTaskName(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,k)[k])==null?void 0:e.render()}renderTask(){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F].task||babelHelpers.classPrivateFieldLooseBase(this,F)[F].userId!==babelHelpers.classPrivateFieldLooseBase(this,g)[g]){const e=babelHelpers.classPrivateFieldLooseBase(this,F)[F].isCompleted?"--success":"";let s="";if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].isCompleted&&babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowResult!==null){s=new d.WorkflowResult(babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowResult).render()}return c.Tag.render(m||(m=h`
				<div class="bp-status-panel ${0}">
					<div class="bp-status-item">
						<div class="bp-status-name">${0}</div>
						${0}
					</div>
				</div>
			`),e,c.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,F)[F].statusText.toUpperCase()),s)}return this.renderTaskName()}renderDocumentName(){var e,s,t,r;const a=c.Type.isString((e=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:(s=e.document)==null?void 0:s.name)?babelHelpers.classPrivateFieldLooseBase(this,F)[F].document.name:"";if(c.Type.isString((t=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:(r=t.document)==null?void 0:r.url)){const e=new c.Uri(babelHelpers.classPrivateFieldLooseBase(this,F)[F].document.url);return c.Tag.render(B||(B=h`
				<a href="${0}">
					${0}
				</a>
			`),c.Text.encode(e.toString()),c.Text.encode(a))}return c.Text.encode(a)}renderWorkflowFaces(){const e=c.Tag.render(w||(w=h`<div></div>`));if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowId&&babelHelpers.classPrivateFieldLooseBase(this,F)[F].taskProgress){try{babelHelpers.classPrivateFieldLooseBase(this,E)[E]=new i.WorkflowFaces({workflowId:babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowId,targetUserId:babelHelpers.classPrivateFieldLooseBase(this,L)[L],target:e,data:{steps:babelHelpers.classPrivateFieldLooseBase(this,F)[F].taskProgress.steps,progressBox:babelHelpers.classPrivateFieldLooseBase(this,F)[F].taskProgress.progressBox},showArrow:true});babelHelpers.classPrivateFieldLooseBase(this,E)[E].render()}catch(e){console.error(e)}}return e}renderSummary(){var e;if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowId||!((e=babelHelpers.classPrivateFieldLooseBase(this,F)[F].taskProgress)!=null&&e.timeStep)){return null}return new n.Summary({workflowId:babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowId,data:babelHelpers.classPrivateFieldLooseBase(this,F)[F].taskProgress.timeStep}).render()}destroy(){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=null;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null;if(!c.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,E)[E])){babelHelpers.classPrivateFieldLooseBase(this,E)[E].destroy();babelHelpers.classPrivateFieldLooseBase(this,E)[E]=null}}}function H(){var e;const s=c.Type.isNil((e=babelHelpers.classPrivateFieldLooseBase(this,F)[F].task)==null?void 0:e.id)?babelHelpers.classPrivateFieldLooseBase(this,F)[F].workflowId:babelHelpers.classPrivateFieldLooseBase(this,F)[F].task.id;const t=new c.Uri(`/company/personal/bizproc/${s}/`);return t.toString()}var y=babelHelpers.classPrivateFieldLooseKey("subscribeToPulls");var _=babelHelpers.classPrivateFieldLooseKey("getTaskColor");var C=babelHelpers.classPrivateFieldLooseKey("getCommentColor");var O=babelHelpers.classPrivateFieldLooseKey("setFilterPreset");var R=babelHelpers.classPrivateFieldLooseKey("getFilterManager");class U{constructor(e){Object.defineProperty(this,R,{value:K});Object.defineProperty(this,O,{value:N});Object.defineProperty(this,C,{value:M});Object.defineProperty(this,_,{value:D});Object.defineProperty(this,y,{value:A});this.filterId=e.filterId;this.counters=e.counters}renderTo(e){var s,t,r,a;this.uiPanel=new BX.UI.CounterPanel({target:e,multiselect:false,title:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_LABEL"),items:[{id:"task",value:{value:((s=this.counters)==null?void 0:s.task)||0,order:1},title:{value:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_TASK"),order:2},color:babelHelpers.classPrivateFieldLooseBase(this,_)[_]((t=this.counters)==null?void 0:t.task),separator:false,eventsForActive:{click:babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this)},eventsForUnActive:{click:babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this,"active_task")}},{id:"comment",value:((r=this.counters)==null?void 0:r.comment)||0,title:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_COMMENT"),color:babelHelpers.classPrivateFieldLooseBase(this,C)[C]((a=this.counters)==null?void 0:a.comment),eventsForActive:{click:babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this)},eventsForUnActive:{click:babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this,"comment")}}]});this.uiPanel.init();babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}}function A(){BX.PULL.subscribe({moduleId:"main",command:"user_counter",callback:e=>{var s,t;const r=(s=(t=e[BX.message("SITE_ID")])==null?void 0:t.bp_tasks)!=null?s:null;if(r!==null){this.uiPanel.getItemById("task").updateValue(r);this.uiPanel.getItemById("task").updateColor(babelHelpers.classPrivateFieldLooseBase(this,_)[_](r))}}});BX.PULL.subscribe({moduleId:"bizproc",command:"comment",callback:e=>{var s,t;const r=(s=(t=e.counter)==null?void 0:t.allUnread)!=null?s:null;if(r!==null){this.uiPanel.getItemById("comment").updateValue(r);this.uiPanel.getItemById("comment").updateColor(babelHelpers.classPrivateFieldLooseBase(this,C)[C](r))}}})}function D(e){return e>0?"DANGER":"THEME"}function M(e){return e>0?"SUCCESS":"THEME"}function N(e){const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R]();if(!s){return}const t=s.getApi();const r={SYSTEM_PRESET:e!=null?e:"in_work"};t.setFields(r);t.apply()}function K(){if(this.filterId){var e;return(e=BX.Main.filterManager)==null?void 0:e.getById(this.filterId)}console.warn("Filter not found");return null}let x=e=>e,W;var j=babelHelpers.classPrivateFieldLooseKey("workflowTasks");var X=babelHelpers.classPrivateFieldLooseKey("workflowRenderer");var G=babelHelpers.classPrivateFieldLooseKey("targetUserId");var z=babelHelpers.classPrivateFieldLooseKey("shownMobilePopup");var $=babelHelpers.classPrivateFieldLooseKey("appLink");var Z=babelHelpers.classPrivateFieldLooseKey("subscribeToPushes");var V=babelHelpers.classPrivateFieldLooseKey("subscribeToTaskDo");var Y=babelHelpers.classPrivateFieldLooseKey("updateWorkflows");var q=babelHelpers.classPrivateFieldLooseKey("appendWorkflow");var J=babelHelpers.classPrivateFieldLooseKey("getCountersOption");var Q=babelHelpers.classPrivateFieldLooseKey("createWorkflowRenderer");var ee=babelHelpers.classPrivateFieldLooseKey("getWorkflowRendererById");var se=babelHelpers.classPrivateFieldLooseKey("deleteWorkflowRendererById");var te=babelHelpers.classPrivateFieldLooseKey("hideRow");var re=babelHelpers.classPrivateFieldLooseKey("showRow");class ae{constructor(e){Object.defineProperty(this,re,{value:ve});Object.defineProperty(this,te,{value:ue});Object.defineProperty(this,se,{value:be});Object.defineProperty(this,ee,{value:pe});Object.defineProperty(this,Q,{value:ce});Object.defineProperty(this,J,{value:de});Object.defineProperty(this,q,{value:ne});Object.defineProperty(this,Y,{value:ie});Object.defineProperty(this,V,{value:oe});Object.defineProperty(this,Z,{value:le});this.delegateToUserId=0;Object.defineProperty(this,j,{writable:true,value:new Map});Object.defineProperty(this,X,{writable:true,value:{}});Object.defineProperty(this,G,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:void 0});let s=false;if(c.Type.isPlainObject(e)){this.gridId=e.gridId;if(c.Type.isArray(e.errors)){this.showErrors(e.errors)}this.actionPanel={wrapperElementId:e.actionPanelUserWrapperId,actionButtonName:`${this.gridId}_action_button`};this.currentUserId=e.currentUserId;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e.targetUserId;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.shownMobilePopup;babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e.appLink;s=e.mustSubscribeToPushes===true}this.loader=new u;if(s){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()}babelHelpers.classPrivateFieldLooseBase(this,V)[V]();this.init();this.initCounterPanel(e.counters,e.filterId)}getDefaultAddRowOptions(e,s){const t=[{text:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_DOCUMENT"),href:e.document.url||"#"}];if(e.task){t.push({text:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_TASK"),href:e.task.url})}return{id:e.workflowId,animation:false,columns:{ID:e.workflowId,PROCESS:s.renderProcess(),TASK_PROGRESS:s.renderWorkflowFaces(),TASK:s.renderTask(),WORKFLOW_STATE:c.Text.encode(e.statusText),DOCUMENT_NAME:s.renderDocumentName(),WORKFLOW_TEMPLATE_NAME:c.Text.encode(e.templateName),TASK_DESCRIPTION:c.Dom.create("span",{html:e.description||""}),MODIFIED:c.Text.encode(e.modified),WORKFLOW_STARTED:c.Text.encode(e.workflowStarted),WORKFLOW_STARTED_BY:c.Text.encode(e.startedBy),OVERDUE_DATE:c.Text.encode(e.overdueDate),SUMMARY:s.renderSummary()},actions:t,columnClasses:{TASK_PROGRESS:"bp-task-progress-cell",SUMMARY:"bp-summary-cell",TASK:e.isCompleted?"bp-status-completed-cell":"",TASK_DESCRIPTION:"bp-description-cell"},counters:babelHelpers.classPrivateFieldLooseBase(this,J)[J](e),editable:Boolean(e.task)}}init(){this.actionPanel.userWrapperElement=document.getElementById(this.actionPanel.wrapperElementId);this.initUserSelector();this.renderCells();this.onActionPanelChanged()}initCounterPanel(e,s){const t=document.querySelector('[data-role="bizproc-counterpanel"]');if(!t){return}new U({counters:e,filterId:s}).renderTo(t)}renderCells(){const e=new Map;document.querySelectorAll('[data-role="bp-render-cell"]').forEach((s=>{const t=c.Dom.attr(s,"data-workflow");const r=c.Dom.attr(s,"data-column");if(t){if(!e.has(t.workflowId)){babelHelpers.classPrivateFieldLooseBase(this,se)[se](t.workflowId);e.set(t.workflowId)}if(t.task){babelHelpers.classPrivateFieldLooseBase(this,j)[j].set(t.workflowId,t.task.id)}this.renderColumnCell(s,r,t)}}))}renderColumnCell(e,s,t){var r;const a=(r=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](String(t.workflowId)))!=null?r:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](String(t.workflowId),t);let l=null;switch(s){case"DOCUMENT_NAME":l=a.renderDocumentName();break;case"PROCESS":l=a.renderProcess();break;case"TASK_PROGRESS":l=a.renderWorkflowFaces();break;case"TASK":l=a.renderTask();break;case"SUMMARY":l=a.renderSummary();break;case"MODIFIED":l=a.renderModified();break;default:}if(l){c.Dom.replace(e,l)}}clickStartWorkflowButton(){c.Runtime.loadExtension("bizproc.router").then((({Router:e})=>{e.openUserProcessesStart()})).catch((e=>console.error(e)));c.Runtime.loadExtension("ui.analytics").then((({sendData:e})=>{e({tool:"automation",category:"bizproc_operations",event:"drawer_open",c_section:"bizproc",c_element:"button"})})).catch((()=>{}))}creationGuideOpen(e){c.Runtime.loadExtension("lists.element.creation-guide").then((({CreationGuide:s})=>{s==null?void 0:s.open(e)})).catch((()=>{}))}initUserSelector(){if(!this.delegateToSelector){this.delegateToSelector=new t.TagSelector({multiple:false,tagMaxWidth:180,events:{onTagAdd:e=>{this.delegateToUserId=parseInt(e.getData().tag.getId(),10);if(!c.Type.isInteger(this.delegateToUserId)){this.delegateToUserId=0}},onTagRemove:()=>{this.delegateToUserId=0}},dialogOptions:{entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:false}}]}})}if(c.Type.isDomNode(this.actionPanel.userWrapperElement)){c.Dom.clean(this.actionPanel.userWrapperElement);this.delegateToSelector.renderTo(this.actionPanel.userWrapperElement)}}showErrors(e){if(!c.Type.isArrayFilled(e)){if(!c.Type.isArray(e)){console.error(e)}return}const t=document.getElementById("bp-user-processes-errors-container");if(t){let r=0;const a=()=>{if(r>0){c.Dom.style(t,{margin:"10px"})}else{c.Dom.style(t,{margin:"0px"})}};for(const l of e){r+=1;const e=new s.Alert({text:c.Text.encode(l.message),color:s.AlertColor.DANGER,closeBtn:true,animated:true});e.renderTo(t);if(e.getCloseBtn()){e.getCloseBtn().onclick=()=>{r-=1;a()}}}a()}}onActionPanelChanged(){const e=this.getGrid();const s=e==null?void 0:e.getActionsPanel();if(s){const e=s.getValues()[this.actionPanel.actionButtonName];if(!c.Type.isString(e)||e.includes("set_status")){c.Dom.hide(this.actionPanel.userWrapperElement)}else{c.Dom.show(this.actionPanel.userWrapperElement)}}}applyActionPanelValues(){const e=this.getGrid();const s=e==null?void 0:e.getActionsPanel();if(e&&s){var t;const r=((t=s.getForAllCheckbox())==null?void 0:t.checked)===true;if(r){this.showErrors([{message:"Not implemented currently"}])}const a=s.getValues()[this.actionPanel.actionButtonName];if(c.Type.isString(a)){const s=this.getSelectedTaskIds(e.getRows().getSelectedIds());if(s.length===0){return}if(a.includes("set_status_")){const e=parseInt(a.split("_").pop(),10);if(c.Type.isNumber(e)){this.setTasksStatuses(s,e)}}else if(a.startsWith("delegate_to")){this.delegateTasks(s,this.delegateToUserId)}}}}getSelectedTaskIds(e){return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,j)[j].get(e))).filter((e=>c.Type.isNumber(e)))}setTasksStatuses(e,s){c.ajax.runAction("bizproc.task.doInlineTasks",{data:{taskIds:e,newStatus:s}}).catch((e=>{this.showErrors(e.errors);this.reloadGrid()}))}delegateTasks(e,s){c.ajax.runComponentAction("bitrix:bizproc.user.processes","delegateTasks",{mode:"class",data:{taskIds:e,toUserId:s}}).catch((e=>{this.showErrors(e.errors);this.reloadGrid()}))}reloadGrid(){var e;(e=this.getGrid())==null?void 0:e.reload()}doTask(e){babelHelpers.classPrivateFieldLooseBase(this,te)[te](e.workflowId);c.ajax.runAction("bizproc.task.do",{data:e}).then((()=>{if(e.taskName){p.UI.Notification.Center.notify({content:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_TASK_TOUCHED",{"#TASK_NAME#":c.Text.encode(e.taskName)})})}})).catch((s=>{this.showErrors(s.errors);babelHelpers.classPrivateFieldLooseBase(this,re)[re](e.workflowId)}))}removeWorkflow(e){if(!babelHelpers.classPrivateFieldLooseBase(this,z)[z]&&babelHelpers.classPrivateFieldLooseBase(this,j)[j].has(e)){const e=new BX.UI.MobilePromoter({title:c.Loc.getMessage("BIZPROC_USER_PROCESSES_POPUP_PUSH_TITLE"),content:this.getPopupContent(),position:{right:30,bottom:30},qrContent:babelHelpers.classPrivateFieldLooseBase(this,$)[$],analytics:{c_section:"bizproc"}});e.show();BX.userOptions.save("bizproc.user.processes","mobile_promotion_popup","shown_popup","Y",false);babelHelpers.classPrivateFieldLooseBase(this,z)[z]=true}babelHelpers.classPrivateFieldLooseBase(this,te)[te](e,true);babelHelpers.classPrivateFieldLooseBase(this,se)[se](e);babelHelpers.classPrivateFieldLooseBase(this,j)[j].delete(e)}getPopupContent(){return c.Tag.render(W||(W=x`
			<div class="ui-mobile-promoter__content-wrapper">
				<ul class="ui-mobile-promoter__popup-list">
					<li class="ui-mobile-promoter__popup-list-item">
						${0}
					</li>
					<li class="ui-mobile-promoter__popup-list-item">
						${0}
					</li>
					<li class="ui-mobile-promoter__popup-list-item">
						${0}
					</li>
				</ul>
				<div class="ui-mobile-promoter__popup-desc">${0}</div>
				<div class="ui-mobile-promoter__popup-info">${0}</div>
			</div>
		`),c.Loc.getMessage("BIZPROC_USER_PROCESSES_POPUP_PUSH_DO_PROCESS"),c.Loc.getMessage("BIZPROC_USER_PROCESSES_POPUP_PUSH_REACT"),c.Loc.getMessage("BIZPROC_USER_PROCESSES_POPUP_PUSH_CONTROL"),c.Loc.getMessage("UI_MOBILE_PROMOTER_DESC"),c.Loc.getMessage("UI_MOBILE_PROMOTER_INFO"))}getGrid(){if(this.gridId){var e;return(e=BX.Main.gridManager)==null?void 0:e.getInstanceById(this.gridId)}console.warn("Grid not found");return null}}function le(){BX.PULL.subscribe({moduleId:"bizproc",command:"workflow",callback:e=>{if(e.eventName==="DELETED"||e.eventName==="UPDATED"){e.items.forEach((e=>this.removeWorkflow(e.id)))}if(e.eventName==="ADDED"||e.eventName==="UPDATED"){const s=this.getGrid().getRows();let t=e.items.map((e=>e.id));if(e.eventName==="ADDED"){t=t.filter((e=>!s.getById(e)))}if(t.length>0){this.loader.loadWorkflows(t).then(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this)).catch((e=>this.showErrors(e)))}}}})}function oe(){BX.addCustomEvent("SidePanel.Slider:onMessage",(e=>{if(e.getEventId()==="try-do-bp-task-event"){babelHelpers.classPrivateFieldLooseBase(this,te)[te](e.data.workflowId)}else if(e.getEventId()==="error-do-bp-task-event"){babelHelpers.classPrivateFieldLooseBase(this,re)[re](e.data.workflowId)}else if(e.getEventId()==="success-do-bp-task-event"){p.UI.Notification.Center.notify({content:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_TASK_TOUCHED",{"#TASK_NAME#":c.Text.encode(e.data.taskName)})})}}))}function ie(e){var s;const{workflows:t}=e.data;if(!c.Type.isArray(t)){console.warn("Unexpected response from server. Expected workflow.data to be an array");return}const r=(s=this.getGrid())==null?void 0:s.getRealtime();if(r){let e=null;t.forEach((s=>{const t=Boolean(s.taskCnt>0||s.commentCnt>0||s.startedById===this.currentUserId&&s.isCompleted===false);if(t){babelHelpers.classPrivateFieldLooseBase(this,q)[q]({workflow:s,renderer:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](s.workflowId,s),insertAfter:e});e=s.workflowId}}))}}function ne({workflow:e,renderer:s,insertAfter:t}){var r,a;if(e.task){babelHelpers.classPrivateFieldLooseBase(this,j)[j].set(e.workflowId,e.task.id)}const l=(r=this.getGrid())==null?void 0:r.getRealtime();if(!l){return}const o=this.getDefaultAddRowOptions(e,s);if(c.Type.isStringFilled(t)){o.insertAfter=t}else{o.prepend=true}l.addRow(o);const i=(a=this.getGrid())==null?void 0:a.getRows().getById(e.workflowId);if(i){if(o.columnClasses){for(const[e,s]of Object.entries(o.columnClasses)){if(s){c.Dom.addClass(i.getCellById(e),s)}}}c.Dom.addClass(i.getNode(),"main-ui-grid-show-new-row");c.Event.bind(i.getNode(),"animationend",(e=>{if(e.animationName==="showNewRow"){c.Dom.removeClass(i.getNode(),"main-ui-grid-show-new-row")}}))}}function de(e){const s={};if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]===this.currentUserId&&(e.taskCnt>0||e.commentCnt>0)){const t=e.taskCnt===0&&e.commentCnt>0?BX.Grid.Counters.Color.SUCCESS:BX.Grid.Counters.Color.DANGER;s.MODIFIED={type:BX.Grid.Counters.Type.LEFT,color:t,secondaryColor:BX.Grid.Counters.Color.SUCCESS,value:(e.taskCnt||0)+(e.commentCnt||0),isDouble:e.taskCnt>0&&e.commentCnt>0}}return s}function ce(e,s){babelHelpers.classPrivateFieldLooseBase(this,X)[X][e]=new I({userProcesses:this,currentUserId:this.currentUserId,workflow:s});return babelHelpers.classPrivateFieldLooseBase(this,X)[X][e]}function pe(e){return c.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,X)[X][e])?null:babelHelpers.classPrivateFieldLooseBase(this,X)[X][e]}function be(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e);if(s){s.destroy();delete babelHelpers.classPrivateFieldLooseBase(this,X)[X][e]}}function ue(e,s=false){const t=this.getGrid();const r=t==null?void 0:t.getRows().getById(e);if(r){r.hide();if(s){c.Dom.remove(r.getNode())}if(t.getRows().getCountDisplayed()===0){t.getRealtime().showStub()}}}function ve(e){var s;const t=(s=this.getGrid())==null?void 0:s.getRows().getById(e);if(t){t.show();c.Dom.addClass(t.getNode(),"main-ui-grid-show-new-row");c.Event.bind(t.getNode(),"animationend",(e=>{if(e.animationName==="showNewRow"){c.Dom.removeClass(t.getNode(),"main-ui-grid-show-new-row")}}))}}e.UserProcesses=ae})(this.BX.Bizproc.Component=this.BX.Bizproc.Component||{},BX.UI,BX.UI.EntitySelector,BX.Main,BX.Bizproc,BX.Bizproc,BX,BX.Bizproc.Workflow,BX.Bizproc.Workflow.Faces,BX.Bizproc.Workflow.Result,BX,BX);
//# sourceMappingURL=script.map.js