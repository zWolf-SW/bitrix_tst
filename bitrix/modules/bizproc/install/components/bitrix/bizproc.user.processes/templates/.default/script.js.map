{"version":3,"file":"script.js","sources":["src/workflow-loader.js","src/workflow-renderer.js","src/counter-panel.js","src/user-processes.js"],"sourcesContent":["import { TaskControls } from 'bizproc.task';\nimport { WorkflowId } from 'bizproc.types';\nimport { ajax } from 'main.core';\n\nexport type LoadWorkflowsResponseData = {\n\tdata: {\n\t\tworkflows: Array<WorkflowData>,\n\t},\n};\n\nexport type WorkflowData = {\n\tworkflowId: string,\n\tuserId: number,\n\tstartedById: number,\n\tstartedBy?: string,\n\ttaskProgress: {\n\t\tsteps: [],\n\t\ttimeStep: {},\n\t\tisWorkflowFinished: boolean,\n\t\tprogressBox?: {},\n\t},\n\tname: string,\n\tdescription: string,\n\ttypeName: string,\n\tstatusText: string,\n\tmodified: string,\n\ttemplateName?: string,\n\tworkflowStarted: string,\n\tdocument: {\n\t\turl?: string,\n\t\tname: string,\n\t},\n\ttask: Partial<{\n\t\tid: number,\n\t\tname: string,\n\t\tdescription: string,\n\t\turl: string,\n\t\tusers: Array<{ id: number, status: number }>,\n\t\tstatus: number | string,\n\t\tcontrols: TaskControls,\n\t\tapproveType: string,\n\t\tcomments: number,\n\t\tmodified: string,\n\t\tmodifiedDate: number,\n\t\toverdueDate: string,\n\t}>,\n\ttaskCnt: number,\n\tcommentCnt: number,\n\tisCompleted: boolean,\n\tworkflowUrl: ?string,\n\tworkflowResult: ?string,\n};\n\nexport class WorkflowLoader\n{\n\tloadWorkflows(ids: WorkflowId[]): Promise<LoadWorkflowsResponseData, Array<{ message: string }>>\n\t{\n\t\treturn this.#runComponentAction('loadWorkflows', { ids });\n\t}\n\n\t#runComponentAction(action: string, data: Object = {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction('bitrix:bizproc.user.processes', action, {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata,\n\t\t\t}).catch((response) => {\n\t\t\t\treject(response);\n\t\t\t}).then((response) => {\n\t\t\t\tresolve(response);\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Text, Tag, Type, Dom, Uri, Loc } from 'main.core';\nimport { Task, InlineTaskView } from 'bizproc.task';\nimport type { UserProcesses } from './user-processes';\nimport 'ui.hint';\nimport { WorkflowData } from './workflow-loader';\nimport { WorkflowFaces } from 'bizproc.workflow.faces';\nimport { Summary } from 'bizproc.workflow.faces.summary';\nimport { WorkflowResult } from 'bizproc.workflow.result';\n\nexport class WorkflowRenderer\n{\n\t#currentUserId: number;\n\t#targetUserId: ?number;\n\t#data: WorkflowData;\n\t#task: Task;\n\t#inlineTaskView: InlineTaskView;\n\t#faces: ?WorkflowFaces = null;\n\n\tconstructor(data: {\n\t\tuserProcesses: UserProcesses,\n\t\tcurrentUserId: number,\n\t\tworkflow: WorkflowData,\n\t})\n\t{\n\t\tthis.#data = data.workflow;\n\t\tthis.#currentUserId = Type.isNumber(data.currentUserId) ? data.currentUserId : 0;\n\t\tthis.#targetUserId = this.#data.userId;\n\n\t\tif (this.#data.task)\n\t\t{\n\t\t\tthis.#task = new Task(this.#data.task);\n\t\t\tif (Type.isArrayFilled(this.#task.controls.buttons))\n\t\t\t{\n\t\t\t\tthis.#task.setButtons(\n\t\t\t\t\tthis.#task.buttons.map((button) => ({\n\t\t\t\t\t\tonclick: () => data.userProcesses.doTask({\n\t\t\t\t\t\t\ttaskId: this.#task.id,\n\t\t\t\t\t\t\tworkflowId: this.#data.workflowId,\n\t\t\t\t\t\t\ttaskName: this.#task.name,\n\t\t\t\t\t\t\ttaskRequest: {\n\t\t\t\t\t\t\t\t[button.NAME]: button.VALUE,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t...button,\n\t\t\t\t\t})),\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.#inlineTaskView = new InlineTaskView({\n\t\t\t\ttask: this.#task,\n\t\t\t\tresponsibleUser: this.#targetUserId,\n\t\t\t});\n\t\t}\n\t}\n\n\trenderProcess(): HTMLElement | string\n\t{\n\t\tconst itemName = Type.isString(this.#data?.name) ? this.#data.name : '';\n\t\tconst typeName = Type.isString(this.#data?.typeName) ? this.#data.typeName : '';\n\t\tconst documentUrl = this.#data.task?.url || this.#data.workflowUrl || this.#getWorkflowInfoUrl();\n\n\t\tconst description = Type.isString(this.#data?.description) ? this.#data.description : '';\n\t\tconst lengthLimit = 80;\n\t\tconst collapsedDescription = Dom.create('span', { html: description?.replace(/(<br \\/>)+/gm, ' ') }).textContent.replace(/\\n+/, ' ').slice(0, lengthLimit);\n\t\tconst collapsed = description?.length > lengthLimit;\n\n\t\tconst descriptionNode = Tag.render`\n\t\t\t<span class=\"bp-user-processes__description\">\n\t\t\t\t${description}\n\t\t\t</span>\n\t\t`;\n\n\t\tBX.UI.Hint.init(descriptionNode);\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-user-processes\">\n\t\t\t\t\t<a class=\"bp-user-processes__title-link ui-typography-text-lg\"\n\t\t\t\t\t\thref=\"${Text.encode(documentUrl)}\">${Text.encode(itemName)}\n\t\t\t\t\t</a>\n\t\t\t\t\t<div class=\"bp-user-processes__appointment\">${Text.encode(typeName.toUpperCase())}</div>\n\t\t\t\t\t<div class=\"bp-user-processes__description-box ${collapsed ? '' : '--expanded'}\">\n\t\t\t\t\t\t<span class=\"bp-user-processes__short_description\">\n\t\t\t\t\t\t\t${Text.encode(collapsedDescription)}\n\t\t\t\t\t\t\t...<a href=\"#\" onclick=\"this.closest('div').classList.add('--expanded'); return false;\" class=\"bp-user-processes__description-link\">${Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_DESCRIPTION_MORE')}</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t${descriptionNode}\n\t\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getWorkflowInfoUrl(): string\n\t{\n\t\tconst idParam = Type.isNil(this.#data.task?.id) ? this.#data.workflowId : this.#data.task.id;\n\t\tconst uri = new Uri(`/company/personal/bizproc/${idParam}/`);\n\n\t\treturn uri.toString();\n\t}\n\n\trenderTaskName(): ?HTMLElement\n\t{\n\t\treturn this.#inlineTaskView?.render();\n\t}\n\n\trenderTask(): ?HTMLElement\n\t{\n\t\tif (!this.#data.task || this.#data.userId !== this.#currentUserId)\n\t\t{\n\t\t\tconst completedClassName = this.#data.isCompleted ? '--success' : '';\n\t\t\tlet resultNode = '';\n\n\t\t\tif (this.#data.isCompleted && (this.#data.workflowResult !== null))\n\t\t\t{\n\t\t\t\tresultNode = (new WorkflowResult(this.#data.workflowResult)).render();\n\t\t\t}\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-status-panel ${completedClassName}\">\n\t\t\t\t\t<div class=\"bp-status-item\">\n\t\t\t\t\t\t<div class=\"bp-status-name\">${Text.encode(this.#data.statusText.toUpperCase())}</div>\n\t\t\t\t\t\t${resultNode}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.renderTaskName();\n\t}\n\n\trenderDocumentName(): HTMLElement\n\t{\n\t\tconst documentName = Type.isString(this.#data?.document?.name) ? this.#data.document.name : '';\n\n\t\tif (Type.isString(this.#data?.document?.url))\n\t\t{\n\t\t\tconst url = new Uri(this.#data.document.url);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<a href=\"${Text.encode(url.toString())}\">\n\t\t\t\t\t${Text.encode(documentName)}\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn Text.encode(documentName);\n\t}\n\n\trenderWorkflowFaces(): HTMLElement\n\t{\n\t\tconst target = Tag.render`<div></div>`;\n\n\t\tif (this.#data.workflowId && this.#data.taskProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.#faces = (new WorkflowFaces({\n\t\t\t\t\tworkflowId: this.#data.workflowId,\n\t\t\t\t\ttargetUserId: this.#targetUserId,\n\t\t\t\t\ttarget,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsteps: this.#data.taskProgress.steps,\n\t\t\t\t\t\tprogressBox: this.#data.taskProgress.progressBox,\n\t\t\t\t\t},\n\t\t\t\t\tshowArrow: true,\n\t\t\t\t}));\n\t\t\t\tthis.#faces.render();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\trenderSummary(): ?HTMLElement\n\t{\n\t\tif (!this.#data.workflowId || !this.#data.taskProgress?.timeStep)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (\n\t\t\t(new Summary({\n\t\t\t\tworkflowId: this.#data.workflowId,\n\t\t\t\tdata: this.#data.taskProgress.timeStep,\n\t\t\t})\n\t\t\t).render()\n\t\t);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#data = null;\n\t\tthis.#task = null;\n\t\tthis.#inlineTaskView = null;\n\n\t\tif (!Type.isNil(this.#faces))\n\t\t{\n\t\t\tthis.#faces.destroy();\n\t\t\tthis.#faces = null;\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\n\ntype Counters = {\n\ttask: number,\n\tcomment: number,\n}\n\nexport class CounterPanel\n{\n\tfilterId: string;\n\tcounters: Counters;\n\tuiPanel;\n\n\tconstructor(options: {\n\t\tfilterId: string,\n\t\tcounters: Counters,\n\t})\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.counters = options.counters;\n\t}\n\n\trenderTo(target: HTMLElement)\n\t{\n\t\tthis.uiPanel = new BX.UI.CounterPanel({\n\t\t\ttarget,\n\t\t\tmultiselect: false,\n\t\t\ttitle: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_LABEL'),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tid: 'task',\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tvalue: this.counters?.task || 0,\n\t\t\t\t\t\torder: 1,\n\t\t\t\t\t},\n\t\t\t\t\ttitle: {\n\t\t\t\t\t\tvalue: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_TASK'),\n\t\t\t\t\t\torder: 2,\n\t\t\t\t\t},\n\t\t\t\t\tcolor: this.#getTaskColor(this.counters?.task),\n\t\t\t\t\tseparator: false,\n\t\t\t\t\teventsForActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\teventsForUnActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this, 'active_task'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'comment',\n\t\t\t\t\tvalue: this.counters?.comment || 0,\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_COMMENT'),\n\t\t\t\t\tcolor: this.#getCommentColor(this.counters?.comment),\n\t\t\t\t\teventsForActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\teventsForUnActive: {\n\t\t\t\t\t\tclick: this.#setFilterPreset.bind(this, 'comment'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.uiPanel.init();\n\t\tthis.#subscribeToPulls();\n\t}\n\n\t#subscribeToPulls()\n\t{\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'main',\n\t\t\tcommand: 'user_counter',\n\t\t\tcallback: (params) => {\n\t\t\t\tconst taskCounterValue = (params[BX.message('SITE_ID')])?.bp_tasks ?? null;\n\t\t\t\tif (taskCounterValue !== null)\n\t\t\t\t{\n\t\t\t\t\tthis.uiPanel.getItemById('task').updateValue(taskCounterValue);\n\t\t\t\t\tthis.uiPanel.getItemById('task').updateColor(this.#getTaskColor(taskCounterValue));\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'bizproc',\n\t\t\tcommand: 'comment',\n\t\t\tcallback: (params) => {\n\t\t\t\tconst allUnreadValue: number | null = params.counter?.allUnread ?? null;\n\n\t\t\t\tif (allUnreadValue !== null)\n\t\t\t\t{\n\t\t\t\t\tthis.uiPanel.getItemById('comment').updateValue(allUnreadValue);\n\t\t\t\t\tthis.uiPanel.getItemById('comment').updateColor(this.#getCommentColor(allUnreadValue));\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\t#getTaskColor(value): string\n\t{\n\t\treturn value > 0 ? 'DANGER' : 'THEME';\n\t}\n\n\t#getCommentColor(value): string\n\t{\n\t\treturn value > 0 ? 'SUCCESS' : 'THEME';\n\t}\n\n\t#setFilterPreset(presetId: string): void\n\t{\n\t\tconst filterManager = this.#getFilterManager();\n\t\tif (!filterManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst api = filterManager.getApi();\n\t\tconst fields = {\n\t\t\tSYSTEM_PRESET: presetId ?? 'in_work',\n\t\t};\n\n\t\tapi.setFields(fields);\n\t\tapi.apply();\n\t}\n\n\t#getFilterManager(): ?BX.Main.Filter\n\t{\n\t\tif (this.filterId)\n\t\t{\n\t\t\treturn BX.Main.filterManager?.getById(this.filterId);\n\t\t}\n\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.warn('Filter not found');\n\n\t\treturn null;\n\t}\n}\n","import { ajax, Type, Dom, Tag, Text, Loc, Event, Runtime } from 'main.core';\nimport { Alert, AlertColor } from 'ui.alerts';\nimport { TagSelector } from 'ui.entity-selector';\nimport { Menu } from 'main.popup';\nimport type { WorkflowData } from './workflow-loader';\nimport { WorkflowLoader, LoadWorkflowsResponseData } from './workflow-loader';\nimport { WorkflowRenderer } from './workflow-renderer';\nimport { CounterPanel } from './counter-panel.js';\nimport { UI } from 'ui.notification';\n\nimport './style.css';\n\nimport 'ui.design-tokens';\n\ntype WorkflowId = string;\ntype TaskId = number;\n\nexport class UserProcesses\n{\n\tgridId: string;\n\tdelegateToSelector: TagSelector;\n\tdelegateToUserId: number = 0;\n\tactionPanel: {\n\t\twrapperElementId: string,\n\t\tactionButtonName: string,\n\t\tuserWrapperElement: ?HTMLElement,\n\t};\n\n\t#workflowTasks: Map<WorkflowId, TaskId> = new Map();\n\t#workflowRenderer: Object<WorkflowId, WorkflowRenderer> = {};\n\tcurrentUserId: number;\n\t#targetUserId: number;\n\t#shownMobilePopup: boolean;\n\t#appLink: string;\n\n\tloader: WorkflowLoader;\n\n\tconstructor(options: {\n\t\tgridId: string,\n\t\tactionPanelUserWrapperId: string,\n\t\terrors: Array<{ message: string }>,\n\t\tcurrentUserId: number,\n\t\ttargetUserId: number;\n\t\tmustSubscribeToPushes: boolean,\n\t\tshownMobilePopup: boolean,\n\t\tappLink: string,\n\t})\n\t{\n\t\tlet mustSubscribeToPushes = false;\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.gridId = options.gridId;\n\n\t\t\tif (Type.isArray(options.errors))\n\t\t\t{\n\t\t\t\tthis.showErrors(options.errors);\n\t\t\t}\n\t\t\tthis.actionPanel = {\n\t\t\t\twrapperElementId: options.actionPanelUserWrapperId,\n\t\t\t\tactionButtonName: `${this.gridId}_action_button`,\n\t\t\t};\n\n\t\t\tthis.currentUserId = options.currentUserId;\n\t\t\tthis.#targetUserId = options.targetUserId;\n\t\t\tthis.#shownMobilePopup = options.shownMobilePopup;\n\t\t\tthis.#appLink = options.appLink;\n\n\t\t\tmustSubscribeToPushes = options.mustSubscribeToPushes === true;\n\t\t}\n\n\t\tthis.loader = new WorkflowLoader();\n\n\t\tif (mustSubscribeToPushes)\n\t\t{\n\t\t\tthis.#subscribeToPushes();\n\t\t}\n\t\tthis.#subscribeToTaskDo();\n\n\t\tthis.init();\n\t\tthis.initCounterPanel(options.counters, options.filterId);\n\t}\n\n\t#subscribeToPushes()\n\t{\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'bizproc',\n\t\t\tcommand: 'workflow',\n\t\t\tcallback: (params) => {\n\t\t\t\tif (params.eventName === 'DELETED' || params.eventName === 'UPDATED')\n\t\t\t\t{\n\t\t\t\t\tparams.items.forEach((workflow) => this.removeWorkflow(workflow.id));\n\t\t\t\t}\n\n\t\t\t\tif (params.eventName === 'ADDED' || params.eventName === 'UPDATED')\n\t\t\t\t{\n\t\t\t\t\tconst rowsCollectionWrapper: BX.Grid.Rows = this.getGrid().getRows();\n\t\t\t\t\tlet ids = params.items.map((workflow) => workflow.id);\n\t\t\t\t\tif (params.eventName === 'ADDED')\n\t\t\t\t\t{\n\t\t\t\t\t\tids = ids.filter((id) => !rowsCollectionWrapper.getById(id));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ids.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.loader\n\t\t\t\t\t\t\t.loadWorkflows(ids)\n\t\t\t\t\t\t\t.then(this.#updateWorkflows.bind(this))\n\t\t\t\t\t\t\t.catch((response) => this.showErrors(response))\n\t\t\t\t\t\t;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\t#subscribeToTaskDo()\n\t{\n\t\tBX.addCustomEvent(\n\t\t\t'SidePanel.Slider:onMessage',\n\t\t\t(event) => {\n\t\t\t\tif (event.getEventId() === 'try-do-bp-task-event')\n\t\t\t\t{\n\t\t\t\t\tthis.#hideRow(event.data.workflowId);\n\t\t\t\t}\n\t\t\t\telse if (event.getEventId() === 'error-do-bp-task-event')\n\t\t\t\t{\n\t\t\t\t\tthis.#showRow(event.data.workflowId);\n\t\t\t\t}\n\t\t\t\telse if (event.getEventId() === 'success-do-bp-task-event')\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage(\n\t\t\t\t\t\t\t'BIZPROC_USER_PROCESSES_TEMPLATE_TASK_TOUCHED',\n\t\t\t\t\t\t\t{ '#TASK_NAME#': Text.encode(event.data.taskName) },\n\t\t\t\t\t\t),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\t#updateWorkflows(response: LoadWorkflowsResponseData): void\n\t{\n\t\tconst { workflows } = response.data;\n\t\tif (!Type.isArray(workflows))\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn('Unexpected response from server. Expected workflow.data to be an array');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRealtime = this.getGrid()?.getRealtime();\n\n\t\tif (gridRealtime)\n\t\t{\n\t\t\tlet lastWorkflowId = null;\n\t\t\tworkflows.forEach((workflow) => {\n\t\t\t\tconst isActual = Boolean(\n\t\t\t\t\tworkflow.taskCnt > 0\n\t\t\t\t\t|| workflow.commentCnt > 0\n\t\t\t\t\t|| (\n\t\t\t\t\t\tworkflow.startedById === this.currentUserId\n\t\t\t\t\t\t&& workflow.isCompleted === false\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\tif (isActual)\n\t\t\t\t{\n\t\t\t\t\tthis.#appendWorkflow({\n\t\t\t\t\t\tworkflow,\n\t\t\t\t\t\trenderer: this.#createWorkflowRenderer(workflow.workflowId, workflow),\n\t\t\t\t\t\tinsertAfter: lastWorkflowId,\n\t\t\t\t\t});\n\t\t\t\t\tlastWorkflowId = workflow.workflowId;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#appendWorkflow({ workflow, renderer, insertAfter }): void\n\t{\n\t\tif (workflow.task)\n\t\t{\n\t\t\tthis.#workflowTasks.set(workflow.workflowId, workflow.task.id);\n\t\t}\n\n\t\tconst gridRealtime = this.getGrid()?.getRealtime();\n\t\tif (!gridRealtime)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst addRowOptions = this.getDefaultAddRowOptions(workflow, renderer);\n\n\t\tif (Type.isStringFilled(insertAfter))\n\t\t{\n\t\t\taddRowOptions.insertAfter = insertAfter;\n\t\t}\n\t\telse\n\t\t{\n\t\t\taddRowOptions.prepend = true;\n\t\t}\n\n\t\tgridRealtime.addRow(addRowOptions);\n\n\t\t// temporary crutches for the GRID :-)\n\t\tconst row: BX.Grid.Row = this.getGrid()?.getRows().getById(workflow.workflowId);\n\t\tif (row)\n\t\t{\n\t\t\tif (addRowOptions.columnClasses)\n\t\t\t{\n\t\t\t\tfor (const [columnId, columnClass] of Object.entries(addRowOptions.columnClasses))\n\t\t\t\t{\n\t\t\t\t\tif (columnClass)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(row.getCellById(columnId), columnClass);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tDom.addClass(row.getNode(), 'main-ui-grid-show-new-row');\n\t\t\tEvent.bind(row.getNode(), 'animationend', (event: AnimationEvent) => {\n\t\t\t\tif (event.animationName === 'showNewRow')\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(row.getNode(), 'main-ui-grid-show-new-row');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetDefaultAddRowOptions(workflow: WorkflowData, renderer: WorkflowRenderer): Object\n\t{\n\t\tconst actions = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_DOCUMENT'),\n\t\t\t\thref: workflow.document.url || '#',\n\t\t\t},\n\t\t];\n\n\t\tif (workflow.task)\n\t\t{\n\t\t\tactions.push({\n\t\t\t\ttext: Loc.getMessage('BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_TASK'),\n\t\t\t\thref: workflow.task.url,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tid: workflow.workflowId,\n\t\t\tanimation: false,\n\t\t\tcolumns: {\n\t\t\t\tID: workflow.workflowId,\n\t\t\t\tPROCESS: renderer.renderProcess(),\n\t\t\t\tTASK_PROGRESS: renderer.renderWorkflowFaces(),\n\t\t\t\tTASK: renderer.renderTask(),\n\t\t\t\tWORKFLOW_STATE: Text.encode(workflow.statusText),\n\t\t\t\tDOCUMENT_NAME: renderer.renderDocumentName(),\n\t\t\t\tWORKFLOW_TEMPLATE_NAME: Text.encode(workflow.templateName),\n\t\t\t\tTASK_DESCRIPTION: Dom.create('span', { html: workflow.description || '' }),\n\t\t\t\tMODIFIED: Text.encode(workflow.modified),\n\t\t\t\tWORKFLOW_STARTED: Text.encode(workflow.workflowStarted),\n\t\t\t\tWORKFLOW_STARTED_BY: Text.encode(workflow.startedBy),\n\t\t\t\tOVERDUE_DATE: Text.encode(workflow.overdueDate),\n\t\t\t\tSUMMARY: renderer.renderSummary(),\n\t\t\t},\n\t\t\tactions,\n\t\t\tcolumnClasses: {\n\t\t\t\tTASK_PROGRESS: 'bp-task-progress-cell',\n\t\t\t\tSUMMARY: 'bp-summary-cell',\n\t\t\t\tTASK: workflow.isCompleted ? 'bp-status-completed-cell' : '',\n\t\t\t\tTASK_DESCRIPTION: 'bp-description-cell',\n\t\t\t},\n\t\t\tcounters: this.#getCountersOption(workflow),\n\t\t\teditable: Boolean(workflow.task),\n\t\t};\n\t}\n\n\t#getCountersOption(workflow: WorkflowData): Object\n\t{\n\t\tconst counters = {};\n\t\tif (this.#targetUserId === this.currentUserId && (workflow.taskCnt > 0 || workflow.commentCnt > 0))\n\t\t{\n\t\t\tconst primaryColor = workflow.taskCnt === 0 && workflow.commentCnt > 0\n\t\t\t\t? BX.Grid.Counters.Color.SUCCESS\n\t\t\t\t: BX.Grid.Counters.Color.DANGER\n\t\t\t;\n\n\t\t\tcounters.MODIFIED = {\n\t\t\t\ttype: BX.Grid.Counters.Type.LEFT,\n\t\t\t\tcolor: primaryColor,\n\t\t\t\tsecondaryColor: BX.Grid.Counters.Color.SUCCESS,\n\t\t\t\tvalue: (workflow.taskCnt || 0) + (workflow.commentCnt || 0),\n\t\t\t\tisDouble: workflow.taskCnt > 0 && workflow.commentCnt > 0,\n\t\t\t};\n\t\t}\n\n\t\treturn counters;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.actionPanel.userWrapperElement = document.getElementById(this.actionPanel.wrapperElementId);\n\t\tthis.initUserSelector();\n\t\tthis.renderCells();\n\n\t\tthis.onActionPanelChanged();\n\t}\n\n\tinitCounterPanel(counters, filterId): void\n\t{\n\t\tconst panelWrapperNode = document.querySelector('[data-role=\"bizproc-counterpanel\"]');\n\t\tif (!panelWrapperNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t(new CounterPanel({ counters, filterId })).renderTo(panelWrapperNode);\n\t}\n\n\trenderCells()\n\t{\n\t\tconst updated = new Map();\n\n\t\tdocument.querySelectorAll('[data-role=\"bp-render-cell\"]').forEach(\n\t\t\t(target) => {\n\t\t\t\tconst workflow = Dom.attr(target, 'data-workflow');\n\t\t\t\tconst columnId = Dom.attr(target, 'data-column');\n\n\t\t\t\tif (workflow)\n\t\t\t\t{\n\t\t\t\t\tif (!updated.has(workflow.workflowId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#deleteWorkflowRendererById(workflow.workflowId);\n\t\t\t\t\t\tupdated.set(workflow.workflowId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (workflow.task)\n\t\t\t\t\t{\n\t\t\t\t\t\t// set workflow task map\n\t\t\t\t\t\tthis.#workflowTasks.set(workflow.workflowId, workflow.task.id);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.renderColumnCell(target, columnId, workflow);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\trenderColumnCell(target, columnId, workflow)\n\t{\n\t\tconst renderer = (\n\t\t\tthis.#getWorkflowRendererById(String(workflow.workflowId))\n\t\t\t?? this.#createWorkflowRenderer(String(workflow.workflowId), workflow)\n\t\t);\n\n\t\tlet childNode = null;\n\t\tswitch (columnId)\n\t\t{\n\t\t\tcase 'DOCUMENT_NAME':\n\t\t\t\tchildNode = renderer.renderDocumentName();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PROCESS':\n\t\t\t\tchildNode = renderer.renderProcess();\n\t\t\t\tbreak;\n\n\t\t\tcase 'TASK_PROGRESS':\n\t\t\t\tchildNode = renderer.renderWorkflowFaces();\n\t\t\t\tbreak;\n\n\t\t\tcase 'TASK':\n\t\t\t\tchildNode = renderer.renderTask();\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUMMARY':\n\t\t\t\tchildNode = renderer.renderSummary();\n\t\t\t\tbreak;\n\n\t\t\tcase 'MODIFIED':\n\t\t\t\tchildNode = renderer.renderModified();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// do nothing\n\t\t}\n\n\t\tif (childNode)\n\t\t{\n\t\t\tDom.replace(\n\t\t\t\ttarget,\n\t\t\t\tchildNode,\n\t\t\t);\n\t\t}\n\t}\n\n\tclickStartWorkflowButton(): void\n\t{\n\t\tRuntime\n\t\t\t.loadExtension('bizproc.router')\n\t\t\t.then(({ Router }) => {\n\t\t\t\tRouter.openUserProcessesStart();\n\t\t\t})\n\t\t\t.catch((e) => console.error(e));\n\n\t\tRuntime\n\t\t\t.loadExtension('ui.analytics')\n\t\t\t.then(({ sendData }) => {\n\t\t\t\tsendData({\n\t\t\t\t\ttool: 'automation',\n\t\t\t\t\tcategory: 'bizproc_operations',\n\t\t\t\t\tevent: 'drawer_open',\n\t\t\t\t\tc_section: 'bizproc',\n\t\t\t\t\tc_element: 'button',\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\tcreationGuideOpen(params: Object): void\n\t{\n\t\tRuntime.loadExtension('lists.element.creation-guide')\n\t\t\t.then(({ CreationGuide }) => {\n\t\t\t\tCreationGuide?.open(params);\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\tinitUserSelector(): void\n\t{\n\t\tif (!this.delegateToSelector)\n\t\t{\n\t\t\tthis.delegateToSelector = new TagSelector({\n\t\t\t\tmultiple: false,\n\t\t\t\ttagMaxWidth: 180,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event) => {\n\t\t\t\t\t\tthis.delegateToUserId = parseInt(event.getData().tag.getId(), 10);\n\n\t\t\t\t\t\tif (!Type.isInteger(this.delegateToUserId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.delegateToUserId = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.delegateToUserId = 0;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isDomNode(this.actionPanel.userWrapperElement))\n\t\t{\n\t\t\tDom.clean(this.actionPanel.userWrapperElement);\n\t\t\tthis.delegateToSelector.renderTo(this.actionPanel.userWrapperElement);\n\t\t}\n\t}\n\n\tshowErrors(errors: Array<{ message: string }>): void\n\t{\n\t\tif (!Type.isArrayFilled(errors))\n\t\t{\n\t\t\tif (!Type.isArray(errors))\n\t\t\t{\n\t\t\t\tconsole.error(errors);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst errorsContainer = document.getElementById('bp-user-processes-errors-container');\n\n\t\tif (errorsContainer)\n\t\t{\n\t\t\tlet errorCounter = 0;\n\t\t\tconst fixStyles = () => {\n\t\t\t\tif (errorCounter > 0)\n\t\t\t\t{\n\t\t\t\t\tDom.style(errorsContainer, { margin: '10px' });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.style(errorsContainer, { margin: '0px' });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfor (const error of errors)\n\t\t\t{\n\t\t\t\terrorCounter += 1;\n\n\t\t\t\tconst alert = new Alert({\n\t\t\t\t\ttext: Text.encode(error.message),\n\t\t\t\t\tcolor: AlertColor.DANGER,\n\t\t\t\t\tcloseBtn: true,\n\t\t\t\t\tanimated: true,\n\t\t\t\t});\n\n\t\t\t\talert.renderTo(errorsContainer);\n\n\t\t\t\tif (alert.getCloseBtn())\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-loop-func\n\t\t\t\t\talert.getCloseBtn().onclick = () => {\n\t\t\t\t\t\terrorCounter -= 1;\n\t\t\t\t\t\tfixStyles();\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfixStyles();\n\t\t}\n\t}\n\n\tonActionPanelChanged(): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst actionPanel = grid?.getActionsPanel();\n\n\t\tif (actionPanel)\n\t\t{\n\t\t\tconst action = actionPanel.getValues()[this.actionPanel.actionButtonName];\n\t\t\tif (!Type.isString(action) || action.includes('set_status'))\n\t\t\t{\n\t\t\t\tDom.hide(this.actionPanel.userWrapperElement);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.show(this.actionPanel.userWrapperElement);\n\t\t\t}\n\t\t}\n\t}\n\n\tapplyActionPanelValues(): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst actionsPanel = grid?.getActionsPanel();\n\n\t\tif (grid && actionsPanel)\n\t\t{\n\t\t\tconst isApplyingForAll = actionsPanel.getForAllCheckbox()?.checked === true;\n\t\t\t// TODO - implement doing all tasks\n\t\t\tif (isApplyingForAll)\n\t\t\t{\n\t\t\t\tthis.showErrors([{ message: 'Not implemented currently' }]);\n\t\t\t}\n\n\t\t\tconst action: string = actionsPanel.getValues()[this.actionPanel.actionButtonName];\n\n\t\t\tif (Type.isString(action))\n\t\t\t{\n\t\t\t\tconst selectedTasks = this.getSelectedTaskIds(grid.getRows().getSelectedIds());\n\n\t\t\t\tif (selectedTasks.length === 0)\n\t\t\t\t{\n\t\t\t\t\t// todo: show error?\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (action.includes('set_status_'))\n\t\t\t\t{\n\t\t\t\t\tconst status = parseInt(action.split('_').pop(), 10);\n\n\t\t\t\t\tif (Type.isNumber(status))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setTasksStatuses(selectedTasks, status);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (action.startsWith('delegate_to'))\n\t\t\t\t{\n\t\t\t\t\tthis.delegateTasks(selectedTasks, this.delegateToUserId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedTaskIds(selectedWorkflowIds: Array<WorkflowId>): Array<TaskId>\n\t{\n\t\treturn (\n\t\t\tselectedWorkflowIds\n\t\t\t\t.map((workflowId) => this.#workflowTasks.get(workflowId))\n\t\t\t\t.filter((taskId) => Type.isNumber(taskId))\n\t\t);\n\t}\n\n\tsetTasksStatuses(taskIds: Array<TaskId>, newStatus: number): void\n\t{\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tajax\n\t\t\t.runAction('bizproc.task.doInlineTasks', {\n\t\t\t\tdata: {\n\t\t\t\t\ttaskIds,\n\t\t\t\t\tnewStatus,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\tthis.reloadGrid();\n\t\t\t})\n\t\t\t// .then(() => this.reloadGrid())\n\t\t;\n\t}\n\n\tdelegateTasks(taskIds: Array<TaskId>, toUserId: number): void\n\t{\n\t\t// eslint-disable-next-line promise/catch-or-return\n\t\tajax\n\t\t\t.runComponentAction('bitrix:bizproc.user.processes', 'delegateTasks', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\ttaskIds,\n\t\t\t\t\ttoUserId,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.showErrors(response.errors);\n\t\t\t\tthis.reloadGrid();\n\t\t\t})\n\t\t\t// .then(() => this.reloadGrid())\n\t\t;\n\t}\n\n\treloadGrid(): void\n\t{\n\t\tthis.getGrid()?.reload();\n\t}\n\n\tdoTask(props: {\n\t\ttaskId: TaskId,\n\t\tworkflowId: WorkflowId,\n\t\ttaskName: string,\n\t\ttaskRequest: Object,\n\t}): void\n\t{\n\t\tthis.#hideRow(props.workflowId);\n\n\t\tajax.runAction('bizproc.task.do', {\n\t\t\tdata: props,\n\t\t}).then(() => {\n\t\t\tif (props.taskName)\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage(\n\t\t\t\t\t\t'BIZPROC_USER_PROCESSES_TEMPLATE_TASK_TOUCHED',\n\t\t\t\t\t\t{ '#TASK_NAME#': Text.encode(props.taskName) },\n\t\t\t\t\t),\n\t\t\t\t});\n\t\t\t}\n\t\t}).catch((response) => {\n\t\t\tthis.showErrors(response.errors);\n\t\t\tthis.#showRow(props.workflowId);\n\t\t});\n\t}\n\n\tremoveWorkflow(workflowId: string): void\n\t{\n\t\tif (!this.#shownMobilePopup && this.#workflowTasks.has(workflowId))\n\t\t{\n\t\t\tconst mobile = new BX.UI.MobilePromoter({\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_USER_PROCESSES_POPUP_PUSH_TITLE'),\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t\tposition: {\n\t\t\t\t\tright: 30,\n\t\t\t\t\tbottom: 30,\n\t\t\t\t},\n\t\t\t\tqrContent: this.#appLink,\n\t\t\t\tanalytics: { c_section: 'bizproc' },\n\t\t\t});\n\t\t\tmobile.show();\n\t\t\tBX.userOptions.save('bizproc.user.processes', 'mobile_promotion_popup', 'shown_popup', 'Y', false);\n\t\t\tthis.#shownMobilePopup = true;\n\t\t}\n\n\t\tthis.#hideRow(workflowId, true);\n\t\tthis.#deleteWorkflowRendererById(workflowId);\n\t\tthis.#workflowTasks.delete(workflowId);\n\t}\n\n\tgetPopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-mobile-promoter__content-wrapper\">\n\t\t\t\t<ul class=\"ui-mobile-promoter__popup-list\">\n\t\t\t\t\t<li class=\"ui-mobile-promoter__popup-list-item\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_USER_PROCESSES_POPUP_PUSH_DO_PROCESS')}\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class=\"ui-mobile-promoter__popup-list-item\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_USER_PROCESSES_POPUP_PUSH_REACT')}\n\t\t\t\t\t</li>\n\t\t\t\t\t<li class=\"ui-mobile-promoter__popup-list-item\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_USER_PROCESSES_POPUP_PUSH_CONTROL')}\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class=\"ui-mobile-promoter__popup-desc\">${Loc.getMessage('UI_MOBILE_PROMOTER_DESC')}</div>\n\t\t\t\t<div class=\"ui-mobile-promoter__popup-info\">${Loc.getMessage('UI_MOBILE_PROMOTER_INFO')}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetGrid(): ?BX.Main.grid\n\t{\n\t\tif (this.gridId)\n\t\t{\n\t\t\treturn BX.Main.gridManager?.getInstanceById(this.gridId);\n\t\t}\n\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.warn('Grid not found');\n\n\t\treturn null;\n\t}\n\n\t#createWorkflowRenderer(workflowId: WorkflowId, workflow): WorkflowRenderer\n\t{\n\t\tthis.#workflowRenderer[workflowId] = new WorkflowRenderer({\n\t\t\tuserProcesses: this,\n\t\t\tcurrentUserId: this.currentUserId,\n\t\t\tworkflow,\n\t\t});\n\n\t\treturn this.#workflowRenderer[workflowId];\n\t}\n\n\t#getWorkflowRendererById(workflowId: WorkflowId): ?WorkflowRenderer\n\t{\n\t\treturn Type.isNil(this.#workflowRenderer[workflowId]) ? null : this.#workflowRenderer[workflowId];\n\t}\n\n\t#deleteWorkflowRendererById(workflowId: WorkflowId)\n\t{\n\t\tconst renderer = this.#getWorkflowRendererById(workflowId);\n\t\tif (renderer)\n\t\t{\n\t\t\trenderer.destroy();\n\t\t\tdelete this.#workflowRenderer[workflowId];\n\t\t}\n\t}\n\n\t#hideRow(id: string, remove: boolean = false): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid?.getRows().getById(id);\n\n\t\tif (row)\n\t\t{\n\t\t\trow.hide();\n\t\t\tif (remove)\n\t\t\t{\n\t\t\t\tDom.remove(row.getNode());\n\t\t\t}\n\n\t\t\tif (grid.getRows().getCountDisplayed() === 0)\n\t\t\t{\n\t\t\t\tgrid.getRealtime().showStub();\n\t\t\t}\n\t\t}\n\t}\n\n\t#showRow(id: string): void\n\t{\n\t\tconst row = this.getGrid()?.getRows().getById(id);\n\t\tif (row)\n\t\t{\n\t\t\trow.show();\n\t\t\tDom.addClass(row.getNode(), 'main-ui-grid-show-new-row');\n\n\t\t\tEvent.bind(row.getNode(), 'animationend', (event: AnimationEvent) => {\n\t\t\t\tif (event.animationName === 'showNewRow')\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(row.getNode(), 'main-ui-grid-show-new-row');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n"],"names":["WorkflowLoader","loadWorkflows","ids","action","data","Promise","resolve","reject","ajax","runComponentAction","mode","catch","response","then","WorkflowRenderer","constructor","workflow","Type","isNumber","currentUserId","userId","task","Task","isArrayFilled","controls","buttons","setButtons","map","button","onclick","userProcesses","doTask","taskId","id","workflowId","taskName","name","taskRequest","NAME","VALUE","InlineTaskView","responsibleUser","renderProcess","itemName","isString","typeName","documentUrl","url","workflowUrl","description","lengthLimit","collapsedDescription","Dom","create","html","replace","textContent","slice","collapsed","length","descriptionNode","Tag","render","BX","UI","Hint","init","Text","encode","toUpperCase","Loc","getMessage","renderTaskName","renderTask","completedClassName","isCompleted","resultNode","workflowResult","WorkflowResult","statusText","renderDocumentName","documentName","document","Uri","toString","renderWorkflowFaces","target","taskProgress","WorkflowFaces","targetUserId","steps","progressBox","showArrow","e","console","error","renderSummary","timeStep","Summary","destroy","isNil","idParam","uri","CounterPanel","options","filterId","counters","renderTo","uiPanel","multiselect","title","items","value","order","color","separator","eventsForActive","click","bind","eventsForUnActive","comment","PULL","subscribe","moduleId","command","callback","params","taskCounterValue","message","bp_tasks","getItemById","updateValue","updateColor","allUnreadValue","counter","allUnread","presetId","filterManager","api","getApi","fields","SYSTEM_PRESET","setFields","apply","Main","getById","warn","UserProcesses","delegateToUserId","Map","mustSubscribeToPushes","isPlainObject","gridId","isArray","errors","showErrors","actionPanel","wrapperElementId","actionPanelUserWrapperId","actionButtonName","shownMobilePopup","appLink","loader","initCounterPanel","getDefaultAddRowOptions","renderer","actions","text","href","push","animation","columns","ID","PROCESS","TASK_PROGRESS","TASK","WORKFLOW_STATE","DOCUMENT_NAME","WORKFLOW_TEMPLATE_NAME","templateName","TASK_DESCRIPTION","MODIFIED","modified","WORKFLOW_STARTED","workflowStarted","WORKFLOW_STARTED_BY","startedBy","OVERDUE_DATE","overdueDate","SUMMARY","columnClasses","editable","Boolean","userWrapperElement","getElementById","initUserSelector","renderCells","onActionPanelChanged","panelWrapperNode","querySelector","updated","querySelectorAll","forEach","attr","columnId","has","set","renderColumnCell","String","childNode","renderModified","clickStartWorkflowButton","Runtime","loadExtension","Router","openUserProcessesStart","sendData","tool","category","event","c_section","c_element","creationGuideOpen","CreationGuide","open","delegateToSelector","TagSelector","multiple","tagMaxWidth","events","onTagAdd","parseInt","getData","tag","getId","isInteger","onTagRemove","dialogOptions","entities","intranetUsersOnly","inviteEmployeeLink","isDomNode","clean","errorsContainer","errorCounter","fixStyles","style","margin","alert","Alert","AlertColor","DANGER","closeBtn","animated","getCloseBtn","grid","getGrid","getActionsPanel","getValues","includes","hide","show","applyActionPanelValues","actionsPanel","isApplyingForAll","getForAllCheckbox","checked","selectedTasks","getSelectedTaskIds","getRows","getSelectedIds","status","split","pop","setTasksStatuses","startsWith","delegateTasks","selectedWorkflowIds","get","filter","taskIds","newStatus","runAction","reloadGrid","toUserId","reload","props","Notification","Center","notify","content","removeWorkflow","mobile","MobilePromoter","getPopupContent","position","right","bottom","qrContent","analytics","userOptions","save","delete","gridManager","getInstanceById","eventName","rowsCollectionWrapper","addCustomEvent","getEventId","workflows","gridRealtime","getRealtime","lastWorkflowId","isActual","taskCnt","commentCnt","startedById","insertAfter","addRowOptions","isStringFilled","prepend","addRow","row","columnClass","Object","entries","addClass","getCellById","getNode","Event","animationName","removeClass","primaryColor","Grid","Counters","Color","SUCCESS","type","LEFT","secondaryColor","isDouble","remove","getCountDisplayed","showStub"],"mappings":";;;;;;CAEiC;AAmDjC,CAAO,MAAMA,cAAc,CAC3B;GAAA;KAAA;OAAA;;;GACCC,aAAa,CAACC,GAAiB,EAC/B;KACC,+CAAO,IAAI,4CAAqB,eAAe,EAAE;OAAEA;MAAK;;CAgB1D;CAAC,8BAboBC,MAAc,EAAEC,IAAY,GAAG,EAAE,EACrD;GACC,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;KACvCC,cAAI,CAACC,kBAAkB,CAAC,+BAA+B,EAAEN,MAAM,EAAE;OAChEO,IAAI,EAAE,OAAO;OACbN;MACA,CAAC,CAACO,KAAK,CAAEC,QAAQ,IAAK;OACtBL,MAAM,CAACK,QAAQ,CAAC;MAChB,CAAC,CAACC,IAAI,CAAED,QAAQ,IAAK;OACrBN,OAAO,CAACM,QAAQ,CAAC;MACjB,CAAC;IACF,CAAC;CACH;;;;;;;;ACxED,CAOyD;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEzD,CAAO,MAAME,gBAAgB,CAC7B;GAQCC,WAAW,CAACX,IAIX,EACD;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAPyB;;KAQxB,4CAAI,kBAASA,IAAI,CAACY,QAAQ;KAC1B,4CAAI,oCAAkBC,cAAI,CAACC,QAAQ,CAACd,IAAI,CAACe,aAAa,CAAC,GAAGf,IAAI,CAACe,aAAa,GAAG,CAAC;KAChF,4CAAI,kCAAiB,4CAAI,gBAAOC,MAAM;KAEtC,IAAI,4CAAI,gBAAOC,IAAI,EACnB;OACC,4CAAI,kBAAS,IAAIC,iBAAI,CAAC,4CAAI,gBAAOD,IAAI,CAAC;OACtC,IAAIJ,cAAI,CAACM,aAAa,CAAC,4CAAI,gBAAOC,QAAQ,CAACC,OAAO,CAAC,EACnD;SACC,4CAAI,gBAAOC,UAAU,CACpB,4CAAI,gBAAOD,OAAO,CAACE,GAAG,CAAEC,MAAM,KAAM;WACnCC,OAAO,EAAE,MAAMzB,IAAI,CAAC0B,aAAa,CAACC,MAAM,CAAC;aACxCC,MAAM,EAAE,4CAAI,gBAAOC,EAAE;aACrBC,UAAU,EAAE,4CAAI,gBAAOA,UAAU;aACjCC,QAAQ,EAAE,4CAAI,gBAAOC,IAAI;aACzBC,WAAW,EAAE;eACZ,CAACT,MAAM,CAACU,IAAI,GAAGV,MAAM,CAACW;;YAEvB,CAAC;WACF,GAAGX;UACH,CAAC,CAAC,CACH;;OAEF,4CAAI,sCAAmB,IAAIY,2BAAc,CAAC;SACzCnB,IAAI,0CAAE,IAAI,eAAM;SAChBoB,eAAe,0CAAE,IAAI;QACrB,CAAC;;;GAIJC,aAAa,GACb;KAAA;KACC,MAAMC,QAAQ,GAAG1B,cAAI,CAAC2B,QAAQ,kEAAC,IAAI,oCAAJ,sBAAYR,IAAI,CAAC,GAAG,4CAAI,gBAAOA,IAAI,GAAG,EAAE;KACvE,MAAMS,QAAQ,GAAG5B,cAAI,CAAC2B,QAAQ,mEAAC,IAAI,oCAAJ,uBAAYC,QAAQ,CAAC,GAAG,4CAAI,gBAAOA,QAAQ,GAAG,EAAE;KAC/E,MAAMC,WAAW,GAAG,uEAAI,gBAAOzB,IAAI,qBAAf,uBAAiB0B,GAAG,KAAI,4CAAI,gBAAOC,WAAW,4CAAI,IAAI,6CAAsB;KAEhG,MAAMC,WAAW,GAAGhC,cAAI,CAAC2B,QAAQ,mEAAC,IAAI,oCAAJ,uBAAYK,WAAW,CAAC,GAAG,4CAAI,gBAAOA,WAAW,GAAG,EAAE;KACxF,MAAMC,WAAW,GAAG,EAAE;KACtB,MAAMC,oBAAoB,GAAGC,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;OAAEC,IAAI,EAAEL,WAAW,oBAAXA,WAAW,CAAEM,OAAO,CAAC,cAAc,EAAE,GAAG;MAAG,CAAC,CAACC,WAAW,CAACD,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAACE,KAAK,CAAC,CAAC,EAAEP,WAAW,CAAC;KAC1J,MAAMQ,SAAS,GAAG,CAAAT,WAAW,oBAAXA,WAAW,CAAEU,MAAM,IAAGT,WAAW;KAEnD,MAAMU,eAAe,GAAGC,aAAG,CAACC,MAAM,cAAC;;MAEjC,CAAc;;GAEhB,GAFIb,WAAW,CAEd;KAEDc,EAAE,CAACC,EAAE,CAACC,IAAI,CAACC,IAAI,CAACN,eAAe,CAAC;KAEhC,OAAOC,aAAG,CAACC,MAAM,gBAAC;;;cAGR,CAA2B,KAAE,CAAwB;;mDAEhB,CAAsC;sDACnC,CAAgC;;SAE7E,CAAoC;6IACgG,CAAqE;;QAE1M,CAAkB;;;GAGtB,GAXYK,cAAI,CAACC,MAAM,CAACtB,WAAW,CAAC,EAAKqB,cAAI,CAACC,MAAM,CAACzB,QAAQ,CAAC,EAEbwB,cAAI,CAACC,MAAM,CAACvB,QAAQ,CAACwB,WAAW,EAAE,CAAC,EAChCX,SAAS,GAAG,EAAE,GAAG,YAAY,EAE1ES,cAAI,CAACC,MAAM,CAACjB,oBAAoB,CAAC,EACmGmB,aAAG,CAACC,UAAU,CAAC,kDAAkD,CAAC,EAEvMX,eAAe;;GActBY,cAAc,GACd;KAAA;KACC,yEAAO,IAAI,wDAAJ,uBAAsBV,MAAM,EAAE;;GAGtCW,UAAU,GACV;KACC,IAAI,CAAC,4CAAI,gBAAOpD,IAAI,IAAI,4CAAI,gBAAOD,MAAM,6CAAK,IAAI,iCAAe,EACjE;OACC,MAAMsD,kBAAkB,GAAG,4CAAI,gBAAOC,WAAW,GAAG,WAAW,GAAG,EAAE;OACpE,IAAIC,UAAU,GAAG,EAAE;OAEnB,IAAI,4CAAI,gBAAOD,WAAW,IAAK,4CAAI,gBAAOE,cAAc,KAAK,IAAK,EAClE;SACCD,UAAU,GAAI,IAAIE,sCAAc,CAAC,4CAAI,gBAAOD,cAAc,CAAC,CAAEf,MAAM,EAAE;;OAGtE,OAAOD,aAAG,CAACC,MAAM,gBAAC;kCACW,CAAqB;;oCAEnB,CAAmD;QAC/E,CAAa;;;IAGhB,GAN+BY,kBAAkB,EAEhBP,cAAI,CAACC,MAAM,CAAC,4CAAI,gBAAOW,UAAU,CAACV,WAAW,EAAE,CAAC,EAC5EO,UAAU;;KAMhB,OAAO,IAAI,CAACJ,cAAc,EAAE;;GAG7BQ,kBAAkB,GAClB;KAAA;KACC,MAAMC,YAAY,GAAGhE,cAAI,CAAC2B,QAAQ,mEAAC,IAAI,8DAAJ,uBAAYsC,QAAQ,qBAApB,uBAAsB9C,IAAI,CAAC,GAAG,4CAAI,gBAAO8C,QAAQ,CAAC9C,IAAI,GAAG,EAAE;KAE9F,IAAInB,cAAI,CAAC2B,QAAQ,mEAAC,IAAI,8DAAJ,uBAAYsC,QAAQ,qBAApB,uBAAsBnC,GAAG,CAAC,EAC5C;OACC,MAAMA,GAAG,GAAG,IAAIoC,aAAG,CAAC,4CAAI,gBAAOD,QAAQ,CAACnC,GAAG,CAAC;OAE5C,OAAOc,aAAG,CAACC,MAAM,gBAAC;eACR,CAA8B;OACtC,CAA4B;;IAE9B,GAHYK,cAAI,CAACC,MAAM,CAACrB,GAAG,CAACqC,QAAQ,EAAE,CAAC,EACnCjB,cAAI,CAACC,MAAM,CAACa,YAAY,CAAC;;KAK9B,OAAOd,cAAI,CAACC,MAAM,CAACa,YAAY,CAAC;;GAGjCI,mBAAmB,GACnB;KACC,MAAMC,MAAM,GAAGzB,aAAG,CAACC,MAAM,gBAAC,aAAW,EAAC;KAEtC,IAAI,4CAAI,gBAAO5B,UAAU,IAAI,4CAAI,gBAAOqD,YAAY,EACpD;OACC,IACA;SACC,4CAAI,oBAAW,IAAIC,oCAAa,CAAC;WAChCtD,UAAU,EAAE,4CAAI,gBAAOA,UAAU;WACjCuD,YAAY,0CAAE,IAAI,+BAAc;WAChCH,MAAM;WACNlF,IAAI,EAAE;aACLsF,KAAK,EAAE,4CAAI,gBAAOH,YAAY,CAACG,KAAK;aACpCC,WAAW,EAAE,4CAAI,gBAAOJ,YAAY,CAACI;YACrC;WACDC,SAAS,EAAE;UACX,CAAE;SACH,4CAAI,kBAAQ9B,MAAM,EAAE;QACpB,CACD,OAAO+B,CAAC,EACR;SACCC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC;;;KAIlB,OAAOP,MAAM;;GAGdU,aAAa,GACb;KAAA;KACC,IAAI,CAAC,4CAAI,gBAAO9D,UAAU,IAAI,6BAAC,4CAAI,gBAAOqD,YAAY,aAAvB,wBAAyBU,QAAQ,GAChE;OACC,OAAO,IAAI;;KAGZ,OACE,IAAIC,sCAAO,CAAC;OACZhE,UAAU,EAAE,4CAAI,gBAAOA,UAAU;OACjC9B,IAAI,EAAE,4CAAI,gBAAOmF,YAAY,CAACU;MAC9B,CAAC,CACAnC,MAAM,EAAE;;GAIZqC,OAAO,GACP;KACC,4CAAI,kBAAS,IAAI;KACjB,4CAAI,kBAAS,IAAI;KACjB,4CAAI,sCAAmB,IAAI;KAE3B,IAAI,CAAClF,cAAI,CAACmF,KAAK,yCAAC,IAAI,kBAAQ,EAC5B;OACC,4CAAI,kBAAQD,OAAO,EAAE;OACrB,4CAAI,oBAAU,IAAI;;;CAGrB;CAAC,gCAhHA;GAAA;GACC,MAAME,OAAO,GAAGpF,cAAI,CAACmF,KAAK,4BAAC,4CAAI,gBAAO/E,IAAI,qBAAf,wBAAiBY,EAAE,CAAC,GAAG,4CAAI,gBAAOC,UAAU,GAAG,4CAAI,gBAAOb,IAAI,CAACY,EAAE;GAC5F,MAAMqE,GAAG,GAAG,IAAInB,aAAG,CAAE,6BAA4BkB,OAAQ,GAAE,CAAC;GAE5D,OAAOC,GAAG,CAAClB,QAAQ,EAAE;CACtB;;CChG+B;CAAA;CAAA;CAAA;CAAA;AAOhC,CAAO,MAAMmB,YAAY,CACzB;GAKCxF,WAAW,CAACyF,OAGX,EACD;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KACC,IAAI,CAACC,QAAQ,GAAGD,OAAO,CAACC,QAAQ;KAChC,IAAI,CAACC,QAAQ,GAAGF,OAAO,CAACE,QAAQ;;GAGjCC,QAAQ,CAACrB,MAAmB,EAC5B;KAAA;KACC,IAAI,CAACsB,OAAO,GAAG,IAAI7C,EAAE,CAACC,EAAE,CAACuC,YAAY,CAAC;OACrCjB,MAAM;OACNuB,WAAW,EAAE,KAAK;OAClBC,KAAK,EAAExC,aAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC;OACvEwC,KAAK,EAAE,CACN;SACC9E,EAAE,EAAE,MAAM;SACV+E,KAAK,EAAE;WACNA,KAAK,EAAE,uBAAI,CAACN,QAAQ,qBAAb,eAAerF,IAAI,KAAI,CAAC;WAC/B4F,KAAK,EAAE;UACP;SACDH,KAAK,EAAE;WACNE,KAAK,EAAE1C,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC;WACtE0C,KAAK,EAAE;UACP;SACDC,KAAK,0CAAE,IAAI,mDAAe,IAAI,CAACR,QAAQ,qBAAb,gBAAerF,IAAI,CAAC;SAC9C8F,SAAS,EAAE,KAAK;SAChBC,eAAe,EAAE;WAChBC,KAAK,EAAE,4CAAI,sCAAkBC,IAAI,CAAC,IAAI;UACtC;SACDC,iBAAiB,EAAE;WAClBF,KAAK,EAAE,4CAAI,sCAAkBC,IAAI,CAAC,IAAI,EAAE,aAAa;;QAEtD,EACD;SACCrF,EAAE,EAAE,SAAS;SACb+E,KAAK,EAAE,wBAAI,CAACN,QAAQ,qBAAb,gBAAec,OAAO,KAAI,CAAC;SAClCV,KAAK,EAAExC,aAAG,CAACC,UAAU,CAAC,kDAAkD,CAAC;SACzE2C,KAAK,0CAAE,IAAI,yDAAkB,IAAI,CAACR,QAAQ,qBAAb,gBAAec,OAAO,CAAC;SACpDJ,eAAe,EAAE;WAChBC,KAAK,EAAE,4CAAI,sCAAkBC,IAAI,CAAC,IAAI;UACtC;SACDC,iBAAiB,EAAE;WAClBF,KAAK,EAAE,4CAAI,sCAAkBC,IAAI,CAAC,IAAI,EAAE,SAAS;;QAElD;MAEF,CAAC;KAEF,IAAI,CAACV,OAAO,CAAC1C,IAAI,EAAE;KACnB,4CAAI;;CAwEN;CAAC,8BApEA;GACCH,EAAE,CAAC0D,IAAI,CAACC,SAAS,CAAC;KACjBC,QAAQ,EAAE,MAAM;KAChBC,OAAO,EAAE,cAAc;KACvBC,QAAQ,EAAGC,MAAM,IAAK;OAAA;OACrB,MAAMC,gBAAgB,kDAAID,MAAM,CAAC/D,EAAE,CAACiE,OAAO,CAAC,SAAS,CAAC,CAAC,qBAA9B,mBAAiCC,QAAQ,oCAAI,IAAI;OAC1E,IAAIF,gBAAgB,KAAK,IAAI,EAC7B;SACC,IAAI,CAACnB,OAAO,CAACsB,WAAW,CAAC,MAAM,CAAC,CAACC,WAAW,CAACJ,gBAAgB,CAAC;SAC9D,IAAI,CAACnB,OAAO,CAACsB,WAAW,CAAC,MAAM,CAAC,CAACE,WAAW,yCAAC,IAAI,gCAAeL,gBAAgB,EAAE;;;IAGpF,CAAC;GAEFhE,EAAE,CAAC0D,IAAI,CAACC,SAAS,CAAC;KACjBC,QAAQ,EAAE,SAAS;KACnBC,OAAO,EAAE,SAAS;KAClBC,QAAQ,EAAGC,MAAM,IAAK;OAAA;OACrB,MAAMO,cAA6B,+CAAGP,MAAM,CAACQ,OAAO,qBAAd,gBAAgBC,SAAS,oCAAI,IAAI;OAEvE,IAAIF,cAAc,KAAK,IAAI,EAC3B;SACC,IAAI,CAACzB,OAAO,CAACsB,WAAW,CAAC,SAAS,CAAC,CAACC,WAAW,CAACE,cAAc,CAAC;SAC/D,IAAI,CAACzB,OAAO,CAACsB,WAAW,CAAC,SAAS,CAAC,CAACE,WAAW,yCAAC,IAAI,sCAAkBC,cAAc,EAAE;;;IAGxF,CAAC;CACH;CAAC,wBAEarB,KAAK,EACnB;GACC,OAAOA,KAAK,GAAG,CAAC,GAAG,QAAQ,GAAG,OAAO;CACtC;CAAC,2BAEgBA,KAAK,EACtB;GACC,OAAOA,KAAK,GAAG,CAAC,GAAG,SAAS,GAAG,OAAO;CACvC;CAAC,2BAEgBwB,QAAgB,EACjC;GACC,MAAMC,aAAa,2CAAG,IAAI,yCAAoB;GAC9C,IAAI,CAACA,aAAa,EAClB;KACC;;GAGD,MAAMC,GAAG,GAAGD,aAAa,CAACE,MAAM,EAAE;GAClC,MAAMC,MAAM,GAAG;KACdC,aAAa,EAAEL,QAAQ,WAARA,QAAQ,GAAI;IAC3B;GAEDE,GAAG,CAACI,SAAS,CAACF,MAAM,CAAC;GACrBF,GAAG,CAACK,KAAK,EAAE;CACZ;CAAC,8BAGD;GACC,IAAI,IAAI,CAACtC,QAAQ,EACjB;KAAA;KACC,gCAAO1C,EAAE,CAACiF,IAAI,CAACP,aAAa,qBAArB,sBAAuBQ,OAAO,CAAC,IAAI,CAACxC,QAAQ,CAAC;;;;GAIrDX,OAAO,CAACoD,IAAI,CAAC,kBAAkB,CAAC;GAEhC,OAAO,IAAI;CACZ;;;;ACvID,CAY0B;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAK1B,CAAO,MAAMC,aAAa,CAC1B;GAmBCpI,WAAW,CAACyF,OASX,EACD;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA,KA1BA4C,gBAAgB,GAAW,CAAC;KAAA;OAAA;OAAA,OAOc,IAAIC,GAAG;;KAAE;OAAA;OAAA,OACO;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAmB3D,IAAIC,qBAAqB,GAAG,KAAK;KAEjC,IAAIrI,cAAI,CAACsI,aAAa,CAAC/C,OAAO,CAAC,EAC/B;OACC,IAAI,CAACgD,MAAM,GAAGhD,OAAO,CAACgD,MAAM;OAE5B,IAAIvI,cAAI,CAACwI,OAAO,CAACjD,OAAO,CAACkD,MAAM,CAAC,EAChC;SACC,IAAI,CAACC,UAAU,CAACnD,OAAO,CAACkD,MAAM,CAAC;;OAEhC,IAAI,CAACE,WAAW,GAAG;SAClBC,gBAAgB,EAAErD,OAAO,CAACsD,wBAAwB;SAClDC,gBAAgB,EAAG,GAAE,IAAI,CAACP,MAAO;QACjC;OAED,IAAI,CAACrI,aAAa,GAAGqF,OAAO,CAACrF,aAAa;OAC1C,4CAAI,sCAAiBqF,OAAO,CAACf,YAAY;OACzC,4CAAI,0CAAqBe,OAAO,CAACwD,gBAAgB;OACjD,4CAAI,wBAAYxD,OAAO,CAACyD,OAAO;OAE/BX,qBAAqB,GAAG9C,OAAO,CAAC8C,qBAAqB,KAAK,IAAI;;KAG/D,IAAI,CAACY,MAAM,GAAG,IAAIlK,cAAc,EAAE;KAElC,IAAIsJ,qBAAqB,EACzB;OACC,4CAAI;;KAEL,4CAAI;KAEJ,IAAI,CAACpF,IAAI,EAAE;KACX,IAAI,CAACiG,gBAAgB,CAAC3D,OAAO,CAACE,QAAQ,EAAEF,OAAO,CAACC,QAAQ,CAAC;;GAuJ1D2D,uBAAuB,CAACpJ,QAAsB,EAAEqJ,QAA0B,EAC1E;KACC,MAAMC,OAAO,GAAG,CACf;OACCC,IAAI,EAAEjG,aAAG,CAACC,UAAU,CAAC,qDAAqD,CAAC;OAC3EiG,IAAI,EAAExJ,QAAQ,CAACkE,QAAQ,CAACnC,GAAG,IAAI;MAC/B,CACD;KAED,IAAI/B,QAAQ,CAACK,IAAI,EACjB;OACCiJ,OAAO,CAACG,IAAI,CAAC;SACZF,IAAI,EAAEjG,aAAG,CAACC,UAAU,CAAC,iDAAiD,CAAC;SACvEiG,IAAI,EAAExJ,QAAQ,CAACK,IAAI,CAAC0B;QACpB,CAAC;;KAGH,OAAO;OACNd,EAAE,EAAEjB,QAAQ,CAACkB,UAAU;OACvBwI,SAAS,EAAE,KAAK;OAChBC,OAAO,EAAE;SACRC,EAAE,EAAE5J,QAAQ,CAACkB,UAAU;SACvB2I,OAAO,EAAER,QAAQ,CAAC3H,aAAa,EAAE;SACjCoI,aAAa,EAAET,QAAQ,CAAChF,mBAAmB,EAAE;SAC7C0F,IAAI,EAAEV,QAAQ,CAAC5F,UAAU,EAAE;SAC3BuG,cAAc,EAAE7G,cAAI,CAACC,MAAM,CAACpD,QAAQ,CAAC+D,UAAU,CAAC;SAChDkG,aAAa,EAAEZ,QAAQ,CAACrF,kBAAkB,EAAE;SAC5CkG,sBAAsB,EAAE/G,cAAI,CAACC,MAAM,CAACpD,QAAQ,CAACmK,YAAY,CAAC;SAC1DC,gBAAgB,EAAEhI,aAAG,CAACC,MAAM,CAAC,MAAM,EAAE;WAAEC,IAAI,EAAEtC,QAAQ,CAACiC,WAAW,IAAI;UAAI,CAAC;SAC1EoI,QAAQ,EAAElH,cAAI,CAACC,MAAM,CAACpD,QAAQ,CAACsK,QAAQ,CAAC;SACxCC,gBAAgB,EAAEpH,cAAI,CAACC,MAAM,CAACpD,QAAQ,CAACwK,eAAe,CAAC;SACvDC,mBAAmB,EAAEtH,cAAI,CAACC,MAAM,CAACpD,QAAQ,CAAC0K,SAAS,CAAC;SACpDC,YAAY,EAAExH,cAAI,CAACC,MAAM,CAACpD,QAAQ,CAAC4K,WAAW,CAAC;SAC/CC,OAAO,EAAExB,QAAQ,CAACrE,aAAa;QAC/B;OACDsE,OAAO;OACPwB,aAAa,EAAE;SACdhB,aAAa,EAAE,uBAAuB;SACtCe,OAAO,EAAE,iBAAiB;SAC1Bd,IAAI,EAAE/J,QAAQ,CAAC2D,WAAW,GAAG,0BAA0B,GAAG,EAAE;SAC5DyG,gBAAgB,EAAE;QAClB;OACD1E,QAAQ,0CAAE,IAAI,0CAAoB1F,QAAQ,CAAC;OAC3C+K,QAAQ,EAAEC,OAAO,CAAChL,QAAQ,CAACK,IAAI;MAC/B;;GAyBF6C,IAAI,GACJ;KACC,IAAI,CAAC0F,WAAW,CAACqC,kBAAkB,GAAG/G,QAAQ,CAACgH,cAAc,CAAC,IAAI,CAACtC,WAAW,CAACC,gBAAgB,CAAC;KAChG,IAAI,CAACsC,gBAAgB,EAAE;KACvB,IAAI,CAACC,WAAW,EAAE;KAElB,IAAI,CAACC,oBAAoB,EAAE;;GAG5BlC,gBAAgB,CAACzD,QAAQ,EAAED,QAAQ,EACnC;KACC,MAAM6F,gBAAgB,GAAGpH,QAAQ,CAACqH,aAAa,CAAC,oCAAoC,CAAC;KACrF,IAAI,CAACD,gBAAgB,EACrB;OACC;;KAGA,IAAI/F,YAAY,CAAC;OAAEG,QAAQ;OAAED;MAAU,CAAC,CAAEE,QAAQ,CAAC2F,gBAAgB,CAAC;;GAGtEF,WAAW,GACX;KACC,MAAMI,OAAO,GAAG,IAAInD,GAAG,EAAE;KAEzBnE,QAAQ,CAACuH,gBAAgB,CAAC,8BAA8B,CAAC,CAACC,OAAO,CAC/DpH,MAAM,IAAK;OACX,MAAMtE,QAAQ,GAAGoC,aAAG,CAACuJ,IAAI,CAACrH,MAAM,EAAE,eAAe,CAAC;OAClD,MAAMsH,QAAQ,GAAGxJ,aAAG,CAACuJ,IAAI,CAACrH,MAAM,EAAE,aAAa,CAAC;OAEhD,IAAItE,QAAQ,EACZ;SACC,IAAI,CAACwL,OAAO,CAACK,GAAG,CAAC7L,QAAQ,CAACkB,UAAU,CAAC,EACrC;WACC,4CAAI,4DAA6BlB,QAAQ,CAACkB,UAAU;WACpDsK,OAAO,CAACM,GAAG,CAAC9L,QAAQ,CAACkB,UAAU,CAAC;;SAGjC,IAAIlB,QAAQ,CAACK,IAAI,EACjB;;WAEC,4CAAI,kCAAgByL,GAAG,CAAC9L,QAAQ,CAACkB,UAAU,EAAElB,QAAQ,CAACK,IAAI,CAACY,EAAE,CAAC;;SAG/D,IAAI,CAAC8K,gBAAgB,CAACzH,MAAM,EAAEsH,QAAQ,EAAE5L,QAAQ,CAAC;;MAElD,CACD;;GAGF+L,gBAAgB,CAACzH,MAAM,EAAEsH,QAAQ,EAAE5L,QAAQ,EAC3C;KAAA;KACC,MAAMqJ,QAAQ,oEACb,IAAI,sDAA0B2C,MAAM,CAAChM,QAAQ,CAACkB,UAAU,CAAC,6EACtD,IAAI,oDAAyB8K,MAAM,CAAChM,QAAQ,CAACkB,UAAU,CAAC,EAAElB,QAAQ,CACrE;KAED,IAAIiM,SAAS,GAAG,IAAI;KACpB,QAAQL,QAAQ;OAEf,KAAK,eAAe;SACnBK,SAAS,GAAG5C,QAAQ,CAACrF,kBAAkB,EAAE;SACzC;OAED,KAAK,SAAS;SACbiI,SAAS,GAAG5C,QAAQ,CAAC3H,aAAa,EAAE;SACpC;OAED,KAAK,eAAe;SACnBuK,SAAS,GAAG5C,QAAQ,CAAChF,mBAAmB,EAAE;SAC1C;OAED,KAAK,MAAM;SACV4H,SAAS,GAAG5C,QAAQ,CAAC5F,UAAU,EAAE;SACjC;OAED,KAAK,SAAS;SACbwI,SAAS,GAAG5C,QAAQ,CAACrE,aAAa,EAAE;SACpC;OAED,KAAK,UAAU;SACdiH,SAAS,GAAG5C,QAAQ,CAAC6C,cAAc,EAAE;SACrC;OAED;;;;KAID,IAAID,SAAS,EACb;OACC7J,aAAG,CAACG,OAAO,CACV+B,MAAM,EACN2H,SAAS,CACT;;;GAIHE,wBAAwB,GACxB;KACCC,iBAAO,CACLC,aAAa,CAAC,gBAAgB,CAAC,CAC/BxM,IAAI,CAAC,CAAC;OAAEyM;MAAQ,KAAK;OACrBA,MAAM,CAACC,sBAAsB,EAAE;MAC/B,CAAC,CACD5M,KAAK,CAAEkF,CAAC,IAAKC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC,CAAC;KAEhCuH,iBAAO,CACLC,aAAa,CAAC,cAAc,CAAC,CAC7BxM,IAAI,CAAC,CAAC;OAAE2M;MAAU,KAAK;OACvBA,QAAQ,CAAC;SACRC,IAAI,EAAE,YAAY;SAClBC,QAAQ,EAAE,oBAAoB;SAC9BC,KAAK,EAAE,aAAa;SACpBC,SAAS,EAAE,SAAS;SACpBC,SAAS,EAAE;QACX,CAAC;MACF,CAAC,CACDlN,KAAK,CAAC,MAAM,EAAE,CAAC;;GAIlBmN,iBAAiB,CAAChG,MAAc,EAChC;KACCsF,iBAAO,CAACC,aAAa,CAAC,8BAA8B,CAAC,CACnDxM,IAAI,CAAC,CAAC;OAAEkN;MAAe,KAAK;OAC5BA,aAAa,oBAAbA,aAAa,CAAEC,IAAI,CAAClG,MAAM,CAAC;MAC3B,CAAC,CACDnH,KAAK,CAAC,MAAM,EAAE,CAAC;;GAIlBwL,gBAAgB,GAChB;KACC,IAAI,CAAC,IAAI,CAAC8B,kBAAkB,EAC5B;OACC,IAAI,CAACA,kBAAkB,GAAG,IAAIC,6BAAW,CAAC;SACzCC,QAAQ,EAAE,KAAK;SACfC,WAAW,EAAE,GAAG;SAChBC,MAAM,EAAE;WACPC,QAAQ,EAAGX,KAAK,IAAK;aACpB,IAAI,CAACvE,gBAAgB,GAAGmF,QAAQ,CAACZ,KAAK,CAACa,OAAO,EAAE,CAACC,GAAG,CAACC,KAAK,EAAE,EAAE,EAAE,CAAC;aAEjE,IAAI,CAACzN,cAAI,CAAC0N,SAAS,CAAC,IAAI,CAACvF,gBAAgB,CAAC,EAC1C;eACC,IAAI,CAACA,gBAAgB,GAAG,CAAC;;YAE1B;WACDwF,WAAW,EAAE,MAAM;aAClB,IAAI,CAACxF,gBAAgB,GAAG,CAAC;;UAE1B;SACDyF,aAAa,EAAE;WACdC,QAAQ,EAAE,CACT;aACC7M,EAAE,EAAE,MAAM;aACVuE,OAAO,EAAE;eACRuI,iBAAiB,EAAE,IAAI;eACvBC,kBAAkB,EAAE;;YAErB;;QAGH,CAAC;;KAGH,IAAI/N,cAAI,CAACgO,SAAS,CAAC,IAAI,CAACrF,WAAW,CAACqC,kBAAkB,CAAC,EACvD;OACC7I,aAAG,CAAC8L,KAAK,CAAC,IAAI,CAACtF,WAAW,CAACqC,kBAAkB,CAAC;OAC9C,IAAI,CAACgC,kBAAkB,CAACtH,QAAQ,CAAC,IAAI,CAACiD,WAAW,CAACqC,kBAAkB,CAAC;;;GAIvEtC,UAAU,CAACD,MAAkC,EAC7C;KACC,IAAI,CAACzI,cAAI,CAACM,aAAa,CAACmI,MAAM,CAAC,EAC/B;OACC,IAAI,CAACzI,cAAI,CAACwI,OAAO,CAACC,MAAM,CAAC,EACzB;SACC5D,OAAO,CAACC,KAAK,CAAC2D,MAAM,CAAC;;OAGtB;;KAGD,MAAMyF,eAAe,GAAGjK,QAAQ,CAACgH,cAAc,CAAC,oCAAoC,CAAC;KAErF,IAAIiD,eAAe,EACnB;OACC,IAAIC,YAAY,GAAG,CAAC;OACpB,MAAMC,SAAS,GAAG,MAAM;SACvB,IAAID,YAAY,GAAG,CAAC,EACpB;WACChM,aAAG,CAACkM,KAAK,CAACH,eAAe,EAAE;aAAEI,MAAM,EAAE;YAAQ,CAAC;UAC9C,MAED;WACCnM,aAAG,CAACkM,KAAK,CAACH,eAAe,EAAE;aAAEI,MAAM,EAAE;YAAO,CAAC;;QAE9C;OAED,KAAK,MAAMxJ,KAAK,IAAI2D,MAAM,EAC1B;SACC0F,YAAY,IAAI,CAAC;SAEjB,MAAMI,KAAK,GAAG,IAAIC,eAAK,CAAC;WACvBlF,IAAI,EAAEpG,cAAI,CAACC,MAAM,CAAC2B,KAAK,CAACiC,OAAO,CAAC;WAChCd,KAAK,EAAEwI,oBAAU,CAACC,MAAM;WACxBC,QAAQ,EAAE,IAAI;WACdC,QAAQ,EAAE;UACV,CAAC;SAEFL,KAAK,CAAC7I,QAAQ,CAACwI,eAAe,CAAC;SAE/B,IAAIK,KAAK,CAACM,WAAW,EAAE,EACvB;;WAECN,KAAK,CAACM,WAAW,EAAE,CAACjO,OAAO,GAAG,MAAM;aACnCuN,YAAY,IAAI,CAAC;aACjBC,SAAS,EAAE;YACX;;;OAIHA,SAAS,EAAE;;;GAIbhD,oBAAoB,GACpB;KACC,MAAM0D,IAAI,GAAG,IAAI,CAACC,OAAO,EAAE;KAC3B,MAAMpG,WAAW,GAAGmG,IAAI,oBAAJA,IAAI,CAAEE,eAAe,EAAE;KAE3C,IAAIrG,WAAW,EACf;OACC,MAAMzJ,MAAM,GAAGyJ,WAAW,CAACsG,SAAS,EAAE,CAAC,IAAI,CAACtG,WAAW,CAACG,gBAAgB,CAAC;OACzE,IAAI,CAAC9I,cAAI,CAAC2B,QAAQ,CAACzC,MAAM,CAAC,IAAIA,MAAM,CAACgQ,QAAQ,CAAC,YAAY,CAAC,EAC3D;SACC/M,aAAG,CAACgN,IAAI,CAAC,IAAI,CAACxG,WAAW,CAACqC,kBAAkB,CAAC;QAC7C,MAED;SACC7I,aAAG,CAACiN,IAAI,CAAC,IAAI,CAACzG,WAAW,CAACqC,kBAAkB,CAAC;;;;GAKhDqE,sBAAsB,GACtB;KACC,MAAMP,IAAI,GAAG,IAAI,CAACC,OAAO,EAAE;KAC3B,MAAMO,YAAY,GAAGR,IAAI,oBAAJA,IAAI,CAAEE,eAAe,EAAE;KAE5C,IAAIF,IAAI,IAAIQ,YAAY,EACxB;OAAA;OACC,MAAMC,gBAAgB,GAAG,0BAAAD,YAAY,CAACE,iBAAiB,EAAE,qBAAhC,sBAAkCC,OAAO,MAAK,IAAI;;OAE3E,IAAIF,gBAAgB,EACpB;SACC,IAAI,CAAC7G,UAAU,CAAC,CAAC;WAAE3B,OAAO,EAAE;UAA6B,CAAC,CAAC;;OAG5D,MAAM7H,MAAc,GAAGoQ,YAAY,CAACL,SAAS,EAAE,CAAC,IAAI,CAACtG,WAAW,CAACG,gBAAgB,CAAC;OAElF,IAAI9I,cAAI,CAAC2B,QAAQ,CAACzC,MAAM,CAAC,EACzB;SACC,MAAMwQ,aAAa,GAAG,IAAI,CAACC,kBAAkB,CAACb,IAAI,CAACc,OAAO,EAAE,CAACC,cAAc,EAAE,CAAC;SAE9E,IAAIH,aAAa,CAAChN,MAAM,KAAK,CAAC,EAC9B;;;WAGC;;SAGD,IAAIxD,MAAM,CAACgQ,QAAQ,CAAC,aAAa,CAAC,EAClC;WACC,MAAMY,MAAM,GAAGxC,QAAQ,CAACpO,MAAM,CAAC6Q,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,EAAE,EAAE,EAAE,CAAC;WAEpD,IAAIhQ,cAAI,CAACC,QAAQ,CAAC6P,MAAM,CAAC,EACzB;aACC,IAAI,CAACG,gBAAgB,CAACP,aAAa,EAAEI,MAAM,CAAC;;UAE7C,MACI,IAAI5Q,MAAM,CAACgR,UAAU,CAAC,aAAa,CAAC,EACzC;WACC,IAAI,CAACC,aAAa,CAACT,aAAa,EAAE,IAAI,CAACvH,gBAAgB,CAAC;;;;;GAM5DwH,kBAAkB,CAACS,mBAAsC,EACzD;KACC,OACCA,mBAAmB,CACjB1P,GAAG,CAAEO,UAAU,IAAK,4CAAI,kCAAgBoP,GAAG,CAACpP,UAAU,CAAC,CAAC,CACxDqP,MAAM,CAAEvP,MAAM,IAAKf,cAAI,CAACC,QAAQ,CAACc,MAAM,CAAC,CAAC;;GAI7CkP,gBAAgB,CAACM,OAAsB,EAAEC,SAAiB,EAC1D;;KAECjR,cAAI,CACFkR,SAAS,CAAC,4BAA4B,EAAE;OACxCtR,IAAI,EAAE;SACLoR,OAAO;SACPC;;MAED,CAAC,CACD9Q,KAAK,CAAEC,QAAQ,IAAK;OACpB,IAAI,CAAC+I,UAAU,CAAC/I,QAAQ,CAAC8I,MAAM,CAAC;OAChC,IAAI,CAACiI,UAAU,EAAE;MACjB;;;;;GAKHP,aAAa,CAACI,OAAsB,EAAEI,QAAgB,EACtD;;KAECpR,cAAI,CACFC,kBAAkB,CAAC,+BAA+B,EAAE,eAAe,EAAE;OACrEC,IAAI,EAAE,OAAO;OACbN,IAAI,EAAE;SACLoR,OAAO;SACPI;;MAED,CAAC,CACDjR,KAAK,CAAEC,QAAQ,IAAK;OACpB,IAAI,CAAC+I,UAAU,CAAC/I,QAAQ,CAAC8I,MAAM,CAAC;OAChC,IAAI,CAACiI,UAAU,EAAE;MACjB;;;;;GAKHA,UAAU,GACV;KAAA;KACC,qBAAI,CAAC3B,OAAO,EAAE,qBAAd,cAAgB6B,MAAM,EAAE;;GAGzB9P,MAAM,CAAC+P,KAKN,EACD;KACC,4CAAI,sBAAUA,KAAK,CAAC5P,UAAU;KAE9B1B,cAAI,CAACkR,SAAS,CAAC,iBAAiB,EAAE;OACjCtR,IAAI,EAAE0R;MACN,CAAC,CAACjR,IAAI,CAAC,MAAM;OACb,IAAIiR,KAAK,CAAC3P,QAAQ,EAClB;SACC6B,kBAAE,CAAC+N,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAC7BC,OAAO,EAAE5N,aAAG,CAACC,UAAU,CACtB,8CAA8C,EAC9C;aAAE,aAAa,EAAEJ,cAAI,CAACC,MAAM,CAAC0N,KAAK,CAAC3P,QAAQ;YAAG;UAE/C,CAAC;;MAEH,CAAC,CAACxB,KAAK,CAAEC,QAAQ,IAAK;OACtB,IAAI,CAAC+I,UAAU,CAAC/I,QAAQ,CAAC8I,MAAM,CAAC;OAChC,4CAAI,sBAAUoI,KAAK,CAAC5P,UAAU;MAC9B,CAAC;;GAGHiQ,cAAc,CAACjQ,UAAkB,EACjC;KACC,IAAI,yCAAC,IAAI,uCAAkB,IAAI,4CAAI,kCAAgB2K,GAAG,CAAC3K,UAAU,CAAC,EAClE;OACC,MAAMkQ,MAAM,GAAG,IAAIrO,EAAE,CAACC,EAAE,CAACqO,cAAc,CAAC;SACvCvL,KAAK,EAAExC,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;SAChE2N,OAAO,EAAE,IAAI,CAACI,eAAe,EAAE;SAC/BC,QAAQ,EAAE;WACTC,KAAK,EAAE,EAAE;WACTC,MAAM,EAAE;UACR;SACDC,SAAS,0CAAE,IAAI,qBAAS;SACxBC,SAAS,EAAE;WAAE/E,SAAS,EAAE;;QACxB,CAAC;OACFwE,MAAM,CAAC/B,IAAI,EAAE;OACbtM,EAAE,CAAC6O,WAAW,CAACC,IAAI,CAAC,wBAAwB,EAAE,wBAAwB,EAAE,aAAa,EAAE,GAAG,EAAE,KAAK,CAAC;OAClG,4CAAI,0CAAqB,IAAI;;KAG9B,4CAAI,sBAAU3Q,UAAU,EAAE,IAAI;KAC9B,4CAAI,4DAA6BA,UAAU;KAC3C,4CAAI,kCAAgB4Q,MAAM,CAAC5Q,UAAU,CAAC;;GAGvCoQ,eAAe,GACf;KACC,OAAOzO,aAAG,CAACC,MAAM,oBAAC;;;;QAId,CAAiE;;;QAGjE,CAA4D;;;QAG5D,CAA8D;;;kDAGpB,CAA4C;kDAC5C,CAA4C;;GAE1F,GAZMQ,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,EAG9DD,aAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC,EAGzDD,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC,EAGjBD,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC,EACzCD,aAAG,CAACC,UAAU,CAAC,yBAAyB,CAAC;;GAK1FyL,OAAO,GACP;KACC,IAAI,IAAI,CAACxG,MAAM,EACf;OAAA;OACC,+BAAOzF,EAAE,CAACiF,IAAI,CAAC+J,WAAW,qBAAnB,qBAAqBC,eAAe,CAAC,IAAI,CAACxJ,MAAM,CAAC;;;;KAIzD1D,OAAO,CAACoD,IAAI,CAAC,gBAAgB,CAAC;KAE9B,OAAO,IAAI;;CAiEb;CAAC,+BA/rBA;GACCnF,EAAE,CAAC0D,IAAI,CAACC,SAAS,CAAC;KACjBC,QAAQ,EAAE,SAAS;KACnBC,OAAO,EAAE,UAAU;KACnBC,QAAQ,EAAGC,MAAM,IAAK;OACrB,IAAIA,MAAM,CAACmL,SAAS,KAAK,SAAS,IAAInL,MAAM,CAACmL,SAAS,KAAK,SAAS,EACpE;SACCnL,MAAM,CAACf,KAAK,CAAC2F,OAAO,CAAE1L,QAAQ,IAAK,IAAI,CAACmR,cAAc,CAACnR,QAAQ,CAACiB,EAAE,CAAC,CAAC;;OAGrE,IAAI6F,MAAM,CAACmL,SAAS,KAAK,OAAO,IAAInL,MAAM,CAACmL,SAAS,KAAK,SAAS,EAClE;SACC,MAAMC,qBAAmC,GAAG,IAAI,CAAClD,OAAO,EAAE,CAACa,OAAO,EAAE;SACpE,IAAI3Q,GAAG,GAAG4H,MAAM,CAACf,KAAK,CAACpF,GAAG,CAAEX,QAAQ,IAAKA,QAAQ,CAACiB,EAAE,CAAC;SACrD,IAAI6F,MAAM,CAACmL,SAAS,KAAK,OAAO,EAChC;WACC/S,GAAG,GAAGA,GAAG,CAACqR,MAAM,CAAEtP,EAAE,IAAK,CAACiR,qBAAqB,CAACjK,OAAO,CAAChH,EAAE,CAAC,CAAC;;SAG7D,IAAI/B,GAAG,CAACyD,MAAM,GAAG,CAAC,EAClB;WACC,IAAI,CAACuG,MAAM,CACTjK,aAAa,CAACC,GAAG,CAAC,CAClBW,IAAI,CAAC,4CAAI,sCAAkByG,IAAI,CAAC,IAAI,CAAC,CAAC,CACtC3G,KAAK,CAAEC,QAAQ,IAAK,IAAI,CAAC+I,UAAU,CAAC/I,QAAQ,CAAC,CAAC;;;;IAKnD,CAAC;CACH;CAAC,+BAGD;GACCmD,EAAE,CAACoP,cAAc,CAChB,4BAA4B,EAC3BxF,KAAK,IAAK;KACV,IAAIA,KAAK,CAACyF,UAAU,EAAE,KAAK,sBAAsB,EACjD;OACC,4CAAI,sBAAUzF,KAAK,CAACvN,IAAI,CAAC8B,UAAU;MACnC,MACI,IAAIyL,KAAK,CAACyF,UAAU,EAAE,KAAK,wBAAwB,EACxD;OACC,4CAAI,sBAAUzF,KAAK,CAACvN,IAAI,CAAC8B,UAAU;MACnC,MACI,IAAIyL,KAAK,CAACyF,UAAU,EAAE,KAAK,0BAA0B,EAC1D;OACCpP,kBAAE,CAAC+N,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC7BC,OAAO,EAAE5N,aAAG,CAACC,UAAU,CACtB,8CAA8C,EAC9C;WAAE,aAAa,EAAEJ,cAAI,CAACC,MAAM,CAACuJ,KAAK,CAACvN,IAAI,CAAC+B,QAAQ;UAAG;QAEpD,CAAC;;IAEH,CACD;CACF;CAAC,2BAEgBvB,QAAmC,EACpD;GAAA;GACC,MAAM;KAAEyS;IAAW,GAAGzS,QAAQ,CAACR,IAAI;GACnC,IAAI,CAACa,cAAI,CAACwI,OAAO,CAAC4J,SAAS,CAAC,EAC5B;;KAECvN,OAAO,CAACoD,IAAI,CAAC,wEAAwE,CAAC;KAEtF;;GAGD,MAAMoK,YAAY,qBAAG,IAAI,CAACtD,OAAO,EAAE,qBAAd,eAAgBuD,WAAW,EAAE;GAElD,IAAID,YAAY,EAChB;KACC,IAAIE,cAAc,GAAG,IAAI;KACzBH,SAAS,CAAC3G,OAAO,CAAE1L,QAAQ,IAAK;OAC/B,MAAMyS,QAAQ,GAAGzH,OAAO,CACvBhL,QAAQ,CAAC0S,OAAO,GAAG,CAAC,IACjB1S,QAAQ,CAAC2S,UAAU,GAAG,CAAC,IAEzB3S,QAAQ,CAAC4S,WAAW,KAAK,IAAI,CAACzS,aAAa,IACxCH,QAAQ,CAAC2D,WAAW,KAAK,KAC5B,CACD;OAED,IAAI8O,QAAQ,EACZ;SACC,4CAAI,oCAAiB;WACpBzS,QAAQ;WACRqJ,QAAQ,0CAAE,IAAI,oDAAyBrJ,QAAQ,CAACkB,UAAU,EAAElB,QAAQ,CAAC;WACrE6S,WAAW,EAAEL;UACb;SACDA,cAAc,GAAGxS,QAAQ,CAACkB,UAAU;;MAErC,CAAC;;CAEJ;CAAC,0BAEe;GAAElB,QAAQ;GAAEqJ,QAAQ;GAAEwJ;CAAY,CAAC,EACnD;GAAA;GACC,IAAI7S,QAAQ,CAACK,IAAI,EACjB;KACC,4CAAI,kCAAgByL,GAAG,CAAC9L,QAAQ,CAACkB,UAAU,EAAElB,QAAQ,CAACK,IAAI,CAACY,EAAE,CAAC;;GAG/D,MAAMqR,YAAY,qBAAG,IAAI,CAACtD,OAAO,EAAE,qBAAd,eAAgBuD,WAAW,EAAE;GAClD,IAAI,CAACD,YAAY,EACjB;KACC;;GAGD,MAAMQ,aAAa,GAAG,IAAI,CAAC1J,uBAAuB,CAACpJ,QAAQ,EAAEqJ,QAAQ,CAAC;GAEtE,IAAIpJ,cAAI,CAAC8S,cAAc,CAACF,WAAW,CAAC,EACpC;KACCC,aAAa,CAACD,WAAW,GAAGA,WAAW;IACvC,MAED;KACCC,aAAa,CAACE,OAAO,GAAG,IAAI;;GAG7BV,YAAY,CAACW,MAAM,CAACH,aAAa,CAAC;;;GAGlC,MAAMI,GAAgB,qBAAG,IAAI,CAAClE,OAAO,EAAE,qBAAd,eAAgBa,OAAO,EAAE,CAAC5H,OAAO,CAACjI,QAAQ,CAACkB,UAAU,CAAC;GAC/E,IAAIgS,GAAG,EACP;KACC,IAAIJ,aAAa,CAAChI,aAAa,EAC/B;OACC,KAAK,MAAM,CAACc,QAAQ,EAAEuH,WAAW,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACP,aAAa,CAAChI,aAAa,CAAC,EACjF;SACC,IAAIqI,WAAW,EACf;WACC/Q,aAAG,CAACkR,QAAQ,CAACJ,GAAG,CAACK,WAAW,CAAC3H,QAAQ,CAAC,EAAEuH,WAAW,CAAC;;;;KAIvD/Q,aAAG,CAACkR,QAAQ,CAACJ,GAAG,CAACM,OAAO,EAAE,EAAE,2BAA2B,CAAC;KACxDC,eAAK,CAACnN,IAAI,CAAC4M,GAAG,CAACM,OAAO,EAAE,EAAE,cAAc,EAAG7G,KAAqB,IAAK;OACpE,IAAIA,KAAK,CAAC+G,aAAa,KAAK,YAAY,EACxC;SACCtR,aAAG,CAACuR,WAAW,CAACT,GAAG,CAACM,OAAO,EAAE,EAAE,2BAA2B,CAAC;;MAE5D,CAAC;;CAEJ;CAAC,6BAiDkBxT,QAAsB,EACzC;GACC,MAAM0F,QAAQ,GAAG,EAAE;GACnB,IAAI,4CAAI,wCAAmB,IAAI,CAACvF,aAAa,KAAKH,QAAQ,CAAC0S,OAAO,GAAG,CAAC,IAAI1S,QAAQ,CAAC2S,UAAU,GAAG,CAAC,CAAC,EAClG;KACC,MAAMiB,YAAY,GAAG5T,QAAQ,CAAC0S,OAAO,KAAK,CAAC,IAAI1S,QAAQ,CAAC2S,UAAU,GAAG,CAAC,GACnE5P,EAAE,CAAC8Q,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,OAAO,GAC9BjR,EAAE,CAAC8Q,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACpF,MAAM;KAGhCjJ,QAAQ,CAAC2E,QAAQ,GAAG;OACnB4J,IAAI,EAAElR,EAAE,CAAC8Q,IAAI,CAACC,QAAQ,CAAC7T,IAAI,CAACiU,IAAI;OAChChO,KAAK,EAAE0N,YAAY;OACnBO,cAAc,EAAEpR,EAAE,CAAC8Q,IAAI,CAACC,QAAQ,CAACC,KAAK,CAACC,OAAO;OAC9ChO,KAAK,EAAE,CAAChG,QAAQ,CAAC0S,OAAO,IAAI,CAAC,KAAK1S,QAAQ,CAAC2S,UAAU,IAAI,CAAC,CAAC;OAC3DyB,QAAQ,EAAEpU,QAAQ,CAAC0S,OAAO,GAAG,CAAC,IAAI1S,QAAQ,CAAC2S,UAAU,GAAG;MACxD;;GAGF,OAAOjN,QAAQ;CAChB;CAAC,kCA2auBxE,UAAsB,EAAElB,QAAQ,EACxD;GACC,4CAAI,wCAAmBkB,UAAU,CAAC,GAAG,IAAIpB,gBAAgB,CAAC;KACzDgB,aAAa,EAAE,IAAI;KACnBX,aAAa,EAAE,IAAI,CAACA,aAAa;KACjCH;IACA,CAAC;GAEF,OAAO,4CAAI,wCAAmBkB,UAAU,CAAC;CAC1C;CAAC,mCAEwBA,UAAsB,EAC/C;GACC,OAAOjB,cAAI,CAACmF,KAAK,CAAC,4CAAI,wCAAmBlE,UAAU,CAAC,CAAC,GAAG,IAAI,GAAG,4CAAI,wCAAmBA,UAAU,CAAC;CAClG;CAAC,sCAE2BA,UAAsB,EAClD;GACC,MAAMmI,QAAQ,2CAAG,IAAI,sDAA0BnI,UAAU,CAAC;GAC1D,IAAImI,QAAQ,EACZ;KACCA,QAAQ,CAAClE,OAAO,EAAE;KAClB,OAAO,4CAAI,wCAAmBjE,UAAU,CAAC;;CAE3C;CAAC,mBAEQD,EAAU,EAAEoT,MAAe,GAAG,KAAK,EAC5C;GACC,MAAMtF,IAAI,GAAG,IAAI,CAACC,OAAO,EAAE;GAC3B,MAAMkE,GAAG,GAAGnE,IAAI,oBAAJA,IAAI,CAAEc,OAAO,EAAE,CAAC5H,OAAO,CAAChH,EAAE,CAAC;GAEvC,IAAIiS,GAAG,EACP;KACCA,GAAG,CAAC9D,IAAI,EAAE;KACV,IAAIiF,MAAM,EACV;OACCjS,aAAG,CAACiS,MAAM,CAACnB,GAAG,CAACM,OAAO,EAAE,CAAC;;KAG1B,IAAIzE,IAAI,CAACc,OAAO,EAAE,CAACyE,iBAAiB,EAAE,KAAK,CAAC,EAC5C;OACCvF,IAAI,CAACwD,WAAW,EAAE,CAACgC,QAAQ,EAAE;;;CAGhC;CAAC,mBAEQtT,EAAU,EACnB;GAAA;GACC,MAAMiS,GAAG,qBAAG,IAAI,CAAClE,OAAO,EAAE,qBAAd,eAAgBa,OAAO,EAAE,CAAC5H,OAAO,CAAChH,EAAE,CAAC;GACjD,IAAIiS,GAAG,EACP;KACCA,GAAG,CAAC7D,IAAI,EAAE;KACVjN,aAAG,CAACkR,QAAQ,CAACJ,GAAG,CAACM,OAAO,EAAE,EAAE,2BAA2B,CAAC;KAExDC,eAAK,CAACnN,IAAI,CAAC4M,GAAG,CAACM,OAAO,EAAE,EAAE,cAAc,EAAG7G,KAAqB,IAAK;OACpE,IAAIA,KAAK,CAAC+G,aAAa,KAAK,YAAY,EACxC;SACCtR,aAAG,CAACuR,WAAW,CAACT,GAAG,CAACM,OAAO,EAAE,EAAE,2BAA2B,CAAC;;MAE5D,CAAC;;CAEJ;;;;;;;;"}