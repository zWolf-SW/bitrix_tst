{"version":3,"file":"html-formatter.bundle.js","sources":["../src/helpers/create-empty-paragraphs.js","../src/helpers/should-wrap-in-paragraph.js","../src/helpers/wrap-text-nodes.js","../src/helpers/normalize-text-nodes.js","../src/node-formatters/root/root-formatter.js","../src/helpers/find-parent.js","../src/node-formatters/text/text-formatter.js","../src/node-formatters/text/tab-formatter.js","../src/node-formatters/text/linebreak-formatter.js","../src/helpers/normalize-line-breaks.js","../src/node-formatters/paragraph/paragraph-formatter.js","../src/node-formatters/format/bold-formatter.js","../src/node-formatters/format/underline-formatter.js","../src/node-formatters/format/italic-formatter.js","../src/node-formatters/format/strikethrough-formatter.js","../src/node-formatters/table/table-formatter.js","../src/node-formatters/table/table-head-cell-formatter.js","../src/node-formatters/table/table-data-cell-formatter.js","../src/node-formatters/table/table-row-formatter.js","../src/node-formatters/list/list-formatter.js","../src/node-formatters/list/list-item-formatter.js","../src/node-formatters/quote/quote-formatter.js","../src/node-formatters/code/code-formatter.js","../src/node-formatters/link/link-formatter.js","../src/node-formatters/spoiler/spoiler-formatter.js","../src/node-formatters/mention/user-formatter.js","../src/node-formatters/mention/department-formatter.js","../src/node-formatters/mention/project-formatter.js","../src/helpers/create-image-node.js","../src/helpers/validate-image-url.js","../src/node-formatters/image/image-formatter.js","../src/helpers/create-video-node.js","../src/helpers/sanitize-url.js","../src/helpers/validate-video-url.js","../src/node-formatters/video/video-formatter.js","../src/node-formatters/file/file-formatter.js","../src/html-formatter.js","../src/html-formatter-component.js"],"sourcesContent":["import { BBCodeElementNode, BBCodeScheme } from 'ui.bbcode.model';\n\nexport function createEmptyParagraphs(scheme: BBCodeScheme, count: number = 1): Array<BBCodeElementNode>\n{\n\tconst result = [];\n\tfor (let i = 0; i < count; i++)\n\t{\n\t\tresult.push(scheme.createElement({ name: 'p' }));\n\t}\n\n\treturn result;\n}\n","import { type BBCodeElementNode, BBCodeNode } from 'ui.bbcode.model';\n\nexport function shouldWrapInParagraph(node: BBCodeNode | BBCodeElementNode): boolean\n{\n\treturn node.getType() !== BBCodeNode.ELEMENT_NODE || node.hasGroup('#inline') || node.hasGroup('#inlineBlock');\n}\n","import { BBCodeElementNode, BBCodeNode, BBCodeScheme } from 'ui.bbcode.model';\nimport { createEmptyParagraphs } from './create-empty-paragraphs';\nimport { shouldWrapInParagraph } from './should-wrap-in-paragraph';\n\nexport function wrapTextNodes(nodes: Array<BBCodeNode>, scheme: BBCodeScheme): Array<BBCodeElementNode>\n{\n\tconst result = [];\n\tlet currentParagraph = null;\n\tlet lineBreaks = 0;\n\n\tfor (const node of nodes)\n\t{\n\t\tif (scheme.isNewLine(node))\n\t\t{\n\t\t\tlineBreaks++;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (shouldWrapInParagraph(node))\n\t\t{\n\t\t\tif (currentParagraph === null || lineBreaks >= 2)\n\t\t\t{\n\t\t\t\tresult.push(...createEmptyParagraphs(scheme, lineBreaks - 2));\n\t\t\t\tcurrentParagraph = scheme.createElement({ name: 'p' });\n\t\t\t\tresult.push(currentParagraph);\n\t\t\t}\n\t\t\telse if (lineBreaks === 1)\n\t\t\t{\n\t\t\t\tcurrentParagraph.appendChild(scheme.createNewLine());\n\t\t\t}\n\n\t\t\tcurrentParagraph.appendChild(node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (lineBreaks > 2)\n\t\t\t{\n\t\t\t\tresult.push(...createEmptyParagraphs(scheme, lineBreaks - 2));\n\t\t\t}\n\n\t\t\tresult.push(node);\n\t\t\tcurrentParagraph = null;\n\t\t}\n\n\t\tlineBreaks = 0;\n\t}\n\n\t// to avoid a height collapsing for empty elements\n\tif (result.length === 0)\n\t{\n\t\treturn [scheme.createElement({ name: 'p' })];\n\t}\n\n\treturn result;\n}\n","import { BBCodeElementNode, BBCodeScheme } from 'ui.bbcode.model';\nimport { wrapTextNodes } from './wrap-text-nodes';\n\nexport function normalizeTextNodes(node: BBCodeElementNode): BBCodeElementNode\n{\n\tconst scheme: BBCodeScheme = node.getScheme();\n\tconst children: Array<BBCodeElementNode> = wrapTextNodes(node.getChildren(), scheme);\n\tnode.setChildren(children);\n\n\treturn node;\n}\n","import { Tag } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype BeforeConvertCallbackOptions,\n\ttype AfterCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\nimport { type BBCodeNode } from 'ui.bbcode.model';\n\nexport class RootNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: '#root',\n\t\t\tconvert(): DocumentFragment {\n\t\t\t\treturn document.createDocumentFragment();\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\tafter({ element, formatter }: AfterCallbackOptions): HTMLElement {\n\t\t\t\tconst mode = formatter.getContainerMode();\n\t\t\t\tif (mode === 'void' || mode === 'collapsed')\n\t\t\t\t{\n\t\t\t\t\tconst container = Tag.render`<div class=\"ui-typography-container --${mode}\"></div>`;\n\t\t\t\t\tcontainer.appendChild(element);\n\n\t\t\t\t\treturn container;\n\t\t\t\t}\n\n\t\t\t\treturn element;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { BBCodeNode } from 'ui.bbcode.model';\n\nexport function findParent(startingNode: BBCodeNode, findFn: (node: BBCodeNode) => boolean): BBCodeNode | null\n{\n\tlet curr: BBCodeNode | null = startingNode;\n\twhile (curr !== null && curr.getType() !== BBCodeNode.ROOT_NODE)\n\t{\n\t\tif (findFn(curr))\n\t\t{\n\t\t\treturn curr;\n\t\t}\n\n\t\tcurr = curr.getParent();\n\t}\n\n\treturn null;\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { type BBCodeNode } from 'ui.bbcode.model';\nimport { type Smiley, SmileyManager, SmileyParser } from 'ui.smiley';\nimport { findParent } from '../../helpers/find-parent';\n\nexport class TextNodeFormatter extends NodeFormatter\n{\n\t#smileyParser: SmileyParser = null;\n\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#text',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text {\n\t\t\t\tconst text = node.toString({ encode: false });\n\t\t\t\tif (findParent(node, (parent: BBCodeNode) => parent.getName() === 'code'))\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(text);\n\t\t\t\t}\n\n\t\t\t\tconst splits: Array<{ start: number, end: number }> = this.#smileyParser.parse(text);\n\t\t\t\tif (splits.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(text);\n\t\t\t\t}\n\n\t\t\t\t// console.log('splits', splits);\n\n\t\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\t\tlet currentIndex = 0;\n\t\t\t\tfor (const split of splits)\n\t\t\t\t{\n\t\t\t\t\tif (currentIndex < split.start)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst chunk = document.createTextNode(text.slice(currentIndex, split.start));\n\t\t\t\t\t\tfragment.appendChild(chunk);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst typing = text.slice(split.start, split.end);\n\t\t\t\t\tconst smiley = SmileyManager.get(typing);\n\t\t\t\t\tif (smiley === null)\n\t\t\t\t\t{\n\t\t\t\t\t\tfragment.appendChild(document.createTextNode(typing));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfragment.appendChild(this.createImg(smiley));\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentIndex = split.end;\n\t\t\t\t}\n\n\t\t\t\tif (currentIndex < text.length)\n\t\t\t\t{\n\t\t\t\t\tconst tail = document.createTextNode(text.slice(currentIndex));\n\t\t\t\t\tfragment.appendChild(tail);\n\t\t\t\t}\n\n\t\t\t\treturn fragment;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.#smileyParser = new SmileyParser(SmileyManager.getAll());\n\t}\n\n\tcreateImg(smiley: Smiley): HTMLImageElement\n\t{\n\t\tconst img: HTMLImageElement = document.createElement('img');\n\t\timg.src = encodeURI(smiley.getImage());\n\t\timg.className = 'ui-typography-smiley';\n\t\timg.alt = smiley.getTyping();\n\t\tif (smiley.getWidth() > 0 && smiley.getHeight() > 0)\n\t\t{\n\t\t\timg.width = smiley.getWidth();\n\t\t\timg.height = smiley.getHeight();\n\t\t}\n\n\t\treturn img;\n\t}\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class TabNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#tab',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text {\n\t\t\t\tif (node.getParent().getName() === 'code')\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t}\n\n\t\t\t\treturn document.createTextNode(' ');\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class LinebreakNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#linebreak',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text | HTMLBRElement {\n\t\t\t\treturn document.createElement('br');\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { type BBCodeElementNode, type BBCodeScheme } from 'ui.bbcode.model';\n\nexport function normalizeLineBreaks(node: BBCodeElementNode): BBCodeElementNode\n{\n\tconst scheme: BBCodeScheme = node.getScheme();\n\n\t// To avoid a height collapsing for empty elements we need to add an additional <br> (<p></p> => <p><br></p>).\n\t// If we end an element with a LineBreakNode, then we need to add an additional <br>.\n\t// A browser doesn't render the last <br> (<p>text<br></p>).\n\n\tnode.appendChild(scheme.createNewLine());\n\n\treturn node;\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeLineBreaks } from '../../helpers/normalize-line-breaks';\n\nexport class ParagraphNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'p',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLParagraphElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: node.getName(),\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-paragraph',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeLineBreaks(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class BoldNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'b',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'b',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-bold',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class UnderlineNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'u',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'u',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-underline',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ItalicNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'i',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'i',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-italic',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class StrikethroughNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 's',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 's',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-strikethrough',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\n\nexport class TableNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'table',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'table',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class TableHeadCellNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'th',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'th',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-cell ui-typography-table-cell-header',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class TableDataCellNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'td',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'td',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-cell',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\n\nexport class TableRowNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'tr',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'tr',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-row',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ListNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: 'list',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLUListElement | HTMLOListElement {\n\t\t\t\tconst tagName = node.getValue() === '1' ? 'ol' : 'ul';\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: tagName,\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: `ui-typography-${tagName}`,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ListItemNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: '*',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLLIElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'li',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-li',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class QuoteNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'quote',\n\t\t\tconvert(): HTMLQuoteElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'blockquote',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-quote',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype BeforeConvertCallbackOptions,\n\ttype ConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { type BBCodeNode } from 'ui.bbcode.model';\nimport { CodeParser, type CodeToken } from 'ui.code-parser';\nimport { normalizeLineBreaks } from '../../helpers/normalize-line-breaks';\n\nexport class CodeNodeFormatter extends NodeFormatter\n{\n\t#codeParser: CodeParser = new CodeParser();\n\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'code',\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeLineBreaks(node);\n\t\t\t},\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\tconst content = node.getTextContent();\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'code',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-code',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tdecorator: true,\n\t\t\t\t\t},\n\t\t\t\t\tchildren: getCodeTokenNodes(this.#codeParser.parse(content)),\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n\nfunction getCodeTokenNodes(tokens: Array<CodeToken>): Array<Text | HTMLElement>\n{\n\tconst nodes: Array<Text | HTMLElement>[] = [];\n\ttokens.forEach((token: CodeToken): void => {\n\t\tconst partials: string[] = token.content.split(/([\\t\\n])/);\n\t\tconst partialsLength: number = partials.length;\n\t\tfor (let i = 0; i < partialsLength; i++)\n\t\t{\n\t\t\tconst part: string = partials[i];\n\t\t\tif (part === '\\n' || part === '\\r\\n')\n\t\t\t{\n\t\t\t\tnodes.push(document.createElement('br'));\n\t\t\t}\n\t\t\telse if (part === '\\t')\n\t\t\t{\n\t\t\t\tnodes.push(document.createTextNode('\\t'));\n\t\t\t}\n\t\t\telse if (part.length > 0)\n\t\t\t{\n\t\t\t\tconst span = document.createElement('span');\n\t\t\t\tspan.className = `ui-typography-token-${token.type}`;\n\t\t\t\tspan.textContent = part;\n\t\t\t\tnodes.push(span);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn nodes;\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype AfterCallbackOptions,\n\ttype ConvertCallbackOptions,\n\ttype ValidateCallbackOptions,\n} from 'ui.bbcode.formatter';\nimport type { BBCodeContentNode } from 'ui.bbcode.model';\nimport {\n\tBBCodeElementNode,\n\tBBCodeRootNode,\n\tBBCodeScheme,\n} from 'ui.bbcode.model';\n\nexport class LinkNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'url',\n\t\t\tvalidate({ node }: ValidateCallbackOptions): boolean {\n\t\t\t\tconst nodeValue: string = LinkNodeFormatter.fetchNodeValue(node);\n\n\t\t\t\treturn !LinkNodeFormatter.startsWithJavascriptScheme(nodeValue);\n\t\t\t},\n\t\t\tbefore({ node, formatter }: AfterCallbackOptions): BBCodeElementNode {\n\t\t\t\tif (formatter.isShortLinkEnabled())\n\t\t\t\t{\n\t\t\t\t\tconst isIncludeImg: boolean = node.getChildren().some((node: BBCodeContentNode) => {\n\t\t\t\t\t\treturn node.getName() === 'img';\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!isIncludeImg)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst scheme: BBCodeScheme = node.getScheme();\n\t\t\t\t\t\tconst nodeContentLength: number = node.getPlainTextLength();\n\t\t\t\t\t\tconst { shortLink } = formatter.getLinkSettings();\n\t\t\t\t\t\tif (nodeContentLength > shortLink.maxLength)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst sourceHref: string = LinkNodeFormatter.fetchNodeValue(node);\n\n\t\t\t\t\t\t\tconst nodeRoot: BBCodeRootNode = scheme.createRoot({\n\t\t\t\t\t\t\t\tchildren: node.getChildren(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst [left, right] = nodeRoot.split({\n\t\t\t\t\t\t\t\toffset: shortLink.maxLength - shortLink.lastFragmentLength,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst sourceRightFragmentLength: number = right.getPlainTextLength();\n\t\t\t\t\t\t\tconst newLink: BBCodeElementNode = node.clone();\n\t\t\t\t\t\t\tnewLink.setValue(sourceHref);\n\n\t\t\t\t\t\t\tif (sourceRightFragmentLength > shortLink.lastFragmentLength)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnewLink.appendChild(\n\t\t\t\t\t\t\t\t\t...left.getChildren(),\n\t\t\t\t\t\t\t\t\tscheme.createText('...'),\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tconst [, lastFragment] = right.split({\n\t\t\t\t\t\t\t\t\toffset: sourceRightFragmentLength - shortLink.lastFragmentLength,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tnewLink.appendChild(...lastFragment.getChildren());\n\n\t\t\t\t\t\t\t\treturn newLink;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnewLink.setChildren([\n\t\t\t\t\t\t\t\t...left.getChildren(),\n\t\t\t\t\t\t\t\tscheme.createText('...'),\n\t\t\t\t\t\t\t\t...right.getChildren(),\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t\treturn newLink;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLLinkElement | HTMLUnknownElement {\n\t\t\t\tconst sourceHref: string = (() => {\n\t\t\t\t\tconst value: ?string = node.getValue();\n\t\t\t\t\tif (Type.isStringFilled(value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node.getContent();\n\t\t\t\t})();\n\t\t\t\tconst nodeAttributes: {[key: string]: string} = node.getAttributes();\n\t\t\t\tconst { defaultTarget = '_blank', attributes } = formatter.getLinkSettings();\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'a',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...nodeAttributes,\n\t\t\t\t\t\t...attributes,\n\t\t\t\t\t\thref: sourceHref,\n\t\t\t\t\t\ttarget: defaultTarget,\n\t\t\t\t\t\tclassName: 'ui-typography-link',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n\n\tstatic fetchNodeValue(node: BBCodeElementNode): string\n\t{\n\t\tconst value: ?string = node.getValue();\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\treturn value;\n\t\t}\n\n\t\treturn node.toPlainText();\n\t}\n\n\tstatic startsWithJavascriptScheme(sourceHref: string): boolean\n\t{\n\t\tif (Type.isStringFilled(sourceHref))\n\t\t{\n\t\t\t// eslint-disable-next-line no-control-regex\n\t\t\tconst regexp = /^[\\u0000-\\u001F ]*j[\\t\\n\\r]*a[\\t\\n\\r]*v[\\t\\n\\r]*a[\\t\\n\\r]*s[\\t\\n\\r]*c[\\t\\n\\r]*r[\\t\\n\\r]*i[\\t\\n\\r]*p[\\t\\n\\r]*t[\\t\\n\\r]*:/i;\n\n\t\t\treturn regexp.test(sourceHref);\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","import { Dom, Type, Loc } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype AfterCallbackOptions,\n\ttype NodeFormatterOptions,\n\ttype ConvertCallbackOptions,\n\ttype BeforeConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\nimport type { BBCodeNode } from 'ui.bbcode.model';\n\nexport class SpoilerNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'spoiler',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLDetailsElement {\n\t\t\t\tconst value = node.getValue().trim();\n\t\t\t\tconst title = Type.isStringFilled(value) ? value : Loc.getMessage('HTML_FORMATTER_SPOILER_TITLE');\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'details',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-spoiler ui-icon-set__scope',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create({\n\t\t\t\t\t\t\ttag: 'summary',\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\tclassName: 'ui-typography-spoiler-title',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: title,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\tafter({ element }: AfterCallbackOptions): HTMLElement {\n\t\t\t\tconst [summary, ...content] = element.children;\n\n\t\t\t\telement.appendChild(summary);\n\t\t\t\telement.appendChild(\n\t\t\t\t\tDom.create({\n\t\t\t\t\t\ttag: 'div',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'ui-typography-spoiler-content',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tspoilerContent: 'true',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t...content,\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\treturn element;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class UserNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: 'user',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.user))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.user;\n\t\t\t\t\tconst userUrl: string = urlTemplate.replaceAll('#ID#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: userUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tmentionEntityId: 'user',\n\t\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tmentionEntityId: 'user',\n\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class DepartmentNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'department',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement | HTMLSpanElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.department))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.department;\n\t\t\t\t\tconst departmentUrl: string = urlTemplate.replaceAll('#ID#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: departmentUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tmentionEntityId: 'department',\n\t\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tmentionEntityId: 'department',\n\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class ProjectNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'project',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement | HTMLSpanElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.project))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.project;\n\t\t\t\t\tconst projectUrl: string = urlTemplate.replaceAll('#group_id#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: projectUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tmentionEntityId: 'project',\n\t\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tmentionEntityId: 'project',\n\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\n\nexport function createImageNode({ src, width, height }): HTMLSpanElement\n{\n\treturn Dom.create({\n\t\ttag: 'span',\n\t\tattrs: {\n\t\t\tclassName: 'ui-typography-image-container',\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t},\n\t\tchildren: [\n\t\t\tDom.create({\n\t\t\t\ttag: 'img',\n\t\t\t\tattrs: {\n\t\t\t\t\tsrc,\n\t\t\t\t\tclassName: 'ui-typography-image',\n\t\t\t\t\twidth,\n\t\t\t\t\tloading: 'lazy',\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\taspectRatio: width > 0 && height > 0 ? `${width} / ${height}` : 'auto',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\terror: (event) => {\n\t\t\t\t\t\tconst img: HTMLImageElement = event.target;\n\t\t\t\t\t\timg.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\t\t\t\t\t\tDom.addClass(img.parentNode, '--error ui-icon-set__scope');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t],\n\t});\n}\n","export function validateImageUrl(url: string): boolean\n{\n\treturn /^(http:|https:|ftp:|\\/)/i.test(url);\n}\n","import { Type } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { createImageNode } from '../../helpers/create-image-node';\nimport { validateImageUrl } from '../../helpers/validate-image-url';\n\nexport class ImageNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'img',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLSpanElement {\n\t\t\t\t// [img]{url}[/img]\n\t\t\t\t// [img width={width} height={height}]{url}[/img]\n\t\t\t\tconst src = node.getContent().trim();\n\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : null;\n\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : null;\n\n\t\t\t\tif (validateImageUrl(src))\n\t\t\t\t{\n\t\t\t\t\treturn createImageNode({ src, width, height });\n\t\t\t\t}\n\n\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\n\nexport function createVideoNode({ url, width, height, type }): HTMLSpanElement\n{\n\tconst video: HTMLVideoElement = Dom.create({\n\t\ttag: 'video',\n\t\tattrs: {\n\t\t\tcontrols: true,\n\t\t\tclassName: 'ui-typography-video-object',\n\t\t\tpreload: 'metadata',\n\t\t\tplaysinline: true,\n\t\t\tsrc: url,\n\t\t\twidth,\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t},\n\t\tstyle: {\n\t\t\taspectRatio: width > 0 && height > 0 ? `${width} / ${height}` : 'auto',\n\t\t},\n\t\t/* children: [\n\t\t\tDom.create({\n\t\t\t\ttag: 'source',\n\t\t\t\tattrs: {\n\t\t\t\t\ttype,\n\t\t\t\t\tsrc: url,\n\t\t\t\t},\n\t\t\t}),\n\t\t], */\n\t});\n\n\treturn Dom.create({\n\t\ttag: 'span',\n\t\tattrs: {\n\t\t\tclassName: 'ui-typography-video-container',\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t},\n\t\tchildren: [video],\n\t});\n}\n","import { Type } from 'main.core';\n\n// eslint-disable-next-line no-control-regex\nconst ATTRIBUTE_WHITESPACES = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g;\nconst SAFE_URL = /^(?:(?:https?|ftps?|mailto):|[^a-z]|[+.a-z-]+(?:[^+.:a-z-]|$))/i;\n\nexport function sanitizeUrl(url: string): string\n{\n\tif (!Type.isStringFilled(url))\n\t{\n\t\treturn '';\n\t}\n\n\tconst normalizedUrl = url.replaceAll(ATTRIBUTE_WHITESPACES, '');\n\n\treturn SAFE_URL.test(normalizedUrl) ? normalizedUrl : '';\n}\n","export function validateVideoUrl(url: string): boolean\n{\n\treturn /^(http:|https:|\\/)/i.test(url);\n}\n","import { Dom, Type, Uri } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { VideoService } from 'ui.video-service';\nimport { createVideoNode } from '../../helpers/create-video-node';\nimport { sanitizeUrl } from '../../helpers/sanitize-url';\nimport { validateVideoUrl } from '../../helpers/validate-video-url';\n\nexport class VideoNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'video',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLSpanElement {\n\t\t\t\t// [video type={type} width={width} height={height}]{url}[/video]\n\t\t\t\tconst src = sanitizeUrl(node.getContent().trim());\n\t\t\t\tif (!validateVideoUrl(src))\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t}\n\n\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : 560;\n\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : 315;\n\n\t\t\t\tconst url = /^https?:/.test(src) ? src : `https://${src.replace(/^\\/\\//, '')}`;\n\t\t\t\tconst uri = new Uri(url);\n\t\t\t\tconst trusted = VideoService.createByHost(uri.getHost()) !== null;\n\t\t\t\tif (trusted)\n\t\t\t\t{\n\t\t\t\t\tconst video: HTMLIFrameElement = Dom.create({\n\t\t\t\t\t\ttag: 'iframe',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tsrc,\n\t\t\t\t\t\t\tclassName: 'ui-typography-video-object',\n\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\theight: 'auto',\n\t\t\t\t\t\t\tframeborder: 0,\n\t\t\t\t\t\t\tallowfullscreen: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\taspectRatio: `${width} / ${height}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'span',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'ui-typography-video-container',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tdecorator: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [video],\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// const path = uri.getPath();\n\t\t\t\t// const position: number = path.lastIndexOf('.');\n\t\t\t\t// const extension = position >= 0 ? path.slice(Math.max(0, position + 1)).toLowerCase() : '';\n\t\t\t\t// const type = ['mp4', 'webm', 'mov'].includes(extension) ? `video/${extension}` : null;\n\n\t\t\t\treturn createVideoNode({ url, width, height });\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type, Text } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatter } from 'ui.bbcode.formatter.html-formatter';\nimport type { UploaderFileInfo } from 'ui.uploader.core';\nimport { createImageNode } from '../../helpers/create-image-node';\nimport { createVideoNode } from '../../helpers/create-video-node';\n\nexport class FileNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tconst formatter: HtmlFormatter = options.formatter;\n\t\tconst fileMode = formatter.getFileMode();\n\n\t\tsuper({\n\t\t\tname: fileMode || '__unknown__',\n\t\t\tconvert({ node, data }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\tif (fileMode === null)\n\t\t\t\t{\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t\t// [DISK FILE ID=n14194]\n\t\t\t\t// [DISK FILE ID=14194]\n\n\t\t\t\t// [FILE ID=5b87ba3b-edb1-49df-a840-50d17b6c3e8c.fbbdd477d5ff19d61...a875e731fa89cfd1e1]\n\t\t\t\t// [FILE ID=14194]\n\t\t\t\tconst serverFileId = node.getAttribute('id');\n\t\t\t\tconst createTextNode = () => {\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\t!Type.isStringFilled(serverFileId)\n\t\t\t\t\t|| (fileMode === 'disk' && !/^n?\\d+$/i.test(serverFileId))\n\t\t\t\t\t|| (fileMode === 'file' && !/^(\\d+|[\\da-f-]{36}\\.[\\da-f]{32,})$/i.test(serverFileId))\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn createTextNode();\n\t\t\t\t}\n\n\t\t\t\tconst info: UploaderFileInfo = data?.files?.find((file: UploaderFileInfo): boolean => {\n\t\t\t\t\treturn file.serverFileId.toString() === serverFileId.toString();\n\t\t\t\t});\n\n\t\t\t\tif (!info)\n\t\t\t\t{\n\t\t\t\t\treturn createTextNode();\n\t\t\t\t}\n\n\t\t\t\tif (info.isImage)\n\t\t\t\t{\n\t\t\t\t\tlet width = Text.toInteger(node.getAttribute('width'));\n\t\t\t\t\tlet height = Text.toInteger(node.getAttribute('height'));\n\n\t\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : info.serverPreviewWidth;\n\t\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : info.serverPreviewHeight;\n\n\t\t\t\t\treturn createImageNode({\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\theight,\n\t\t\t\t\t\tsrc: info.serverPreviewUrl,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (info.isVideo)\n\t\t\t\t{\n\t\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : 600;\n\t\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : null;\n\n\t\t\t\t\treturn createVideoNode({ url: info.downloadUrl, width, height });\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'a',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\thref: info.downloadUrl,\n\t\t\t\t\t\tclassName: 'ui-typography-link',\n\t\t\t\t\t},\n\t\t\t\t\ttext: info.name || 'unknown',\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tfileId: info.serverFileId,\n\t\t\t\t\t\tfileInfo: JSON.stringify(info),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Type, Extension } from 'main.core';\nimport {\n\tFormatter,\n\tNodeFormatter,\n\ttype FormatterOptions,\n\ttype UnknownNodeCallbackOptions,\n\ttype BeforeConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\nimport { BBCodeScheme, BBCodeFragmentNode } from 'ui.bbcode.model';\nimport * as NodeFormatters from './node-formatters';\n\nimport 'ui.typography';\n\nexport type HtmlFormatterOptions = FormatterOptions & {\n\tlinkSettings?: {\n\t\tallowedSchemes?: string,\n\t\tdefaultScheme?: 'http',\n\t\tdefaultTarget?: '_self' | '_blank' | '_parent' | '_top',\n\t\tshortLink: {\n\t\t\tenabled?: boolean,\n\t\t\tmaxLength?: number,\n\t\t\tlastFragmentLength?: number,\n\t\t},\n\t\tattributes?: {\n\t\t\t[key: string]: string,\n\t\t},\n\t},\n\tmention: {\n\t\turlTemplate: {\n\t\t\tuser: string,\n\t\t\tproject: string,\n\t\t\tdepartment: string,\n\t\t},\n\t},\n\tfileMode: 'disk' | 'file',\n\tcontainerMode: 'none' | 'void' | 'collapsed',\n};\n\nconst globalSettings = Extension.getSettings('ui.bbcode.formatter.html-formatter');\n\n/**\n * @memberOf BX.UI.BBCode.Formatter\n */\nexport class HtmlFormatter extends Formatter\n{\n\t#linkSettings: HtmlFormatterOptions['linkSettings'];\n\t#mentionSettings: HtmlFormatterOptions['mention'];\n\t#fileMode: HtmlFormatterOptions['fileMode'];\n\t#containerMode: HtmlFormatterOptions['container'];\n\n\tconstructor(options: HtmlFormatterOptions = {})\n\t{\n\t\tsuper();\n\n\t\tthis.setLinkSettings({\n\t\t\t...globalSettings.linkSettings,\n\t\t\t...options.linkSettings,\n\t\t});\n\n\t\tthis.setMentionSettings({\n\t\t\t...globalSettings.mention,\n\t\t\t...options.mention,\n\t\t});\n\n\t\tthis.#fileMode = ['file', 'disk'].includes(options.fileMode) ? options.fileMode : null;\n\n\t\tconst defaultFormatters = Object.values(NodeFormatters).map((FormatterClass: NodeFormatter) => {\n\t\t\treturn new FormatterClass({ formatter: this });\n\t\t});\n\n\t\tthis.setContainerMode(options.containerMode);\n\t\tthis.setNodeFormatters(defaultFormatters);\n\t\tthis.setNodeFormatters(options.formatters);\n\t}\n\n\tisShortLinkEnabled(): boolean\n\t{\n\t\tconst { shortLink } = this.getLinkSettings();\n\n\t\treturn (\n\t\t\tType.isPlainObject(shortLink)\n\t\t\t&& shortLink.enabled === true\n\t\t\t&& Type.isInteger(shortLink.maxLength)\n\t\t);\n\t}\n\n\tsetLinkSettings(settings: HtmlFormatterOptions['linkSettings'])\n\t{\n\t\tthis.#linkSettings = { ...settings };\n\t}\n\n\tgetLinkSettings(): HtmlFormatterOptions['linkSettings']\n\t{\n\t\treturn this.#linkSettings;\n\t}\n\n\tgetFileMode(): HtmlFormatterOptions['fileMode'] | null\n\t{\n\t\treturn this.#fileMode;\n\t}\n\n\tsetMentionSettings(settings: HtmlFormatterOptions['mention'])\n\t{\n\t\tthis.#mentionSettings = { ...settings };\n\t}\n\n\tgetMentionSettings(): HtmlFormatterOptions['mention']\n\t{\n\t\treturn this.#mentionSettings;\n\t}\n\n\tsetContainerMode(mode: HtmlFormatterOptions['containerMode']): void\n\t{\n\t\tthis.#containerMode = mode;\n\t}\n\n\tgetContainerMode(): HtmlFormatterOptions['container']\n\t{\n\t\treturn this.#containerMode;\n\t}\n\n\tisElement(source): boolean\n\t{\n\t\tif (source.nodeType === Node.DOCUMENT_FRAGMENT_NODE)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (source.nodeType !== Node.ELEMENT_NODE || this.#isVoidElement(source))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Type.isUndefined(source.dataset.decorator);\n\t}\n\n\t#isVoidElement(source): boolean\n\t{\n\t\treturn ['img', 'br', 'hr', 'input'].includes(source.tagName.toLowerCase());\n\t}\n\n\tgetDefaultUnknownNodeCallback(options): (UnknownNodeCallbackOptions) => NodeFormatter | null\n\t{\n\t\treturn () => {\n\t\t\treturn new NodeFormatter({\n\t\t\t\tname: 'unknown',\n\t\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeFragmentNode {\n\t\t\t\t\tconst scheme: BBCodeScheme = node.getScheme();\n\n\t\t\t\t\tif (node.isVoid())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn scheme.createFragment({\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tscheme.createText(node.getOpeningTag()),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn scheme.createFragment({\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tscheme.createText(node.getOpeningTag()),\n\t\t\t\t\t\t\t...node.getChildren(),\n\t\t\t\t\t\t\tscheme.createText(node.getClosingTag()),\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tconvert(): DocumentFragment {\n\t\t\t\t\treturn document.createDocumentFragment();\n\t\t\t\t},\n\t\t\t});\n\t\t};\n\t}\n}\n","import { Dom } from 'main.core';\nimport { HtmlFormatter } from './html-formatter';\n\nexport const HtmlFormatterComponent = {\n\tprops: {\n\t\tbbcode: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\t/** @type HtmlFormatterOptions */\n\t\toptions: {\n\t\t\ttype: Object,\n\t\t\tdefault: undefined,\n\t\t},\n\t\t/** @type FormatterData */\n\t\tformatData: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({}),\n\t\t},\n\t},\n\tbeforeCreate(): void\n\t{\n\t\tthis.htmlFormatter = null;\n\t},\n\tmounted(): void\n\t{\n\t\tthis.format();\n\t},\n\tunmounted(): void\n\t{\n\t\tthis.htmlFormatter = null;\n\t},\n\twatch: {\n\t\tbbcode(): void\n\t\t{\n\t\t\tthis.format();\n\t\t},\n\t\tformatData(): void\n\t\t{\n\t\t\tthis.format();\n\t\t},\n\t},\n\tmethods: {\n\t\tformat(): void\n\t\t{\n\t\t\tconst result = this.getHtmlFormatter().format({ source: this.bbcode, data: this.formatData });\n\n\t\t\tDom.clean(this.$el);\n\t\t\tDom.append(result, this.$el);\n\t\t},\n\t\tgetHtmlFormatter(): HtmlFormatter\n\t\t{\n\t\t\tthis.htmlFormatter ??= new HtmlFormatter(this.options);\n\n\t\t\treturn this.htmlFormatter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-typography-container\"></div>\n\t`,\n};\n"],"names":["createEmptyParagraphs","scheme","count","result","i","push","createElement","name","shouldWrapInParagraph","node","getType","BBCodeNode","ELEMENT_NODE","hasGroup","wrapTextNodes","nodes","currentParagraph","lineBreaks","isNewLine","appendChild","createNewLine","length","normalizeTextNodes","getScheme","children","getChildren","setChildren","RootNodeFormatter","NodeFormatter","constructor","options","convert","document","createDocumentFragment","before","after","element","formatter","mode","getContainerMode","container","Tag","render","findParent","startingNode","findFn","curr","ROOT_NODE","getParent","TextNodeFormatter","text","toString","encode","parent","getName","createTextNode","splits","parse","fragment","currentIndex","split","start","chunk","slice","typing","end","smiley","SmileyManager","get","createImg","tail","SmileyParser","getAll","img","src","encodeURI","getImage","className","alt","getTyping","getWidth","getHeight","width","height","TabNodeFormatter","LinebreakNodeFormatter","normalizeLineBreaks","ParagraphNodeFormatter","Dom","create","tag","attrs","BoldNodeFormatter","getAttributes","UnderlineNodeFormatter","ItalicNodeFormatter","StrikethroughNodeFormatter","TableNodeFormatter","classname","TableHeadCellNodeFormatter","TableDataCellNodeFormatter","TableRowNodeFormatter","ListNodeFormatter","tagName","getValue","ListItemNodeFormatter","QuoteNodeFormatter","CodeNodeFormatter","content","getTextContent","dataset","decorator","getCodeTokenNodes","CodeParser","tokens","forEach","token","partials","partialsLength","part","span","type","textContent","LinkNodeFormatter","validate","nodeValue","fetchNodeValue","startsWithJavascriptScheme","isShortLinkEnabled","isIncludeImg","some","nodeContentLength","getPlainTextLength","shortLink","getLinkSettings","maxLength","sourceHref","nodeRoot","createRoot","left","right","offset","lastFragmentLength","sourceRightFragmentLength","newLink","clone","setValue","createText","lastFragment","value","Type","isStringFilled","getContent","nodeAttributes","defaultTarget","attributes","href","target","toPlainText","regexp","test","SpoilerNodeFormatter","trim","title","Loc","getMessage","summary","spoilerContent","UserNodeFormatter","mentionSettings","getMentionSettings","urlTemplate","user","userUrl","replaceAll","mentionEntityId","mentionId","DepartmentNodeFormatter","department","departmentUrl","ProjectNodeFormatter","project","projectUrl","createImageNode","loading","style","aspectRatio","events","error","event","addClass","parentNode","validateImageUrl","url","ImageNodeFormatter","Number","getAttribute","isNumber","Math","round","createVideoNode","video","controls","preload","playsinline","ATTRIBUTE_WHITESPACES","SAFE_URL","sanitizeUrl","normalizedUrl","validateVideoUrl","VideoNodeFormatter","replace","uri","Uri","trusted","VideoService","createByHost","getHost","frameborder","allowfullscreen","FileNodeFormatter","fileMode","getFileMode","data","serverFileId","info","files","find","file","isImage","Text","toInteger","serverPreviewWidth","serverPreviewHeight","serverPreviewUrl","isVideo","downloadUrl","fileId","fileInfo","JSON","stringify","globalSettings","Extension","getSettings","HtmlFormatter","Formatter","setLinkSettings","linkSettings","setMentionSettings","mention","includes","defaultFormatters","Object","values","NodeFormatters","map","FormatterClass","setContainerMode","containerMode","setNodeFormatters","formatters","isPlainObject","enabled","isInteger","settings","isElement","source","nodeType","Node","DOCUMENT_FRAGMENT_NODE","isUndefined","getDefaultUnknownNodeCallback","isVoid","createFragment","getOpeningTag","getClosingTag","toLowerCase","HtmlFormatterComponent","props","bbcode","String","default","undefined","formatData","beforeCreate","htmlFormatter","mounted","format","unmounted","watch","methods","getHtmlFormatter","clean","$el","append","template"],"mappings":";;;;;;;CAEO,SAASA,qBAAqB,CAACC,MAAoB,EAAEC,KAAa,GAAG,CAAC,EAC7E;GACC,MAAMC,MAAM,GAAG,EAAE;GACjB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,KAAK,EAAEE,CAAC,EAAE,EAC9B;KACCD,MAAM,CAACE,IAAI,CAACJ,MAAM,CAACK,aAAa,CAAC;OAAEC,IAAI,EAAE;MAAK,CAAC,CAAC;;GAGjD,OAAOJ,MAAM;CACd;;CCTO,SAASK,qBAAqB,CAACC,IAAoC,EAC1E;GACC,OAAOA,IAAI,CAACC,OAAO,EAAE,KAAKC,0BAAU,CAACC,YAAY,IAAIH,IAAI,CAACI,QAAQ,CAAC,SAAS,CAAC,IAAIJ,IAAI,CAACI,QAAQ,CAAC,cAAc,CAAC;CAC/G;;CCDO,SAASC,aAAa,CAACC,KAAwB,EAAEd,MAAoB,EAC5E;GACC,MAAME,MAAM,GAAG,EAAE;GACjB,IAAIa,gBAAgB,GAAG,IAAI;GAC3B,IAAIC,UAAU,GAAG,CAAC;GAElB,KAAK,MAAMR,IAAI,IAAIM,KAAK,EACxB;KACC,IAAId,MAAM,CAACiB,SAAS,CAACT,IAAI,CAAC,EAC1B;OACCQ,UAAU,EAAE;OAEZ;;KAGD,IAAIT,qBAAqB,CAACC,IAAI,CAAC,EAC/B;OACC,IAAIO,gBAAgB,KAAK,IAAI,IAAIC,UAAU,IAAI,CAAC,EAChD;SACCd,MAAM,CAACE,IAAI,CAAC,GAAGL,qBAAqB,CAACC,MAAM,EAAEgB,UAAU,GAAG,CAAC,CAAC,CAAC;SAC7DD,gBAAgB,GAAGf,MAAM,CAACK,aAAa,CAAC;WAAEC,IAAI,EAAE;UAAK,CAAC;SACtDJ,MAAM,CAACE,IAAI,CAACW,gBAAgB,CAAC;QAC7B,MACI,IAAIC,UAAU,KAAK,CAAC,EACzB;SACCD,gBAAgB,CAACG,WAAW,CAAClB,MAAM,CAACmB,aAAa,EAAE,CAAC;;OAGrDJ,gBAAgB,CAACG,WAAW,CAACV,IAAI,CAAC;MAClC,MAED;OACC,IAAIQ,UAAU,GAAG,CAAC,EAClB;SACCd,MAAM,CAACE,IAAI,CAAC,GAAGL,qBAAqB,CAACC,MAAM,EAAEgB,UAAU,GAAG,CAAC,CAAC,CAAC;;OAG9Dd,MAAM,CAACE,IAAI,CAACI,IAAI,CAAC;OACjBO,gBAAgB,GAAG,IAAI;;KAGxBC,UAAU,GAAG,CAAC;;;;GAIf,IAAId,MAAM,CAACkB,MAAM,KAAK,CAAC,EACvB;KACC,OAAO,CAACpB,MAAM,CAACK,aAAa,CAAC;OAAEC,IAAI,EAAE;MAAK,CAAC,CAAC;;GAG7C,OAAOJ,MAAM;CACd;;CCpDO,SAASmB,kBAAkB,CAACb,IAAuB,EAC1D;GACC,MAAMR,MAAoB,GAAGQ,IAAI,CAACc,SAAS,EAAE;GAC7C,MAAMC,QAAkC,GAAGV,aAAa,CAACL,IAAI,CAACgB,WAAW,EAAE,EAAExB,MAAM,CAAC;GACpFQ,IAAI,CAACiB,WAAW,CAACF,QAAQ,CAAC;GAE1B,OAAOf,IAAI;CACZ;;;;ACVA,CAWO,MAAMkB,iBAAiB,SAASC,iCAAa,CACpD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,OAAO;OACbwB,OAAO,GAAqB;SAC3B,OAAOC,QAAQ,CAACC,sBAAsB,EAAE;QACxC;OACDC,MAAM,CAAC;SAAEzB;QAAoC,EAAc;SAC1D,OAAOa,kBAAkB,CAACb,IAAI,CAAC;QAC/B;OACD0B,KAAK,CAAC;SAAEC,OAAO;SAAEC;QAAiC,EAAe;SAChE,MAAMC,IAAI,GAAGD,SAAS,CAACE,gBAAgB,EAAE;SACzC,IAAID,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,WAAW,EAC3C;WACC,MAAME,SAAS,GAAGC,aAAG,CAACC,MAAM,cAAC,yCAAsC,CAAO,UAAQ,GAAbJ,IAAI,CAAU;WACnFE,SAAS,CAACrB,WAAW,CAACiB,OAAO,CAAC;WAE9B,OAAOI,SAAS;;SAGjB,OAAOJ,OAAO;QACd;OACD,GAAGN;MACH,CAAC;;CAEJ;;CCpCO,SAASa,UAAU,CAACC,YAAwB,EAAEC,MAAqC,EAC1F;GACC,IAAIC,IAAuB,GAAGF,YAAY;GAC1C,OAAOE,IAAI,KAAK,IAAI,IAAIA,IAAI,CAACpC,OAAO,EAAE,KAAKC,0BAAU,CAACoC,SAAS,EAC/D;KACC,IAAIF,MAAM,CAACC,IAAI,CAAC,EAChB;OACC,OAAOA,IAAI;;KAGZA,IAAI,GAAGA,IAAI,CAACE,SAAS,EAAE;;GAGxB,OAAO,IAAI;CACZ;;CCbuD;AAEvD,CAAO,MAAMC,iBAAiB,SAASrB,iCAAa,CACpD;GAGCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAAE;KAC/C,KAAK,CAAC;OACLvB,IAAI,EAAE,OAAO;OACbwB,OAAO,CAAC;SAAEtB;QAA8B,EAAQ;SAC/C,MAAMyC,IAAI,GAAGzC,IAAI,CAAC0C,QAAQ,CAAC;WAAEC,MAAM,EAAE;UAAO,CAAC;SAC7C,IAAIT,UAAU,CAAClC,IAAI,EAAG4C,MAAkB,IAAKA,MAAM,CAACC,OAAO,EAAE,KAAK,MAAM,CAAC,EACzE;WACC,OAAOtB,QAAQ,CAACuB,cAAc,CAACL,IAAI,CAAC;;SAGrC,MAAMM,MAA6C,GAAG,4CAAI,gCAAeC,KAAK,CAACP,IAAI,CAAC;SACpF,IAAIM,MAAM,CAACnC,MAAM,KAAK,CAAC,EACvB;WACC,OAAOW,QAAQ,CAACuB,cAAc,CAACL,IAAI,CAAC;;;;;SAKrC,MAAMQ,QAAQ,GAAG1B,QAAQ,CAACC,sBAAsB,EAAE;SAClD,IAAI0B,YAAY,GAAG,CAAC;SACpB,KAAK,MAAMC,KAAK,IAAIJ,MAAM,EAC1B;WACC,IAAIG,YAAY,GAAGC,KAAK,CAACC,KAAK,EAC9B;aACC,MAAMC,KAAK,GAAG9B,QAAQ,CAACuB,cAAc,CAACL,IAAI,CAACa,KAAK,CAACJ,YAAY,EAAEC,KAAK,CAACC,KAAK,CAAC,CAAC;aAC5EH,QAAQ,CAACvC,WAAW,CAAC2C,KAAK,CAAC;;WAG5B,MAAME,MAAM,GAAGd,IAAI,CAACa,KAAK,CAACH,KAAK,CAACC,KAAK,EAAED,KAAK,CAACK,GAAG,CAAC;WACjD,MAAMC,MAAM,GAAGC,uBAAa,CAACC,GAAG,CAACJ,MAAM,CAAC;WACxC,IAAIE,MAAM,KAAK,IAAI,EACnB;aACCR,QAAQ,CAACvC,WAAW,CAACa,QAAQ,CAACuB,cAAc,CAACS,MAAM,CAAC,CAAC;YACrD,MAED;aACCN,QAAQ,CAACvC,WAAW,CAAC,IAAI,CAACkD,SAAS,CAACH,MAAM,CAAC,CAAC;;WAG7CP,YAAY,GAAGC,KAAK,CAACK,GAAG;;SAGzB,IAAIN,YAAY,GAAGT,IAAI,CAAC7B,MAAM,EAC9B;WACC,MAAMiD,IAAI,GAAGtC,QAAQ,CAACuB,cAAc,CAACL,IAAI,CAACa,KAAK,CAACJ,YAAY,CAAC,CAAC;WAC9DD,QAAQ,CAACvC,WAAW,CAACmD,IAAI,CAAC;;SAG3B,OAAOZ,QAAQ;QACf;OACD,GAAG5B;MACH,CAAC;KAAC;OAAA;OAAA,OArD0B;;KAuD7B,4CAAI,kCAAiB,IAAIyC,sBAAY,CAACJ,uBAAa,CAACK,MAAM,EAAE,CAAC;;GAG9DH,SAAS,CAACH,MAAc,EACxB;KACC,MAAMO,GAAqB,GAAGzC,QAAQ,CAAC1B,aAAa,CAAC,KAAK,CAAC;KAC3DmE,GAAG,CAACC,GAAG,GAAGC,SAAS,CAACT,MAAM,CAACU,QAAQ,EAAE,CAAC;KACtCH,GAAG,CAACI,SAAS,GAAG,sBAAsB;KACtCJ,GAAG,CAACK,GAAG,GAAGZ,MAAM,CAACa,SAAS,EAAE;KAC5B,IAAIb,MAAM,CAACc,QAAQ,EAAE,GAAG,CAAC,IAAId,MAAM,CAACe,SAAS,EAAE,GAAG,CAAC,EACnD;OACCR,GAAG,CAACS,KAAK,GAAGhB,MAAM,CAACc,QAAQ,EAAE;OAC7BP,GAAG,CAACU,MAAM,GAAGjB,MAAM,CAACe,SAAS,EAAE;;KAGhC,OAAOR,GAAG;;CAEZ;;CC7EO,MAAMW,gBAAgB,SAASxD,iCAAa,CACnD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAAE;KAC/C,KAAK,CAAC;OACLvB,IAAI,EAAE,MAAM;OACZwB,OAAO,CAAC;SAAEtB;QAA8B,EAAQ;SAC/C,IAAIA,IAAI,CAACuC,SAAS,EAAE,CAACM,OAAO,EAAE,KAAK,MAAM,EACzC;WACC,OAAOtB,QAAQ,CAACuB,cAAc,CAAC9C,IAAI,CAAC0C,QAAQ,EAAE,CAAC;;SAGhD,OAAOnB,QAAQ,CAACuB,cAAc,CAAC,GAAG,CAAC;QACnC;OACD,GAAGzB;MACH,CAAC;;CAEJ;;CChBO,MAAMuD,sBAAsB,SAASzD,iCAAa,CACzD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAAE;KAC/C,KAAK,CAAC;OACLvB,IAAI,EAAE,YAAY;OAClBwB,OAAO,CAAC;SAAEtB;QAA8B,EAAwB;SAC/D,OAAOuB,QAAQ,CAAC1B,aAAa,CAAC,IAAI,CAAC;QACnC;OACD,GAAGwB;MACH,CAAC;;CAEJ;;CCXO,SAASwD,mBAAmB,CAAC7E,IAAuB,EAC3D;GACC,MAAMR,MAAoB,GAAGQ,IAAI,CAACc,SAAS,EAAE;;;;;;GAM7Cd,IAAI,CAACU,WAAW,CAAClB,MAAM,CAACmB,aAAa,EAAE,CAAC;GAExC,OAAOX,IAAI;CACZ;;CCPO,MAAM8E,sBAAsB,SAAS3D,iCAAa,CACzD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,GAAG;OACTwB,OAAO,CAAC;SAAEtB;QAA8B,EAAwB;SAC/D,OAAO+E,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAEjF,IAAI,CAAC6C,OAAO,EAAE;WACnBqC,KAAK,EAAE;aACNd,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD3C,MAAM,CAAC;SAAEzB;QAAoC,EAAc;SAC1D,OAAO6E,mBAAmB,CAAC7E,IAAI,CAAC;QAChC;OACD,GAAGqB;MACH,CAAC;;CAEJ;;CCvBO,MAAM8D,iBAAiB,SAAShE,iCAAa,CACpD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,GAAG;OACTwB,OAAO,CAAC;SAAEtB;QAA8B,EAAe;SACtD,OAAO+E,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,GAAG;WACRC,KAAK,EAAE;aACN,GAAGlF,IAAI,CAACoF,aAAa,EAAE;aACvBhB,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAG/C;MACH,CAAC;;CAEJ;;CClBO,MAAMgE,sBAAsB,SAASlE,iCAAa,CACzD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,GAAG;OACTwB,OAAO,CAAC;SAAEtB;QAA8B,EAAe;SACtD,OAAO+E,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,GAAG;WACRC,KAAK,EAAE;aACN,GAAGlF,IAAI,CAACoF,aAAa,EAAE;aACvBhB,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAG/C;MACH,CAAC;;CAEJ;;CClBO,MAAMiE,mBAAmB,SAASnE,iCAAa,CACtD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,GAAG;OACTwB,OAAO,CAAC;SAAEtB;QAA8B,EAAe;SACtD,OAAO+E,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,GAAG;WACRC,KAAK,EAAE;aACN,GAAGlF,IAAI,CAACoF,aAAa,EAAE;aACvBhB,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAG/C;MACH,CAAC;;CAEJ;;CClBO,MAAMkE,0BAA0B,SAASpE,iCAAa,CAC7D;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,GAAG;OACTwB,OAAO,CAAC;SAAEtB;QAA8B,EAAe;SACtD,OAAO+E,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,GAAG;WACRC,KAAK,EAAE;aACN,GAAGlF,IAAI,CAACoF,aAAa,EAAE;aACvBhB,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAG/C;MACH,CAAC;;CAEJ;;CClBO,MAAMmE,kBAAkB,SAASrE,iCAAa,CACrD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,OAAO;OACbwB,OAAO,GAAqB;SAC3B,OAAOyD,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,OAAO;WACZC,KAAK,EAAE;aACNO,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAGpE;MACH,CAAC;;CAEJ;;CCdO,MAAMqE,0BAA0B,SAASvE,iCAAa,CAC7D;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,IAAI;OACVwB,OAAO,GAAqB;SAC3B,OAAOyD,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,IAAI;WACTC,KAAK,EAAE;aACNO,SAAS,EAAE;;UAEZ,CAAC;QACF;OACDhE,MAAM,CAAC;SAAEzB;QAAoC,EAAc;SAC1D,OAAOa,kBAAkB,CAACb,IAAI,CAAC;QAC/B;OACD,GAAGqB;MACH,CAAC;;CAEJ;;CCpBO,MAAMsE,0BAA0B,SAASxE,iCAAa,CAC7D;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,IAAI;OACVwB,OAAO,GAAqB;SAC3B,OAAOyD,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,IAAI;WACTC,KAAK,EAAE;aACNO,SAAS,EAAE;;UAEZ,CAAC;QACF;OACDhE,MAAM,CAAC;SAAEzB;QAAoC,EAAc;SAC1D,OAAOa,kBAAkB,CAACb,IAAI,CAAC;QAC/B;OACD,GAAGqB;MACH,CAAC;;CAEJ;;CCvBO,MAAMuE,qBAAqB,SAASzE,iCAAa,CACxD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,IAAI;OACVwB,OAAO,GAAqB;SAC3B,OAAOyD,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,IAAI;WACTC,KAAK,EAAE;aACNO,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAGpE;MACH,CAAC;;CAEJ;;CCjBO,MAAMwE,iBAAiB,SAAS1E,iCAAa,CACpD;GACCC,WAAW,CAACC,OAA6B,EACzC;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,MAAM;OACZwB,OAAO,CAAC;SAAEtB;QAA8B,EAAuC;SAC9E,MAAM8F,OAAO,GAAG9F,IAAI,CAAC+F,QAAQ,EAAE,KAAK,GAAG,GAAG,IAAI,GAAG,IAAI;SAErD,OAAOhB,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAEa,OAAO;WACZZ,KAAK,EAAE;aACN,GAAGlF,IAAI,CAACoF,aAAa,EAAE;aACvBhB,SAAS,EAAG,iBAAgB0B,OAAQ;;UAErC,CAAC;QACF;OACD,GAAGzE;MACH,CAAC;;CAEJ;;CCpBO,MAAM2E,qBAAqB,SAAS7E,iCAAa,CACxD;GACCC,WAAW,CAACC,OAA6B,EACzC;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,GAAG;OACTwB,OAAO,CAAC;SAAEtB;QAA8B,EAAiB;SACxD,OAAO+E,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,IAAI;WACTC,KAAK,EAAE;aACN,GAAGlF,IAAI,CAACoF,aAAa,EAAE;aACvBhB,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAG/C;MACH,CAAC;;CAEJ;;CCfO,MAAM4E,kBAAkB,SAAS9E,iCAAa,CACrD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,OAAO;OACbwB,OAAO,GAAqB;SAC3B,OAAOyD,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,YAAY;WACjBC,KAAK,EAAE;aACNd,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD3C,MAAM,CAAC;SAAEzB;QAAoC,EAAc;SAC1D,OAAOa,kBAAkB,CAACb,IAAI,CAAC;QAC/B;OAED,GAAGqB;MACH,CAAC;;CAEJ;;CCjB0E;AAE1E,CAAO,MAAM6E,iBAAiB,SAAS/E,iCAAa,CACpD;GAGCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,MAAM;OACZ2B,MAAM,CAAC;SAAEzB;QAAoC,EAAc;SAC1D,OAAO6E,mBAAmB,CAAC7E,IAAI,CAAC;QAChC;OACDsB,OAAO,CAAC;SAAEtB;QAA8B,EAAe;SACtD,MAAMmG,OAAO,GAAGnG,IAAI,CAACoG,cAAc,EAAE;SAErC,OAAOrB,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,MAAM;WACXC,KAAK,EAAE;aACNd,SAAS,EAAE;YACX;WACDiC,OAAO,EAAE;aACRC,SAAS,EAAE;YACX;WACDvF,QAAQ,EAAEwF,iBAAiB,CAAC,4CAAI,4BAAavD,KAAK,CAACmD,OAAO,CAAC;UAC3D,CAAC;QACF;OACD,GAAG9E;MACH,CAAC;KAAC;OAAA;OAAA,OAxBsB,IAAImF,wBAAU;;;CA0BzC;CAEA,SAASD,iBAAiB,CAACE,MAAwB,EACnD;GACC,MAAMnG,KAAkC,GAAG,EAAE;GAC7CmG,MAAM,CAACC,OAAO,CAAEC,KAAgB,IAAW;KAC1C,MAAMC,QAAkB,GAAGD,KAAK,CAACR,OAAO,CAAChD,KAAK,CAAC,UAAU,CAAC;KAC1D,MAAM0D,cAAsB,GAAGD,QAAQ,CAAChG,MAAM;KAC9C,KAAK,IAAIjB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkH,cAAc,EAAElH,CAAC,EAAE,EACvC;OACC,MAAMmH,IAAY,GAAGF,QAAQ,CAACjH,CAAC,CAAC;OAChC,IAAImH,IAAI,KAAK,IAAI,IAAIA,IAAI,KAAK,MAAM,EACpC;SACCxG,KAAK,CAACV,IAAI,CAAC2B,QAAQ,CAAC1B,aAAa,CAAC,IAAI,CAAC,CAAC;QACxC,MACI,IAAIiH,IAAI,KAAK,IAAI,EACtB;SACCxG,KAAK,CAACV,IAAI,CAAC2B,QAAQ,CAACuB,cAAc,CAAC,IAAI,CAAC,CAAC;QACzC,MACI,IAAIgE,IAAI,CAAClG,MAAM,GAAG,CAAC,EACxB;SACC,MAAMmG,IAAI,GAAGxF,QAAQ,CAAC1B,aAAa,CAAC,MAAM,CAAC;SAC3CkH,IAAI,CAAC3C,SAAS,GAAI,uBAAsBuC,KAAK,CAACK,IAAK,EAAC;SACpDD,IAAI,CAACE,WAAW,GAAGH,IAAI;SACvBxG,KAAK,CAACV,IAAI,CAACmH,IAAI,CAAC;;;IAGlB,CAAC;GAEF,OAAOzG,KAAK;CACb;;CCvDO,MAAM4G,iBAAiB,SAAS/F,iCAAa,CACpD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,KAAK;OACXqH,QAAQ,CAAC;SAAEnH;QAA+B,EAAW;SACpD,MAAMoH,SAAiB,GAAGF,iBAAiB,CAACG,cAAc,CAACrH,IAAI,CAAC;SAEhE,OAAO,CAACkH,iBAAiB,CAACI,0BAA0B,CAACF,SAAS,CAAC;QAC/D;OACD3F,MAAM,CAAC;SAAEzB,IAAI;SAAE4B;QAAiC,EAAqB;SACpE,IAAIA,SAAS,CAAC2F,kBAAkB,EAAE,EAClC;WACC,MAAMC,YAAqB,GAAGxH,IAAI,CAACgB,WAAW,EAAE,CAACyG,IAAI,CAAEzH,IAAuB,IAAK;aAClF,OAAOA,IAAI,CAAC6C,OAAO,EAAE,KAAK,KAAK;YAC/B,CAAC;WAEF,IAAI,CAAC2E,YAAY,EACjB;aACC,MAAMhI,MAAoB,GAAGQ,IAAI,CAACc,SAAS,EAAE;aAC7C,MAAM4G,iBAAyB,GAAG1H,IAAI,CAAC2H,kBAAkB,EAAE;aAC3D,MAAM;eAAEC;cAAW,GAAGhG,SAAS,CAACiG,eAAe,EAAE;aACjD,IAAIH,iBAAiB,GAAGE,SAAS,CAACE,SAAS,EAC3C;eACC,MAAMC,UAAkB,GAAGb,iBAAiB,CAACG,cAAc,CAACrH,IAAI,CAAC;eAEjE,MAAMgI,QAAwB,GAAGxI,MAAM,CAACyI,UAAU,CAAC;iBAClDlH,QAAQ,EAAEf,IAAI,CAACgB,WAAW;gBAC1B,CAAC;eACF,MAAM,CAACkH,IAAI,EAAEC,KAAK,CAAC,GAAGH,QAAQ,CAAC7E,KAAK,CAAC;iBACpCiF,MAAM,EAAER,SAAS,CAACE,SAAS,GAAGF,SAAS,CAACS;gBACxC,CAAC;eACF,MAAMC,yBAAiC,GAAGH,KAAK,CAACR,kBAAkB,EAAE;eACpE,MAAMY,OAA0B,GAAGvI,IAAI,CAACwI,KAAK,EAAE;eAC/CD,OAAO,CAACE,QAAQ,CAACV,UAAU,CAAC;eAE5B,IAAIO,yBAAyB,GAAGV,SAAS,CAACS,kBAAkB,EAC5D;iBACCE,OAAO,CAAC7H,WAAW,CAClB,GAAGwH,IAAI,CAAClH,WAAW,EAAE,EACrBxB,MAAM,CAACkJ,UAAU,CAAC,KAAK,CAAC,CACxB;iBAED,MAAM,GAAGC,YAAY,CAAC,GAAGR,KAAK,CAAChF,KAAK,CAAC;mBACpCiF,MAAM,EAAEE,yBAAyB,GAAGV,SAAS,CAACS;kBAC9C,CAAC;iBAEFE,OAAO,CAAC7H,WAAW,CAAC,GAAGiI,YAAY,CAAC3H,WAAW,EAAE,CAAC;iBAElD,OAAOuH,OAAO;;eAGfA,OAAO,CAACtH,WAAW,CAAC,CACnB,GAAGiH,IAAI,CAAClH,WAAW,EAAE,EACrBxB,MAAM,CAACkJ,UAAU,CAAC,KAAK,CAAC,EACxB,GAAGP,KAAK,CAACnH,WAAW,EAAE,CACtB,CAAC;eAEF,OAAOuH,OAAO;;;;SAKjB,OAAOvI,IAAI;QACX;OACDsB,OAAO,CAAC;SAAEtB,IAAI;SAAE4B;QAAmC,EAAwC;SAC1F,MAAMmG,UAAkB,GAAG,CAAC,MAAM;WACjC,MAAMa,KAAc,GAAG5I,IAAI,CAAC+F,QAAQ,EAAE;WACtC,IAAI8C,cAAI,CAACC,cAAc,CAACF,KAAK,CAAC,EAC9B;aACC,OAAOA,KAAK;;WAGb,OAAO5I,IAAI,CAAC+I,UAAU,EAAE;UACxB,GAAG;SACJ,MAAMC,cAAuC,GAAGhJ,IAAI,CAACoF,aAAa,EAAE;SACpE,MAAM;WAAE6D,aAAa,GAAG,QAAQ;WAAEC;UAAY,GAAGtH,SAAS,CAACiG,eAAe,EAAE;SAE5E,OAAO9C,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,GAAG;WACRC,KAAK,EAAE;aACN,GAAG8D,cAAc;aACjB,GAAGE,UAAU;aACbC,IAAI,EAAEpB,UAAU;aAChBqB,MAAM,EAAEH,aAAa;aACrB7E,SAAS,EAAE;;UAEZ,CAAC;QACF;OACD,GAAG/C;MACH,CAAC;;GAGH,OAAOgG,cAAc,CAACrH,IAAuB,EAC7C;KACC,MAAM4I,KAAc,GAAG5I,IAAI,CAAC+F,QAAQ,EAAE;KACtC,IAAI8C,cAAI,CAACC,cAAc,CAACF,KAAK,CAAC,EAC9B;OACC,OAAOA,KAAK;;KAGb,OAAO5I,IAAI,CAACqJ,WAAW,EAAE;;GAG1B,OAAO/B,0BAA0B,CAACS,UAAkB,EACpD;KACC,IAAIc,cAAI,CAACC,cAAc,CAACf,UAAU,CAAC,EACnC;;OAEC,MAAMuB,MAAM,GAAG,0HAA0H;OAEzI,OAAOA,MAAM,CAACC,IAAI,CAACxB,UAAU,CAAC;;KAG/B,OAAO,KAAK;;CAEd;;CCxHO,MAAMyB,oBAAoB,SAASrI,iCAAa,CACvD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,SAAS;OACfwB,OAAO,CAAC;SAAEtB;QAA8B,EAAsB;SAC7D,MAAM4I,KAAK,GAAG5I,IAAI,CAAC+F,QAAQ,EAAE,CAAC0D,IAAI,EAAE;SACpC,MAAMC,KAAK,GAAGb,cAAI,CAACC,cAAc,CAACF,KAAK,CAAC,GAAGA,KAAK,GAAGe,aAAG,CAACC,UAAU,CAAC,8BAA8B,CAAC;SAEjG,OAAO7E,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,SAAS;WACdC,KAAK,EAAE;aACNd,SAAS,EAAE;YACX;WACDrD,QAAQ,EAAE,CACTgE,aAAG,CAACC,MAAM,CAAC;aACVC,GAAG,EAAE,SAAS;aACdC,KAAK,EAAE;eACNd,SAAS,EAAE;cACX;aACD3B,IAAI,EAAEiH;YACN,CAAC;UAEH,CAAC;QACF;OACDjI,MAAM,CAAC;SAAEzB;QAAoC,EAAc;SAC1D,OAAOa,kBAAkB,CAACb,IAAI,CAAC;QAC/B;OACD0B,KAAK,CAAC;SAAEC;QAA+B,EAAe;SACrD,MAAM,CAACkI,OAAO,EAAE,GAAG1D,OAAO,CAAC,GAAGxE,OAAO,CAACZ,QAAQ;SAE9CY,OAAO,CAACjB,WAAW,CAACmJ,OAAO,CAAC;SAC5BlI,OAAO,CAACjB,WAAW,CAClBqE,aAAG,CAACC,MAAM,CAAC;WACVC,GAAG,EAAE,KAAK;WACVC,KAAK,EAAE;aACNd,SAAS,EAAE;YACX;WACDiC,OAAO,EAAE;aACRyD,cAAc,EAAE;YAChB;WACD/I,QAAQ,EAAE,CACT,GAAGoF,OAAO;UAEX,CAAC,CACF;SAED,OAAOxE,OAAO;QACd;OACD,GAAGN;MACH,CAAC;;CAEJ;;CCzDO,MAAM0I,iBAAiB,SAAS5I,iCAAa,CACpD;GACCC,WAAW,CAACC,OAA6B,EACzC;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,MAAM;OACZwB,OAAO,CAAC;SAAEtB,IAAI;SAAE4B;QAAmC,EAAqB;SAAA;SACvE,MAAMoI,eAAgD,GAAGpI,SAAS,CAACqI,kBAAkB,EAAE;SACvF,IAAIpB,cAAI,CAACC,cAAc,CAACkB,eAAe,6CAAfA,eAAe,CAAEE,WAAW,qBAA5B,sBAA8BC,IAAI,CAAC,EAC3D;WACC,MAAMD,WAAmB,GAAGF,eAAe,CAACE,WAAW,CAACC,IAAI;WAC5D,MAAMC,OAAe,GAAGF,WAAW,CAACG,UAAU,CAAC,MAAM,EAAErK,IAAI,CAAC+F,QAAQ,EAAE,CAAC;WAEvE,OAAOhB,aAAG,CAACC,MAAM,CAAC;aACjBC,GAAG,EAAE,GAAG;aACRC,KAAK,EAAE;eACNiE,IAAI,EAAEiB,OAAO;eACbhG,SAAS,EAAE;cACX;aACDiC,OAAO,EAAE;eACRiE,eAAe,EAAE,MAAM;eACvBC,SAAS,EAAEvK,IAAI,CAAC+F,QAAQ;;YAEzB,CAAC;;SAGH,OAAOhB,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,MAAM;WACXC,KAAK,EAAE;aACNd,SAAS,EAAE;YACX;WACDiC,OAAO,EAAE;aACRiE,eAAe,EAAE,MAAM;aACvBC,SAAS,EAAEvK,IAAI,CAAC+F,QAAQ;;UAEzB,CAAC;QACF;OACD,GAAG1E;MACH,CAAC;;CAEJ;;CCxCO,MAAMmJ,uBAAuB,SAASrJ,iCAAa,CAC1D;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,YAAY;OAClBwB,OAAO,CAAC;SAAEtB,IAAI;SAAE4B;QAAmC,EAAuC;SAAA;SACzF,MAAMoI,eAAgD,GAAGpI,SAAS,CAACqI,kBAAkB,EAAE;SACvF,IAAIpB,cAAI,CAACC,cAAc,CAACkB,eAAe,6CAAfA,eAAe,CAAEE,WAAW,qBAA5B,sBAA8BO,UAAU,CAAC,EACjE;WACC,MAAMP,WAAmB,GAAGF,eAAe,CAACE,WAAW,CAACO,UAAU;WAClE,MAAMC,aAAqB,GAAGR,WAAW,CAACG,UAAU,CAAC,MAAM,EAAErK,IAAI,CAAC+F,QAAQ,EAAE,CAAC;WAE7E,OAAOhB,aAAG,CAACC,MAAM,CAAC;aACjBC,GAAG,EAAE,GAAG;aACRC,KAAK,EAAE;eACNiE,IAAI,EAAEuB,aAAa;eACnBtG,SAAS,EAAE;cACX;aACDiC,OAAO,EAAE;eACRiE,eAAe,EAAE,YAAY;eAC7BC,SAAS,EAAEvK,IAAI,CAAC+F,QAAQ;;YAEzB,CAAC;;SAGH,OAAOhB,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,MAAM;WACXC,KAAK,EAAE;aACNd,SAAS,EAAE;YACX;WACDiC,OAAO,EAAE;aACRiE,eAAe,EAAE,YAAY;aAC7BC,SAAS,EAAEvK,IAAI,CAAC+F,QAAQ;;UAEzB,CAAC;QACF;OACD,GAAG1E;MACH,CAAC;;CAEJ;;CCxCO,MAAMsJ,oBAAoB,SAASxJ,iCAAa,CACvD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,SAAS;OACfwB,OAAO,CAAC;SAAEtB,IAAI;SAAE4B;QAAmC,EAAuC;SAAA;SACzF,MAAMoI,eAAgD,GAAGpI,SAAS,CAACqI,kBAAkB,EAAE;SACvF,IAAIpB,cAAI,CAACC,cAAc,CAACkB,eAAe,6CAAfA,eAAe,CAAEE,WAAW,qBAA5B,sBAA8BU,OAAO,CAAC,EAC9D;WACC,MAAMV,WAAmB,GAAGF,eAAe,CAACE,WAAW,CAACU,OAAO;WAC/D,MAAMC,UAAkB,GAAGX,WAAW,CAACG,UAAU,CAAC,YAAY,EAAErK,IAAI,CAAC+F,QAAQ,EAAE,CAAC;WAEhF,OAAOhB,aAAG,CAACC,MAAM,CAAC;aACjBC,GAAG,EAAE,GAAG;aACRC,KAAK,EAAE;eACNiE,IAAI,EAAE0B,UAAU;eAChBzG,SAAS,EAAE;cACX;aACDiC,OAAO,EAAE;eACRiE,eAAe,EAAE,SAAS;eAC1BC,SAAS,EAAEvK,IAAI,CAAC+F,QAAQ;;YAEzB,CAAC;;SAGH,OAAOhB,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,MAAM;WACXC,KAAK,EAAE;aACNd,SAAS,EAAE;YACX;WACDiC,OAAO,EAAE;aACRiE,eAAe,EAAE,SAAS;aAC1BC,SAAS,EAAEvK,IAAI,CAAC+F,QAAQ;;UAEzB,CAAC;QACF;OACD,GAAG1E;MACH,CAAC;;CAEJ;;CC9CO,SAASyJ,eAAe,CAAC;GAAE7G,GAAG;GAAEQ,KAAK;GAAEC;CAAO,CAAC,EACtD;GACC,OAAOK,aAAG,CAACC,MAAM,CAAC;KACjBC,GAAG,EAAE,MAAM;KACXC,KAAK,EAAE;OACNd,SAAS,EAAE;MACX;KACDiC,OAAO,EAAE;OACRC,SAAS,EAAE;MACX;KACDvF,QAAQ,EAAE,CACTgE,aAAG,CAACC,MAAM,CAAC;OACVC,GAAG,EAAE,KAAK;OACVC,KAAK,EAAE;SACNjB,GAAG;SACHG,SAAS,EAAE,qBAAqB;SAChCK,KAAK;SACLsG,OAAO,EAAE;QACT;OACDC,KAAK,EAAE;SACNC,WAAW,EAAExG,KAAK,GAAG,CAAC,IAAIC,MAAM,GAAG,CAAC,GAAI,GAAED,KAAM,MAAKC,MAAO,EAAC,GAAG;QAChE;OACDwG,MAAM,EAAE;SACPC,KAAK,EAAGC,KAAK,IAAK;WACjB,MAAMpH,GAAqB,GAAGoH,KAAK,CAAChC,MAAM;WAC1CpF,GAAG,CAACC,GAAG,GAAG,gFAAgF;WAC1Fc,aAAG,CAACsG,QAAQ,CAACrH,GAAG,CAACsH,UAAU,EAAE,4BAA4B,CAAC;;;MAG5D,CAAC;IAEH,CAAC;CACH;;CClCO,SAASC,gBAAgB,CAACC,GAAW,EAC5C;GACC,OAAO,0BAA0B,CAACjC,IAAI,CAACiC,GAAG,CAAC;CAC5C;;CCEO,MAAMC,kBAAkB,SAAStK,iCAAa,CACrD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,KAAK;OACXwB,OAAO,CAAC;SAAEtB;QAA8B,EAAmB;;;SAG1D,MAAMiE,GAAG,GAAGjE,IAAI,CAAC+I,UAAU,EAAE,CAACU,IAAI,EAAE;SACpC,IAAIhF,KAAK,GAAGiH,MAAM,CAAC1L,IAAI,CAAC2L,YAAY,CAAC,OAAO,CAAC,CAAC;SAC9C,IAAIjH,MAAM,GAAGgH,MAAM,CAAC1L,IAAI,CAAC2L,YAAY,CAAC,QAAQ,CAAC,CAAC;SAChDlH,KAAK,GAAGoE,cAAI,CAAC+C,QAAQ,CAACnH,KAAK,CAAC,IAAIA,KAAK,GAAG,CAAC,GAAGoH,IAAI,CAACC,KAAK,CAACrH,KAAK,CAAC,GAAG,IAAI;SACpEC,MAAM,GAAGmE,cAAI,CAAC+C,QAAQ,CAAClH,MAAM,CAAC,IAAIA,MAAM,GAAG,CAAC,GAAGmH,IAAI,CAACC,KAAK,CAACpH,MAAM,CAAC,GAAG,IAAI;SAExE,IAAI6G,gBAAgB,CAACtH,GAAG,CAAC,EACzB;WACC,OAAO6G,eAAe,CAAC;aAAE7G,GAAG;aAAEQ,KAAK;aAAEC;YAAQ,CAAC;;SAG/C,OAAOnD,QAAQ,CAACuB,cAAc,CAAC9C,IAAI,CAAC0C,QAAQ,EAAE,CAAC;QAC/C;OACD,GAAGrB;MACH,CAAC;;CAEJ;;CC5BO,SAAS0K,eAAe,CAAC;GAAEP,GAAG;GAAE/G,KAAK;GAAEC,MAAM;GAAEsC;CAAK,CAAC,EAC5D;GACC,MAAMgF,KAAuB,GAAGjH,aAAG,CAACC,MAAM,CAAC;KAC1CC,GAAG,EAAE,OAAO;KACZC,KAAK,EAAE;OACN+G,QAAQ,EAAE,IAAI;OACd7H,SAAS,EAAE,4BAA4B;OACvC8H,OAAO,EAAE,UAAU;OACnBC,WAAW,EAAE,IAAI;OACjBlI,GAAG,EAAEuH,GAAG;OACR/G;MACA;KACD4B,OAAO,EAAE;OACRC,SAAS,EAAE;MACX;KACD0E,KAAK,EAAE;OACNC,WAAW,EAAExG,KAAK,GAAG,CAAC,IAAIC,MAAM,GAAG,CAAC,GAAI,GAAED,KAAM,MAAKC,MAAO,EAAC,GAAG;;;CAGnE;CACA;CACA;CACA;CACA;CACA;CACA;CACA;IACE,CAAC;;GAEF,OAAOK,aAAG,CAACC,MAAM,CAAC;KACjBC,GAAG,EAAE,MAAM;KACXC,KAAK,EAAE;OACNd,SAAS,EAAE;MACX;KACDiC,OAAO,EAAE;OACRC,SAAS,EAAE;MACX;KACDvF,QAAQ,EAAE,CAACiL,KAAK;IAChB,CAAC;CACH;;CCvCA;CACA,MAAMI,qBAAqB,GAAG,6DAA6D;CAC3F,MAAMC,QAAQ,GAAG,iEAAiE;AAElF,CAAO,SAASC,WAAW,CAACd,GAAW,EACvC;GACC,IAAI,CAAC3C,cAAI,CAACC,cAAc,CAAC0C,GAAG,CAAC,EAC7B;KACC,OAAO,EAAE;;GAGV,MAAMe,aAAa,GAAGf,GAAG,CAACnB,UAAU,CAAC+B,qBAAqB,EAAE,EAAE,CAAC;GAE/D,OAAOC,QAAQ,CAAC9C,IAAI,CAACgD,aAAa,CAAC,GAAGA,aAAa,GAAG,EAAE;CACzD;;CChBO,SAASC,gBAAgB,CAAChB,GAAW,EAC5C;GACC,OAAO,qBAAqB,CAACjC,IAAI,CAACiC,GAAG,CAAC;CACvC;;CCIO,MAAMiB,kBAAkB,SAAStL,iCAAa,CACrD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,CAAC;OACLvB,IAAI,EAAE,OAAO;OACbwB,OAAO,CAAC;SAAEtB;QAA8B,EAAmB;;SAE1D,MAAMiE,GAAG,GAAGqI,WAAW,CAACtM,IAAI,CAAC+I,UAAU,EAAE,CAACU,IAAI,EAAE,CAAC;SACjD,IAAI,CAAC+C,gBAAgB,CAACvI,GAAG,CAAC,EAC1B;WACC,OAAO1C,QAAQ,CAACuB,cAAc,CAAC9C,IAAI,CAAC0C,QAAQ,EAAE,CAAC;;SAGhD,IAAI+B,KAAK,GAAGiH,MAAM,CAAC1L,IAAI,CAAC2L,YAAY,CAAC,OAAO,CAAC,CAAC;SAC9C,IAAIjH,MAAM,GAAGgH,MAAM,CAAC1L,IAAI,CAAC2L,YAAY,CAAC,QAAQ,CAAC,CAAC;SAChDlH,KAAK,GAAGoE,cAAI,CAAC+C,QAAQ,CAACnH,KAAK,CAAC,IAAIA,KAAK,GAAG,CAAC,GAAGoH,IAAI,CAACC,KAAK,CAACrH,KAAK,CAAC,GAAG,GAAG;SACnEC,MAAM,GAAGmE,cAAI,CAAC+C,QAAQ,CAAClH,MAAM,CAAC,IAAIA,MAAM,GAAG,CAAC,GAAGmH,IAAI,CAACC,KAAK,CAACpH,MAAM,CAAC,GAAG,GAAG;SAEvE,MAAM8G,GAAG,GAAG,UAAU,CAACjC,IAAI,CAACtF,GAAG,CAAC,GAAGA,GAAG,GAAI,WAAUA,GAAG,CAACyI,OAAO,CAAC,OAAO,EAAE,EAAE,CAAE,EAAC;SAC9E,MAAMC,GAAG,GAAG,IAAIC,aAAG,CAACpB,GAAG,CAAC;SACxB,MAAMqB,OAAO,GAAGC,4BAAY,CAACC,YAAY,CAACJ,GAAG,CAACK,OAAO,EAAE,CAAC,KAAK,IAAI;SACjE,IAAIH,OAAO,EACX;WACC,MAAMb,KAAwB,GAAGjH,aAAG,CAACC,MAAM,CAAC;aAC3CC,GAAG,EAAE,QAAQ;aACbC,KAAK,EAAE;eACNjB,GAAG;eACHG,SAAS,EAAE,4BAA4B;eACvCK,KAAK;eACLC,MAAM,EAAE,MAAM;eACduI,WAAW,EAAE,CAAC;eACdC,eAAe,EAAE;cACjB;aACDlC,KAAK,EAAE;eACNC,WAAW,EAAG,GAAExG,KAAM,MAAKC,MAAO;;YAEnC,CAAC;WAEF,OAAOK,aAAG,CAACC,MAAM,CAAC;aACjBC,GAAG,EAAE,MAAM;aACXC,KAAK,EAAE;eACNd,SAAS,EAAE;cACX;aACDiC,OAAO,EAAE;eACRC,SAAS,EAAE;cACX;aACDvF,QAAQ,EAAE,CAACiL,KAAK;YAChB,CAAC;;;;;;;;SAQH,OAAOD,eAAe,CAAC;WAAEP,GAAG;WAAE/G,KAAK;WAAEC;UAAQ,CAAC;QAC9C;OACD,GAAGrD;MACH,CAAC;;CAEJ;;CCzDO,MAAM8L,iBAAiB,SAAShM,iCAAa,CACpD;GACCC,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,MAAMO,SAAwB,GAAGP,OAAO,CAACO,SAAS;KAClD,MAAMwL,QAAQ,GAAGxL,SAAS,CAACyL,WAAW,EAAE;KAExC,KAAK,CAAC;OACLvN,IAAI,EAAEsN,QAAQ,IAAI,aAAa;OAC/B9L,OAAO,CAAC;SAAEtB,IAAI;SAAEsN;QAA8B,EAAe;SAAA;SAC5D,IAAIF,QAAQ,KAAK,IAAI,EACrB;WACC,OAAOpN,IAAI;;;;;;;SAOZ,MAAMuN,YAAY,GAAGvN,IAAI,CAAC2L,YAAY,CAAC,IAAI,CAAC;SAC5C,MAAM7I,cAAc,GAAG,MAAM;WAC5B,OAAOvB,QAAQ,CAACuB,cAAc,CAAC9C,IAAI,CAAC0C,QAAQ,EAAE,CAAC;UAC/C;SAED,IACC,CAACmG,cAAI,CAACC,cAAc,CAACyE,YAAY,CAAC,IAC9BH,QAAQ,KAAK,MAAM,IAAI,CAAC,UAAU,CAAC7D,IAAI,CAACgE,YAAY,CAAE,IACtDH,QAAQ,KAAK,MAAM,IAAI,CAAC,qCAAqC,CAAC7D,IAAI,CAACgE,YAAY,CAAE,EAEtF;WACC,OAAOzK,cAAc,EAAE;;SAGxB,MAAM0K,IAAsB,GAAGF,IAAI,mCAAJA,IAAI,CAAEG,KAAK,qBAAX,YAAaC,IAAI,CAAEC,IAAsB,IAAc;WACrF,OAAOA,IAAI,CAACJ,YAAY,CAAC7K,QAAQ,EAAE,KAAK6K,YAAY,CAAC7K,QAAQ,EAAE;UAC/D,CAAC;SAEF,IAAI,CAAC8K,IAAI,EACT;WACC,OAAO1K,cAAc,EAAE;;SAGxB,IAAI0K,IAAI,CAACI,OAAO,EAChB;WACC,IAAInJ,KAAK,GAAGoJ,cAAI,CAACC,SAAS,CAAC9N,IAAI,CAAC2L,YAAY,CAAC,OAAO,CAAC,CAAC;WACtD,IAAIjH,MAAM,GAAGmJ,cAAI,CAACC,SAAS,CAAC9N,IAAI,CAAC2L,YAAY,CAAC,QAAQ,CAAC,CAAC;WAExDlH,KAAK,GAAGoE,cAAI,CAAC+C,QAAQ,CAACnH,KAAK,CAAC,IAAIA,KAAK,GAAG,CAAC,GAAGoH,IAAI,CAACC,KAAK,CAACrH,KAAK,CAAC,GAAG+I,IAAI,CAACO,kBAAkB;WACvFrJ,MAAM,GAAGmE,cAAI,CAAC+C,QAAQ,CAAClH,MAAM,CAAC,IAAIA,MAAM,GAAG,CAAC,GAAGmH,IAAI,CAACC,KAAK,CAACpH,MAAM,CAAC,GAAG8I,IAAI,CAACQ,mBAAmB;WAE5F,OAAOlD,eAAe,CAAC;aACtBrG,KAAK;aACLC,MAAM;aACNT,GAAG,EAAEuJ,IAAI,CAACS;YACV,CAAC;;SAGH,IAAIT,IAAI,CAACU,OAAO,EAChB;WACC,IAAIzJ,KAAK,GAAGiH,MAAM,CAAC1L,IAAI,CAAC2L,YAAY,CAAC,OAAO,CAAC,CAAC;WAC9C,IAAIjH,MAAM,GAAGgH,MAAM,CAAC1L,IAAI,CAAC2L,YAAY,CAAC,QAAQ,CAAC,CAAC;WAChDlH,KAAK,GAAGoE,cAAI,CAAC+C,QAAQ,CAACnH,KAAK,CAAC,IAAIA,KAAK,GAAG,CAAC,GAAGoH,IAAI,CAACC,KAAK,CAACrH,KAAK,CAAC,GAAG,GAAG;WACnEC,MAAM,GAAGmE,cAAI,CAAC+C,QAAQ,CAAClH,MAAM,CAAC,IAAIA,MAAM,GAAG,CAAC,GAAGmH,IAAI,CAACC,KAAK,CAACpH,MAAM,CAAC,GAAG,IAAI;WAExE,OAAOqH,eAAe,CAAC;aAAEP,GAAG,EAAEgC,IAAI,CAACW,WAAW;aAAE1J,KAAK;aAAEC;YAAQ,CAAC;;SAGjE,OAAOK,aAAG,CAACC,MAAM,CAAC;WACjBC,GAAG,EAAE,GAAG;WACRC,KAAK,EAAE;aACNiE,IAAI,EAAEqE,IAAI,CAACW,WAAW;aACtB/J,SAAS,EAAE;YACX;WACD3B,IAAI,EAAE+K,IAAI,CAAC1N,IAAI,IAAI,SAAS;WAC5BuG,OAAO,EAAE;aACR+H,MAAM,EAAEZ,IAAI,CAACD,YAAY;aACzBc,QAAQ,EAAEC,IAAI,CAACC,SAAS,CAACf,IAAI;;UAE9B,CAAC;QACF;OACD,GAAGnM;MACH,CAAC;;CAEJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CCxDA,MAAMmN,cAAc,GAAGC,mBAAS,CAACC,WAAW,CAAC,oCAAoC,CAAC;;CAElF;CACA;CACA;CAFA;CAAA;CAAA;CAAA;CAAA;AAGA,CAAO,MAAMC,aAAa,SAASC,6BAAS,CAC5C;GAMCxN,WAAW,CAACC,OAA6B,GAAG,EAAE,EAC9C;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAER,IAAI,CAACwN,eAAe,CAAC;OACpB,GAAGL,cAAc,CAACM,YAAY;OAC9B,GAAGzN,OAAO,CAACyN;MACX,CAAC;KAEF,IAAI,CAACC,kBAAkB,CAAC;OACvB,GAAGP,cAAc,CAACQ,OAAO;OACzB,GAAG3N,OAAO,CAAC2N;MACX,CAAC;KAEF,4CAAI,0BAAa,CAAC,MAAM,EAAE,MAAM,CAAC,CAACC,QAAQ,CAAC5N,OAAO,CAAC+L,QAAQ,CAAC,GAAG/L,OAAO,CAAC+L,QAAQ,GAAG,IAAI;KAEtF,MAAM8B,iBAAiB,GAAGC,MAAM,CAACC,MAAM,CAACC,cAAc,CAAC,CAACC,GAAG,CAAEC,cAA6B,IAAK;OAC9F,OAAO,IAAIA,cAAc,CAAC;SAAE3N,SAAS,EAAE;QAAM,CAAC;MAC9C,CAAC;KAEF,IAAI,CAAC4N,gBAAgB,CAACnO,OAAO,CAACoO,aAAa,CAAC;KAC5C,IAAI,CAACC,iBAAiB,CAACR,iBAAiB,CAAC;KACzC,IAAI,CAACQ,iBAAiB,CAACrO,OAAO,CAACsO,UAAU,CAAC;;GAG3CpI,kBAAkB,GAClB;KACC,MAAM;OAAEK;MAAW,GAAG,IAAI,CAACC,eAAe,EAAE;KAE5C,OACCgB,cAAI,CAAC+G,aAAa,CAAChI,SAAS,CAAC,IAC1BA,SAAS,CAACiI,OAAO,KAAK,IAAI,IAC1BhH,cAAI,CAACiH,SAAS,CAAClI,SAAS,CAACE,SAAS,CAAC;;GAIxC+G,eAAe,CAACkB,QAA8C,EAC9D;KACC,4CAAI,kCAAiB;OAAE,GAAGA;MAAU;;GAGrClI,eAAe,GACf;KACC,+CAAO,IAAI;;GAGZwF,WAAW,GACX;KACC,+CAAO,IAAI;;GAGZ0B,kBAAkB,CAACgB,QAAyC,EAC5D;KACC,4CAAI,wCAAoB;OAAE,GAAGA;MAAU;;GAGxC9F,kBAAkB,GAClB;KACC,+CAAO,IAAI;;GAGZuF,gBAAgB,CAAC3N,IAA2C,EAC5D;KACC,4CAAI,oCAAkBA,IAAI;;GAG3BC,gBAAgB,GAChB;KACC,+CAAO,IAAI;;GAGZkO,SAAS,CAACC,MAAM,EAChB;KACC,IAAIA,MAAM,CAACC,QAAQ,KAAKC,IAAI,CAACC,sBAAsB,EACnD;OACC,OAAO,IAAI;;KAGZ,IAAIH,MAAM,CAACC,QAAQ,KAAKC,IAAI,CAAChQ,YAAY,4CAAI,IAAI,kCAAgB8P,MAAM,CAAC,EACxE;OACC,OAAO,KAAK;;KAGb,OAAOpH,cAAI,CAACwH,WAAW,CAACJ,MAAM,CAAC5J,OAAO,CAACC,SAAS,CAAC;;GAQlDgK,6BAA6B,CAACjP,OAAO,EACrC;KACC,OAAO,MAAM;OACZ,OAAO,IAAIF,iCAAa,CAAC;SACxBrB,IAAI,EAAE,SAAS;SACf2B,MAAM,CAAC;WAAEzB;UAAoC,EAAsB;WAClE,MAAMR,MAAoB,GAAGQ,IAAI,CAACc,SAAS,EAAE;WAE7C,IAAId,IAAI,CAACuQ,MAAM,EAAE,EACjB;aACC,OAAO/Q,MAAM,CAACgR,cAAc,CAAC;eAC5BzP,QAAQ,EAAE,CACTvB,MAAM,CAACkJ,UAAU,CAAC1I,IAAI,CAACyQ,aAAa,EAAE,CAAC;cAExC,CAAC;;WAGH,OAAOjR,MAAM,CAACgR,cAAc,CAAC;aAC5BzP,QAAQ,EAAE,CACTvB,MAAM,CAACkJ,UAAU,CAAC1I,IAAI,CAACyQ,aAAa,EAAE,CAAC,EACvC,GAAGzQ,IAAI,CAACgB,WAAW,EAAE,EACrBxB,MAAM,CAACkJ,UAAU,CAAC1I,IAAI,CAAC0Q,aAAa,EAAE,CAAC;YAExC,CAAC;UACF;SACDpP,OAAO,GAAqB;WAC3B,OAAOC,QAAQ,CAACC,sBAAsB,EAAE;;QAEzC,CAAC;MACF;;CAEH;CAAC,yBApCeyO,MAAM,EACrB;GACC,OAAO,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,CAAC,CAAChB,QAAQ,CAACgB,MAAM,CAACnK,OAAO,CAAC6K,WAAW,EAAE,CAAC;CAC3E;;OCxIYC,sBAAsB,GAAG;GACrCC,KAAK,EAAE;KACNC,MAAM,EAAE;OACP9J,IAAI,EAAE+J,MAAM;OACZC,OAAO,EAAE;MACT;;KAED3P,OAAO,EAAE;OACR2F,IAAI,EAAEmI,MAAM;OACZ6B,OAAO,EAAEC;MACT;;KAEDC,UAAU,EAAE;OACXlK,IAAI,EAAEmI,MAAM;OACZ6B,OAAO,EAAE,OAAO,EAAE;;IAEnB;GACDG,YAAY,GACZ;KACC,IAAI,CAACC,aAAa,GAAG,IAAI;IACzB;GACDC,OAAO,GACP;KACC,IAAI,CAACC,MAAM,EAAE;IACb;GACDC,SAAS,GACT;KACC,IAAI,CAACH,aAAa,GAAG,IAAI;IACzB;GACDI,KAAK,EAAE;KACNV,MAAM,GACN;OACC,IAAI,CAACQ,MAAM,EAAE;MACb;KACDJ,UAAU,GACV;OACC,IAAI,CAACI,MAAM,EAAE;;IAEd;GACDG,OAAO,EAAE;KACRH,MAAM,GACN;OACC,MAAM5R,MAAM,GAAG,IAAI,CAACgS,gBAAgB,EAAE,CAACJ,MAAM,CAAC;SAAErB,MAAM,EAAE,IAAI,CAACa,MAAM;SAAExD,IAAI,EAAE,IAAI,CAAC4D;QAAY,CAAC;OAE7FnM,aAAG,CAAC4M,KAAK,CAAC,IAAI,CAACC,GAAG,CAAC;OACnB7M,aAAG,CAAC8M,MAAM,CAACnS,MAAM,EAAE,IAAI,CAACkS,GAAG,CAAC;MAC5B;KACDF,gBAAgB,GAChB;OAAA;OACC,2BAAI,CAACN,aAAa,kCAAlB,IAAI,CAACA,aAAa,GAAK,IAAIzC,aAAa,CAAC,IAAI,CAACtN,OAAO,CAAC;OAEtD,OAAO,IAAI,CAAC+P,aAAa;;IAE1B;GACDU,QAAQ,EAAG;;;CAGZ,CAAC;;;;;;;;;"}