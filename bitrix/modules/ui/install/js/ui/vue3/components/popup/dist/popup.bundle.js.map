{"version":3,"file":"popup.bundle.js","sources":["../src/side-panel-integration.js","../src/popup.js"],"sourcesContent":["import { Popup as MainPopup } from 'main.popup';\nimport type { BaseEvent } from 'main.core.events';\nimport { Popup } from './popup';\n\nexport class SidePanelIntegration\n{\n\tpopup: Popup = null;\n\tsliders: Set = new Set();\n\n\tconstructor(popup: Popup)\n\t{\n\t\tthis.popup = popup;\n\n\t\tthis.getPopup().subscribe('onShow', this.onPopupShow.bind(this));\n\t\tthis.getPopup().subscribe('onClose', this.onPopupClose.bind(this));\n\t\tthis.getPopup().subscribe('onDestroy', this.onPopupClose.bind(this));\n\n\t\tthis.handleSliderOpen = this.handleSliderOpen.bind(this);\n\t\tthis.handleSliderClose = this.handleSliderClose.bind(this);\n\t\tthis.handleSliderDestroy = this.handleSliderDestroy.bind(this);\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tthis.unbindEvents();\n\n\t\tif (top.BX)\n\t\t{\n\t\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onOpen', this.handleSliderOpen);\n\t\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onCloseComplete', this.handleSliderClose);\n\t\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t\t}\n\t}\n\n\tunbindEvents(): void\n\t{\n\t\tif (top.BX)\n\t\t{\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onOpen', this.handleSliderOpen);\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onCloseComplete', this.handleSliderClose);\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onDestroy', this.handleSliderDestroy);\n\t\t}\n\t}\n\n\tonPopupShow(): void\n\t{\n\t\tthis.bindEvents();\n\t}\n\n\tonPopupClose(): void\n\t{\n\t\tthis.unbindEvents();\n\t\tthis.sliders.clear();\n\t\tthis.popup.unfreeze();\n\t}\n\n\thandleSliderOpen(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider = sliderEvent.getSlider();\n\n\t\tif (!this.isPopupInSlider(slider))\n\t\t{\n\t\t\tthis.sliders.add(slider);\n\t\t\tthis.popup.freeze();\n\t\t}\n\t}\n\n\thandleSliderClose(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider = sliderEvent.getSlider();\n\n\t\tthis.sliders.delete(slider);\n\t\tif (this.sliders.size === 0)\n\t\t{\n\t\t\tthis.popup.unfreeze();\n\t\t}\n\t}\n\n\thandleSliderDestroy(event: BaseEvent): void\n\t{\n\t\tconst [sliderEvent] = event.getData();\n\t\tconst slider = sliderEvent.getSlider();\n\n\t\tif (this.isPopupInSlider(slider))\n\t\t{\n\t\t\tthis.unbindEvents();\n\t\t\tthis.getPopup().destroy();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sliders.delete(slider);\n\t\t\tif (this.sliders.size === 0)\n\t\t\t{\n\t\t\t\tthis.popup.unfreeze();\n\t\t\t}\n\t\t}\n\t}\n\n\tisPopupInSlider(slider): boolean\n\t{\n\t\tif (slider.getFrameWindow())\n\t\t{\n\t\t\treturn slider.getFrameWindow().document.contains(this.getPopup().getPopupContainer());\n\t\t}\n\n\t\treturn slider.getContainer().contains(this.getPopup().getPopupContainer());\n\t}\n\n\tgetPopup(): MainPopup\n\t{\n\t\treturn this.popup.getPopupInstance();\n\t}\n}\n","import { Text } from 'main.core';\nimport { Popup as MainPopup, PopupManager, type PopupOptions } from 'main.popup';\nimport { SidePanelIntegration } from './side-panel-integration';\n\n// @vue/component\nexport const Popup = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\tdefault: () => `ui-vue3-popup-${Text.getRandom()}`,\n\t\t},\n\t\toptions: {\n\t\t\t/** @type PopupOptions */\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['close'],\n\tcomputed: {\n\t\tpopupContainer(): string\n\t\t{\n\t\t\treturn `#${this.popupOptions.id}`;\n\t\t},\n\t\tcontainer(): HTMLElement\n\t\t{\n\t\t\treturn this.getPopupInstance().getPopupContainer();\n\t\t},\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn { ...this.defaultOptions, ...this.options };\n\t\t},\n\t\tdefaultOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: this.id,\n\t\t\t\tcacheable: false,\n\t\t\t\tautoHide: true,\n\t\t\t\tautoHideHandler: this.autoHideHandler,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tanimation: 'fading',\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: this.closePopup,\n\t\t\t\t\tonPopupDestroy: this.closePopup,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tnew SidePanelIntegration(this);\n\t},\n\tbeforeMount(): void\n\t{\n\t\tthis.getPopupInstance().show();\n\t},\n\tmounted(): void\n\t{\n\t\tthis.adjustPosition();\n\t\tthis.getPopupInstance().getContentContainer().remove();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.popupHTML = this.instance.getPopupContainer()?.innerHTML;\n\t},\n\tunmounted(): void\n\t{\n\t\tif (this.popupHTML)\n\t\t{\n\t\t\tthis.instance.getPopupContainer().innerHTML = this.popupHTML;\n\t\t}\n\n\t\tthis.instance?.close();\n\t},\n\tmethods: {\n\t\tcontains(element: HTMLElement): boolean\n\t\t{\n\t\t\treturn this.container.contains(element) ?? false;\n\t\t},\n\t\tadjustPosition(): void\n\t\t{\n\t\t\tthis.getPopupInstance().adjustPosition(this.popupOptions.bindOptions);\n\t\t},\n\t\tfreeze(): void\n\t\t{\n\t\t\tthis.getPopupInstance().setAutoHide(false);\n\t\t\tthis.getPopupInstance().setClosingByEsc(false);\n\t\t},\n\t\tunfreeze(): void\n\t\t{\n\t\t\tthis.getPopupInstance().setAutoHide(this.popupOptions.autoHide);\n\t\t\tthis.getPopupInstance().setClosingByEsc(this.popupOptions.closeByEsc);\n\t\t},\n\t\tgetPopupInstance(): MainPopup\n\t\t{\n\t\t\tif (!this.instance)\n\t\t\t{\n\t\t\t\tPopupManager.getPopupById(this.popupOptions.id)?.destroy();\n\n\t\t\t\tthis.instance = new MainPopup(this.popupOptions);\n\t\t\t}\n\n\t\t\treturn this.instance;\n\t\t},\n\t\tautoHideHandler({ target }): boolean\n\t\t{\n\t\t\tconst parentAutoHide = target !== this.container && !this.container.contains(target);\n\t\t\tconst isAhaMoment = target.closest('.popup-window-ui-tour');\n\n\t\t\treturn parentAutoHide && !isAhaMoment;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Teleport :to=\"popupContainer\">\n\t\t\t<slot :adjustPosition=\"adjustPosition\" :freeze=\"freeze\" :unfreeze=\"unfreeze\"></slot>\n\t\t</Teleport>\n\t`,\n};\n"],"names":["SidePanelIntegration","constructor","popup","sliders","Set","getPopup","subscribe","onPopupShow","bind","onPopupClose","handleSliderOpen","handleSliderClose","handleSliderDestroy","bindEvents","unbindEvents","top","BX","Event","EventEmitter","unsubscribe","clear","unfreeze","event","sliderEvent","getData","slider","getSlider","isPopupInSlider","add","freeze","delete","size","destroy","getFrameWindow","document","contains","getPopupContainer","getContainer","getPopupInstance","Popup","props","id","type","String","default","Text","getRandom","options","Object","emits","computed","popupContainer","popupOptions","container","defaultOptions","cacheable","autoHide","autoHideHandler","closeByEsc","animation","bindOptions","forceBindPosition","events","closePopup","onPopupDestroy","created","beforeMount","show","mounted","adjustPosition","getContentContainer","remove","beforeUnmount","popupHTML","instance","innerHTML","unmounted","close","methods","element","setAutoHide","setClosingByEsc","PopupManager","getPopupById","MainPopup","target","parentAutoHide","isAhaMoment","closest","$emit","template"],"mappings":"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"}