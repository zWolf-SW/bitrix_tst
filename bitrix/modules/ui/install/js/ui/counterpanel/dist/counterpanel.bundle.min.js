this.BX=this.BX||{};(function(t,e,i,s,n,a,l){"use strict";let r=t=>t,o,u,h,c,d,v,p,f,m;function y(t,e){g(t,e);e.add(t)}function C(t,e,i){g(t,e);e.set(t,i)}function g(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function k(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var b=new WeakMap;var w=new WeakMap;var A=new WeakMap;var D=new WeakMap;var T=new WeakSet;var I=new WeakSet;var E=new WeakSet;var _=new WeakSet;var S=new WeakSet;var P=new WeakSet;var F=new WeakSet;var B=new WeakSet;var $=new WeakSet;var O=new WeakSet;var H=new WeakSet;let U=function(){function t(e){var i,s,a,l,r,o;babelHelpers.classCallCheck(this,t);y(this,H);y(this,O);y(this,$);y(this,B);y(this,F);y(this,P);y(this,S);y(this,_);y(this,E);y(this,I);y(this,T);C(this,b,{writable:true,value:void 0});C(this,w,{writable:true,value:void 0});C(this,A,{writable:true,value:void 0});C(this,D,{writable:true,value:false});this.id=(i=e.id)!==null&&i!==void 0?i:null;this.separator=n.Type.isBoolean(e.separator)?e.separator:true;this.items=n.Type.isArray(e.items)?e.items:[];this.popupMenu=null;this.isActive=n.Type.isBoolean(e.isActive)?e.isActive:false;this.isRestricted=n.Type.isBoolean(e.isRestricted)?e.isRestricted:false;this.panel=(s=e.panel)!==null&&s!==void 0?s:null;this.title=(a=e.title)!==null&&a!==void 0?a:null;this.value=n.Type.isNumber(e.value)&&e.value!==undefined?e.value:null;this.titleOrder=null;this.valueOrder=null;this.color=(l=e.color)!==null&&l!==void 0?l:null;this.parent=n.Type.isBoolean(e.parent)?e.parent:null;this.parentId=(r=e.parentId)!==null&&r!==void 0?r:null;this.locked=e.locked===true;this.type=n.Type.isString(e.type)?e.type.toLowerCase():null;this.eventsForActive=n.Type.isObject(e.eventsForActive)?e.eventsForActive:{};this.eventsForUnActive=n.Type.isObject(e.eventsForUnActive)?e.eventsForUnActive:{};this.hideValue=n.Type.isBoolean(e.hideValue)?e.hideValue:false;babelHelpers.classPrivateFieldSet(this,b,(o=e.collapsedIcon)!==null&&o!==void 0?o:null);babelHelpers.classPrivateFieldSet(this,w,e.collapsed===true);babelHelpers.classPrivateFieldSet(this,A,n.Type.isPlainObject(e.dataAttributes)?e.dataAttributes:{});babelHelpers.classPrivateFieldSet(this,D,e.useAirDesign===true);if(n.Type.isObject(e.title)){var u;this.title=(u=e.title.value)!==null&&u!==void 0?u:null;this.titleOrder=n.Type.isNumber(e.title.order)?e.title.order:null}if(n.Type.isObject(e.value)){this.value=n.Type.isNumber(e.value.value)?e.value.value:null;this.valueOrder=n.Type.isNumber(e.value.order)?e.value.order:null}this.layout={container:null,value:null,title:null,cross:null,dropdownArrow:null,menuItem:null};this.counter=k(this,E,N).call(this);if(!k(this,I,M).call(this).isMultiselect()){k(this,T,W).call(this)}}babelHelpers.createClass(t,[{key:"getItems",value:function t(){return this.items}},{key:"getId",value:function t(){return this.id}},{key:"hasParentId",value:function t(){return this.parentId}},{key:"updateValue",value:function t(e){if(n.Type.isNumber(e)){this.value=e;k(this,E,N).call(this).update(e);if(e===0){this.updateColor(this.parentId?"GRAY":"THEME");n.Dom.addClass(this.layout.container,k(this,H,z).call(this))}else{n.Dom.removeClass(this.layout.container,k(this,H,z).call(this))}}}},{key:"updateValueAnimate",value:function t(e){if(n.Type.isNumber(e)){this.value=e;k(this,E,N).call(this).update(e);k(this,E,N).call(this).show();if(e===0){const t=this.parentId?"GRAY":"THEME";this.updateColor(t);k(this,E,N).call(this).setStyle(k(this,$,V).call(this,a.Counter.Color[t]))}}}},{key:"updateColor",value:function t(e){if(n.Type.isString(e)){this.color=e;k(this,E,N).call(this).setColor(a.Counter.Color[e]);k(this,E,N).call(this).setStyle(k(this,$,V).call(this,a.Counter.Color[e]))}}},{key:"activate",value:function t(e=true){this.isActive=true;if(this.parentId){const t=BX.findParent(this.getContainerMenu(),{className:"ui-counter-panel__popup-item"});if(t){n.Dom.addClass(t,"-active")}}else{n.Dom.addClass(this.getContainer(),"--active")}if(e){l.EventEmitter.emit("BX.UI.CounterPanel.Item:activate",this)}}},{key:"deactivate",value:function t(e=true){this.isActive=false;if(this.parentId){const t=BX.findParent(this.getContainerMenu(),{className:"ui-counter-panel__popup-item"});if(t){n.Dom.removeClass(t,"--active");n.Dom.removeClass(t,"--hover")}}else{n.Dom.removeClass(this.getContainer(),"--active");n.Dom.removeClass(this.getContainer(),"--hover")}if(e){l.EventEmitter.emit("BX.UI.CounterPanel.Item:deactivate",this)}}},{key:"collapse",value:function t(){n.Dom.addClass(this.getContainer(),"--collapsed")}},{key:"expand",value:function t(){n.Dom.removeClass(this.getContainer(),"--collapsed")}},{key:"getSeparator",value:function t(){return this.separator}},{key:"getCounterContainer",value:function t(){return this.layout.value}},{key:"setEvents",value:function t(e){if(!e){e=this.getContainer()}if(this.eventsForActive){const t=Object.keys(this.eventsForActive);for(const i of t){n.Event.bind(e,i,(()=>{if(this.isActive){this.eventsForActive[i]()}}))}}if(this.eventsForUnActive){const t=Object.keys(this.eventsForUnActive);for(const i of t){n.Event.bind(e,i,(()=>{if(!this.isActive){this.eventsForUnActive[i]()}}))}}}},{key:"isLocked",value:function t(){return this.locked}},{key:"lock",value:function t(){this.locked=true;n.Dom.addClass(this.getContainer(),"--locked")}},{key:"unLock",value:function t(){this.locked=false;n.Dom.removeClass(this.getContainer(),"--locked")}},{key:"getArrowDropdown",value:function t(){if(!this.layout.dropdownArrow){this.layout.dropdownArrow=n.Tag.render(o||(o=r`
				<div class="ui-counter-panel__item-dropdown">
					<i></i>
				</div>
			`))}return this.layout.dropdownArrow}},{key:"getContainerMenu",value:function t(){if(!this.layout.menuItem){this.layout.menuItem=n.Tag.render(u||(u=r`
				<span>
					${0}
					${0}
					${0}
				</span>
			`),k(this,_,X).call(this),this.title,k(this,F,R).call(this))}return this.layout.menuItem}},{key:"getContainer",value:function t(){if(!this.layout.container){const t=this.type?`id="ui-counter-panel-item-${this.type}"`:"";const e=n.Type.isNumber(this.value);this.layout.container=n.Tag.render(h||(h=r`
				<div ${0} class="ui-counter-panel__item ${0}">
					${0}
					${0}
					${0}
					${0}
				</div>
			`),t,k(this,O,x).call(this,this.value),babelHelpers.classPrivateFieldGet(this,b)?k(this,P,L).call(this):"",e&&!this.hideValue?k(this,_,X).call(this):"",this.title?k(this,S,j).call(this):"",e?k(this,F,R).call(this):"");if(this.parent){this.layout.container=n.Tag.render(c||(c=r`
					<div class="ui-counter-panel__item">
						${0}
						${0}
						${0}
					</div>
				`),this.title?k(this,S,j).call(this):"",e?k(this,_,X).call(this):"",k(this,F,R).call(this));n.Event.bind(k(this,F,R).call(this),"click",(t=>{this.deactivate();t.stopPropagation()}));n.Dom.addClass(this.layout.container,"--dropdown")}if(!e){n.Dom.addClass(this.layout.container,"--string")}if(!e&&!this.eventsForActive&&!this.eventsForUnActive){n.Dom.addClass(this.layout.container,"--title")}if(!this.separator){n.Dom.addClass(this.layout.container,"--without-separator")}if(this.locked){n.Dom.addClass(this.layout.container,"--locked")}if(this.isActive){this.activate()}if(this.isRestricted){n.Dom.addClass(this.layout.container,"--restricted")}if(babelHelpers.classPrivateFieldGet(this,w)){this.collapse()}if(this.locked){this.lock()}this.setEvents(this.layout.container);k(this,B,G).call(this,this.layout.container);n.Event.bind(this.layout.container,"click",(()=>{l.EventEmitter.emit("BX.UI.CounterPanel.Item:click",{item:this})}));if(e&&this.items.length===0&&!this.parent){n.Event.bind(this.layout.container,"mouseenter",(()=>{if(!this.isActive){n.Dom.addClass(this.layout.container,"--hover")}}));n.Event.bind(this.layout.container,"mouseleave",(()=>{if(!this.isActive){n.Dom.removeClass(this.layout.container,"--hover")}}));n.Event.bind(this.layout.container,"click",(()=>{if(this.isActive){this.deactivate()}else{this.activate()}}))}if(this.parent){n.Dom.append(this.getArrowDropdown(),this.layout.container)}}return this.layout.container}},{key:"setDataAttributes",value:function t(e){babelHelpers.classPrivateFieldSet(this,A,n.Type.isPlainObject(e)||{});k(this,B,G).call(this,this.getContainer())}}]);return t}();function W(){l.EventEmitter.subscribe("BX.UI.CounterPanel.Item:activate",(t=>{const e=t.data.parentId===this.id;if(t.data!==this&&!e){this.deactivate()}}))}function M(){return this.panel}function N(){if(!this.counter){const t=this.color?a.Counter.Color[this.color.toUpperCase()]:this.parentId?a.Counter.Color.GRAY:a.Counter.Color.THEME;this.counter=new a.Counter({color:t,value:this.value,animation:false,useAirDesign:babelHelpers.classPrivateFieldGet(this,D),style:k(this,$,V).call(this,t)})}return this.counter}function X(){if(!this.layout.value){const t=this.isRestricted?n.Tag.render(d||(d=r`<div class="ui-counter-panel__item-lock"></div>`)):k(this,E,N).call(this).getContainer();this.layout.value=n.Tag.render(v||(v=r`
				<div class="ui-counter-panel__item-value">
					${0}
				</div>
			`),t);n.Dom.style(this.layout.value,"order",this.valueOrder)}return this.layout.value}function j(){if(!this.layout.title){this.layout.title=n.Tag.render(p||(p=r`
				<div class="ui-counter-panel__item-title">${0}</div>
			`),this.title);n.Dom.style(this.layout.title,"order",this.titleOrder)}return this.layout.title}function L(){return n.Tag.render(f||(f=r`
			<div class="ui-counter-panel__item-collapsed-icon ui-icon-set__scope --icon-${0}"></div>
		`),babelHelpers.classPrivateFieldGet(this,b))}function R(){if(!this.layout.cross){this.layout.cross=n.Tag.render(m||(m=r`
				<div class="ui-counter-panel__item-cross">
					<i></i>
				</div>
			`))}return this.layout.cross}function G(t){if(!t){return}Object.entries(babelHelpers.classPrivateFieldGet(this,A)).forEach((([e,i])=>{n.Dom.attr(t,`data-${e}`,i)}))}function V(t){if(t===a.CounterColor.DANGER){return a.CounterStyle.FILLED_ALERT}if(t===a.CounterColor.SUCCESS){return a.CounterStyle.FILLED_SUCCESS}return a.CounterStyle.OUTLINE_NO_ACCENT}function x(t){return t===0?k(this,H,z).call(this):""}function z(){return"--zero"}let Y=t=>t,K,q,J;function Q(t,e){Z(t,e);e.add(t)}function Z(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function tt(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var et=new WeakSet;var it=new WeakSet;var st=new WeakSet;let nt=function(){function t(e){babelHelpers.classCallCheck(this,t);Q(this,st);Q(this,it);Q(this,et);this.target=n.Type.isDomNode(e.target)?e.target:null;this.items=n.Type.isArray(e.items)?e.items:[];this.multiselect=n.Type.isBoolean(e.multiselect)?e.multiselect:null;this.title=n.Type.isStringFilled(e.title)?e.title:null;this.container=null;this.keys=[];this.hasParent=[]}babelHelpers.createClass(t,[{key:"isMultiselect",value:function t(){return this.multiselect}},{key:"getItems",value:function t(){return this.items}},{key:"getItemById",value:function t(e){if(e){const t=this.keys.indexOf(e);return this.items[t]}return undefined}},{key:"init",value:function t(){tt(this,et,at).call(this);tt(this,st,rt).call(this)}},{key:"setItems",value:function t(e){this.items=e}},{key:"hasAirDesign",value:function t(){return n.Extension.getSettings("ui.counterpanel").get("useAirDesign")===true}}]);return t}();function at(){this.items=this.items.map((t=>{this.keys.push(t.id);if(t.parentId){this.hasParent.push(t.parentId)}return new U({...t,useAirDesign:this.hasAirDesign(),panel:this})}));this.hasParent.forEach((t=>{const e=this.keys.indexOf(t);this.items[e].parent=true}));this.items.forEach((t=>{if(t.parentId){const e=this.keys.indexOf(t.parentId);this.items[e].items.push(t.id)}}))}function lt(){if(!this.container){let t="";if(this.title){t=n.Tag.render(K||(K=Y`
					<div class="ui-counter-panel__item-head">${0}</div>
				`),this.title)}this.container=n.Tag.render(q||(q=Y`
				<div class="ui-counter-panel ui-counter-panel__scope">${0}</div>
			`),t);if(this.hasAirDesign()===true){n.Dom.addClass(this.container,"--air")}}return this.container}function rt(){if(this.target&&this.items.length>0){this.items.forEach(((t,e)=>{if(t instanceof U){if(!t.hasParentId()){n.Dom.append(t.getContainer(),tt(this,it,lt).call(this));if(this.items.length!==e+1&&this.items.length>1){n.Dom.append(n.Tag.render(J||(J=Y`
								<div class="ui-counter-panel__item-separator ${0}"></div>
							`),t.getSeparator()?"":"--invisible"),tt(this,it,lt).call(this))}}if(t.parent){n.Event.bind(t.getContainer(),"click",(()=>{const e=[];t.getItems().forEach((t=>{const i=this.getItemById(t);const s={html:i.getContainerMenu(),className:`ui-counter-panel__popup-item ${this.hasAirDesign()?"--air":""} menu-popup-no-icon ${i.isActive?"--active":""}`,onclick:()=>{if(i.isActive){i.deactivate()}else{i.activate()}}};e.push(s)}));const i=new s.PopupMenuWindow({className:"ui-counter-panel__popup ui-counter-panel__scope",bindElement:t.getArrowDropdown(),autoHide:true,closeByEsc:true,items:e,angle:true,offsetLeft:6,offsetTop:5,animation:"fading-slide",events:{onPopupShow:()=>{n.Dom.addClass(t.getContainer(),"--hover");n.Dom.addClass(t.getContainer(),"--pointer-events-none")},onPopupClose:()=>{n.Dom.removeClass(t.getContainer(),"--hover");n.Dom.removeClass(t.getContainer(),"--pointer-events-none");i.destroy()}}});i.show()}))}}}));n.Dom.clean(this.target);n.Dom.append(tt(this,it,lt).call(this),this.target)}}const ot=Object.freeze({CHAT_CHECK:"chat-chek"});t.CounterPanel=nt;t.CounterItem=U;t.CounterItemCollapsedIcon=ot})(this.BX.UI=this.BX.UI||{},BX.UI,BX,BX.Main,BX,BX.UI,BX.Event);
//# sourceMappingURL=counterpanel.bundle.map.js