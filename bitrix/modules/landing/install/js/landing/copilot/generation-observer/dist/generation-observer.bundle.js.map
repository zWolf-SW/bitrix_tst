{"version":3,"file":"generation-observer.bundle.js","sources":["../src/generation-observer.js"],"sourcesContent":["export class GenerationObserver\n{\n\tstatic INTERVAL = 30000;\n\n\tgenerationId: number;\n\t#intervalId: ?number = null;\n\n\tconstructor(generationId: number)\n\t{\n\t\tthis.generationId = generationId;\n\t\tthis.onGenerationRestart = this.onGenerationRestart.bind(this);\n\t}\n\n\tobserve()\n\t{\n\t\tthis.restartObserve();\n\n\t\tBX.PULL.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'landing',\n\t\t\tcallback: (event) => {\n\t\t\t\tif (\n\t\t\t\t\tevent.params.generationId !== undefined\n\t\t\t\t\t&& event.params.generationId !== this.generationId\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst command = event.command;\n\n\t\t\t\tif (\n\t\t\t\t\tcommand === 'LandingCopilotGeneration:onStepExecute'\n\t\t\t\t\t|| command === 'LandingCopilotGeneration:onPreviewImageCreate'\n\t\t\t\t\t|| command === 'LandingCopilotGeneration:onCopilotImageCreate'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.restartObserve();\n\t\t\t\t}\n\n\t\t\t\tif (command === 'LandingCopilotGeneration:onCopilotTimeIsOver')\n\t\t\t\t{\n\t\t\t\t\tthis.onGenerationRestart();\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tcommand === 'LandingCopilotGeneration:onGenerationError'\n\t\t\t\t\t|| command === 'LandingCopilotGeneration:onGenerationFinish'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.stopObserve();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\trestartObserve()\n\t{\n\t\tif (this.#intervalId)\n\t\t{\n\t\t\tclearInterval(this.#intervalId);\n\t\t}\n\n\t\tthis.#intervalId = setInterval(this.onGenerationRestart, GenerationObserver.INTERVAL);\n\t}\n\n\tstopObserve()\n\t{\n\t\tif (this.#intervalId)\n\t\t{\n\t\t\tclearInterval(this.#intervalId);\n\t\t}\n\t}\n\n\tonGenerationRestart()\n\t{\n\t\tBX.ajax.runAction(\n\t\t\t'landing.api.copilot.executeGeneration',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tgenerationId: this.generationId,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tthis.restartObserve();\n\t}\n}\n"],"names":["GenerationObserver","constructor","generationId","onGenerationRestart","bind","observe","restartObserve","BX","PULL","subscribe","type","PullClient","SubscriptionType","Server","moduleId","callback","event","params","undefined","command","stopObserve","clearInterval","setInterval","INTERVAL","ajax","runAction","data"],"mappings":";;;;;;;AAAA,CAAO,MAAMA,kBAAkB,CAC/B;GAMCC,WAAW,CAACC,YAAoB,EAChC;KAAA;OAAA;OAAA,OAHuB;;KAItB,IAAI,CAACA,YAAY,GAAGA,YAAY;KAChC,IAAI,CAACC,mBAAmB,GAAG,IAAI,CAACA,mBAAmB,CAACC,IAAI,CAAC,IAAI,CAAC;;GAG/DC,OAAO,GACP;KACC,IAAI,CAACC,cAAc,EAAE;KAErBC,EAAE,CAACC,IAAI,CAACC,SAAS,CAAC;OACjBC,IAAI,EAAEH,EAAE,CAACI,UAAU,CAACC,gBAAgB,CAACC,MAAM;OAC3CC,QAAQ,EAAE,SAAS;OACnBC,QAAQ,EAAGC,KAAK,IAAK;SACpB,IACCA,KAAK,CAACC,MAAM,CAACf,YAAY,KAAKgB,SAAS,IACpCF,KAAK,CAACC,MAAM,CAACf,YAAY,KAAK,IAAI,CAACA,YAAY,EAEnD;WACC;;SAGD,MAAMiB,OAAO,GAAGH,KAAK,CAACG,OAAO;SAE7B,IACCA,OAAO,KAAK,wCAAwC,IACjDA,OAAO,KAAK,+CAA+C,IAC3DA,OAAO,KAAK,+CAA+C,EAE/D;WACC,IAAI,CAACb,cAAc,EAAE;;SAGtB,IAAIa,OAAO,KAAK,8CAA8C,EAC9D;WACC,IAAI,CAAChB,mBAAmB,EAAE;;SAG3B,IACCgB,OAAO,KAAK,4CAA4C,IACrDA,OAAO,KAAK,6CAA6C,EAE7D;WACC,IAAI,CAACC,WAAW,EAAE;;;MAGpB,CAAC;;GAGHd,cAAc,GACd;KACC,4CAAI,IAAI,6BACR;OACCe,aAAa,yCAAC,IAAI,4BAAa;;KAGhC,4CAAI,8BAAeC,WAAW,CAAC,IAAI,CAACnB,mBAAmB,EAAEH,kBAAkB,CAACuB,QAAQ,CAAC;;GAGtFH,WAAW,GACX;KACC,4CAAI,IAAI,6BACR;OACCC,aAAa,yCAAC,IAAI,4BAAa;;;GAIjClB,mBAAmB,GACnB;KACCI,EAAE,CAACiB,IAAI,CAACC,SAAS,CAChB,uCAAuC,EACvC;OACCC,IAAI,EAAE;SACLxB,YAAY,EAAE,IAAI,CAACA;;MAEpB,CACD;KAED,IAAI,CAACI,cAAc,EAAE;;CAEvB;CAvFaN,kBAAkB,CAEvBuB,QAAQ,GAAG,KAAK;;;;;;;;"}