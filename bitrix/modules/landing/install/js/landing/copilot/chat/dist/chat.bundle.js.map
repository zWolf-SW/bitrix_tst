{"version":3,"file":"chat.bundle.js","sources":["../src/chat.js"],"sourcesContent":["import { Dom, Loc } from 'main.core';\nimport { CopilotChat as CopilotChatInstance, CopilotChatEvents as cce } from 'ai.copilot-chat.core';\nimport { CopilotChatMessageType as ccmt } from 'ai.copilot-chat.ui';\n\nimport './chat.css';\n\nexport type GetCopilotChatInstanceOptions = {\n\tentityId: string;\n\tchatId?: number;\n\tshowChatButtonElement?: HTMLElement;\n\tisSiteEditChat?: boolean;\n\tscenario?: string;\n};\n\nexport const CopilotChatEvents = cce;\nexport const CopilotChatMessageType = ccmt;\n\nexport class Chat\n{\n\tstatic CopilotChatEvents = cce;\n\tstatic CopilotChatMessageType = ccmt;\n\n\tstatic getCopilotChatInstance(options: GetCopilotChatInstanceOptions): ? CopilotChatInstance\n\t{\n\t\tconst entityId = options.entityId;\n\t\tconst chatId = options.chatId ?? null;\n\t\tconst scenario = options.scenario ?? 'site_with_ai';\n\n\t\treturn new BX.AI.CopilotChat.Core.CopilotChat({\n\t\t\tentityId,\n\t\t\tchatId,\n\t\t\tscenarioCode: scenario,\n\t\t\tentityType: 'landing',\n\t\t\tinitChatExtraOptions: {\n\t\t\t\tisSiteEditChat: options.isSiteEditChat ?? false,\n\t\t\t},\n\t\t\tchatOptions: {\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tcacheable: true,\n\t\t\t\t\twidth: this.getPopupWidth(),\n\t\t\t\t\theight: this.getPopupHeight(options.showChatButtonElement),\n\t\t\t\t\tbindElement: this.getPopupPosition(Boolean(options.showChatButtonElement)),\n\t\t\t\t\tclassName: 'landing__create-site-copilot-chat-popup',\n\t\t\t\t\tanimation: {\n\t\t\t\t\t\tshowClassName: 'create-site-chat-show',\n\t\t\t\t\t\tcloseClassName: 'create-site-chat-hide',\n\t\t\t\t\t\tcloseAnimationType: 'animation',\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupFirstShow: (popup: Popup) => {\n\t\t\t\t\t\t\tpopup.subscribe('onBeforeAdjustPosition', () => {\n\t\t\t\t\t\t\t\tpopup.setHeight(this.getPopupHeight(options.showChatButtonElement));\n\t\t\t\t\t\t\t\tpopup.setBindElement(this.getPopupPosition(Boolean(options.showChatButtonElement)));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\theader: {\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_COPILOT_CHAT_TITLE'),\n\t\t\t\t\tsubtitle: Loc.getMessage('LANDING_COPILOT_CHAT_SUBTITLE'),\n\t\t\t\t\tavatar: '/bitrix/js/landing/copilot/chat/images/avatar.png?v2',\n\t\t\t\t},\n\t\t\t\tbotOptions: {\n\t\t\t\t\tmessageTitle: Loc.getMessage('LANDING_COPILOT_CHAT_BOT_TITLE'),\n\t\t\t\t\tavatar: '/bitrix/js/landing/copilot/chat/images/avatar.png?v2',\n\t\t\t\t},\n\t\t\t\tslots: {\n\t\t\t\t\tLOADER: null,\n\t\t\t\t\tLOADER_ERROR: null,\n\t\t\t\t},\n\t\t\t\tvueComponents: {},\n\t\t\t\tshowCopilotWarningMessage: false,\n\t\t\t\tinputPlaceholder: Loc.getMessage('LANDING_COPILOT_CHAT_INPUT_PLACEHOLDER'),\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic getPopupPosition(usedWithShowPopupButton: boolean): { top: number, left: number }\n\t{\n\t\treturn {\n\t\t\ttop: this.getTopPanelHeight() + this.getPopupVerticalOffset(),\n\t\t\tleft: document.body.clientWidth - this.getPopupWidth() - this.getPopupHorizontalOffset(usedWithShowPopupButton),\n\t\t};\n\t}\n\n\tstatic getPopupWidth(): number\n\t{\n\t\treturn 375;\n\t}\n\n\tstatic getPopupHeight(showChatButton: HTMLElement): number\n\t{\n\t\tconst showChatButtonPos = Dom.getPosition(showChatButton);\n\n\t\treturn (showChatButtonPos.top || window.innerHeight) - this.getTopPanelHeight() - this.getPopupVerticalOffset() * 2;\n\t}\n\n\tstatic getPopupVerticalOffset(): number\n\t{\n\t\treturn 15;\n\t}\n\n\tstatic getPopupHorizontalOffset(usedWithShowPopupButton: boolean): number\n\t{\n\t\treturn usedWithShowPopupButton ? 32 : 12;\n\t}\n\n\tstatic getTopPanelHeight(): number\n\t{\n\t\treturn 66;\n\t}\n}\n"],"names":["CopilotChatEvents","cce","CopilotChatMessageType","ccmt","Chat","getCopilotChatInstance","options","entityId","chatId","scenario","BX","AI","CopilotChat","Core","scenarioCode","entityType","initChatExtraOptions","isSiteEditChat","chatOptions","popupOptions","cacheable","width","getPopupWidth","height","getPopupHeight","showChatButtonElement","bindElement","getPopupPosition","Boolean","className","animation","showClassName","closeClassName","closeAnimationType","events","onPopupFirstShow","popup","subscribe","setHeight","setBindElement","header","title","Loc","getMessage","subtitle","avatar","botOptions","messageTitle","slots","LOADER","LOADER_ERROR","vueComponents","showCopilotWarningMessage","inputPlaceholder","usedWithShowPopupButton","top","getTopPanelHeight","getPopupVerticalOffset","left","document","body","clientWidth","getPopupHorizontalOffset","showChatButton","showChatButtonPos","Dom","getPosition","window","innerHeight"],"mappings":"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"}