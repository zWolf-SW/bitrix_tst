{"version":3,"file":"booking-resource-auto-selection.bundle.js","sources":["../src/images/resource-auto-selection-icon.svg","../src/booking-resource-auto-selection.js"],"sourcesContent":["export default \"/bitrix/js/landing/ui/panel/formsettingspanel/content/booking-resource-auto-selection/dist/images/resource-auto-selection-icon.svg\"","import { Reflection, Tag } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { CrmFormSettingsDataPropName } from 'booking.const';\n\nimport { Loc } from 'landing.loc';\nimport { HeaderCard } from 'landing.ui.card.headercard';\nimport { MessageCard } from 'landing.ui.card.messagecard';\nimport { ContentWrapper } from 'landing.ui.panel.basepresetpanel';\nimport { FormSettingsForm } from 'landing.ui.form.formsettingsform';\n\nimport 'ui.sidepanel-content';\n\nimport resourceAutoSelectionIcon from './images/resource-auto-selection-icon.svg';\n\nexport default class BookingResourceAutoSelection extends ContentWrapper\n{\n\t#options;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.#options = options;\n\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.BookingResourceAutoSelectionContent');\n\n\t\tthis.addItem(this.#getHeaderCard());\n\t\tthis.addItem(this.#getMessageCard());\n\t\tthis.addItem(this.#getSettingsForm());\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember(\n\t\t\t'layout',\n\t\t\t() => Tag.render`<div class=\"landing-ui-content-booking-resource-auto-selection\"></div>`,\n\t\t);\n\t}\n\n\tvalueReducer(value): { bookingResourceAutoSelection: { use: boolean } }\n\t{\n\t\tconst checked = Boolean(this.#getSettingsForm().isOpened());\n\n\t\treturn {\n\t\t\tdata: this.#getFormOptionData(checked),\n\t\t\tbookingResourceAutoSelection: {\n\t\t\t\t...value,\n\t\t\t\tuse: checked,\n\t\t\t},\n\t\t};\n\t}\n\n\tonChange(event: BaseEvent): void\n\t{\n\t\tthis.emit('onChange', { ...event.getData(), skipPrepare: true });\n\t}\n\n\t#getFormOptionData(checked: boolean): Array\n\t{\n\t\tconst bookingField = this.#options?.formOptions?.data?.fields?.find(({ id }) => id === 'BOOKING_BOOKING');\n\t\tif (!bookingField)\n\t\t{\n\t\t\treturn this.#options?.formOptions?.data;\n\t\t}\n\n\t\tconst settingsData = bookingField.settingsData || {};\n\t\tsettingsData[CrmFormSettingsDataPropName.isAutoSelectionOn] = checked;\n\t\tsettingsData[CrmFormSettingsDataPropName.autoSelection] = Object.assign(\n\t\t\t(settingsData[CrmFormSettingsDataPropName.autoSelection] || {}),\n\t\t\t{ hasSlotsAllAvailableResources: false },\n\t\t);\n\n\t\tbookingField.settingsData = {\n\t\t\t...settingsData,\n\t\t};\n\n\t\treturn this.#options.formOptions.data;\n\t}\n\n\t#getHeaderCard(): HeaderCard\n\t{\n\t\treturn new HeaderCard({\n\t\t\ttitle: Loc.getMessage('LANDING_FORM_BOOKING_RESOURCE_AUTO_SELECTION_TITLE'),\n\t\t});\n\t}\n\n\t#getMessageCard(): MessageCard\n\t{\n\t\treturn new MessageCard({\n\t\t\tid: 'bookingResourceAutoSelectionMessage',\n\t\t\theader: Loc.getMessage('LANDING_FORM_BOOKING_RESOURCE_AUTO_SELECTION_MESSAGE_HEADER'),\n\t\t\tdescription: Loc.getMessage('LANDING_FORM_BOOKING_RESOURCE_AUTO_SELECTION_MESSAGE_DESCRIPTION'),\n\t\t\trestoreState: true,\n\t\t\tcloseable: false,\n\t\t\tangle: false,\n\t\t\tmore: () => {\n\t\t\t\tconst helper = Reflection.getClass('top.BX.Helper');\n\t\t\t\tif (helper)\n\t\t\t\t{\n\t\t\t\t\tBX.Helper.show('redirect=detail&code=25366370');\n\t\t\t\t}\n\t\t\t},\n\t\t\ticon: resourceAutoSelectionIcon,\n\t\t});\n\t}\n\n\t#getSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('bookingResourceAutoSelectionForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\tid: 'bookingResourceAutoSelection',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_BOOKING_RESOURCE_AUTO_SELECTION_SELECTOR'),\n\t\t\t\ttoggleable: true,\n\t\t\t\topened: this.options.formOptions.bookingResourceAutoSelection.use,\n\t\t\t\tfields: [],\n\t\t\t});\n\t\t});\n\t}\n}\n"],"names":["BookingResourceAutoSelection","options","setEventNamespace","addItem","cache","remember","Tag","render","value","checked","Boolean","isOpened","data","bookingResourceAutoSelection","use","event","emit","getData","skipPrepare","ContentWrapper","bookingField","formOptions","fields","find","id","settingsData","CrmFormSettingsDataPropName","isAutoSelectionOn","autoSelection","Object","assign","hasSlotsAllAvailableResources","HeaderCard","title","Loc","getMessage","MessageCard","header","description","restoreState","closeable","angle","more","helper","Reflection","getClass","BX","Helper","show","icon","resourceAutoSelectionIcon","FormSettingsForm","toggleable","opened"],"mappings":"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"}