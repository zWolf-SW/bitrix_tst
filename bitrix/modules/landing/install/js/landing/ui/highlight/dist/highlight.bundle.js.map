{"version":3,"file":"highlight.bundle.js","sources":["../src/highlight.js"],"sourcesContent":["import { Dom, Runtime, Type, Text } from 'main.core';\nimport { PageObject } from 'landing.pageobject';\n\ntype HighlightItem = {\n\tnode: HTMLElement,\n\thighlight: HTMLDivElement, // layout\n}\n\n/**\n * Implements interface for works with highlights\n * Implements singleton pattern\n * @memberOf BX.Landing.UI\n */\nexport class Highlight\n{\n\tlayout: HTMLDivElement;\n\tisSingle: boolean = false;\n\tlocalStore: ?BX.Landing.Collection.BaseCollection = null;\n\n\tstatic getInstance(): Highlight\n\t{\n\t\tif (!Highlight.instance)\n\t\t{\n\t\t\tHighlight.instance = new Highlight();\n\t\t}\n\n\t\treturn Highlight.instance;\n\t}\n\n\t/**\n\t * Collection of HighlightItem elements\n\t * @type {null}\n\t */\n\tstatic highlightsStore = null;\n\n\tstatic get highlights(): BX.Landing.Collection.BaseCollection\n\t{\n\t\tif (!Highlight.highlightsStore)\n\t\t{\n\t\t\tHighlight.highlightsStore = new BX.Landing.Collection.BaseCollection();\n\t\t}\n\n\t\treturn Highlight.highlightsStore;\n\t}\n\n\tstatic defaultBorderColor = '#2fc6f6';\n\tstatic defaultBorderWidth = 2;\n\tstatic defaultBackground = 'rgba(47, 198, 246, .15)';\n\n\tconstructor()\n\t{\n\t\tthis.id = Text.getRandom(8);\n\t\tthis.layout = Dom.create('div');\n\n\t\tDom.addClass(this.layout, 'landing-highlight-border');\n\t\tDom.style(this.layout, {\n\t\t\tposition: 'absolute',\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t\tright: 0,\n\t\t\tbottom: 0,\n\t\t\t'z-index': 9999,\n\t\t\topacity: '.4',\n\t\t\t'pointer-events': 'none',\n\t\t\ttransform: 'translateZ(0)',\n\t\t\t'background-color': 'rgba(47, 198, 246, .15)',\n\t\t});\n\t\tthis.setBorder(Highlight.defaultBorderColor, Highlight.defaultBorderWidth);\n\t\tthis.setBackground(Highlight.defaultBackground);\n\t}\n\n\t/**\n\t * If true - this highlight will not depend on others.\n\t * You should full control (show and hide) them! Use carefully\n\t * @param flag\n\t * @returns {BX.Landing.UI.Highlight}\n\t */\n\tsetSingleMode(flag: boolean = true): Highlight\n\t{\n\t\tif (flag)\n\t\t{\n\t\t\tthis.localStore = new BX.Landing.Collection.BaseCollection();\n\t\t}\n\t\tthis.isSingle = flag;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Set border color\n\t * @param {string} color - HEX string\n\t * @param {number} width - border width in px, just number\n\t * @returns {BX.Landing.UI.Highlight}\n\t */\n\tsetBorder(color: string, width: ?number = Highlight.defaultBorderWidth): Highlight\n\t{\n\t\tDom.style(this.layout, {\n\t\t\tborder: `${width}px ${color} dashed`,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param {string} bg - any valid color string (hex, rgba etc). Remember about opacity!\n\t * @returns {BX.Landing.UI.Highlight}\n\t */\n\tsetBackground(bg: string): Highlight\n\t{\n\t\tDom.style(this.layout, {\n\t\t\t'background-color': bg,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Shows highlight for node\n\t * @param {HTMLElement|HTMLElement[]} node\n\t * @param {object} [rect]\n\t */\n\tshow(node, rect)\n\t{\n\t\tthis.hide();\n\t\tif (Type.isArray(node))\n\t\t{\n\t\t\tnode.forEach((element) => {\n\t\t\t\tthis.#highlightNode(element);\n\t\t\t});\n\t\t}\n\t\telse if (Type.isDomNode(node))\n\t\t{\n\t\t\tthis.#highlightNode(node, rect);\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param node\n\t * @param {object} rect\n\t */\n\t#highlightNode(node, rect)\n\t{\n\t\tconst highlight = Runtime.clone(this.layout);\n\n\t\tif (rect)\n\t\t{\n\t\t\tBX.DOM.write(() => {\n\t\t\t\tDom.style(highlight, {\n\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\twidth: `${rect.width}px`,\n\t\t\t\t\theight: `${rect.height}px`,\n\t\t\t\t\ttop: `${rect.top}px`,\n\t\t\t\t\tleft: `${rect.left}px`,\n\t\t\t\t\tright: `${rect.right}px`,\n\t\t\t\t\tbottom: `${rect.bottom}px`,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tconst editor = PageObject.getEditorWindow();\n\t\t\tif (editor)\n\t\t\t{\n\t\t\t\tBX.DOM.write(() => {\n\t\t\t\t\tDom.append(highlight, editor.document.body);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.DOM.write(() => {\n\t\t\t\tDom.append(highlight, node);\n\t\t\t});\n\t\t}\n\n\t\tBX.DOM.write(() => {\n\t\t\tDom.style(node, {\n\t\t\t\tposition: 'relative',\n\t\t\t\tuserSelect: 'none',\n\t\t\t\tcursor: 'pointer',\n\t\t\t});\n\t\t});\n\n\t\tif (this.isSingle)\n\t\t{\n\t\t\tthis.localStore.add({node, highlight});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHighlight.highlights.add({node, highlight});\n\t\t}\n\t}\n\n\t/**\n\t * Hides highlight for all nodes\n\t * @param force - if true - remove highlight immediately, without requestAnimationFrame\n\t */\n\thide(force: boolean = false)\n\t{\n\t\tconst store = this.isSingle ? this.localStore : Highlight.highlights;\n\t\tstore.forEach((item: HighlightItem) => {\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.#hideNode(item);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.DOM.write(this.#hideNode.bind(this, item));\n\t\t\t}\n\t\t});\n\n\t\tstore.clear();\n\t}\n\n\t#hideNode(item: HighlightItem)\n\t{\n\t\tDom.remove(item.highlight);\n\t\tDom.style(item.node, {\n\t\t\tposition: '',\n\t\t\tuserSelect: '',\n\t\t\tcursor: '',\n\t\t});\n\t}\n}\n"],"names":["Highlight","instance","highlightsStore","BX","Landing","Collection","BaseCollection","id","Text","getRandom","layout","Dom","create","addClass","style","position","top","left","right","bottom","opacity","transform","setBorder","defaultBorderColor","defaultBorderWidth","setBackground","defaultBackground","flag","localStore","isSingle","color","width","border","bg","node","rect","hide","Type","isArray","forEach","element","isDomNode","force","store","highlights","item","DOM","write","bind","clear","highlight","Runtime","clone","height","editor","PageObject","getEditorWindow","append","document","body","userSelect","cursor","add","remove"],"mappings":"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"}