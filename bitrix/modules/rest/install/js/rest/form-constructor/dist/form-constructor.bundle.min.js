this.BX=this.BX||{};(function(e,t,s,i){"use strict";let r=e=>e,a,o;var n=babelHelpers.classPrivateFieldLooseKey("errorBlock");class l extends i.EventEmitter{constructor(e){var t;super();Object.defineProperty(this,n,{writable:true,value:void 0});this.setEventNamespace("BX.Rest.EInvoice.Field");this.options=e;this.value=(t=this.options.value)!=null?t:null;this.readySave=!(s.Type.isNil(this.value)||this.value==="");this.options.id=s.Type.isStringFilled(this.options.id)?this.options.id:s.Text.getRandom(8)}getId(){return this.options.id}getName(){return this.options.name}getContent(){const e=s.Tag.render(a||(a=r`
			<div class="container"></div>
		`));s.Dom.append(this.renderFieldContainer(),e);s.Dom.append(this.renderErrorsContainer(),e);s.Dom.hide(this.renderErrorsContainer());this.subscribe("error",(t=>{const i=t.data.messages;this.renderErrorsContainer().innerHTML=s.Type.isArray(i)?i.join("<br>"):i;s.Dom.show(this.renderErrorsContainer());if(!s.Dom.hasClass(e,"ui-ctl-warning")){s.Dom.addClass(e,"ui-ctl-warning")}}));return e}renderFieldContainer(){throw new Error("Must be implemented in a child class")}isReadySave(){return this.readySave}renderErrorsContainer(){if(!babelHelpers.classPrivateFieldLooseBase(this,n)[n]){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=s.Tag.render(o||(o=r`
				<div class="ui-ctl-bottom bitrix-einvoice-error-block"></div>
			`))}return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}getValue(){return this.value}}let d=e=>e,c,p,v;class h extends l{constructor(e){super(e);this.readySave=true}renderFieldContainer(){const e=s.Tag.render(c||(c=d`
			<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">
				<div class="ui-ctl-after ui-ctl-icon-angle"></div>
			</div>
		`));if(s.Type.isArray(this.options.items)){const t=s.Tag.render(p||(p=d`
				<select class="ui-ctl-element" id="${0}" />
			`),this.getId());this.options.items.forEach((e=>{const i=s.Tag.render(v||(v=d`
					<option value="${0}">${0}</option>
				`),e.value,e.name);if(this.options.value===e.value){s.Dom.attr(i,{selected:true})}s.Dom.append(i,t)}));s.Dom.append(t,e);s.Event.bind(t,"change",(e=>{this.value=e.target.value;if(Object.prototype.hasOwnProperty.call(this.options,"updateForm")&&this.options.updateForm){this.emit("onFieldChange",{target:e.target,field:this})}}))}return e}}let u=e=>e,b,f,g;var m=babelHelpers.classPrivateFieldLooseKey("onInput");class y extends l{constructor(...e){super(...e);Object.defineProperty(this,m,{value:F})}renderFieldContainer(){const e=s.Tag.render(b||(b=u`
			<div class="ui-ctl-container"/>
		`));if(this.options.label){const t=s.Tag.render(f||(f=u`
				<div class="ui-ctl-top">
					<div class="ui-ctl-title">${0}</div>
				</div>
			`),this.options.label);s.Dom.append(t,e)}const t=s.Tag.render(g||(g=u`
			<div class="ui-ctl ui-ctl-textbox">
				<input type="text" id="${0}" class="ui-ctl-element">
			</div>
		`),this.getId());const i=t.querySelector("input");if(this.options.placeholder){s.Dom.attr(i,{placeholder:this.options.placeholder})}if(this.options.value){s.Dom.attr(i,{value:this.options.value})}s.Event.bind(i,"paste",(t=>{setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m](e,t)}),0)}));s.Event.bind(i,"input",(t=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m](e,t)}));s.Dom.append(t,e);return e}}function F(e,t){s.Dom.hide(this.renderErrorsContainer());if(s.Dom.hasClass(e,"ui-ctl-warning")){s.Dom.removeClass(e,"ui-ctl-warning")}if(s.Type.isNil(t.target.value)||t.target.value===""){this.emit("onUnreadySave");this.readySave=false}else{this.emit("onReadySave");this.readySave=true}this.value=t.target.value}let B=e=>e,P,w,E,H;var C=babelHelpers.classPrivateFieldLooseKey("options");var L=babelHelpers.classPrivateFieldLooseKey("fields");var T=babelHelpers.classPrivateFieldLooseKey("stepByStep");var D=babelHelpers.classPrivateFieldLooseKey("getContentConfig");var x=babelHelpers.classPrivateFieldLooseKey("getStepContent");class S extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,x,{value:j});Object.defineProperty(this,D,{value:k});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});this.setEventNamespace("BX.Rest.EInvoice");if(!s.Type.isArray(e.steps)){throw new Error('Unexpected property type  "steps", expected type array')}babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=[];babelHelpers.classPrivateFieldLooseBase(this,T)[T]=new t.StepByStep({content:babelHelpers.classPrivateFieldLooseBase(this,D)[D]()})}getFields(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}render(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].getContentWrapper()}renderTo(e){babelHelpers.classPrivateFieldLooseBase(this,T)[T].target=e;babelHelpers.classPrivateFieldLooseBase(this,T)[T].init()}getFormData(){let e={};babelHelpers.classPrivateFieldLooseBase(this,L)[L].forEach((t=>{if(t.isReadySave()){e[t.getName()]=t.getValue()}}));return e}showFieldErrors(e){for(const[t,s]of Object.entries(e)){babelHelpers.classPrivateFieldLooseBase(this,L)[L].forEach((e=>{if(e.getName()===t){e.emit("error",new i.BaseEvent({data:{messages:s}}))}}))}}showTextInBalloon(e){BX.UI.Notification.Center.notify({id:"einvoice-error-save-settings",content:s.Tag.render(P||(P=B`
						<div class="bitrix-einvoice-settings-notification-wrapper">
							<span class="ui-icon-set --warning"></span>
							${0}
						</div>
					`),e),autoHideDelay:5e3})}}function k(){const e=[];babelHelpers.classPrivateFieldLooseBase(this,C)[C].steps.forEach((t=>{const s={html:[{backgroundColor:"#ffffff"}]};if(t.title){s.html[0].header={title:t.title}}s.html[0].node=babelHelpers.classPrivateFieldLooseBase(this,x)[x](t);e.push(s)}));return e}function j(e){const t=s.Tag.render(w||(w=B`
			<div class="bitrix-einvoice-settings-step__wrapper"></div>
		`));if(e.description){const i=s.Tag.render(E||(E=B`
				<div class="bitrix-einvoice-settings-step__description">${0}</div>
			`),e.description);s.Dom.append(i,t)}if(e.fields){e.fields.forEach(((e,i)=>{let r;switch(e.type){case"input":r=new y(e);break;case"dropdown-list":r=new h(e);break;default:throw new Error("Incorrect field type")}if(r instanceof l){r.subscribe("onReadySave",(()=>{this.emit("onReadySave")}));r.subscribe("onUnreadySave",(()=>{this.emit("onUnreadySave")}));r.subscribe("onFieldChange",(e=>{this.emit("onFieldChange",e)}));babelHelpers.classPrivateFieldLooseBase(this,L)[L].push(r);const e=r.getContent();s.Dom.append(e,t);if(i>0){s.Dom.style(e,"margin-top","12px")}}}))}if(e.link&&e.link.url.startsWith("https://")){const i=s.Tag.render(H||(H=B`
				<div class="bitrix-einvoice-settings-step-wrapper-link">
					<a href="${0}" class="bitrix-einvoice-settings-step__link">${0}</a>
				</div>
			`),e.link.url,s.Text.encode(e.link.name));s.Dom.append(i,t)}return t}e.FormConstructor=S})(this.BX.Rest=this.BX.Rest||{},BX.UI,BX,BX.Event);
//# sourceMappingURL=form-constructor.bundle.map.js