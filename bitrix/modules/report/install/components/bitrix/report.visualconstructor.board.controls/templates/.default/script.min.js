(function(){"use strict";BX.namespace("BX.Report.VisualConstructor.Board");BX.Report.VisualConstructor.Board.Controls=function(o){this.addFormSlider=null;this.reportCategories=o.reportCategories;this.configurationButton=o.configurationButton;this.boardId=o.boardId;this.demoToggle=o.demoToggle;this.init()};BX.Report.VisualConstructor.Board.Controls.prototype={init:function(){BX.bind(BX("add_report_popup_button"),"click",this.handlePopupButtonClick.bind(this));BX.bind(this.configurationButton,"click",this.handleConfigurationButtonClick.bind(this));BX.addCustomEvent("BX.Report.VisualConstructor.afterWidgetAdd",this.closeSlider.bind(this))},handleConfigurationButtonClick:function(){if(this.confirmationPopup){return}this.confirmationPopup=new BX.Main.Menu({id:"visualconstructor-dashboard-configuration-popup",bindElement:this.configurationButton,closeByEsc:true,autoHide:true,cacheable:false,items:[{text:this.getToggleBoardTitle(),onclick:this.toggleBoard.bind(this)},{text:this.getDemoModeToggleButtonTitle(),onclick:this.toggleDemoMode.bind(this)}],events:{onPopupClose:()=>{this.confirmationPopup=null}}});this.confirmationPopup.show()},handlePopupButtonClick:function(){this.openSlider()},openSlider:function(){this.addFormSlider=BX.SidePanel.Instance;this.addFormSlider.open("widget:add-widget-to-board",{cacheable:false,contentCallback:BX.delegate((function o(t){var e=new BX.Promise;BX.Report.VC.Core.ajaxGet("board.showAddForm",{urlParams:{categories:this.reportCategories,boardId:this.boardId},onFullSuccess:BX.delegate((function(o){t.getData().set("addFormContent",o.data);e.fulfill(o.data);var i=t.getContentContainer();i.addEventListener("scroll",(function(){BX.Report.VC.PopupWindowManager.adjustPopupsPositions()}))}),this)});return e}),this),animationDuration:100,width:950,events:{onLoad:function(o){var t=o.getSlider();BX.html(null,t.getData().get("addFormContent"))},onClose:function(){BX.Report.VC.PopupWindowManager.closeAllPopups()}}})},closeSlider:function(){this.addFormSlider.closeAll()},getToggleBoardTitle:function(){return BX.message("VISUALCONSTRUCTOR_DASHBOARD_GO_TO_DEFAULT")},getDesignerModeToggleButtonTitle:function(){var o=BX.VisualConstructor.BoardRepository.getBoard(this.boardId).getDashboard();return!o.isDesignerMode()?BX.message("VISUALCONSTRUCTOR_DASHBOARD_DESIGN_MODE_ON_TITLE"):BX.message("VISUALCONSTRUCTOR_DASHBOARD_DESIGN_MODE_OFF_TITLE")},getDemoModeToggleButtonTitle:function(){var o=BX.VisualConstructor.BoardRepository.getBoard(this.boardId);return!o.isDemoMode()?BX.message("VISUALCONSTRUCTOR_DASHBOARD_DEMO_MODE_ON_TITLE"):BX.message("VISUALCONSTRUCTOR_DASHBOARD_DEMO_MODE_OFF_TITLE")},toggleBoard:function(){BX.Report.VC.Core.abortAllRunningRequests();BX.Report.VC.Core.ajaxPost("board.toggleToDefault",{data:{boardKey:this.boardId},onFullSuccess:BX.delegate((function(o){var t=BX.VisualConstructor.BoardRepository.getBoard(this.boardId);if(!o.errors.length){t.getDashboard().clearRows();t.getDashboard().destroy();BX.Report.VC.Core.ajaxGet("widget.loadByBoardId",{urlParams:{boardId:this.boardId},onFullSuccess:BX.delegate((function(o){if(o.data.rows){t.getDashboard().addRows(o.data.rows);t.getDashboard().render()}}),this)})}}),this)});this.confirmationPopup.close()},toggleBoardDesignerMode:function(){var o=BX.VisualConstructor.BoardRepository.getBoard(this.boardId).getDashboard();o.toggleDesignerMode();this.confirmationPopup.close()},toggleDemoMode:function(){var o=BX.VisualConstructor.BoardRepository.getBoard(this.boardId);o.toggleDemoMode();this.confirmationPopup.close()}}})();
//# sourceMappingURL=script.map.js