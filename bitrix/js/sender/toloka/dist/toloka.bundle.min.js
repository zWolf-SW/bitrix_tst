this.BX=this.BX||{};(function(e,t){"use strict";var i={value:"data-value",name:"data-name",disabled:"data-disabled",class:"class",type:"type"};var s=function(){function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};babelHelpers.classCallCheck(this,e);this._node=t instanceof HTMLElement?t:document.createElement(t);this._config={i18n:s};this._setAttributes(i);if(i.textContent){this._setTextContent(i.textContent)}return this}babelHelpers.createClass(e,[{key:"get",value:function e(){return this._node}},{key:"append",value:function e(t){this._node.appendChild(t);return this}},{key:"addClass",value:function e(t){this._node.classList.add(t);return this}},{key:"removeClass",value:function e(t){this._node.classList.remove(t);return this}},{key:"toggleClass",value:function e(t){this._node.classList.toggle(t);return this}},{key:"addEventListener",value:function e(t,i){this._node.addEventListener(t,i);return this}},{key:"removeEventListener",value:function e(t,i){this._node.removeEventListener(t,i);return this}},{key:"setText",value:function e(t){this._setTextContent(t);return this}},{key:"getHeight",value:function e(){return window.getComputedStyle(this._node).height}},{key:"getWidth",value:function e(){return window.getComputedStyle(this._node).width}},{key:"setTop",value:function e(t){this._node.style.top="".concat(t,"px");return this}},{key:"focus",value:function e(){this._node.focus();return this}},{key:"_setTextContent",value:function e(t){this._node.textContent=t}},{key:"_setAttributes",value:function e(t){for(var s in t){if(i[s]&&t[s]){this._setAttribute(i[s],t[s])}}}},{key:"_setAttribute",value:function e(t,i){this._node.setAttribute(t,i)}},{key:"_getAttribute",value:function e(t){this._node.getAttribute(t)}}]);return e}();function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var r={select:"main-ui-control",dropdownShown:"autocomplete-select--opened",multiselect:"main-ui-multi-select",label:"main-ui-square-container",placeholder:"autocomplete-placeholder",dropdown:"popup-select-content",option:"main-ui-select-inner-item",remove:"main-ui-item-icon main-ui-square-delete",optionDisabled:"autocomplete-option--disabled",autocompleteInput:"main-ui-control main-ui-control-string",selectedLabel:"main-ui-square",selectedOption:"autocomplete-option--selected",placeholderHidden:"autocomplete-placeholder--hidden",optionHidden:"autocomplete-option--hidden"};var n=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this._config=l(l({},i),{},{classNames:l(l({},r),i.classNames),disabledOptions:[]});this._state={opened:false};this._icons=[];this._holderElement=t;this._boundHandleClick=this._handleClick.bind(this);this._boundUnselectOption=this._unselectOption.bind(this);this._boundSortOptions=this._sortOptions.bind(this);this._body=new s(document.body);this._create(t);if(!this._config.value){return}this._setValue()}babelHelpers.createClass(e,[{key:"setOptions",value:function e(t){this._config.options=t;this._options=this._generateOptions()}},{key:"value",value:function e(){return this._config.value}},{key:"removeAutocompleteNode",value:function e(){BX.remove(this._autocomplete.get());this._options.map((function(e){BX.remove(e.get())}))}},{key:"reset",value:function e(){this._config.value=this._config.multiple?[]:null;this._setValue()}},{key:"_create",value:function e(i){var a=typeof i==="string"?document.querySelector(i):i;this._parent=new s(a);var l=a.querySelectorAll("div[data-name=".concat(a.dataset.name,"]"))[0];var r=l.cloneNode(true);a.removeChild(l);this._select=new s(r);this._label=new s("span",{class:this._config.classNames.label});this._optionsWrapper=new s("div",{class:this._config.classNames.dropdown});if(this._config.multiple){this._select.addClass(this._config.classNames.multiselect)}this._options=this._generateOptions();this._select.addEventListener("click",this._boundHandleClick);this._select.append(this._label.get());var n=this._parent.get().parentNode.querySelectorAll("div.main-ui-control-value-delete");if(n.length>0){BX.bind(n[0],"click",this.reset.bind(this));this._select.append(n[0])}this._parent.append(this._select.get());this._placeholder=new s("div",{class:this._config.classNames.placeholder,textContent:this._config.placeholder});this._select.append(this._placeholder.get());this._popup=new t.Popup({id:"autocomplete"+Math.random(),bindElement:i,zIndex:3e3,width:515,maxHeight:300});this._popup.setContent(this._optionsWrapper.get())}},{key:"_generateOptions",value:function e(){var t=this;if(this._config.autocomplete&&!this._autocomplete){this._autocomplete=new s("input",{class:this._config.classNames.autocompleteInput,name:"autocomplete-".concat(this._parent.get().dataset.name),type:"text"});this._autocomplete.addEventListener("input",this._boundSortOptions);this._optionsWrapper.append(this._autocomplete.get())}return this._config.options.map((function(e){var i=document.querySelectorAll("div.".concat(t._config.classNames.option,'[data-value="').concat(e.id,'"]'));if(i.length>0){return new s(i[0])}var a=new s("div",{class:"".concat(t._config.classNames.option).concat(e.disabled?" "+t._config.classNames.optionDisabled:""),value:e.id,textContent:e.name,disabled:e.disabled});if(e.disabled){t._config.disabledOptions.push(String(e.id))}t._optionsWrapper.append(a.get());return a}))}},{key:"_handleClick",value:function e(t){t.stopPropagation();if(t.target.className===this._config.classNames.autocompleteInput){return}if(this._state.opened){var i=this._options.find((function(e){if(e){return e.get()===t.target}}));if(i!==undefined){this._setValue(i.get().getAttribute("data-value"),true)}this._popup.close();this._select.removeClass(this._config.classNames.dropdownShown);this._body.removeEventListener("click",this._boundHandleClick);this._select.addEventListener("click",this._boundHandleClick);this._state.opened=false;return}if(t.target.className===this._config.icon){return}this._popup.show();this._select.addClass(this._config.classNames.dropdownShown);this._body.addEventListener("click",this._boundHandleClick);this._select.removeEventListener("click",this._boundHandleClick);this._state.opened=true;if(this._autocomplete){this._autocomplete.focus()}}},{key:"_prepareDataValue",value:function e(){var t=this;var i=[];this._config.options.forEach((function(e){t._config.value.forEach((function(t){if(e.id.toString()===t){i.push({NAME:e.name,VALUE:e.id.toString()})}}))}));this._parent.get().dataset.value=JSON.stringify(i);this._select.get().dataset.value=JSON.stringify(i);return i}},{key:"_setValue",value:function e(t,i,s){var a=this;if(this._config.disabledOptions.indexOf(t)>-1){return}if(t&&!s){this._config.value=this._config.multiple?[].concat(babelHelpers.toConsumableArray(this._config.value||[]),[t]):t}if(t&&s){this._config.value=t}this._options.forEach((function(e){e.removeClass(a._config.classNames.selectedOption)}));this._placeholder.removeClass(this._config.classNames.placeholderHidden);if(this._config.multiple){var l=this._config.value.map((function(e){var t=a._config.options.find((function(t){if(t){return t.id.toString()===e}}));if(!t){return false}var i=a._options.find((function(e){if(e){return e.get().getAttribute("data-value")===t.id.toString()}}));i.addClass(a._config.classNames.selectedOption);return t}));if(l.length){this._placeholder.addClass(this._config.classNames.placeholderHidden)}this._selectOptions(l,i);this._prepareDataValue();return}var r=this._config.value?this._config.options.find((function(e){if(e){e.id.toString()===a._config.value}})):this._config.options[0];var n=this._options.find((function(e){if(e){e.get().getAttribute("data-value")===r.id.toString()}}));this._prepareDataValue();if(!this._config.value){this._label.setText("");return}n.addClass(this._config.classNames.selectedOption);this._placeholder.addClass(this._config.classNames.placeholderHidden);this._selectOption(r,i)}},{key:"_selectOption",value:function e(t,i){this._selectedOption=t;this._label.setText(t.name);if(this._config.onChange&&i){this._config.onChange(t.id,this._prepareDataValue())}}},{key:"_selectOptions",value:function e(t,i){var a=this;this._label.setText("");this._icons=t.map((function(e){if(e){var t=new s("span",{class:a._config.classNames.selectedLabel,textContent:e.name});var i=new s("span",{class:"".concat(a._config.classNames.remove),value:e.id});i.addEventListener("click",a._boundUnselectOption);t.append(i.get());a._label.append(t.get());return i.get()}}));if(i){this._optionsWrapper.setTop(Number(this._select.getHeight().split("px")[0])+5)}if(this._config.onChange&&i){this._config.onChange(this._config.value,this._prepareDataValue())}}},{key:"_unselectOption",value:function e(t){var i=babelHelpers.toConsumableArray(this._config.value);var s=i.indexOf(t.target.getAttribute("data-value"));if(s!==-1){i.splice(s,1)}this._setValue(i,true,true)}},{key:"_sortOptions",value:function e(t){var i=this;this._options.forEach((function(e){if(!e.get().textContent.toLowerCase().startsWith(t.target.value.toLowerCase())){e.addClass(i._config.classNames.optionHidden);return}e.removeClass(i._config.classNames.optionHidden)}))}}]);return e}();function o(e,t,i){c(e,t);t.set(e,i)}function c(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var d=new WeakMap;var u=new WeakMap;var p=new WeakMap;var h=new WeakMap;var v=new WeakMap;var b=new WeakMap;var f=new WeakMap;var _=new WeakMap;var g=new WeakMap;var m=new WeakMap;var P=new WeakMap;var H=new WeakMap;var F=new WeakMap;var y=new WeakMap;var k=new WeakMap;var N=new WeakMap;var w=new WeakMap;var G=new WeakMap;var S=new WeakMap;var C=new WeakMap;var O=new WeakMap;var E=new WeakMap;var I=new WeakMap;var T=new WeakMap;var B=new WeakMap;var A=new WeakMap;var W=new WeakMap;var L=new WeakMap;var M=new WeakMap;var D=new WeakMap;var X=new WeakMap;var U=new WeakMap;var x=new WeakMap;var j=new WeakMap;var R=new WeakMap;var q=function(){function e(){babelHelpers.classCallCheck(this,e);o(this,d,{writable:true,value:BX.Sender.Page});o(this,u,{writable:true,value:BX.Sender.Helper});o(this,p,{writable:true,value:void 0});o(this,h,{writable:true,value:void 0});o(this,v,{writable:true,value:void 0});o(this,b,{writable:true,value:void 0});o(this,f,{writable:true,value:void 0});o(this,_,{writable:true,value:void 0});o(this,g,{writable:true,value:void 0});o(this,m,{writable:true,value:void 0});o(this,P,{writable:true,value:void 0});o(this,H,{writable:true,value:void 0});o(this,F,{writable:true,value:void 0});o(this,y,{writable:true,value:void 0});o(this,k,{writable:true,value:void 0});o(this,N,{writable:true,value:void 0});o(this,w,{writable:true,value:void 0});o(this,G,{writable:true,value:void 0});o(this,S,{writable:true,value:void 0});o(this,C,{writable:true,value:void 0});o(this,O,{writable:true,value:void 0});o(this,E,{writable:true,value:void 0});o(this,I,{writable:true,value:void 0});o(this,T,{writable:true,value:null});o(this,B,{writable:true,value:void 0});o(this,A,{writable:true,value:void 0});o(this,W,{writable:true,value:void 0});o(this,L,{writable:true,value:void 0});o(this,M,{writable:true,value:void 0});o(this,D,{writable:true,value:void 0});o(this,X,{writable:true,value:"REGION_BY_IP"});o(this,U,{writable:true,value:"REGION_BY_PHONE"});o(this,x,{writable:true,value:void 0});o(this,j,{writable:true,value:void 0});o(this,R,{writable:true,value:void 0})}babelHelpers.createClass(e,[{key:"bindEvents",value:function e(){var t=this;this._expireInNode.addEventListener("change",this.validateRequiredFields.bind(this));if(BX.Sender.Template&&BX.Sender.Template.Selector){var i=BX.Sender.Template.Selector;BX.addCustomEvent(i,i.events.templateSelect,this.onTemplateSelect.bind(this));BX.addCustomEvent(i,i.events.selectorClose,this.closeTemplateSelector.bind(this))}if(this._saveBtn){BX.bind(this._saveBtn,"click",this.applyChanges.bind(this))}if(babelHelpers.classPrivateFieldGet(this,B)){BX.bind(babelHelpers.classPrivateFieldGet(this,B),"click",this.showTemplateSelector.bind(this))}if(babelHelpers.classPrivateFieldGet(this,f)){top.BX.onCustomEvent(top,"sender-letter-edit-change",[this.letterTile]);babelHelpers.classPrivateFieldGet(this,d).slider.close();if(babelHelpers.classPrivateFieldGet(this,g)){BX.UI.Notification.Center.notify({content:babelHelpers.classPrivateFieldGet(this,m).outsideSaveSuccess,autoHideDelay:5e3})}}if(babelHelpers.classPrivateFieldGet(this,R)&&babelHelpers.classPrivateFieldGet(this,x)){babelHelpers.classPrivateFieldGet(this,R).subscribe(BX.UI.ToolbarEvents.finishEditing,(function(e){var i=e.getData().updatedTitle;if(i&&babelHelpers.classPrivateFieldGet(t,y)){babelHelpers.classPrivateFieldGet(t,y).value=i}}))}this.initWidget();var s=this.getFilter();s.getAddPresetButton().style.display="none";s.getPreset().getPresets().forEach((function(e){e.style.display="none"}));BX.bind(s.getResetButton(),"click",this.reInitAddressWidget.bind(this));var a=document.querySelector(".main-ui-delete");BX.bind(a,"click",this.reInitAddressWidget.bind(this))}},{key:"initialize",value:function e(t){babelHelpers.classPrivateFieldSet(this,p,BX(t.containerId));babelHelpers.classPrivateFieldSet(this,S,[]);babelHelpers.classPrivateFieldGet(this,S)[babelHelpers.classPrivateFieldGet(this,X)]={region:[]};babelHelpers.classPrivateFieldGet(this,S)[babelHelpers.classPrivateFieldGet(this,U)]={region:[]};babelHelpers.classPrivateFieldSet(this,C,"toloka-filter-connector");babelHelpers.classPrivateFieldSet(this,G,document.getElementById("".concat(babelHelpers.classPrivateFieldGet(this,C),"_search_container")));babelHelpers.classPrivateFieldSet(this,O,this.getFilter());babelHelpers.classPrivateFieldSet(this,B,BX("SENDER_TOLOKA_BUTTON_CHANGE"));babelHelpers.classPrivateFieldGet(this,u).changeDisplay(babelHelpers.classPrivateFieldGet(this,B),false);babelHelpers.classPrivateFieldSet(this,h,t.actionUri);babelHelpers.classPrivateFieldSet(this,I,new BX.AjaxAction(babelHelpers.classPrivateFieldGet(this,h)));babelHelpers.classPrivateFieldSet(this,v,t.isFrame||false);babelHelpers.classPrivateFieldSet(this,b,t.prettyDateFormat);babelHelpers.classPrivateFieldSet(this,f,t.isSaved||false);babelHelpers.classPrivateFieldSet(this,_,t.isRegistered||false);babelHelpers.classPrivateFieldSet(this,g,t.isOutside||false);babelHelpers.classPrivateFieldSet(this,E,t.isAvailable||true);babelHelpers.classPrivateFieldSet(this,m,t.mess);babelHelpers.classPrivateFieldSet(this,P,t.letterTile||{});babelHelpers.classPrivateFieldSet(this,D,[]);babelHelpers.classPrivateFieldSet(this,T,this.objectKeysToLowerCase(JSON.parse(t.preset)));this.optionData=[];babelHelpers.classPrivateFieldSet(this,x,t.isSlider);babelHelpers.classPrivateFieldSet(this,j,t.toolbarId);babelHelpers.classPrivateFieldSet(this,R,BX.UI.ToolbarManager.get(this.toolbarId));this.prepareNodes();this.buildDispatchNodes();this._filterNode=[];this._regionInput=[];this._autocomplete=[];this.bindEvents();babelHelpers.classPrivateFieldGet(this,d).initButtons();if(this.isMSBrowser()){babelHelpers.classPrivateFieldGet(this,p).classList.add("bx-sender-letter-ms-ie")}if(!babelHelpers.classPrivateFieldGet(this,_)){babelHelpers.classPrivateFieldGet(this,k).style="";babelHelpers.classPrivateFieldGet(this,N).style="display:none;"}}},{key:"prepareNodes",value:function e(){babelHelpers.classPrivateFieldSet(this,H,babelHelpers.classPrivateFieldGet(this,u).getNode("template-selector",babelHelpers.classPrivateFieldGet(this,p)));babelHelpers.classPrivateFieldSet(this,F,babelHelpers.classPrivateFieldGet(this,u).getNode("editor",babelHelpers.classPrivateFieldGet(this,p)));babelHelpers.classPrivateFieldSet(this,y,babelHelpers.classPrivateFieldGet(this,u).getNode("title",babelHelpers.classPrivateFieldGet(this,p)));babelHelpers.classPrivateFieldSet(this,k,babelHelpers.classPrivateFieldGet(this,u).getNode("login",babelHelpers.classPrivateFieldGet(this,p)));babelHelpers.classPrivateFieldSet(this,N,babelHelpers.classPrivateFieldGet(this,u).getNode("sender-toloka-form",babelHelpers.classPrivateFieldGet(this,p)));babelHelpers.classPrivateFieldSet(this,w,babelHelpers.classPrivateFieldGet(this,u).getNode("toloka-oauth-code",babelHelpers.classPrivateFieldGet(this,p)));babelHelpers.classPrivateFieldSet(this,A,babelHelpers.classPrivateFieldGet(this,u).getNode("letter-buttons",babelHelpers.classPrivateFieldGet(this,p)));babelHelpers.classPrivateFieldSet(this,W,babelHelpers.classPrivateFieldGet(this,u).getNode("template-name",babelHelpers.classPrivateFieldGet(this,F)));babelHelpers.classPrivateFieldSet(this,L,babelHelpers.classPrivateFieldGet(this,u).getNode("template-type",babelHelpers.classPrivateFieldGet(this,F)));babelHelpers.classPrivateFieldSet(this,M,babelHelpers.classPrivateFieldGet(this,u).getNode("template-id",babelHelpers.classPrivateFieldGet(this,F)));this._projectNode=document.getElementById("CONFIGURATION_PROJECT_ID");this._poolNode=document.getElementById("CONFIGURATION_POOL_ID");this._taskSuiteNode=document.getElementById("CONFIGURATION_TASK_SUITE_ID");this._descriptionNode=document.getElementById("CONFIGURATION_DESCRIPTION");this._instructionNode=document.getElementById("CONFIGURATION_INSTRUCTION");this._tasksNode=document.getElementById("CONFIGURATION_TASKS");this._overlapNode=document.getElementById("CONFIGURATION_OVERLAP");this._adultContentNode=document.getElementById("CONFIGURATION_ADULT_CONTENT");this._priceNode=document.getElementById("CONFIGURATION_PRICE");this._expireInNode=document.getElementById("CONFIGURATION_EXPIRE_IN");this._saveBtn=document.getElementById("ui-button-panel-save");this._projectNode.parentNode.parentNode.style="display:none";this._poolNode.parentNode.parentNode.style="display:none";this._taskSuiteNode.parentNode.parentNode.style="display:none"}},{key:"reInitAddressWidget",value:function e(){if(this._filterNode[babelHelpers.classPrivateFieldGet(this,X)]&&this._autocomplete[babelHelpers.classPrivateFieldGet(this,X)]){this._autocomplete[babelHelpers.classPrivateFieldGet(this,X)].removeAutocompleteNode();this._autocomplete[babelHelpers.classPrivateFieldGet(this,X)]=null}if(this._filterNode[babelHelpers.classPrivateFieldGet(this,U)]&&this._autocomplete[babelHelpers.classPrivateFieldGet(this,U)]){this._autocomplete[babelHelpers.classPrivateFieldGet(this,U)].removeAutocompleteNode();this._autocomplete[babelHelpers.classPrivateFieldGet(this,U)]=null}this.initWidget()}},{key:"initWidget",value:function e(){if(babelHelpers.classPrivateFieldGet(this,G)){BX.bind(babelHelpers.classPrivateFieldGet(this,G),"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,X)));BX.bind(babelHelpers.classPrivateFieldGet(this,G),"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,U)));BX.bind(this.getFilter().getPopup().popupContainer,"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,X)));BX.bind(this.getFilter().getPopup().popupContainer,"click",this.initAddressWidget.bind(this,babelHelpers.classPrivateFieldGet(this,U)))}}},{key:"initAddressWidget",value:function e(t,i){var s=this;if(i.target&&this.getFilter().getSearch().isSquareRemoveButton(i.target)){this.reInitAddressWidget()}this._filterNode[t]=document.querySelectorAll(".main-ui-filter-field-container-list > div[data-name=".concat(t,"]"))[0];if(!this._filterNode[t]){if(this._autocomplete[t]){this._autocomplete[t].removeAutocompleteNode();this._autocomplete[babelHelpers.classPrivateFieldGet(this,X)]=null}return}if(this._autocomplete[t]){return}var a=this;this.optionData[t]=this.optionData[t]||[];this._autocomplete[t]=new n(this._filterNode[t],{options:this.optionData[t],multiple:true,autocomplete:true,onChange:function e(i,l){babelHelpers.classPrivateFieldGet(a,S)[t]=i;babelHelpers.classPrivateFieldGet(s,O).getFieldByName(t).ITEMS=l;babelHelpers.classPrivateFieldGet(s,O).getFieldByName(t).VALUE=l}});this._regionInput[t]=document.querySelectorAll("input[data-name=autocomplete-".concat(t,"]"))[0];BX.bind(this._regionInput[t],"keyup",this.getLocationList.bind(this,t))}},{key:"register",value:function e(){var t=this;babelHelpers.classPrivateFieldGet(this,I).request({action:"registerOAuth",onsuccess:function e(i){babelHelpers.classPrivateFieldGet(t,k).style="display:none;";babelHelpers.classPrivateFieldGet(t,N).style=""},data:{access_code:babelHelpers.classPrivateFieldGet(this,w).value}})}},{key:"isMSBrowser",value:function e(){return window.navigator.userAgent.match(/(Trident\/|MSIE|Edge\/)/)!==null}},{key:"getPatternTitle",value:function e(t){return babelHelpers.classPrivateFieldGet(this,u).replace(babelHelpers.classPrivateFieldGet(this,m).patternTitle,{name:t,date:BX.date.format(babelHelpers.classPrivateFieldGet(this,b))})}},{key:"onTemplateSelect",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,W)){babelHelpers.classPrivateFieldGet(this,W).textContent=t.name}if(babelHelpers.classPrivateFieldGet(this,L)){babelHelpers.classPrivateFieldGet(this,L).value=t.type}if(babelHelpers.classPrivateFieldGet(this,M)){babelHelpers.classPrivateFieldGet(this,M).value=t.code}babelHelpers.classPrivateFieldSet(this,T,t.messageFields);this.buildDispatchNodes();babelHelpers.classPrivateFieldGet(this,y).value=this.getPatternTitle(t.name);BX.fireEvent(babelHelpers.classPrivateFieldGet(this,y),"change");this.closeTemplateSelector();window.scrollTo(0,0)}},{key:"buildDispatchNodes",value:function e(){var t=this;babelHelpers.classPrivateFieldGet(this,u).getNodes("dispatch",babelHelpers.classPrivateFieldGet(this,p)).forEach((function(e){var i=e.getAttribute("data-code");for(var s in babelHelpers.classPrivateFieldGet(t,T)){if(!babelHelpers.classPrivateFieldGet(t,T).hasOwnProperty(s)){continue}var a=babelHelpers.classPrivateFieldGet(t,T)[s];if(a.code===i&&e.innerHTML.length===0){e.innerHTML=a.value}babelHelpers.classPrivateFieldGet(t,D)[a.code]=a.value}}))}},{key:"closeTemplateSelector",value:function e(){this.changeDisplayingTemplateSelector(false)}},{key:"showTemplateSelector",value:function e(){this.changeDisplayingTemplateSelector(true)}},{key:"changeDisplayingTemplateSelector",value:function e(t){var i="bx-sender-letter-show";var s="bx-sender-letter-hide";babelHelpers.classPrivateFieldGet(this,u).changeClass(babelHelpers.classPrivateFieldGet(this,H),i,t);babelHelpers.classPrivateFieldGet(this,u).changeClass(babelHelpers.classPrivateFieldGet(this,H),s,!t);babelHelpers.classPrivateFieldGet(this,u).changeClass(babelHelpers.classPrivateFieldGet(this,F),i,!t);babelHelpers.classPrivateFieldGet(this,u).changeClass(babelHelpers.classPrivateFieldGet(this,F),s,t);babelHelpers.classPrivateFieldGet(this,u).changeDisplay(babelHelpers.classPrivateFieldGet(this,B),!t);babelHelpers.classPrivateFieldGet(this,u).changeDisplay(babelHelpers.classPrivateFieldGet(this,A),!t)}},{key:"objectKeysToLowerCase",value:function e(t){var i=this;if(t===null){return t}return Object.keys(t).reduce((function(e,s){var a=t[s];e[s.toLowerCase()]=babelHelpers["typeof"](a)==="object"?i.objectKeysToLowerCase(a):a;return e}),{})}},{key:"getLocationList",value:function e(t){var i=this;if(this._regionInput[t].value.length<3){return}this.usedWords=this.usedWords||[];var s=this._regionInput[t].value;if(this.usedWords.includes(s)){return}this.usedWords.push(s);var a=this;babelHelpers.classPrivateFieldGet(this,I).request({action:"getGeoList",data:{name:s},onsuccess:function e(s){if(!i.optionData[t]){i.optionData[t]=[]}for(var l in s){var r=s[l];if(babelHelpers["typeof"](r)==="object"&&"id"in r){i.optionData[t].push(r)}}if(a._autocomplete[t]){i.optionData[t]=i.optionData[t].reduce((function(e,t){var i=e.find((function(e){return e.id===t.id}));if(!i){return e.concat([t])}else{return e}}),[]);a._autocomplete[t].setOptions(i.optionData[t])}}})}},{key:"validateRequiredFields",value:function e(){var t=this;var i=true;[this._expireInNode,this._priceNode,this._tasksNode].every((function(e){if(!t.validateField(e)){i=false;return false}}));if(!i){this.removeLoader()}return i}},{key:"removeLoader",value:function e(){this._saveBtn.classList.remove("ui-btn-wait")}},{key:"validateField",value:function e(i){if(!this._validatorPopup){this._validatorPopup=new t.Popup({id:"sender-toloka-validator",content:"".concat(babelHelpers.classPrivateFieldGet(this,m).required)})}if(!i.value){this._validatorPopup.setBindElement(i);this._validatorPopup.show();i.classList.add("bx-sender-form-control-danger");i.scrollIntoView();return false}this._validatorPopup.close();i.classList.remove("bx-sender-form-control-danger");return true}},{key:"createProject",value:function e(){var t=this;if(!this.validateRequiredFields()){return}var i=Object.keys(babelHelpers.classPrivateFieldGet(this,D)["INPUT_VALUE"])[0];var s=Object.keys(babelHelpers.classPrivateFieldGet(this,D)["OUTPUT_VALUE"])[0];babelHelpers.classPrivateFieldGet(this,I).request({action:"createProject",data:{id:this._projectNode.value,name:babelHelpers.classPrivateFieldGet(this,y).value,description:this._descriptionNode.value,instruction:this._instructionNode.value,input_type:babelHelpers.classPrivateFieldGet(this,D)["INPUT_VALUE"][i],input_identificator:i,output_type:babelHelpers.classPrivateFieldGet(this,D)["OUTPUT_VALUE"][s],output_identificator:s,markup:babelHelpers.classPrivateFieldGet(this,D)["PRESET"].template,script:babelHelpers.classPrivateFieldGet(this,D)["PRESET"].js,styles:babelHelpers.classPrivateFieldGet(this,D)["PRESET"].css},onsuccess:function e(i){t._projectNode.value=i.id;t.createPool(i.id)},onfailure:function e(i){t.removeLoader()}})}},{key:"createPool",value:function e(t){var i=this;var s=Object.keys(babelHelpers.classPrivateFieldGet(this,D)["INPUT_VALUE"])[0];babelHelpers.classPrivateFieldGet(this,I).request({action:"createPool",data:{id:this._poolNode.value,task_suite_id:this._taskSuiteNode.value,project_id:t,private_name:babelHelpers.classPrivateFieldGet(this,y).value,public_description:this._descriptionNode.value,may_contain_adult_content:this._adultContentNode.checked,reward_per_assignment:this._priceNode.value,will_expire:this._expireInNode.value,overlap:this._overlapNode.value,tasks:this._tasksNode.value,identificator:s,filter:babelHelpers.classPrivateFieldGet(this,S)},onsuccess:function e(t){i._poolNode.value=t.pool_id;i._taskSuiteNode.value=t.id;var s=babelHelpers.classPrivateFieldGet(i,p).getElementsByTagName("form");if(s&&s[0]){s[0].appendChild(BX.create("input",{attrs:{type:"hidden",name:"apply",value:"Y"}}));s[0].submit()}},onfailure:function e(t){i.removeLoader()}})}},{key:"applyChanges",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,E)){BX.UI.InfoHelper.show("limit_crm_marketing_toloka");return}this.createProject()}},{key:"getFilter",value:function e(){var t=BX.Main.filterManager.getById(babelHelpers.classPrivateFieldGet(this,C));if(!t||!(t instanceof BX.Main.Filter)){return null}return t}}],[{key:"create",value:function t(i){var s=new e;s.initialize(i);return s}}]);return e}();e.Toloka=q})(this.BX.Sender=this.BX.Sender||{},BX.Main);
//# sourceMappingURL=toloka.bundle.map.js