{"version":3,"file":"rich-loc.bundle.js","sources":["../src/lib.js","../src/rich-loc.js"],"sourcesContent":["import type { TemplateItem } from './types';\n\nconst escape = (str) => String(str).replaceAll(/[\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n\nfunction getReplacementRegExp(placeholder: string): RegExp\n{\n\tif (isClosedPlaceholder(placeholder))\n\t{\n\t\treturn new RegExp(escape(placeholder), 'gmi');\n\t}\n\n\tconst closePlaceholder = `${placeholder.slice(0, 1)}/${placeholder.slice(1)}`;\n\n\treturn new RegExp(`${escape(placeholder)}.*?${escape(closePlaceholder)}`, 'gmi');\n}\n\nexport function getTemplateItems(text: string, placeholder: string | string[]): TemplateItem[]\n{\n\tconst items = (Array.isArray(placeholder) ? [...placeholder] : [placeholder])\n\t\t.flatMap((templatePlaceholder: string) => {\n\t\t\treturn [...text.matchAll(getReplacementRegExp(templatePlaceholder))].map((exec) => ({\n\t\t\t\tindex: exec.index,\n\t\t\t\tplaceholder: templatePlaceholder,\n\t\t\t\ttemplate: exec[0],\n\t\t\t}));\n\t\t});\n\n\tif (items.length > 1)\n\t{\n\t\titems.sort((a, b) => a.index - b.index);\n\t}\n\n\treturn items;\n}\n\nexport function unfoldTemplate(template: string, placeholder: string): string\n{\n\tif (isClosedPlaceholder(placeholder))\n\t{\n\t\treturn '';\n\t}\n\n\treturn template.slice(placeholder.length, template.length - placeholder.length - 1);\n}\n\nfunction isClosedPlaceholder(placeholder: string): boolean\n{\n\treturn placeholder.at(-2) === '/';\n}\n","import { Type } from 'main.core';\nimport { h } from 'ui.vue3';\nimport { getTemplateItems, unfoldTemplate } from './lib';\nimport type { TemplateItem } from './types';\n\nfunction makeRichLocChildren(text: string, templateItems: TemplateItem[], context): Array<string | Object>\n{\n\tconst children = [];\n\tlet index = 0;\n\tfor (const item of templateItems)\n\t{\n\t\tif (item.index > index)\n\t\t{\n\t\t\tchildren.push(text.slice(index, item.index));\n\t\t\tindex = item.index;\n\t\t}\n\n\t\tif (item.index === index)\n\t\t{\n\t\t\tconst placeholder = item.placeholder;\n\t\t\tconst slotName = placeholder.match(/\\[(.+?)\\/?]/)[1];\n\t\t\tif (Type.isFunction(context.slots[slotName]))\n\t\t\t{\n\t\t\t\tchildren.push(context.slots[slotName]({\n\t\t\t\t\ttext: unfoldTemplate(item.template, placeholder),\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tindex += item.template.length;\n\t\t}\n\t}\n\n\tif (index < text.length)\n\t{\n\t\tchildren.push(text.slice(index));\n\t}\n\n\treturn children;\n}\n\nfunction RichLoc(props: RichLocProps, context): Object\n{\n\tconst templateItems: TemplateItem[] = getTemplateItems(props.text, props.placeholder);\n\tconst children = makeRichLocChildren(props.text, templateItems, context);\n\n\treturn h(\n\t\tprops.tag || 'div',\n\t\t{\n\t\t\t...context.attrs,\n\t\t},\n\t\tchildren,\n\t);\n}\n\ntype RichLocProps = {\n\ttext: string;\n\tplaceholder: string | string[];\n\ttag: ?string | string[];\n}\n\nconst richLocProps: Array<$Keys<RichLocProps>> = ['text', 'placeholder', 'tag'];\n\nRichLoc.props = richLocProps;\n\nexport { RichLoc };\n"],"names":["escape","str","String","replaceAll","getReplacementRegExp","placeholder","isClosedPlaceholder","RegExp","closePlaceholder","slice","getTemplateItems","text","items","Array","isArray","flatMap","templatePlaceholder","matchAll","map","exec","index","template","length","sort","a","b","unfoldTemplate","at","makeRichLocChildren","templateItems","context","children","item","push","slotName","match","Type","isFunction","slots","RichLoc","props","h","tag","attrs","richLocProps"],"mappings":"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"}