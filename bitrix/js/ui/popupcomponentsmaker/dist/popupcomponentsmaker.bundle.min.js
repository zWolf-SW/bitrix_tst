this.BX=this.BX||{};(function(t,i,e,o,n){"use strict";let s=t=>t,a;class l extends e.EventEmitter{constructor(t={}){super();this.html=null;this.awaitContent=null;this.flex=null;this.withoutBackground=null;this.backgroundColor=null;this.backgroundImage=null;this.background=null;this.marginBottom=null;this.disabled=null;this.secondary=null;this.overflow=null;this.displayBlock=null;this.attrs=null;this.minHeight=null;this.sizeLoader=45;this.asyncSecondary=null;this.margin=null;this.setParams(t);this.layout={container:null};if(this.awaitContent){this.await()}}setParams(t={}){this.html=o.Type.isDomNode(t==null?void 0:t.html)?t.html:this.html;this.awaitContent=o.Type.isBoolean(t==null?void 0:t.awaitContent)?t==null?void 0:t.awaitContent:this.awaitContent;this.flex=o.Type.isNumber(t==null?void 0:t.flex)?t.flex:this.flex;this.withoutBackground=o.Type.isBoolean(t==null?void 0:t.withoutBackground)?t.withoutBackground:this.withoutBackground;this.background=o.Type.isString(t==null?void 0:t.background)?t.background:this.background;this.backgroundColor=o.Type.isString(t==null?void 0:t.backgroundColor)?t.backgroundColor:this.backgroundColor;this.backgroundImage=o.Type.isString(t==null?void 0:t.backgroundImage)?t.backgroundImage:this.backgroundImage;this.marginBottom=o.Type.isNumber(t==null?void 0:t.marginBottom)?t.marginBottom:this.marginBottom;this.disabled=o.Type.isBoolean(t==null?void 0:t.disabled)?t.disabled:this.disabled;this.secondary=o.Type.isBoolean(t==null?void 0:t.secondary)?t.secondary:this.secondary;this.overflow=o.Type.isBoolean(t==null?void 0:t.overflow)?t.overflow:this.overflow;this.displayBlock=o.Type.isBoolean(t==null?void 0:t.displayBlock)?t.displayBlock:this.displayBlock;this.attrs=o.Type.isPlainObject(t==null?void 0:t.attrs)?t.attrs:this.attrs;this.minHeight=o.Type.isString(t==null?void 0:t.minHeight)?t.minHeight:this.minHeight;this.margin=o.Type.isString(t.margin)?t.margin:this.margin;this.sizeLoader=o.Type.isNumber(t==null?void 0:t.sizeLoader)?t.sizeLoader:this.sizeLoader;this.asyncSecondary=(t==null?void 0:t.asyncSecondary)instanceof Promise?t.asyncSecondary:this.asyncSecondary}getLoader(){if(!this.loader){this.loader=new n.Loader({target:this.getContainer(),size:this.sizeLoader})}return this.loader}await(){this.getContainer().classList.add("--awaiting");this.showLoader()}stopAwait(){this.getContainer().classList.remove("--awaiting");this.hideLoader()}showLoader(){void this.getLoader().show()}hideLoader(){void this.getLoader().hide()}getContent(){if(this.html){return this.html}return""}updateContent(t){if(o.Type.isDomNode(t)){o.Dom.clean(this.getContainer());this.getContainer().appendChild(t)}}setBackgroundColor(t){if(o.Type.isString(t)){this.getContainer().style.backgroundColor=t}}getMarginBottom(){return this.marginBottom}getContainer(){if(!this.layout.container){this.layout.container=o.Tag.render(a||(a=s`
				<div class="ui-popupcomponentmaker__content--section-item">${0}</div>
			`),this.getContent())}if(this.background){this.layout.container.style.background=this.background}if(this.backgroundColor){this.layout.container.style.backgroundColor=this.backgroundColor}if(this.backgroundImage){this.layout.container.style.backgroundImage=this.backgroundImage}if(this.withoutBackground&&!this.backgroundColor&&!this.background){this.layout.container.classList.add("--transparent")}if(this.flex){this.layout.container.style.flex=this.flex}if(this.disabled){this.layout.container.classList.add("--disabled")}if(this.secondary){o.Dom.addClass(this.layout.container,"--secondary")}if(this.overflow){this.layout.container.classList.add("--overflow-hidden")}if(this.displayBlock){this.layout.container.classList.add("--block")}if(this.attrs){o.Dom.adjust(this.layout.container,{attrs:this.attrs})}if(this.minHeight){o.Dom.style(this.layout.container,"min-height",this.minHeight)}if(this.margin){o.Dom.style(this.layout.container,"margin",this.margin)}if(this.asyncSecondary){this.asyncSecondary.then((t=>{if(t===false){o.Dom.removeClass(this.layout.container,"--secondary")}else{o.Dom.addClass(this.layout.container,"--secondary")}}))}return this.layout.container}}let r=t=>t,d,h,u;class p{constructor({id:t,target:e,content:n,width:s,cacheable:a,contentPadding:l,padding:r,offsetTop:d,blurBackground:h,useAngle:u,popupLoader:p,offsetLeft:c}){this.id=o.Type.isString(t)?t:null;this.target=o.Type.isElementNode(e)?e:null;this.content=n||null;this.contentWrapper=null;this.popup=null;this.loader=null;this.items=[];this.width=o.Type.isNumber(s)?s:null;this.cacheable=o.Type.isBoolean(a)?a:true;this.contentPadding=o.Type.isNumber(l)?l:0;this.padding=o.Type.isNumber(r)?r:13;this.offsetTop=o.Type.isNumber(d)?d:0;this.offsetLeft=o.Type.isNumber(c)?c:null;this.blurBlackground=o.Type.isBoolean(h)?h:false;this.useAngle=o.Type.isUndefined(u)||u!==false;this.popupLoader=p instanceof i.Popup?p:null}getItems(){return this.items}getItem(t){if(t instanceof l){return t}t=new l(t);if(this.items.indexOf(t)===-1){this.items.push(t)}return t}getPopup(){if(!this.popup){var t;const n=this.width?this.width:350;const s=this.id?this.id+"-popup":null;if(this.popupLoader){this.popup=this.popupLoader}else{this.popup=new i.Popup(s,this.target,{angle:this.useAngle?{offset:n/2-16}:false})}o.Dom.addClass(this.popup.getPopupContainer(),"ui-popupcomponentmaker");this.popup.setContent(this.getContentWrapper());this.popup.setContentBackground("transparent");this.popup.setContentPadding(this.contentPadding);this.popup.setOffset({offsetTop:this.offsetTop,offsetLeft:(t=this.offsetLeft)!=null?t:-(n/2)+(this.target?this.target.offsetWidth/2:0)+40});this.popup.setWidth(n);this.popup.setAutoHide(true);this.popup.setPadding(this.padding);this.popup.setAnimation("fading-slide");this.popup.setCacheable(this.cacheable);if(this.blurBlackground){o.Dom.addClass(this.popup.getPopupContainer(),"popup-with-radius");this.setBlurBackground();e.EventEmitter.subscribe(e.EventEmitter.GLOBAL_TARGET,"BX.Intranet.Bitrix24:ThemePicker:onThemeApply",(()=>{setTimeout((()=>{this.setBlurBackground()}),200)}))}this.popup.getContentContainer().style.overflowX=null}return this.popup}isShown(){return this.getPopup().isShown()}getContentWrapper(){if(!this.contentWrapper){this.contentWrapper=o.Tag.render(d||(d=r`
				<div class="ui-popupcomponentmaker__content"></div>
			`));if(!this.content){return}this.content.map((t=>{var i;let e=this.getSection();if(t!=null&&t.marginBottom){o.Type.isNumber(t.marginBottom)?e.style.marginBottom=t.marginBottom+"px":null}if(t!=null&&t.className){o.Dom.addClass(e,t.className)}if(t!=null&&t.attrs){o.Dom.adjust(e,{attrs:t.attrs})}if(o.Type.isDomNode(t==null?void 0:t.html)){e.appendChild(this.getItem(t).getContainer());this.contentWrapper.appendChild(e)}if(o.Type.isArray(t==null?void 0:t.html)){let i=o.Tag.render(h||(h=r`
						<div class="ui-popupcomponentmaker__content--section-item --flex-column --transparent"></div>
					`));t.html.map((t=>{var n;if(t!=null&&(n=t.html)!=null&&n.then){this.adjustPromise(t,e);o.Type.isNumber(t==null?void 0:t.marginBottom)?e.style.marginBottom=t.marginBottom+"px":null}else{if(o.Type.isArray(t==null?void 0:t.html)){t.html.map((t=>{i.appendChild(this.getItem(t).getContainer())}));e.appendChild(i)}else{e.appendChild(this.getItem(t).getContainer())}}}));this.contentWrapper.appendChild(e)}if(o.Type.isFunction(t==null?void 0:(i=t.html)==null?void 0:i.then)){this.adjustPromise(t,e);this.contentWrapper.appendChild(e)}}))}return this.contentWrapper}adjustPromise(t,i){t.awaitContent=true;let e=this.getItem(t);if(i){var n;i.appendChild(e.getContainer());t==null?void 0:(n=t.html)==null?void 0:n.then((t=>{if(o.Type.isDomNode(t)){e.stopAwait();e.updateContent(t)}else if(o.Type.isPlainObject(t)&&o.Type.isDomNode(t.node)){if(o.Type.isPlainObject(t.options)){e.setParams(t.options)}e.stopAwait();e.updateContent(t.node)}}))}}getSection(){return o.Tag.render(u||(u=r`
			<div class="ui-popupcomponentmaker__content--section"></div>
		`))}setBlurBackground(){const t=this.getPopup().getPopupContainer();const i=window.getComputedStyle(document.body);const e=i.backgroundImage;const n=i.backgroundColor;if(o.Type.isDomNode(t)){o.Dom.addClass(t,"popup-window-blur")}let s=o.Dom.create("style",{attrs:{type:"text/css",id:"styles-widget-blur"}});let a=".popup-window-content:after { "+"background-image: "+e+";"+"background-color: "+n+"} ";a=document.createTextNode(a);s.appendChild(a);let l=".popup-window-angly:after { "+"background-color: "+n+"} ";l=document.createTextNode(l);s.appendChild(l);const r=document.head.querySelector("#styles-widget-blur");if(r){o.Dom.replace(r,s)}else{document.head.appendChild(s)}}show(){if(!o.Type.isDomNode(this.target)){return}this.getPopup().show()}close(){this.getPopup().close()}}t.PopupComponentsMakerItem=l;t.PopupComponentsMaker=p})(this.BX.UI=this.BX.UI||{},BX.Main,BX.Event,BX,BX);
//# sourceMappingURL=popupcomponentsmaker.bundle.map.js