this.BX=this.BX||{};(function(e,t,s,i,r,a,o,n,l,c,p,u,d){"use strict";let b=e=>e,h,_,P;var v=babelHelpers.classPrivateFieldLooseKey("name");var g=babelHelpers.classPrivateFieldLooseKey("icon");class T{constructor(e){Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.name;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.icon}getContainer(){return d.Tag.render(h||(h=b`
			<span class="rest-market-item">
				${0}
				<span class="rest-market-item__name" title="${0}">${0}</span>
			</span>
		`),this.renderIcon(),this.getName(),this.getName())}renderTo(e){d.Dom.append(this.getContainer(),e)}getName(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}renderIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,g)[g]){return d.Tag.render(_||(_=b`
				<div class="rest-market-item__icon-container">
					<div class="ui-icon-set --cube-plus rest-market-item__icon"></div>
				</div>
			`))}return d.Tag.render(P||(P=b`
			<div class="rest-market-item__icon-container" 
				style="
					background-image: url(${0});
					background-size: cover;
				">
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,g)[g])}}let L=e=>e,E,B;var m=babelHelpers.classPrivateFieldLooseKey("items");var R=babelHelpers.classPrivateFieldLooseKey("title");var I=babelHelpers.classPrivateFieldLooseKey("link");var y=babelHelpers.classPrivateFieldLooseKey("count");var k=babelHelpers.classPrivateFieldLooseKey("onClick");var f=babelHelpers.classPrivateFieldLooseKey("renderList");class S{constructor(e){Object.defineProperty(this,f,{value:F});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,R,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,m)[m]=d.Type.isArray(e.items)?e.items:[];babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e.title;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.link;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.count;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e.onClick}render(){return d.Tag.render(E||(E=L`
			<div class="rest-market-list">
				<div class="rest-market-list__header">
					<span class="rest-market-list__title">${0}</span>
					<a class="rest-market-list__link" href="${0}" onclick="${0}">
						${0}
					</a>
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,R)[R],babelHelpers.classPrivateFieldLooseBase(this,I)[I],babelHelpers.classPrivateFieldLooseBase(this,k)[k],d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_LINK",{"#COUNT#":babelHelpers.classPrivateFieldLooseBase(this,y)[y]}),babelHelpers.classPrivateFieldLooseBase(this,f)[f]())}}function F(){if(babelHelpers.classPrivateFieldLooseBase(this,m)[m].length===0){return""}const e=d.Tag.render(B||(B=L`
			<div class="rest-market-list__container"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,m)[m].forEach((t=>{t.renderTo(e)}));return e}class O{getContainer(){throw new Error("Not implemented")}}class A{}A.FINAL="FINAL";A.WARNING="WARNING";class C{}C.TRANSITION="transition";C.SUBSCRIPTION="subscription";C.TRIAL="trial";var H=babelHelpers.classPrivateFieldLooseKey("send");var N=babelHelpers.classPrivateFieldLooseKey("getType");var x=babelHelpers.classPrivateFieldLooseKey("getP1");class D{constructor(e){Object.defineProperty(this,x,{value:U});Object.defineProperty(this,N,{value:M});Object.defineProperty(this,H,{value:w});this.context=e}sendShow(){babelHelpers.classPrivateFieldLooseBase(this,H)[H]({tool:"infohelper",category:"market",event:"show_popup"})}sendClickButton(e){babelHelpers.classPrivateFieldLooseBase(this,H)[H]({tool:"infohelper",category:"market",event:"click_button",c_element:e})}sendDemoActivated(){babelHelpers.classPrivateFieldLooseBase(this,H)[H]({tool:"intranet",category:"demo",event:"market_demo_activated"})}}function w(e){c.sendData({...e,type:babelHelpers.classPrivateFieldLooseBase(this,N)[N](),p1:babelHelpers.classPrivateFieldLooseBase(this,x)[x]()})}function M(){let e=this.context.popupType===A.WARNING?"pre_disconnection_alert":"post_disconnection_notice";if(this.context.popupCategory===C.TRIAL){e=`${e}_demo`}return e}function U(){return`discount_${this.context.withDiscount?"Y":"N"}`}let K=e=>e,$,X,j,W;var G=babelHelpers.classPrivateFieldLooseKey("popup");var z=babelHelpers.classPrivateFieldLooseKey("container");var Y=babelHelpers.classPrivateFieldLooseKey("appList");var q=babelHelpers.classPrivateFieldLooseKey("integrationList");var V=babelHelpers.classPrivateFieldLooseKey("analytic");var Q=babelHelpers.classPrivateFieldLooseKey("getContent");var J=babelHelpers.classPrivateFieldLooseKey("getContainer");var Z=babelHelpers.classPrivateFieldLooseKey("renderCloseIcon");var ee=babelHelpers.classPrivateFieldLooseKey("renderMarketList");class te extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,ee,{value:ae});Object.defineProperty(this,Z,{value:re});Object.defineProperty(this,J,{value:ie});Object.defineProperty(this,Q,{value:se});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,Y,{writable:true,value:void 0});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});this.setEventNamespace("Rest.MarketExpired:Popup");this.expireDate=e.expireDate;babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=e.appList;babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e.integrationList;this.withDemo=e.withDemo;this.olWidgetCode=e.olWidgetCode;babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e.analytic;this.type=e.type;this.expireDays=e.expireDays;this.discountEar=e.discountEar;this.marketLabel=e.isRenamedMarket?"":"_MARKET_PLUS"}getTitle(){throw new Error("Not implemented")}getCategory(){throw new Error("Not implemented")}show(){var e,s,i,r;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,G))[G])!=null?s:e[G]=t.PopupWindowManager.create(`marketExpiredPopup_${this.getCategory()}_${this.type}`,null,{animation:{showClassName:"rest-market-expired-popup__show",closeAnimationType:"animation"},overlay:true,content:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](),disableScroll:true,padding:0,className:"rest-market-expired-popup-wrapper",closeByEsc:true,events:{onClose:this.onClose.bind(this),onShow:this.onOpen.bind(this)}});const a=(e,t)=>{e.forEach((e=>{if(!e.isIntersecting){babelHelpers.classPrivateFieldLooseBase(this,G)[G].setDisableScroll(false);t.unobserve(e.target)}}))};const o=new IntersectionObserver(a,{root:null,rootMargin:"0px",threshold:[0,1]});o.observe(babelHelpers.classPrivateFieldLooseBase(this,G)[G].getContentContainer().querySelector(".rest-market-expired-popup__close-icon"));o.observe(babelHelpers.classPrivateFieldLooseBase(this,G)[G].getContentContainer().querySelector(".rest-market-expired-popup__button-container"));(i=babelHelpers.classPrivateFieldLooseBase(this,G)[G])==null?void 0:i.show();(r=babelHelpers.classPrivateFieldLooseBase(this,V)[V])==null?void 0:r.sendShow();if(this.discountEar){if(babelHelpers.classPrivateFieldLooseBase(this,G)[G].getContentContainer().querySelector(".rest-market-expired-popup__content-wrapper").offsetHeight<window.innerHeight){d.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,J)[J](),{maxHeight:`${this.discountEar.getContainer().offsetHeight}px`})}else{d.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,G)[G].getContentContainer().parentNode,{"backdrop-filter":"none","-webkit-backdrop-filter":"none"})}babelHelpers.classPrivateFieldLooseBase(this,G)[G].adjustPosition()}}close(){babelHelpers.classPrivateFieldLooseBase(this,G)[G].close()}onClose(){this.emit("onClose")}onOpen(){this.emit("onOpen")}renderDescription(){return null}renderButtons(){return null}renderAboutLink(){return""}getAnalytic(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}}function se(){return d.Tag.render($||($=K`
			<div class="rest-market-expired-popup">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,J)[J]())}function ie(){var e,t,s;(t=(e=babelHelpers.classPrivateFieldLooseBase(this,z))[z])!=null?t:e[z]=d.Tag.render(X||(X=K`
			<div class="rest-market-expired-popup__container">
				${0}
				<div class="rest-market-expired-popup__content-wrapper">
					<div class="rest-market-expired-popup__content">
						<span class="rest-market-expired-popup__title">${0}</span>
						${0}
						${0}
						${0}
					</div>
					${0}
					${0}
				</div>
			</div>
		`),(s=this.discountEar)==null?void 0:s.getContainer(),this.getTitle(),this.renderDescription(),this.renderAboutLink(),this.renderButtons(),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]());return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}function re(){const e=()=>{var e;babelHelpers.classPrivateFieldLooseBase(this,G)[G].close();(e=babelHelpers.classPrivateFieldLooseBase(this,V)[V])==null?void 0:e.sendClickButton("cancel")};return d.Tag.render(j||(j=K`
			<div class="rest-market-expired-popup__close-icon ui-icon-set --cross-30" onclick="${0}"></div>
		`),e)}function ae(){var e,t;return d.Tag.render(W||(W=K`
			<aside class="rest-market-expired-popup__aside">
				${0}
				${0}
			</aside>
		`),(e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y])==null?void 0:e.render(),(t=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:t.render())}class oe extends i.EventEmitter{constructor(e){super();this.setEventNamespace("BX.Rest.MarketExpired.Button");this.text=e.text;this.onSuccess=e.onSuccess}render(){return this.getButton().render()}getButtonConfig(){return{}}onClick(){var e;(e=this.onSuccess)==null?void 0:e.call(this)}getButton(){var e;(e=this.button)!=null?e:this.button=new u.Button({...this.getButtonConfig(),className:"rest-market-expired-popup__button",text:this.text,onclick:this.onClick.bind(this)});return this.button}}var ne=babelHelpers.classPrivateFieldLooseKey("getSubscribeLink");class le extends oe{constructor(...e){super(...e);Object.defineProperty(this,ne,{value:ce})}getButtonConfig(){return{id:"marketExpiredPopup_button_subscribe",size:u.Button.Size.MEDIUM,color:u.Button.Color.SUCCESS,noCaps:true,round:true,tag:u.Button.Tag.LINK,link:babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()}}onClick(){var e;(e=this.analytic)==null?void 0:e.sendClickButton("buy");super.onClick()}}function ce(){var e,t;return(e=(t=d.Extension.getSettings("rest.market-expired"))==null?void 0:t.marketSubscriptionUrl)!=null?e:""}class pe extends oe{getButtonConfig(){return{id:"marketExpiredPopup_button_hide",size:u.Button.Size.EXTRA_SMALL,color:u.Button.Color.LINK,noCaps:true}}onClick(){var e;(e=this.analytic)==null?void 0:e.sendClickButton("ok");super.onClick()}}let ue=e=>e,de,be,he;var _e=babelHelpers.classPrivateFieldLooseKey("getSubscribeButton");var Pe=babelHelpers.classPrivateFieldLooseKey("getHideButton");class ve extends te{constructor(...e){super(...e);Object.defineProperty(this,Pe,{value:Te});Object.defineProperty(this,_e,{value:ge})}getCategory(){return C.TRIAL}renderDescription(){return d.Tag.render(de||(de=ue`
			<div class="rest-market-expired-popup__description">
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			</div>
		`),d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_DESCRIPTION_TRIAL${this.marketLabel}`))}getTitle(){return d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_TITLE_TRIAL_${this.type}${this.marketLabel}`,{"#DAYS#":this.expireDays})}renderButtons(){return d.Tag.render(be||(be=ue`
			<div class="rest-market-expired-popup__buttons-wrapper">
				<div class="rest-market-expired-popup__button-container">
					${0}
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]().render(),babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]().render())}onOpen(){if(this.type===A.FINAL){BX.userOptions.save("rest","marketSubscriptionPopupDismiss",null,"Y")}else{BX.userOptions.save("rest","marketSubscriptionPopupTs",null,Math.floor(Date.now()/1e3))}super.onOpen()}renderAboutLink(){const e=()=>{var e;BX.Helper.show("redirect=detail&code=17451118");(e=this.getAnalytic())==null?void 0:e.sendClickButton("details")};return d.Tag.render(he||(he=ue`
			<span class="rest-market-expired-popup__details">
				<a
					class="ui-link rest-market-expired-popup__link"
					href="#"
					onclick="${0}"
				>
					${0}
				</a>
			</span>
		`),e,d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DETAILS"))}}function ge(){return new le({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_SUBSCRIBE"),analytic:this.getAnalytic()})}function Te(){return new pe({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_NEVER_SHOW_AGAIN"),onSuccess:()=>{BX.userOptions.save("rest","marketSubscriptionPopupDismiss",null,"Y");this.close()},analytic:this.getAnalytic()})}let Le=e=>e,Ee,Be,me;var Re=babelHelpers.classPrivateFieldLooseKey("getSubscribeButton");var Ie=babelHelpers.classPrivateFieldLooseKey("getHideButton");class ye extends te{constructor(...e){super(...e);Object.defineProperty(this,Ie,{value:fe});Object.defineProperty(this,Re,{value:ke})}getCategory(){return C.SUBSCRIPTION}getTitle(){const e={"#DAYS#":this.expireDays};const t=this.type===A.WARNING?this.marketLabel:"";return d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_TITLE_SUBSCRIPTION_${this.type}${t}`,e)}renderDescription(){const e={"#DATE#":this.expireDate};const t=this.type===A.FINAL?this.marketLabel:"";return d.Tag.render(Ee||(Ee=Le`
			<div class="rest-market-expired-popup__description">
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			</div>
		`),d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_DESCRIPTION_SUBSCRIPTION_${this.type}${t}`,e))}renderButtons(){return d.Tag.render(Be||(Be=Le`
			<div class="rest-market-expired-popup__buttons-wrapper">
				<div class="rest-market-expired-popup__button-container">
					${0}
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]().render(),babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]().render())}onOpen(){if(this.type===A.FINAL){BX.userOptions.save("rest","marketSubscriptionPopupDismiss",null,"Y")}else{BX.userOptions.save("rest","marketSubscriptionPopupTs",null,Math.floor(Date.now()/1e3))}super.onOpen()}renderAboutLink(){const e=()=>{var e;BX.Helper.show("redirect=detail&code=17451118");(e=this.getAnalytic())==null?void 0:e.sendClickButton("details")};return d.Tag.render(me||(me=Le`
			<span class="rest-market-expired-popup__details">
				<a
					class="ui-link rest-market-expired-popup__link"
					href="#"
					onclick="${0}"
				>
					${0}
				</a>
			</span>
		`),e,d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DETAILS"))}}function ke(){return new le({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_RENEW_SUBSCRIPTION"),analytic:this.getAnalytic()})}function fe(){return new pe({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_NEVER_SHOW_AGAIN"),onSuccess:()=>{BX.userOptions.save("rest","marketSubscriptionPopupDismiss",null,"Y");this.close()},analytic:this.getAnalytic()})}let Se=e=>e,Fe,Oe,Ae;var Ce=babelHelpers.classPrivateFieldLooseKey("renderDiscountPercent");var He=babelHelpers.classPrivateFieldLooseKey("renderTermsOfPromotion");class Ne extends O{constructor(e){var t,s,i;super(e);Object.defineProperty(this,He,{value:De});Object.defineProperty(this,Ce,{value:xe});this.discountPercentage=(t=e==null?void 0:e.discountPercentage)!=null?t:null;this.termsUrl=(s=e==null?void 0:e.termsUrl)!=null?s:null;this.marketLabel=(i=e==null?void 0:e.marketLabel)!=null?i:""}getContainer(){var e;(e=this.container)!=null?e:this.container=d.Tag.render(Fe||(Fe=Se`
			<aside class="rest-market-expired-popup__discount rest-market-expired-popup__discount--subscription">
				${0}
				<p class="rest-market-expired-popup__discount-description">
					${0}
				</p>
				${0}
			</aside>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](),d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_DISCOUNT_SUBSCRIPTION_DESCRIPTION${this.marketLabel}`),babelHelpers.classPrivateFieldLooseBase(this,He)[He]());return this.container}}function xe(){if(this.discountPercentage){return d.Tag.render(Oe||(Oe=Se`
				<p class="rest-market-expired-popup__discount-percentage">
					- ${0}%
				</p>
			`),this.discountPercentage)}return""}function De(){if(this.termsUrl){return d.Tag.render(Ae||(Ae=Se`
				<a href="${0}" target="_blank" class="ui-link rest-market-expired-popup__discount-terms">
					${0}
				</a>
			`),this.termsUrl,d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_TERMS_OF_PROMOTION"))}return""}let we=e=>e,Me;class Ue extends O{getContainer(){var e;(e=this.container)!=null?e:this.container=d.Tag.render(Me||(Me=we`
			<aside class="rest-market-expired-popup__discount">
				<p class="rest-market-expired-popup__discount-description">
					${0}
				</p>
			</aside>
		`),d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DISCOUNT_DESCRIPTION",{"[white-span]":'<span class="rest-market-expired-popup__discount-description-white">',"[/white-span]":"</span>"}));return this.container}}class Ke extends oe{getButtonConfig(){return{id:"marketExpiredPopup_button_demo",size:u.Button.Size.MEDIUM,color:u.Button.Color.LIGHT_BORDER,noCaps:true,round:true}}onClick(){var e;this.getButton().unbindEvent("click");this.getButton().setState(u.Button.State.WAITING);(e=this.analytic)==null?void 0:e.sendClickButton("demo");d.ajax({url:"/bitrix/tools/rest.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),action:"activate_demo"},onsuccess:e=>{this.onSuccess();if(e.error){r.UI.Notification.Center.notify({content:e.error,category:"demo_subscribe_error",position:"top-right"})}else{var t;(t=this.analytic)==null?void 0:t.sendDemoActivated();a.FeaturePromotersRegistry.getPromoter({code:"limit_market_trial_active"}).show()}}})}}let $e=e=>e,Xe,je,We,Ge,ze,Ye,qe;var Ve=babelHelpers.classPrivateFieldLooseKey("getDemoButton");var Qe=babelHelpers.classPrivateFieldLooseKey("getSubscribeButton");var Je=babelHelpers.classPrivateFieldLooseKey("getHideButton");var Ze=babelHelpers.classPrivateFieldLooseKey("renderButtonsForWarning");var et=babelHelpers.classPrivateFieldLooseKey("renderButtonsForFinal");var tt=babelHelpers.classPrivateFieldLooseKey("getFeatureCode");var st=babelHelpers.classPrivateFieldLooseKey("showOpenLinesWidget");class it extends te{constructor(...e){super(...e);Object.defineProperty(this,st,{value:pt});Object.defineProperty(this,tt,{value:ct});Object.defineProperty(this,et,{value:lt});Object.defineProperty(this,Ze,{value:nt});Object.defineProperty(this,Je,{value:ot});Object.defineProperty(this,Qe,{value:at});Object.defineProperty(this,Ve,{value:rt})}getCategory(){return C.TRANSITION}getTitle(){return d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_TITLE_${this.type}`)}renderDescription(){const e=d.Tag.render(Xe||(Xe=$e`
			<div class="rest-market-expired-popup__description">
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			</div>
		`),d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_1"),d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_2"),d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_3"));if(this.type==="FINAL"){d.Dom.append(d.Tag.render(je||(je=$e`
					<p class="rest-market-expired-popup__description-text">
						${0}
					</p>
				`),d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_DESCRIPTION_FINAL${this.marketLabel}`)),e)}d.Dom.append(d.Tag.render(We||(We=$e`
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			`),d.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_${this.type}_DESCRIPTION${this.withDemo?"_DEMO":""}`,{"#DATE#":this.expireDate})),e);return e}renderButtons(){if(this.type===A.WARNING){return babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]()}return babelHelpers.classPrivateFieldLooseBase(this,et)[et]()}show(){super.show();if(d.Type.isStringFilled(this.olWidgetCode)&&(!this.withDemo||this.type==="FINAL")){babelHelpers.classPrivateFieldLooseBase(this,st)[st](window,document,`https://bitrix24.team/upload/crm/site_button/loader_${this.olWidgetCode}.js`)}}onClose(){var e;(e=BX.SiteButton)==null?void 0:e.hide();BX.userOptions.save("rest","marketTransitionPopupTs",null,Math.floor(Date.now()/1e3));super.onClose()}renderAboutLink(){const e=()=>{var e;(e=this.getAnalytic())==null?void 0:e.sendClickButton("details")};return d.Tag.render(Ge||(Ge=$e`
			<span class="rest-market-expired-popup__details">
				<a
					class="ui-link rest-market-expired-popup__link"
					href="FEATURE_PROMOTER=${0}"
					onclick="${0}"
				>
					${0}
				</a>
			</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,tt)[tt](),e,d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DETAILS"))}}function rt(){return new Ke({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_DEMO"),onSuccess:this.close.bind(this),analytic:this.getAnalytic()})}function at(){return new le({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_SUBSCRIBE"),analytic:this.getAnalytic()})}function ot(){return new pe({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_HIDE"),onSuccess:()=>{BX.userOptions.save("rest","marketTransitionPopupDismiss",null,"Y");this.close()},analytic:this.getAnalytic()})}function nt(){return d.Tag.render(ze||(ze=$e`
			<div class="rest-market-expired-popup__buttons-wrapper">
				<div class="rest-market-expired-popup__button-container">
					${0}
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]().render(),this.withDemo?babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]().render():"")}function lt(){if(this.withDemo){return d.Tag.render(Ye||(Ye=$e`
				<div class="rest-market-expired-popup__buttons-wrapper">
					${0}
					<div class="rest-market-expired-popup__button-container">
						${0}
						${0}
					</div>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]().render(),babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]().render(),babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]().render())}return d.Tag.render(qe||(qe=$e`
			<div class="rest-market-expired-popup__buttons-wrapper">
				<div class="rest-market-expired-popup__button-container">
					${0}
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]().render(),babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]().render())}function ct(){return`\n\t\t\tlimit_v2_nosubscription_marketplace_withapplications\n\t\t\t${this.withDiscount?"":"_nodiscount"}\n\t\t\t_off\n\t\t\t${this.withDemo?"":"_no_demo"}\n\t\t`}function pt(e,t,s){const i=t.createElement("script");i.async=true;i.src=`${s}?${Date.now()/6e4|0}`;const r=t.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r)}var ut=babelHelpers.classPrivateFieldLooseKey("getPopupClass");var dt=babelHelpers.classPrivateFieldLooseKey("getAnalytic");var bt=babelHelpers.classPrivateFieldLooseKey("getListItemCount");var ht=babelHelpers.classPrivateFieldLooseKey("getDiscountEar");var _t=babelHelpers.classPrivateFieldLooseKey("getMarketList");class Pt{constructor(e){Object.defineProperty(this,_t,{value:Et});Object.defineProperty(this,ht,{value:Lt});Object.defineProperty(this,bt,{value:Tt});Object.defineProperty(this,dt,{value:gt});Object.defineProperty(this,ut,{value:vt});this.config=e}async createPopup(){let e=null;const t=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]();const s=babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]();const{appList:i,integrationList:r}=await babelHelpers.classPrivateFieldLooseBase(this,_t)[_t](s,t);if(i||r){const s=babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]();const a=babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]();e=new a({appList:i,integrationList:r,analytic:t,discountEar:s,expireDate:this.config.expireDate,marketSubscriptionUrl:this.config.marketSubscriptionUrl,withDemo:this.config.withDemo,olWidgetCode:this.config.olWidgetCode,type:this.config.type,expireDays:this.config.expireDays})}return e}}function vt(){switch(this.config.category){case C.TRIAL:return ve;case C.SUBSCRIPTION:return ye;case C.TRANSITION:default:return it}}function gt(){var e,t;return new D({withDiscount:(e=(t=this.config.discount)==null?void 0:t.isAvailable)!=null?e:false,popupType:this.config.type,popupCategory:this.config.category})}function Tt(){switch(this.config.category){case C.TRIAL:case C.SUBSCRIPTION:return 2;case C.TRANSITION:default:return 3}}function Lt(){const e=this.config.discount;if(!(e!=null&&e.isAvailable)){return null}switch(this.config.category){case C.TRIAL:case C.SUBSCRIPTION:return new Ne({discountPercentage:e.percentage,termsUrl:e.termsUrl,marketLabel:this.config.isRenamedMarket?"":"_MARKET_PLUS"});case C.TRANSITION:default:return new Ue}}async function Et(e,t){const s=(e,t,s,i)=>{if(!e||!e.data){return null}const{items:r,count:a}=e.data;const o=[];if(r.length===0||a<1){return null}Object.values(r).forEach((e=>{o.push(new T({name:e.name,icon:e.icon}))}));return new S({title:s,count:a,items:o,link:t,onClick:i})};let i=null;let r=null;await Promise.all([d.ajax.runAction("rest.integration.getApplicationList",{data:{limit:e}}),d.ajax.runAction("rest.integration.getIntegrationList",{data:{limit:e}})]).then((([e,a])=>{i=s(e,"/market/installed/",d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_TITLE_APPS"),(()=>{t.sendClickButton("view_all_apps")}));r=s(a,"/devops/list/",d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_TITLE_INTEGRATIONS"),(()=>{t.sendClickButton("view_all_integrations")}))})).catch((e=>{console.log(e)}));return{appList:i,integrationList:r}}class Bt{}Bt.INTEGRATION="Integration";Bt.APPLICATION="Application";Bt.ANY_PAGE="AnyPage";let mt=e=>e,Rt;var It=babelHelpers.classPrivateFieldLooseKey("panel");var yt=babelHelpers.classPrivateFieldLooseKey("getPanel");var kt=babelHelpers.classPrivateFieldLooseKey("sendAnalytics");class ft{constructor(e){Object.defineProperty(this,kt,{value:Ft});Object.defineProperty(this,yt,{value:St});Object.defineProperty(this,It,{writable:true,value:null});this.options=e}show(){o.BannerDispatcher.critical.toQueue((e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](e);t.show();babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]("show_notification_panel")}))}getRightButtons(){return[]}getContent(){throw new Error("Not Implemented")}onRightButtonClick(){babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]().hide();babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]("click_button")}onHide(){}}function St(e){var t,s;(s=(t=babelHelpers.classPrivateFieldLooseBase(this,It))[It])!=null?s:t[It]=new n.NotificationPanel({content:d.Tag.render(Rt||(Rt=mt`
				<span class="rest-market-expired-curtain">${0}</span>
			`),this.getContent()),backgroundColor:"#E89B06",crossColor:"#FFFFFF",leftIcon:new l.Icon({icon:l.Main.MARKET_1,color:"#FFFFFF"}),rightButtons:this.getRightButtons(),events:{onHide:()=>{e();this.onHide()}},zIndex:1001});return babelHelpers.classPrivateFieldLooseBase(this,It)[It]}function Ft(e){const t={tool:"infohelper",category:"market",event:e,type:"notification_panel"};c.sendData(t)}class Ot extends ft{getRightButtons(){return[new u.Button({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_SUBSCRIBE"),size:u.Button.Size.EXTRA_SMALL,color:u.Button.Color.CURTAIN_WARNING,tag:u.Button.Tag.LINK,noCaps:true,round:true,props:{href:this.options.marketSubscriptionUrl},onclick:()=>super.onRightButtonClick.bind(this)})]}getContent(){return this.options.type===A.FINAL?d.Loc.getMessage(`REST_MARKET_EXPIRED_CURTAIN_TRIAL_FINAL_TEXT${this.marketLabel}`):d.Loc.getMessage(`REST_MARKET_EXPIRED_CURTAIN_TRIAL_WARNING_TEXT${this.marketLabel}`,{"#DAYS#":this.options.expireDays})}onHide(){if(this.options.type===A.FINAL){BX.userOptions.save("rest",`marketSubscriptionCurtain${this.options.curtainPage}Dismiss`,null,"Y")}else{BX.userOptions.save("rest",`marketSubscriptionCurtain${this.options.curtainPage}Ts`,null,Math.floor(Date.now()/1e3))}}}class At extends ft{getRightButtons(){return[new u.Button({text:d.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_RENEW_SUBSCRIPTION"),size:u.Button.Size.EXTRA_SMALL,color:u.Button.Color.CURTAIN_WARNING,tag:u.Button.Tag.LINK,noCaps:true,round:true,props:{href:this.options.marketSubscriptionUrl},onclick:()=>super.onRightButtonClick.bind(this)})]}getContent(){return this.options.type===A.FINAL?d.Loc.getMessage(`REST_MARKET_EXPIRED_CURTAIN_SUBSCRIPTION_FINAL_TEXT${this.marketLabel}`):d.Loc.getMessage(`REST_MARKET_EXPIRED_CURTAIN_SUBSCRIPTION_WARNING_TEXT${this.marketLabel}`,{"#DAYS#":this.options.expireDays})}onHide(){if(this.options.type===A.FINAL){BX.userOptions.save("rest",`marketSubscriptionCurtain${this.options.curtainPage}Dismiss`,null,"Y")}else{BX.userOptions.save("rest",`marketSubscriptionCurtain${this.options.curtainPage}Ts`,null,Math.floor(Date.now()/1e3))}}}class Ct extends ft{getRightButtons(){return[new u.Button({text:d.Loc.getMessage("REST_MARKET_EXPIRED_CURTAIN_TRANSITION_BUTTON"),size:u.Button.Size.EXTRA_SMALL,color:u.Button.Color.CURTAIN_WARNING,tag:u.Button.Tag.LINK,noCaps:true,round:true,props:{href:"FEATURE_PROMOTER=limit_v2_nosubscription_marketplace_withapplications_off"},onclick:()=>super.onRightButtonClick.bind(this)})]}getContent(){return d.Loc.getMessage("REST_MARKET_EXPIRED_CURTAIN_TRANSITION_TEXT")}onHide(){BX.userOptions.save("rest",`marketTransitionCurtain${this.options.curtainPage}Ts`,null,Math.floor(Date.now()/1e3))}}var Ht=babelHelpers.classPrivateFieldLooseKey("getCurtainClass");class Nt{constructor(e){Object.defineProperty(this,Ht,{value:xt});this.config=e}createCurtain(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]();return new t({marketSubscriptionUrl:this.config.marketSubscriptionUrl,type:this.config.type,expireDays:this.config.expireDays,curtainPage:e})}}function xt(){switch(this.config.category){case C.TRIAL:return Ot;case C.SUBSCRIPTION:return At;case C.TRANSITION:default:return Ct}}class Dt{constructor(e){this.config=e}static async getPopup(e=null){const t=e!=null?e:d.Extension.getSettings("rest.market-expired");const s=new Pt(t);return s.createPopup()}static getCurtain(e,t=null){const s=t!=null?t:d.Extension.getSettings("rest.market-expired");const i=new Nt(s);return i.createCurtain(e)}}e.CurtainPage=Bt;e.MarketExpired=Dt})(this.BX.Rest=this.BX.Rest||{},BX.Main,BX,BX.Event,BX,BX.UI,BX.UI,BX.UI,BX.UI.IconSet,BX.UI.Analytics,BX,BX.UI,BX);
//# sourceMappingURL=market-expired.bundle.map.js