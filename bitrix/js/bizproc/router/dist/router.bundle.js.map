{"version":3,"file":"router.bundle.js","sources":["../src/router.js"],"sourcesContent":["import 'sidepanel';\nimport { Loc, Text, Uri } from 'main.core';\nimport { EditConstantParams } from './types/edit-constant-params';\n\nexport class Router\n{\n\tstatic #startSliderWidth: Number = 970;\n\n\tstatic init()\n\t{\n\t\tif (top !== window)\n\t\t{\n\t\t\ttop.BX.Runtime.loadExtension('bizproc.router').then(({ Router }) => {\n\t\t\t\tRouter.init();\n\t\t\t}).catch(e => console.error(e));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#bind();\n\t}\n\n\tstatic #bind()\n\t{\n\t\ttop.BX.SidePanel.Instance.bindAnchors({\n\t\t\trules:\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t'/rpa/task/',\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\twidth: 580,\n\t\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcondition: [\n\t\t\t\t\t\t\t'/company/personal/bizproc/([a-zA-Z0-9\\\\.]+)/',\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\t\tloader: 'bizproc:workflow-info',\n\t\t\t\t\t\t\twidth: this.#detectSliderWidth(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t});\n\t}\n\n\tstatic #detectSliderWidth(): number\n\t{\n\t\tif (window.innerWidth < 1500)\n\t\t{\n\t\t\treturn null; // default slider width\n\t\t}\n\n\t\treturn 1500 + Math.floor((window.innerWidth - 1500) / 3);\n\t}\n\n\tstatic #openSlider(url: string, options: Object): void\n\t{\n\t\ttop.BX.Runtime\n\t\t\t.loadExtension('sidepanel')\n\t\t\t.then(() => {\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t})\n\t\t\t.catch((response) => console.error(response.errors));\n\t}\n\n\tstatic openWorkflowLog(workflowId: string): void\n\t{\n\t\tconst url = `/bitrix/components/bitrix/bizproc.log/slider.php?WORKFLOW_ID=${workflowId}`;\n\t\tconst options = {\n\t\t\twidth: this.#detectSliderWidth(),\n\t\t\tcacheable: false,\n\t\t};\n\t\tthis.#openSlider(url, options);\n\t}\n\n\tstatic openWorkflow(workflowId: string): void\n\t{\n\t\tconst url = `/company/personal/bizproc/${workflowId}/`;\n\t\tconst options = {\n\t\t\twidth: this.#detectSliderWidth(),\n\t\t\tcacheable: false,\n\t\t\tloader: 'bizproc:workflow-info',\n\t\t};\n\t\tthis.#openSlider(url, options);\n\t}\n\n\tstatic openWorkflowTask(taskId: number, userId: number): void\n\t{\n\t\tlet url = `/company/personal/bizproc/${taskId}/`;\n\t\tif (userId > 0)\n\t\t{\n\t\t\turl += `?USER_ID=${userId}`;\n\t\t}\n\t\tconst options = {\n\t\t\twidth: this.#detectSliderWidth(),\n\t\t\tcacheable: false,\n\t\t\tloader: 'bizproc:workflow-info',\n\t\t};\n\t\tthis.#openSlider(url, options);\n\t}\n\n\tstatic openUserProcessesStart(options: Object): void\n\t{\n\t\tconst sliderOptions = {\n\t\t\twidth: this.#startSliderWidth,\n\t\t\tcacheable: false,\n\t\t\tloader: 'bizproc:start-process-page',\n\t\t\t...options,\n\t\t};\n\n\t\tlet url = '/bizproc/start/';\n\t\tif (options && options.requestMethod === 'get' && options.requestParams)\n\t\t{\n\t\t\turl = BX.Uri.addParam(url, options.requestParams);\n\t\t}\n\n\t\tthis.#openSlider(url, sliderOptions);\n\t}\n\n\tstatic openWorkflowStartList(options: Object): void\n\t{\n\t\tconst sliderOptions = {\n\t\t\twidth: this.#startSliderWidth,\n\t\t\tcacheable: false,\n\t\t\tloader: 'bizproc:start-process-page',\n\t\t\t...options,\n\t\t};\n\n\t\tlet url = '/bitrix/components/bitrix/bizproc.workflow.start.list/';\n\t\tif (options && options.requestMethod === 'get' && options.requestParams)\n\t\t{\n\t\t\turl = BX.Uri.addParam(url, options.requestParams);\n\t\t}\n\n\t\tthis.#openSlider(url, sliderOptions);\n\t}\n\n\tstatic openWorkflowChangeConstants(params: EditConstantParams): void\n\t{\n\t\tconst url = Router.#createEditConstantSlider(params);\n\t\tconst sliderOptions = {\n\t\t\twidth: 900,\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t};\n\n\t\tthis.#openSlider(url, sliderOptions);\n\t}\n\n\tstatic #createEditConstantSlider(params: EditConstantParams): string\n\t{\n\t\tlet url = Uri.addParam(\n\t\t\t'/bitrix/components/bitrix/bizproc.workflow.start/',\n\t\t\t{ sessid: Loc.getMessage('bitrix_sessid'), action: 'CHANGE_CONSTANTS' },\n\t\t);\n\n\t\tconst templateId = Text.toInteger(params.templateId);\n\t\tif (templateId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, { templateId });\n\t\t}\n\n\t\tif (params.signedDocumentType)\n\t\t{\n\t\t\turl = Uri.addParam(url, { signedDocumentType: params.signedDocumentType });\n\t\t}\n\n\t\treturn url;\n\t}\n}\n"],"names":["Router","init","top","window","BX","Runtime","loadExtension","then","catch","e","console","error","openWorkflowLog","workflowId","url","options","width","cacheable","openWorkflow","loader","openWorkflowTask","taskId","userId","openUserProcessesStart","sliderOptions","requestMethod","requestParams","Uri","addParam","openWorkflowStartList","openWorkflowChangeConstants","params","allowChangeHistory","SidePanel","Instance","bindAnchors","rules","condition","innerWidth","Math","floor","open","response","errors","sessid","Loc","getMessage","action","templateId","Text","toInteger","signedDocumentType"],"mappings":";;;;;CAEkE;CAAA;CAAA;CAAA;CAAA;AAElE,CAAO,MAAMA,MAAM,CACnB;GAGC,OAAOC,IAAI,GACX;KACC,IAAIC,GAAG,KAAKC,MAAM,EAClB;OACCD,GAAG,CAACE,EAAE,CAACC,OAAO,CAACC,aAAa,CAAC,gBAAgB,CAAC,CAACC,IAAI,CAAC,CAAC;SAAEP;QAAQ,KAAK;SACnEA,MAAM,CAACC,IAAI,EAAE;QACb,CAAC,CAACO,KAAK,CAACC,CAAC,IAAIC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC,CAAC;OAE/B;;KAGD,4CAAI;;GAoDL,OAAOG,eAAe,CAACC,UAAkB,EACzC;KACC,MAAMC,GAAG,GAAI,gEAA+DD,UAAW,EAAC;KACxF,MAAME,OAAO,GAAG;OACfC,KAAK,0CAAE,IAAI,2CAAqB;OAChCC,SAAS,EAAE;MACX;KACD,4CAAI,4BAAaH,GAAG,EAAEC,OAAO;;GAG9B,OAAOG,YAAY,CAACL,UAAkB,EACtC;KACC,MAAMC,GAAG,GAAI,6BAA4BD,UAAW,GAAE;KACtD,MAAME,OAAO,GAAG;OACfC,KAAK,0CAAE,IAAI,2CAAqB;OAChCC,SAAS,EAAE,KAAK;OAChBE,MAAM,EAAE;MACR;KACD,4CAAI,4BAAaL,GAAG,EAAEC,OAAO;;GAG9B,OAAOK,gBAAgB,CAACC,MAAc,EAAEC,MAAc,EACtD;KACC,IAAIR,GAAG,GAAI,6BAA4BO,MAAO,GAAE;KAChD,IAAIC,MAAM,GAAG,CAAC,EACd;OACCR,GAAG,IAAK,YAAWQ,MAAO,EAAC;;KAE5B,MAAMP,OAAO,GAAG;OACfC,KAAK,0CAAE,IAAI,2CAAqB;OAChCC,SAAS,EAAE,KAAK;OAChBE,MAAM,EAAE;MACR;KACD,4CAAI,4BAAaL,GAAG,EAAEC,OAAO;;GAG9B,OAAOQ,sBAAsB,CAACR,OAAe,EAC7C;KACC,MAAMS,aAAa,GAAG;OACrBR,KAAK,0CAAE,IAAI,uCAAkB;OAC7BC,SAAS,EAAE,KAAK;OAChBE,MAAM,EAAE,4BAA4B;OACpC,GAAGJ;MACH;KAED,IAAID,GAAG,GAAG,iBAAiB;KAC3B,IAAIC,OAAO,IAAIA,OAAO,CAACU,aAAa,KAAK,KAAK,IAAIV,OAAO,CAACW,aAAa,EACvE;OACCZ,GAAG,GAAGV,EAAE,CAACuB,GAAG,CAACC,QAAQ,CAACd,GAAG,EAAEC,OAAO,CAACW,aAAa,CAAC;;KAGlD,4CAAI,4BAAaZ,GAAG,EAAEU,aAAa;;GAGpC,OAAOK,qBAAqB,CAACd,OAAe,EAC5C;KACC,MAAMS,aAAa,GAAG;OACrBR,KAAK,0CAAE,IAAI,uCAAkB;OAC7BC,SAAS,EAAE,KAAK;OAChBE,MAAM,EAAE,4BAA4B;OACpC,GAAGJ;MACH;KAED,IAAID,GAAG,GAAG,wDAAwD;KAClE,IAAIC,OAAO,IAAIA,OAAO,CAACU,aAAa,KAAK,KAAK,IAAIV,OAAO,CAACW,aAAa,EACvE;OACCZ,GAAG,GAAGV,EAAE,CAACuB,GAAG,CAACC,QAAQ,CAACd,GAAG,EAAEC,OAAO,CAACW,aAAa,CAAC;;KAGlD,4CAAI,4BAAaZ,GAAG,EAAEU,aAAa;;GAGpC,OAAOM,2BAA2B,CAACC,MAA0B,EAC7D;KACC,MAAMjB,GAAG,2CAAGd,MAAM,wDAA2B+B,MAAM,CAAC;KACpD,MAAMP,aAAa,GAAG;OACrBR,KAAK,EAAE,GAAG;OACVC,SAAS,EAAE,KAAK;OAChBe,kBAAkB,EAAE;MACpB;KAED,4CAAI,4BAAalB,GAAG,EAAEU,aAAa;;CAuBrC;CAAC,kBAxJA;GACCtB,GAAG,CAACE,EAAE,CAAC6B,SAAS,CAACC,QAAQ,CAACC,WAAW,CAAC;KACrCC,KAAK,EACJ,CACC;OACCC,SAAS,EAAE,CACV,YAAY,CACZ;OACDtB,OAAO,EAAE;SACRC,KAAK,EAAE,GAAG;SACVC,SAAS,EAAE,KAAK;SAChBe,kBAAkB,EAAE;;MAErB,EACD;OACCK,SAAS,EAAE,CACV,8CAA8C,CAC9C;OACDtB,OAAO,EAAE;SACRE,SAAS,EAAE,KAAK;SAChBE,MAAM,EAAE,uBAAuB;SAC/BH,KAAK,0CAAE,IAAI;;MAEZ;IAEH,CAAC;CACH;CAAC,+BAGD;GACC,IAAIb,MAAM,CAACmC,UAAU,GAAG,IAAI,EAC5B;KACC,OAAO,IAAI,CAAC;;;GAGb,OAAO,IAAI,GAAGC,IAAI,CAACC,KAAK,CAAC,CAACrC,MAAM,CAACmC,UAAU,GAAG,IAAI,IAAI,CAAC,CAAC;CACzD;CAAC,sBAEkBxB,GAAW,EAAEC,OAAe,EAC/C;GACCb,GAAG,CAACE,EAAE,CAACC,OAAO,CACZC,aAAa,CAAC,WAAW,CAAC,CAC1BC,IAAI,CAAC,MAAM;KACXH,EAAE,CAAC6B,SAAS,CAACC,QAAQ,CAACO,IAAI,CAAC3B,GAAG,EAAEC,OAAO,CAAC;IACxC,CAAC,CACDP,KAAK,CAAEkC,QAAQ,IAAKhC,OAAO,CAACC,KAAK,CAAC+B,QAAQ,CAACC,MAAM,CAAC,CAAC;CACtD;CAAC,oCAsFgCZ,MAA0B,EAC3D;GACC,IAAIjB,GAAG,GAAGa,aAAG,CAACC,QAAQ,CACrB,mDAAmD,EACnD;KAAEgB,MAAM,EAAEC,aAAG,CAACC,UAAU,CAAC,eAAe,CAAC;KAAEC,MAAM,EAAE;IAAoB,CACvE;GAED,MAAMC,UAAU,GAAGC,cAAI,CAACC,SAAS,CAACnB,MAAM,CAACiB,UAAU,CAAC;GACpD,IAAIA,UAAU,GAAG,CAAC,EAClB;KACClC,GAAG,GAAGa,aAAG,CAACC,QAAQ,CAACd,GAAG,EAAE;OAAEkC;MAAY,CAAC;;GAGxC,IAAIjB,MAAM,CAACoB,kBAAkB,EAC7B;KACCrC,GAAG,GAAGa,aAAG,CAACC,QAAQ,CAACd,GAAG,EAAE;OAAEqC,kBAAkB,EAAEpB,MAAM,CAACoB;MAAoB,CAAC;;GAG3E,OAAOrC,GAAG;CACX;CAAC,sBA1KWd,MAAM;GAAA;CAAA;CAAA,sBAANA,MAAM;GAAA;CAAA;CAAA,sBAANA,MAAM;GAAA;CAAA;CAAA,sBAANA,MAAM;GAAA;CAAA;CAAA,sBAANA,MAAM;GAAA;GAAA,OAEiB;CAAG;;;;;;;;"}