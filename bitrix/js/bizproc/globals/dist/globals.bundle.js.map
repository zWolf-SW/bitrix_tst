{"version":3,"file":"globals.bundle.js","sources":["../src/manager.js","../src/globals.js"],"sourcesContent":["import {ajax, Type, Uri, Text} from 'main.core';\nimport 'sidepanel';\n\nlet instance = null;\n\nexport default class Manager\n{\n\tmode = {\n\t\tvariable: 'variable',\n\t\tconstant: 'constant',\n\t}\n\n\tlistUrl = '/bitrix/components/bitrix/bizproc.globalfield.list/';\n\teditUrl = '/bitrix/components/bitrix/bizproc.globalfield.edit/';\n\n\tlistSliderOptions = {\n\t\twidth: 1150,\n\t\tcacheable: false,\n\t\tallowChangeHistory: false,\n\t};\n\n\teditSliderOptions = {\n\t\twidth: 500,\n\t\tcacheable: false,\n\t\tallowChangeHistory: false\n\t};\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tstatic openSlider(url, options): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tif(!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\t\toptions = {...{cacheable: false, allowChangeHistory: true, events: {}}, ...options};\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif(Type.isStringFilled(url))\n\t\t\t{\n\t\t\t\toptions.events.onClose = function(event)\n\t\t\t\t{\n\t\t\t\t\tresolve(event.getSlider());\n\t\t\t\t};\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateGlobals(\n\t\tmode: string,\n\t\tdocumentType: string,\n\t\tname: string,\n\t\tadditionContext: {\n\t\t\tvisibility?: string,\n\t\t\tavailableTypes?: Array<string>,\n\t\t},\n\t): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tconst customName = Type.isStringFilled(name) ? name : '';\n\n\t\tlet url = Uri.addParam(this.editUrl, { documentType, mode: this.mode[mode], name: customName });\n\t\tif (Type.isPlainObject(additionContext))\n\t\t{\n\t\t\tif (Type.isStringFilled(additionContext.visibility))\n\t\t\t{\n\t\t\t\turl = Uri.addParam(url, { visibility: additionContext.visibility });\n\t\t\t}\n\n\t\t\tif (Type.isArrayFilled(additionContext.availableTypes))\n\t\t\t{\n\t\t\t\turl = Uri.addParam(url, { availableTypes: additionContext.availableTypes });\n\t\t\t}\n\t\t}\n\n\t\treturn this.constructor.openSlider(url, this.editSliderOptions);\n\t}\n\n\teditGlobals(id: string, mode: string, documentType: string): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tid = Type.isStringFilled(id) ? Text.decode(id) : '';\n\n\t\treturn this.constructor.openSlider(\n\t\t\tUri.addParam(this.editUrl, {fieldId: id, mode: this.mode[mode], documentType}),\n\t\t\tthis.editSliderOptions\n\t\t);\n\t}\n\n\tshowGlobals(mode: string, documentType: string): Promise<?BX.SidePanel.Slider>\n\t{\n\t\treturn this.constructor.openSlider(\n\t\t\tUri.addParam(this.listUrl, {documentType, mode: this.mode[mode]}),\n\t\t\tthis.listSliderOptions\n\t\t);\n\t}\n\n\tdeleteGlobalsAction(id: string, mode: string, documentType: string): Promise\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'bizproc.globalfield.delete',\n\t\t\t{\n\t\t\t\tanalyticsLabel: 'bizprocGlobalFieldDelete',\n\t\t\t\tdata: {\n\t\t\t\t\tfieldId: id,\n\t\t\t\t\tmode,\n\t\t\t\t\tdocumentType,\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tupsertGlobalsAction(id: string, property: {}, documentType: string, mode: string): Promise\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'bizproc.globalfield.upsert',\n\t\t\t{\n\t\t\t\tanalyticsLabel: 'bizprocGlobalFieldUpsert',\n\t\t\t\tdata: {\n\t\t\t\t\tfieldId: id,\n\t\t\t\t\tproperty,\n\t\t\t\t\tdocumentType,\n\t\t\t\t\tmode\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n}\n","import Manager from './manager';\n\nexport const Globals = {\n\tManager,\n};"],"names":["instance","Manager","variable","constant","width","cacheable","allowChangeHistory","mode","documentType","name","additionContext","customName","Type","isStringFilled","url","Uri","addParam","editUrl","isPlainObject","visibility","isArrayFilled","availableTypes","constructor","openSlider","editSliderOptions","id","Text","decode","fieldId","listUrl","listSliderOptions","ajax","runAction","analyticsLabel","data","property","options","events","Promise","resolve","onClose","event","getSlider","BX","SidePanel","Instance","open","Globals"],"mappings":"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"}