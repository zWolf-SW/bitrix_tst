{"version":3,"file":"copilot.bundle.js","sources":["../src/ai-loader/ai-loader.js","../src/change-background-with-animation.js","../src/copilot.js"],"sourcesContent":["import { Tag, Dom, Event, Loc } from 'main.core';\nimport { Lottie } from 'ui.lottie';\nimport './ai-loader.css';\nimport loaderAnimation from './landing-site-loader.json';\n\nexport class AiLoader\n{\n\tconstructor()\n\t{\n\t\tthis.container = null;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\tconst loaderNode = Tag.render`<div class=\"landing-ui-ai-loader__animate\"></div>`;\n\n\t\t\tLottie.loadAnimation({\n\t\t\t\tcontainer: loaderNode,\n\t\t\t\trenderer: 'svg',\n\t\t\t\tloop: true,\n\t\t\t\tautoplay: true,\n\t\t\t\tanimationData: loaderAnimation,\n\t\t\t});\n\n\t\t\tthis.container = Tag.render`\n\t\t\t\t<div class=\"landing-ui-ai-loader\">\n\t\t\t\t\t<div class=\"landing-ui-ai-loader__animate\">${loaderNode}</div>\n\t\t\t\t\t<div class=\"landing-ui-ai-loader__text\">${Loc.getMessage('LANDING_SITE_GENERATE')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\topen()\n\t{\n\t\tDom.append(this.getContainer(), document.body);\n\t}\n\n\tclose()\n\t{\n\t\tEvent.bind(this.getContainer(), 'transitionend', () => {\n\t\t\tthis.container = null;\n\t\t\tDom.remove(this.getContainer());\n\t\t});\n\t\tDom.addClass(this.getContainer(), '--close');\n\t}\n}\n","import { bind, Dom } from 'main.core';\nimport { wait } from './wait';\n\nexport type ChangeBackgroundWithFadeOptions = {\n\telement: HTMLElement | HTMLImageElement,\n\tnewImageUrl: string;\n\tduration?: number;\n\tdelay?: number;\n}\n\nexport const changeBackgroundWithFade = async (options: ChangeBackgroundWithFadeOptions) => {\n\tconst { element, newImageUrl, duration = 1000, delay = 0 } = options;\n\n\tconst currentImage = element.tagName === 'IMG' ? `url(${element.getAttribute('src')})` : getComputedStyle(element).backgroundImage;\n\tconst elementRect = Dom.getPosition(element);\n\n\tconst overlay = document.createElement('div');\n\tDom.style(overlay, {\n\t\tposition: 'absolute',\n\t\topacity: 1,\n\t\ttop: `${elementRect.top}px`,\n\t\tleft: `${elementRect.left}px`,\n\t\twidth: `${elementRect.width}px`,\n\t\theight: `${elementRect.height}px`,\n\t\tbackgroundImage: String(currentImage),\n\t\ttransition: `opacity ${duration}ms ease`,\n\t\tzIndex: 0,\n\t\tbackgroundSize: 'cover',\n\t\tbackgroundRepeat: 'no-repeat',\n\t\tbackgroundPosition: 'center center',\n\t});\n\n\tDom.append(overlay, document.body);\n\n\tawait load(newImageUrl);\n\tif (element.tagName === 'IMG')\n\t{\n\t\telement.setAttribute('src', newImageUrl);\n\t}\n\telse if (getComputedStyle(element).getPropertyValue('--bg-url'))\n\t{\n\t\telement.style.setProperty('--bg-url', `url(${newImageUrl})`);\n\t\telement.style.setProperty('--bg-url-2x', `url(${newImageUrl})`);\n\t}\n\telse\n\t{\n\t\tDom.style(element, {\n\t\t\tbackgroundImage: `url(${newImageUrl})`,\n\t\t});\n\t}\n\n\tawait wait(delay);\n\t// Fade out overlay\n\trequestAnimationFrame(() => {\n\t\tDom.style(overlay, {\n\t\t\topacity: 0,\n\t\t});\n\t\tsetTimeout(() => {\n\t\t\toverlay.remove();\n\t\t}, 1000);\n\t});\n};\n\nexport function load(src): Promise\n{\n\treturn new Promise((resolve, reject) => {\n\t\tconst image = new Image();\n\t\tbind(image, 'load', resolve);\n\t\tbind(image, 'error', reject);\n\t\timage.src = src;\n\t});\n}\n","import { Dom, Event, Tag, Type, Loc } from 'main.core';\nimport { PULL, PullClient } from 'pull.client';\nimport { PageObject } from 'landing.pageobject';\nimport { Skeleton } from 'landing.ui.copilot.skeleton';\nimport { Lottie } from 'ui.lottie';\nimport { EventEmitter } from 'main.core.events';\nimport loaderAnimation\n\tfrom '../../../../../components/bitrix/landing.site_copilot/templates/.default/lottie/landing-site-loader.json';\nimport { AiLoader } from './ai-loader/ai-loader';\nimport { load } from './change-background-with-animation';\nimport { Confetti } from 'ui.confetti';\n\nimport './css/style.css';\n\nconst ANIMATION_DURATION_DELAY = 300;\nconst ANIMATION_DURATION = 500;\n\ntype BlockImage = {\n\tdefaultSrc?: string,\n\tsrc?: string,\n\tsrc2x?: string,\n\tid?: number,\n\tid2x?: number,\n\ttype?: string,\n\tisSwitchedToDefault?: boolean,\n\tisSwitchedBackToOriginal?: boolean,\n\tnodeCode?: string,\n\tposition?: number,\n\tnode?: any,\n};\n\ntype BlockData = {\n\tid: number,\n\tanchor: string,\n\timages?: BlockImage[],\n\telement?: HTMLElement,\n};\n\nexport class Copilot extends EventEmitter\n{\n\tgenerationId: ?number = null;\n\tblocksData: BlockData[];\n\taiLoader: AiLoader;\n\tmainDocumentBody: HTMLElement;\n\teditorWindow: ?Window;\n\tcompletedBlockIds: ?Set;\n\tscrollTimeout: ?number;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.Animation.Copilot');\n\n\t\tthis.editorWindow = PageObject.getEditorWindow();\n\t\tthis.blocksData = [];\n\t\tthis.aiLoader = new AiLoader({});\n\t\tthis.mainDocumentBody = window.parent.document.body;\n\t\tthis.subscribeToPullEvents();\n\t}\n\n\tsetBlocksData(blocksData: BlockData[]): Copilot\n\t{\n\t\tthis.blocksData = blocksData;\n\n\t\treturn this;\n\t}\n\n\tsetGenerationId(generationId: number): Copilot\n\t{\n\t\tthis.generationId = generationId;\n\n\t\treturn this;\n\t}\n\n\tgetAiLoader(): AiLoader\n\t{\n\t\treturn this.aiLoader;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.disableEditor();\n\n\t\tif (!this.editorWindow)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.completedBlockIds = new Set();\n\n\t\tconst blocks = PageObject.getBlocks();\n\t\tthis.blocksData = this.blocksData.map((blockData) => {\n\t\t\tconst block = blocks.get(blockData.id);\n\t\t\tconst blockDataNew = {\n\t\t\t\t...blockData,\n\t\t\t\telement: block.content,\n\t\t\t\tanchor: block.anchor,\n\t\t\t};\n\n\t\t\tSkeleton.initOnBlock(blockDataNew.anchor, blockDataNew.element);\n\n\t\t\treturn blockDataNew;\n\t\t});\n\n\t\tthis.replaceAllImagesToDefaultImage();\n\n\t\tthis.emit('init', { blocksData: this.blocksData });\n\n\t\tthis.getAiLoader().open();\n\t}\n\n\tsubscribeToPullEvents()\n\t{\n\t\tPULL.subscribe({\n\t\t\ttype: PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'landing',\n\t\t\tcallback: (event) => {\n\t\t\t\tif (\n\t\t\t\t\tevent.params.generationId !== undefined\n\t\t\t\t\t&& this.generationId !== null\n\t\t\t\t\t&& event.params.generationId !== this.generationId\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst command = event.command;\n\n\t\t\t\tif (command === 'LandingCopilotGeneration:onCopilotImageCreate')\n\t\t\t\t{\n\t\t\t\t\tthis.onImageCreate(event);\n\t\t\t\t}\n\n\t\t\t\tif (command === 'LandingCopilotGeneration:onChangeBlockFinish')\n\t\t\t\t{\n\t\t\t\t\tconst blocksData = JSON.parse(event.params.params.blockData);\n\t\t\t\t\tthis.animateBlock(blocksData);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tonImageCreate(event)\n\t{\n\t\tconst blockId = parseInt(event.params.params.blockId, 10);\n\t\tconst selector = event.params.params.selector;\n\t\tconst position = event.params.params.position;\n\t\tconst value = event.params.params.value;\n\n\t\tconst neededBlockData = this.blocksData.find((blockData) => blockData.id === blockId);\n\t\tif (neededBlockData)\n\t\t{\n\t\t\tneededBlockData.images.forEach((image) => {\n\t\t\t\tif (\n\t\t\t\t\timage.nodeCode === selector\n\t\t\t\t\t&& image.position === position\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst { src = '', src2x = '', id = '', id2x = '' } = Type.isString(value)\n\t\t\t\t\t\t? { src: value, src2x: value, id: '', id2x: '' }\n\t\t\t\t\t\t: value;\n\n\t\t\t\t\tObject.assign(image, {\n\t\t\t\t\t\tsrc,\n\t\t\t\t\t\tsrc2x,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tid2x,\n\t\t\t\t\t\tisSwitchedToDefault: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.completedBlockIds.has(blockId))\n\t\t{\n\t\t\tconst block = PageObject.getBlocks().get(blockId);\n\t\t\tif (block)\n\t\t\t{\n\t\t\t\tthis.replaceAllDefaultImagesWithImageWithoutAnimation(block, neededBlockData);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync start(): Promise<void>\n\t{\n\t\tfor (const blockData of this.blocksData)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.scrollToBlock(blockData.element);\n\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.replaceDefaultImagesOnce(blockData.id);\n\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait Skeleton.removeSkeletonFromBlock(blockData.anchor);\n\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.replaceDefaultImagesRecursive(blockData.id);\n\t\t\tthis.completedBlockIds.add(blockData.id);\n\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.delay(ANIMATION_DURATION_DELAY);\n\t\t}\n\t}\n\n\tasync stop(): void\n\t{\n\t\tif (this.blocksData[0]?.element)\n\t\t{\n\t\t\tawait this.scrollToBlock(this.blocksData[0].element);\n\t\t}\n\t\tthis.getAiLoader().close();\n\t}\n\n\tscrollToBlock(block: HTMLElement): Promise<void>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst windowOfElement = block.ownerDocument.defaultView;\n\t\t\tif (!windowOfElement)\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet scrollTimeout = null;\n\n\t\t\tconst handleScrollEnd = () => {\n\t\t\t\tif (scrollTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\t}\n\t\t\t\tscrollTimeout = setTimeout(() => {\n\t\t\t\t\tEvent.unbind(windowOfElement, 'scroll', handleScrollEnd);\n\t\t\t\t\tresolve();\n\t\t\t\t}, 300);\n\t\t\t};\n\n\t\t\tEvent.bind(windowOfElement, 'scroll', handleScrollEnd);\n\n\t\t\tif (\n\t\t\t\t(block.getBoundingClientRect().top === 0 && windowOfElement.scrollY === 0)\n\t\t\t\t|| block.getBoundingClientRect().top < 5\n\t\t\t)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\twindowOfElement.scroll({\n\t\t\t\ttop: block.getBoundingClientRect().top + windowOfElement.scrollY,\n\t\t\t\tbehavior: 'smooth',\n\t\t\t});\n\t\t});\n\t}\n\n\treplaceAllImagesToDefaultImage(): void\n\t{\n\t\tthis.blocksData.forEach((blockData) => {\n\t\t\tblockData.images.forEach((image) => {\n\t\t\t\tif (image && image.src !== image.defaultSrc)\n\t\t\t\t{\n\t\t\t\t\tconst block = PageObject.getBlocks().get(blockData.id);\n\t\t\t\t\tif (block)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setImageToNode(block, image, false);\n\t\t\t\t\t}\n\n\t\t\t\t\tObject.assign(image, {\n\t\t\t\t\t\tisSwitchedToDefault: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tsetImageToNode(block, image, useOriginalSrc = true)\n\t{\n\t\tconst selector = `${image.nodeCode}@${image.position}`;\n\t\tblock.forceInit();\n\t\tconst node = block.nodes.getBySelector(selector);\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.setImageToStyle(node, image, useOriginalSrc))\n\t\t{\n\t\t\tnode.setValue(this.getImageValueObject(image, useOriginalSrc), true);\n\t\t}\n\t}\n\n\tsetImageToStyle(node, image, useOriginalSrc = true): boolean\n\t{\n\t\tconst styleObj = node.node.style;\n\t\tconst src = useOriginalSrc ? image.src : image.defaultSrc;\n\t\tconst src2x = useOriginalSrc ? image.src : image.defaultSrc;\n\n\t\tif (\n\t\t\tstyleObj.getPropertyValue('--bg-url')\n\t\t\t&& src\n\t\t)\n\t\t{\n\t\t\tstyleObj.setProperty('--bg-url', `url(\"${src}\")`);\n\t\t\tif (\n\t\t\t\tstyleObj.getPropertyValue('--bg-url-2x')\n\t\t\t\t&& src2x\n\t\t\t)\n\t\t\t{\n\t\t\t\tstyleObj.setProperty('--bg-url-2x', `url(\"${src2x}\")`);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetImageValueObject(imageNode, useOriginalSrc = true): {}\n\t{\n\t\tif (useOriginalSrc)\n\t\t{\n\t\t\treturn {\n\t\t\t\tsrc: imageNode.src ?? '',\n\t\t\t\tsrc2x: imageNode.src2x ?? '',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tsrc: imageNode.defaultSrc ?? '',\n\t\t\tsrc2x: imageNode.defaultSrc ?? '',\n\t\t};\n\t}\n\n\tasync processBlockImages(blockId: number): Promise<boolean>\n\t{\n\t\tif (this.completedBlockIds.has(blockId))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tlet allImagesReplaced = true;\n\t\tconst neededBlockData = this.blocksData.find((blockData) => blockData.id === blockId);\n\t\tconst block = PageObject.getBlocks().get(blockId);\n\n\t\tif (!block || !neededBlockData?.images)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tblock.forceInit();\n\n\t\tfor (const image of neededBlockData.images)\n\t\t{\n\t\t\tif (!image || !image.src || !image.src2x)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst node = block.nodes.getBySelector(`${image.nodeCode}@${image.position}`);\n\t\t\tif (node && image.isSwitchedToDefault === true && !image.isSwitchedBackToOriginal)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\tawait this.replaceDefaultImageWithImage(image, node, block);\n\t\t\t\timage.isSwitchedBackToOriginal = true;\n\t\t\t}\n\n\t\t\tif (image.src === image.defaultSrc)\n\t\t\t{\n\t\t\t\tallImagesReplaced = false;\n\t\t\t}\n\t\t}\n\n\t\treturn allImagesReplaced;\n\t}\n\n\tasync replaceDefaultImagesOnce(blockId: number): Promise<void>\n\t{\n\t\tawait this.processBlockImages(blockId);\n\t}\n\n\t// eslint-disable-next-line consistent-return\n\tasync replaceDefaultImagesRecursive(\n\t\tblockId: number,\n\t\tcurrentAttempt = 0,\n\t\tmaxAttempts = 5,\n\t): Promise<void>\n\t{\n\t\tconst allReplaced = await this.processBlockImages(blockId);\n\t\tconst canTryAgain = currentAttempt < maxAttempts;\n\n\t\tif (!allReplaced && canTryAgain)\n\t\t{\n\t\t\tawait this.delay(ANIMATION_DURATION * 2);\n\n\t\t\treturn this.replaceDefaultImagesRecursive(blockId, currentAttempt + 1, maxAttempts);\n\t\t}\n\t}\n\n\treplaceAllDefaultImagesWithImageWithoutAnimation(block, blockData: BlockData)\n\t{\n\t\tblock.forceInit();\n\t\tif (blockData.images)\n\t\t{\n\t\t\tfor (const image of blockData.images)\n\t\t\t{\n\t\t\t\tif (image)\n\t\t\t\t{\n\t\t\t\t\tconst node = block.nodes.getBySelector(`${image.nodeCode}@${image.position}`);\n\t\t\t\t\tif (node && image.isSwitchedToDefault === true && !image.isSwitchedBackToOriginal)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.replaceDefaultImageWithImageWithoutAnimation(image, node, block);\n\t\t\t\t\t\timage.isSwitchedBackToOriginal = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync replaceDefaultImageWithImage(image: BlockImage, node: Object, block): Promise<void>\n\t{\n\t\tawait load(image.src);\n\t\tawait load(image.src2x);\n\n\t\tDom.addClass(node.node, 'landing-animation-copilot-default-image');\n\t\tDom.addClass(node.node, 'fade-out');\n\t\t// eslint-disable-next-line no-await-in-loop\n\t\tawait this.delay(ANIMATION_DURATION);\n\n\t\tthis.setImageToNode(block, image);\n\n\t\tDom.removeClass(node.node, 'fade-out');\n\t\tDom.addClass(node.node, 'fade-in');\n\t\t// eslint-disable-next-line no-await-in-loop\n\t\tawait this.delay(ANIMATION_DURATION);\n\n\t\tDom.removeClass(node.node, 'fade-in');\n\t\tDom.removeClass(node.node, 'landing-animation-copilot-default-image');\n\t}\n\n\treplaceDefaultImageWithImageWithoutAnimation(image: BlockImage, node: Object, block): void\n\t{\n\t\tthis.setImageToNode(block, image);\n\t}\n\n\tdelay(ms: number): Promise<void>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, ms);\n\t\t});\n\t}\n\n\tasync showConfetti(): Promise<void>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(async () => {\n\t\t\t\tConfetti.fire({\n\t\t\t\t\tparticleCount: 100,\n\t\t\t\t\tspread: 70,\n\t\t\t\t\torigin: {y: 0.7},\n\t\t\t\t\tzIndex: 99999,\n\t\t\t\t});\n\t\t\t\tawait this.delay(ANIMATION_DURATION * 3);\n\t\t\t\tresolve();\n\t\t\t}, 1000);\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tif (!this.editorWindow)\n\t\t{\n\t\t\tconsole.error('editorDocument is not defined');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst editorDocumentBody = this.editorWindow.document.querySelector('.landing-editor');\n\t\tif (!editorDocumentBody)\n\t\t{\n\t\t\tconsole.error('Element with class .landing-editor not found');\n\n\t\t\treturn;\n\t\t}\n\t\tthis.loader = this.getStatusCreate();\n\t\tDom.append(this.loader, editorDocumentBody);\n\t}\n\n\thideLoader()\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tthis.loader.remove();\n\t\t\tthis.loader = null;\n\t\t}\n\t}\n\n\tdisableEditor(): Copilot\n\t{\n\t\tDom.addClass(this.mainDocumentBody, 'landing-animating');\n\t\tconst editorDocumentBody = this.editorWindow.document.querySelector('.landing-editor');\n\t\tif (editorDocumentBody)\n\t\t{\n\t\t\tDom.addClass(editorDocumentBody, 'landing-editor-disable');\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tenableEditor(): Copilot\n\t{\n\t\tDom.removeClass(this.mainDocumentBody, 'landing-animating');\n\t\tconst editorDocumentBody = this.editorWindow.document.querySelector('.landing-editor');\n\t\tif (editorDocumentBody)\n\t\t{\n\t\t\tDom.removeClass(editorDocumentBody, 'landing-editor-disable');\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tanimateSite(): Promise<void>\n\t{\n\t\tthis.start()\n\t\t\t.then(() => {\n\t\t\t\tthis.stop();\n\n\t\t\t\treturn this.showConfetti();\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.emit('onSiteFinish', { blocksData: this.blocksData });\n\t\t\t\tthis.enableEditor();\n\t\t\t})\n\t\t\t.catch(() => {});\n\t}\n\n\tanimateBlock(blocksData)\n\t{\n\t\tthis.setBlocksData(blocksData);\n\t\tconst reloadPromises = [];\n\t\tconst pageBlocks = PageObject.getBlocks();\n\t\tfor (const blockData of this.blocksData)\n\t\t{\n\t\t\tconst block = pageBlocks.get(blockData.id);\n\t\t\tif (block)\n\t\t\t{\n\t\t\t\treloadPromises.push(block.reload());\n\t\t\t}\n\t\t}\n\n\t\tPromise.all(reloadPromises)\n\t\t\t.then(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.init();\n\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\tthis.start()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tthis.stop();\n\n\t\t\t\t\t\t\treturn this.showConfetti();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tthis.emit('onBlockFinish', { blocksData: this.blocksData });\n\t\t\t\t\t\t\tthis.enableEditor();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {});\n\t\t\t\t}, ANIMATION_DURATION * 6);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t}\n\n\tgetStatusCreate(): HTMLElement\n\t{\n\t\tconst nodeAnimate = Tag.render`<div class=\"landing-site-copilot-status-image\"></div>`;\n\t\tconst nodeText = Tag.render`\n\t\t\t<div class=\"landing-site-copilot-content-text\">\n\t\t\t\t${Loc.getMessage('LANDING_BLOCK_COPILOT_CREATED_1')}\n\t\t\t</div>\n\t\t`;\n\n\t\tLottie.loadAnimation({\n\t\t\tcontainer: nodeAnimate,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: true,\n\t\t\tanimationData: loaderAnimation,\n\t\t});\n\n\t\tlet i = 2;\n\t\tconst iMax = 6;\n\t\tthis.interval = setInterval(() => {\n\t\t\tif (i > iMax)\n\t\t\t{\n\t\t\t\ti = 1;\n\t\t\t}\n\n\t\t\tlet message = Loc.getMessage(`LANDING_BLOCK_COPILOT_CREATED_${i}`);\n\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\ti = 1;\n\t\t\t\tmessage = Loc.getMessage(`LANDING_BLOCK_COPILOT_CREATED_${i}`);\n\t\t\t}\n\n\t\t\tnodeText.innerText = message;\n\t\t\ti++;\n\t\t}, 3000);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"landing-site-copilot-status-wrapper\">\n\t\t\t\t${nodeAnimate}\n\t\t\t\t${nodeText}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n"],"names":["AiLoader","constructor","container","getContainer","loaderNode","Tag","render","Lottie","loadAnimation","renderer","loop","autoplay","animationData","loaderAnimation","Loc","getMessage","open","Dom","append","document","body","close","Event","bind","remove","addClass","load","src","Promise","resolve","reject","image","Image","ANIMATION_DURATION_DELAY","ANIMATION_DURATION","Copilot","EventEmitter","generationId","setEventNamespace","editorWindow","PageObject","getEditorWindow","blocksData","aiLoader","mainDocumentBody","window","parent","subscribeToPullEvents","setBlocksData","setGenerationId","getAiLoader","init","disableEditor","completedBlockIds","Set","blocks","getBlocks","map","blockData","block","get","id","blockDataNew","element","content","anchor","Skeleton","initOnBlock","replaceAllImagesToDefaultImage","emit","PULL","subscribe","type","PullClient","SubscriptionType","Server","moduleId","callback","event","params","undefined","command","onImageCreate","JSON","parse","animateBlock","blockId","parseInt","selector","position","value","neededBlockData","find","images","forEach","nodeCode","src2x","id2x","Type","isString","Object","assign","isSwitchedToDefault","has","replaceAllDefaultImagesWithImageWithoutAnimation","start","scrollToBlock","replaceDefaultImagesOnce","removeSkeletonFromBlock","replaceDefaultImagesRecursive","add","delay","stop","windowOfElement","ownerDocument","defaultView","scrollTimeout","handleScrollEnd","clearTimeout","setTimeout","unbind","getBoundingClientRect","top","scrollY","scroll","behavior","defaultSrc","setImageToNode","useOriginalSrc","forceInit","node","nodes","getBySelector","setImageToStyle","setValue","getImageValueObject","styleObj","style","getPropertyValue","setProperty","imageNode","processBlockImages","allImagesReplaced","isSwitchedBackToOriginal","replaceDefaultImageWithImage","currentAttempt","maxAttempts","allReplaced","canTryAgain","replaceDefaultImageWithImageWithoutAnimation","removeClass","ms","showConfetti","Confetti","fire","particleCount","spread","origin","y","zIndex","showLoader","console","error","editorDocumentBody","querySelector","loader","getStatusCreate","hideLoader","enableEditor","animateSite","then","catch","reloadPromises","pageBlocks","push","reload","all","nodeAnimate","nodeText","i","iMax","interval","setInterval","message","innerText"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,CAKO,MAAMA,QAAQ,CACrB;GACCC,WAAW,GACX;KACC,IAAI,CAACC,SAAS,GAAG,IAAI;;GAGtBC,YAAY,GACZ;KACC,IAAI,CAAC,IAAI,CAACD,SAAS,EACnB;OACC,MAAME,UAAU,GAAGC,aAAG,CAACC,MAAM,cAAC,mDAAiD,EAAC;OAEhFC,gBAAM,CAACC,aAAa,CAAC;SACpBN,SAAS,EAAEE,UAAU;SACrBK,QAAQ,EAAE,KAAK;SACfC,IAAI,EAAE,IAAI;SACVC,QAAQ,EAAE,IAAI;SACdC,aAAa,EAAEC;QACf,CAAC;OAEF,IAAI,CAACX,SAAS,GAAGG,aAAG,CAACC,MAAM,gBAAC;;kDAEiB,CAAa;+CAChB,CAA0C;;IAEpF,GAH+CF,UAAU,EACbU,aAAG,CAACC,UAAU,CAAC,uBAAuB,CAAC,CAElF;;KAGF,OAAO,IAAI,CAACb,SAAS;;GAGtBc,IAAI,GACJ;KACCC,aAAG,CAACC,MAAM,CAAC,IAAI,CAACf,YAAY,EAAE,EAAEgB,QAAQ,CAACC,IAAI,CAAC;;GAG/CC,KAAK,GACL;KACCC,eAAK,CAACC,IAAI,CAAC,IAAI,CAACpB,YAAY,EAAE,EAAE,eAAe,EAAE,MAAM;OACtD,IAAI,CAACD,SAAS,GAAG,IAAI;OACrBe,aAAG,CAACO,MAAM,CAAC,IAAI,CAACrB,YAAY,EAAE,CAAC;MAC/B,CAAC;KACFc,aAAG,CAACQ,QAAQ,CAAC,IAAI,CAACtB,YAAY,EAAE,EAAE,SAAS,CAAC;;CAE9C;;CCaO,SAASuB,IAAI,CAACC,GAAG,EACxB;GACC,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;KACvC,MAAMC,KAAK,GAAG,IAAIC,KAAK,EAAE;KACzBT,cAAI,CAACQ,KAAK,EAAE,MAAM,EAAEF,OAAO,CAAC;KAC5BN,cAAI,CAACQ,KAAK,EAAE,OAAO,EAAED,MAAM,CAAC;KAC5BC,KAAK,CAACJ,GAAG,GAAGA,GAAG;IACf,CAAC;CACH;;;;;;ACvEA,CAcA,MAAMM,wBAAwB,GAAG,GAAG;CACpC,MAAMC,kBAAkB,GAAG,GAAG;AAuB9B,CAAO,MAAMC,OAAO,SAASC,6BAAY,CACzC;GASCnC,WAAW,GACX;KACC,KAAK,EAAE;KAAC,KAVToC,YAAY,GAAY,IAAI;KAW3B,IAAI,CAACC,iBAAiB,CAAC,8BAA8B,CAAC;KAEtD,IAAI,CAACC,YAAY,GAAGC,6BAAU,CAACC,eAAe,EAAE;KAChD,IAAI,CAACC,UAAU,GAAG,EAAE;KACpB,IAAI,CAACC,QAAQ,GAAG,IAAI3C,QAAQ,CAAC,EAAE,CAAC;KAChC,IAAI,CAAC4C,gBAAgB,GAAGC,MAAM,CAACC,MAAM,CAAC3B,QAAQ,CAACC,IAAI;KACnD,IAAI,CAAC2B,qBAAqB,EAAE;;GAG7BC,aAAa,CAACN,UAAuB,EACrC;KACC,IAAI,CAACA,UAAU,GAAGA,UAAU;KAE5B,OAAO,IAAI;;GAGZO,eAAe,CAACZ,YAAoB,EACpC;KACC,IAAI,CAACA,YAAY,GAAGA,YAAY;KAEhC,OAAO,IAAI;;GAGZa,WAAW,GACX;KACC,OAAO,IAAI,CAACP,QAAQ;;GAGrBQ,IAAI,GACJ;KACC,IAAI,CAACC,aAAa,EAAE;KAEpB,IAAI,CAAC,IAAI,CAACb,YAAY,EACtB;OACC;;KAGD,IAAI,CAACc,iBAAiB,GAAG,IAAIC,GAAG,EAAE;KAElC,MAAMC,MAAM,GAAGf,6BAAU,CAACgB,SAAS,EAAE;KACrC,IAAI,CAACd,UAAU,GAAG,IAAI,CAACA,UAAU,CAACe,GAAG,CAAEC,SAAS,IAAK;OACpD,MAAMC,KAAK,GAAGJ,MAAM,CAACK,GAAG,CAACF,SAAS,CAACG,EAAE,CAAC;OACtC,MAAMC,YAAY,GAAG;SACpB,GAAGJ,SAAS;SACZK,OAAO,EAAEJ,KAAK,CAACK,OAAO;SACtBC,MAAM,EAAEN,KAAK,CAACM;QACd;OAEDC,oCAAQ,CAACC,WAAW,CAACL,YAAY,CAACG,MAAM,EAAEH,YAAY,CAACC,OAAO,CAAC;OAE/D,OAAOD,YAAY;MACnB,CAAC;KAEF,IAAI,CAACM,8BAA8B,EAAE;KAErC,IAAI,CAACC,IAAI,CAAC,MAAM,EAAE;OAAE3B,UAAU,EAAE,IAAI,CAACA;MAAY,CAAC;KAElD,IAAI,CAACQ,WAAW,EAAE,CAAClC,IAAI,EAAE;;GAG1B+B,qBAAqB,GACrB;KACCuB,gBAAI,CAACC,SAAS,CAAC;OACdC,IAAI,EAAEC,sBAAU,CAACC,gBAAgB,CAACC,MAAM;OACxCC,QAAQ,EAAE,SAAS;OACnBC,QAAQ,EAAGC,KAAK,IAAK;SACpB,IACCA,KAAK,CAACC,MAAM,CAAC1C,YAAY,KAAK2C,SAAS,IACpC,IAAI,CAAC3C,YAAY,KAAK,IAAI,IAC1ByC,KAAK,CAACC,MAAM,CAAC1C,YAAY,KAAK,IAAI,CAACA,YAAY,EAEnD;WACC;;SAGD,MAAM4C,OAAO,GAAGH,KAAK,CAACG,OAAO;SAE7B,IAAIA,OAAO,KAAK,+CAA+C,EAC/D;WACC,IAAI,CAACC,aAAa,CAACJ,KAAK,CAAC;;SAG1B,IAAIG,OAAO,KAAK,8CAA8C,EAC9D;WACC,MAAMvC,UAAU,GAAGyC,IAAI,CAACC,KAAK,CAACN,KAAK,CAACC,MAAM,CAACA,MAAM,CAACrB,SAAS,CAAC;WAC5D,IAAI,CAAC2B,YAAY,CAAC3C,UAAU,CAAC;;;MAG/B,CAAC;;GAGHwC,aAAa,CAACJ,KAAK,EACnB;KACC,MAAMQ,OAAO,GAAGC,QAAQ,CAACT,KAAK,CAACC,MAAM,CAACA,MAAM,CAACO,OAAO,EAAE,EAAE,CAAC;KACzD,MAAME,QAAQ,GAAGV,KAAK,CAACC,MAAM,CAACA,MAAM,CAACS,QAAQ;KAC7C,MAAMC,QAAQ,GAAGX,KAAK,CAACC,MAAM,CAACA,MAAM,CAACU,QAAQ;KAC7C,MAAMC,KAAK,GAAGZ,KAAK,CAACC,MAAM,CAACA,MAAM,CAACW,KAAK;KAEvC,MAAMC,eAAe,GAAG,IAAI,CAACjD,UAAU,CAACkD,IAAI,CAAElC,SAAS,IAAKA,SAAS,CAACG,EAAE,KAAKyB,OAAO,CAAC;KACrF,IAAIK,eAAe,EACnB;OACCA,eAAe,CAACE,MAAM,CAACC,OAAO,CAAE/D,KAAK,IAAK;SACzC,IACCA,KAAK,CAACgE,QAAQ,KAAKP,QAAQ,IACxBzD,KAAK,CAAC0D,QAAQ,KAAKA,QAAQ,EAE/B;WACC,MAAM;aAAE9D,GAAG,GAAG,EAAE;aAAEqE,KAAK,GAAG,EAAE;aAAEnC,EAAE,GAAG,EAAE;aAAEoC,IAAI,GAAG;YAAI,GAAGC,cAAI,CAACC,QAAQ,CAACT,KAAK,CAAC,GACtE;aAAE/D,GAAG,EAAE+D,KAAK;aAAEM,KAAK,EAAEN,KAAK;aAAE7B,EAAE,EAAE,EAAE;aAAEoC,IAAI,EAAE;YAAI,GAC9CP,KAAK;WAERU,MAAM,CAACC,MAAM,CAACtE,KAAK,EAAE;aACpBJ,GAAG;aACHqE,KAAK;aACLnC,EAAE;aACFoC,IAAI;aACJK,mBAAmB,EAAE;YACrB,CAAC;;QAEH,CAAC;;KAGH,IAAI,IAAI,CAACjD,iBAAiB,CAACkD,GAAG,CAACjB,OAAO,CAAC,EACvC;OACC,MAAM3B,KAAK,GAAGnB,6BAAU,CAACgB,SAAS,EAAE,CAACI,GAAG,CAAC0B,OAAO,CAAC;OACjD,IAAI3B,KAAK,EACT;SACC,IAAI,CAAC6C,gDAAgD,CAAC7C,KAAK,EAAEgC,eAAe,CAAC;;;;GAKhF,MAAMc,KAAK,GACX;KACC,KAAK,MAAM/C,SAAS,IAAI,IAAI,CAAChB,UAAU,EACvC;;OAEC,MAAM,IAAI,CAACgE,aAAa,CAAChD,SAAS,CAACK,OAAO,CAAC;;;OAG3C,MAAM,IAAI,CAAC4C,wBAAwB,CAACjD,SAAS,CAACG,EAAE,CAAC;;;OAGjD,MAAMK,oCAAQ,CAAC0C,uBAAuB,CAAClD,SAAS,CAACO,MAAM,CAAC;;;OAGxD,MAAM,IAAI,CAAC4C,6BAA6B,CAACnD,SAAS,CAACG,EAAE,CAAC;OACtD,IAAI,CAACR,iBAAiB,CAACyD,GAAG,CAACpD,SAAS,CAACG,EAAE,CAAC;;;OAGxC,MAAM,IAAI,CAACkD,KAAK,CAAC9E,wBAAwB,CAAC;;;GAI5C,MAAM+E,IAAI,GACV;KAAA;KACC,yBAAI,IAAI,CAACtE,UAAU,CAAC,CAAC,CAAC,aAAlB,kBAAoBqB,OAAO,EAC/B;OACC,MAAM,IAAI,CAAC2C,aAAa,CAAC,IAAI,CAAChE,UAAU,CAAC,CAAC,CAAC,CAACqB,OAAO,CAAC;;KAErD,IAAI,CAACb,WAAW,EAAE,CAAC7B,KAAK,EAAE;;GAG3BqF,aAAa,CAAC/C,KAAkB,EAChC;KACC,OAAO,IAAI/B,OAAO,CAAEC,OAAO,IAAK;OAC/B,MAAMoF,eAAe,GAAGtD,KAAK,CAACuD,aAAa,CAACC,WAAW;OACvD,IAAI,CAACF,eAAe,EACpB;SACCpF,OAAO,EAAE;SAET;;OAGD,IAAIuF,aAAa,GAAG,IAAI;OAExB,MAAMC,eAAe,GAAG,MAAM;SAC7B,IAAID,aAAa,EACjB;WACCE,YAAY,CAACF,aAAa,CAAC;;SAE5BA,aAAa,GAAGG,UAAU,CAAC,MAAM;WAChCjG,eAAK,CAACkG,MAAM,CAACP,eAAe,EAAE,QAAQ,EAAEI,eAAe,CAAC;WACxDxF,OAAO,EAAE;UACT,EAAE,GAAG,CAAC;QACP;OAEDP,eAAK,CAACC,IAAI,CAAC0F,eAAe,EAAE,QAAQ,EAAEI,eAAe,CAAC;OAEtD,IACE1D,KAAK,CAAC8D,qBAAqB,EAAE,CAACC,GAAG,KAAK,CAAC,IAAIT,eAAe,CAACU,OAAO,KAAK,CAAC,IACtEhE,KAAK,CAAC8D,qBAAqB,EAAE,CAACC,GAAG,GAAG,CAAC,EAEzC;SACC7F,OAAO,EAAE;;OAGVoF,eAAe,CAACW,MAAM,CAAC;SACtBF,GAAG,EAAE/D,KAAK,CAAC8D,qBAAqB,EAAE,CAACC,GAAG,GAAGT,eAAe,CAACU,OAAO;SAChEE,QAAQ,EAAE;QACV,CAAC;MACF,CAAC;;GAGHzD,8BAA8B,GAC9B;KACC,IAAI,CAAC1B,UAAU,CAACoD,OAAO,CAAEpC,SAAS,IAAK;OACtCA,SAAS,CAACmC,MAAM,CAACC,OAAO,CAAE/D,KAAK,IAAK;SACnC,IAAIA,KAAK,IAAIA,KAAK,CAACJ,GAAG,KAAKI,KAAK,CAAC+F,UAAU,EAC3C;WACC,MAAMnE,KAAK,GAAGnB,6BAAU,CAACgB,SAAS,EAAE,CAACI,GAAG,CAACF,SAAS,CAACG,EAAE,CAAC;WACtD,IAAIF,KAAK,EACT;aACC,IAAI,CAACoE,cAAc,CAACpE,KAAK,EAAE5B,KAAK,EAAE,KAAK,CAAC;;WAGzCqE,MAAM,CAACC,MAAM,CAACtE,KAAK,EAAE;aACpBuE,mBAAmB,EAAE;YACrB,CAAC;;QAEH,CAAC;MACF,CAAC;;GAGHyB,cAAc,CAACpE,KAAK,EAAE5B,KAAK,EAAEiG,cAAc,GAAG,IAAI,EAClD;KACC,MAAMxC,QAAQ,GAAI,GAAEzD,KAAK,CAACgE,QAAS,IAAGhE,KAAK,CAAC0D,QAAS,EAAC;KACtD9B,KAAK,CAACsE,SAAS,EAAE;KACjB,MAAMC,IAAI,GAAGvE,KAAK,CAACwE,KAAK,CAACC,aAAa,CAAC5C,QAAQ,CAAC;KAChD,IAAI,CAAC0C,IAAI,EACT;OACC;;KAGD,IAAI,CAAC,IAAI,CAACG,eAAe,CAACH,IAAI,EAAEnG,KAAK,EAAEiG,cAAc,CAAC,EACtD;OACCE,IAAI,CAACI,QAAQ,CAAC,IAAI,CAACC,mBAAmB,CAACxG,KAAK,EAAEiG,cAAc,CAAC,EAAE,IAAI,CAAC;;;GAItEK,eAAe,CAACH,IAAI,EAAEnG,KAAK,EAAEiG,cAAc,GAAG,IAAI,EAClD;KACC,MAAMQ,QAAQ,GAAGN,IAAI,CAACA,IAAI,CAACO,KAAK;KAChC,MAAM9G,GAAG,GAAGqG,cAAc,GAAGjG,KAAK,CAACJ,GAAG,GAAGI,KAAK,CAAC+F,UAAU;KACzD,MAAM9B,KAAK,GAAGgC,cAAc,GAAGjG,KAAK,CAACJ,GAAG,GAAGI,KAAK,CAAC+F,UAAU;KAE3D,IACCU,QAAQ,CAACE,gBAAgB,CAAC,UAAU,CAAC,IAClC/G,GAAG,EAEP;OACC6G,QAAQ,CAACG,WAAW,CAAC,UAAU,EAAG,QAAOhH,GAAI,IAAG,CAAC;OACjD,IACC6G,QAAQ,CAACE,gBAAgB,CAAC,aAAa,CAAC,IACrC1C,KAAK,EAET;SACCwC,QAAQ,CAACG,WAAW,CAAC,aAAa,EAAG,QAAO3C,KAAM,IAAG,CAAC;;OAGvD,OAAO,IAAI;;KAGZ,OAAO,KAAK;;GAGbuC,mBAAmB,CAACK,SAAS,EAAEZ,cAAc,GAAG,IAAI,EACpD;KAAA;KACC,IAAIA,cAAc,EAClB;OAAA;OACC,OAAO;SACNrG,GAAG,oBAAEiH,SAAS,CAACjH,GAAG,6BAAI,EAAE;SACxBqE,KAAK,sBAAE4C,SAAS,CAAC5C,KAAK,+BAAI;QAC1B;;KAGF,OAAO;OACNrE,GAAG,2BAAEiH,SAAS,CAACd,UAAU,oCAAI,EAAE;OAC/B9B,KAAK,4BAAE4C,SAAS,CAACd,UAAU,qCAAI;MAC/B;;GAGF,MAAMe,kBAAkB,CAACvD,OAAe,EACxC;KACC,IAAI,IAAI,CAACjC,iBAAiB,CAACkD,GAAG,CAACjB,OAAO,CAAC,EACvC;OACC,OAAO,IAAI;;KAGZ,IAAIwD,iBAAiB,GAAG,IAAI;KAC5B,MAAMnD,eAAe,GAAG,IAAI,CAACjD,UAAU,CAACkD,IAAI,CAAElC,SAAS,IAAKA,SAAS,CAACG,EAAE,KAAKyB,OAAO,CAAC;KACrF,MAAM3B,KAAK,GAAGnB,6BAAU,CAACgB,SAAS,EAAE,CAACI,GAAG,CAAC0B,OAAO,CAAC;KAEjD,IAAI,CAAC3B,KAAK,IAAI,EAACgC,eAAe,YAAfA,eAAe,CAAEE,MAAM,GACtC;OACC,OAAO,IAAI;;KAGZlC,KAAK,CAACsE,SAAS,EAAE;KAEjB,KAAK,MAAMlG,KAAK,IAAI4D,eAAe,CAACE,MAAM,EAC1C;OACC,IAAI,CAAC9D,KAAK,IAAI,CAACA,KAAK,CAACJ,GAAG,IAAI,CAACI,KAAK,CAACiE,KAAK,EACxC;SACC;;OAGD,MAAMkC,IAAI,GAAGvE,KAAK,CAACwE,KAAK,CAACC,aAAa,CAAE,GAAErG,KAAK,CAACgE,QAAS,IAAGhE,KAAK,CAAC0D,QAAS,EAAC,CAAC;OAC7E,IAAIyC,IAAI,IAAInG,KAAK,CAACuE,mBAAmB,KAAK,IAAI,IAAI,CAACvE,KAAK,CAACgH,wBAAwB,EACjF;;SAEC,MAAM,IAAI,CAACC,4BAA4B,CAACjH,KAAK,EAAEmG,IAAI,EAAEvE,KAAK,CAAC;SAC3D5B,KAAK,CAACgH,wBAAwB,GAAG,IAAI;;OAGtC,IAAIhH,KAAK,CAACJ,GAAG,KAAKI,KAAK,CAAC+F,UAAU,EAClC;SACCgB,iBAAiB,GAAG,KAAK;;;KAI3B,OAAOA,iBAAiB;;GAGzB,MAAMnC,wBAAwB,CAACrB,OAAe,EAC9C;KACC,MAAM,IAAI,CAACuD,kBAAkB,CAACvD,OAAO,CAAC;;;;GAIvC,MAAMuB,6BAA6B,CAClCvB,OAAe,EACf2D,cAAc,GAAG,CAAC,EAClBC,WAAW,GAAG,CAAC,EAEhB;KACC,MAAMC,WAAW,GAAG,MAAM,IAAI,CAACN,kBAAkB,CAACvD,OAAO,CAAC;KAC1D,MAAM8D,WAAW,GAAGH,cAAc,GAAGC,WAAW;KAEhD,IAAI,CAACC,WAAW,IAAIC,WAAW,EAC/B;OACC,MAAM,IAAI,CAACrC,KAAK,CAAC7E,kBAAkB,GAAG,CAAC,CAAC;OAExC,OAAO,IAAI,CAAC2E,6BAA6B,CAACvB,OAAO,EAAE2D,cAAc,GAAG,CAAC,EAAEC,WAAW,CAAC;;;GAIrF1C,gDAAgD,CAAC7C,KAAK,EAAED,SAAoB,EAC5E;KACCC,KAAK,CAACsE,SAAS,EAAE;KACjB,IAAIvE,SAAS,CAACmC,MAAM,EACpB;OACC,KAAK,MAAM9D,KAAK,IAAI2B,SAAS,CAACmC,MAAM,EACpC;SACC,IAAI9D,KAAK,EACT;WACC,MAAMmG,IAAI,GAAGvE,KAAK,CAACwE,KAAK,CAACC,aAAa,CAAE,GAAErG,KAAK,CAACgE,QAAS,IAAGhE,KAAK,CAAC0D,QAAS,EAAC,CAAC;WAC7E,IAAIyC,IAAI,IAAInG,KAAK,CAACuE,mBAAmB,KAAK,IAAI,IAAI,CAACvE,KAAK,CAACgH,wBAAwB,EACjF;aACC,IAAI,CAACM,4CAA4C,CAACtH,KAAK,EAAEmG,IAAI,EAAEvE,KAAK,CAAC;aACrE5B,KAAK,CAACgH,wBAAwB,GAAG,IAAI;;;;;;GAO1C,MAAMC,4BAA4B,CAACjH,KAAiB,EAAEmG,IAAY,EAAEvE,KAAK,EACzE;KACC,MAAMjC,IAAI,CAACK,KAAK,CAACJ,GAAG,CAAC;KACrB,MAAMD,IAAI,CAACK,KAAK,CAACiE,KAAK,CAAC;KAEvB/E,aAAG,CAACQ,QAAQ,CAACyG,IAAI,CAACA,IAAI,EAAE,yCAAyC,CAAC;KAClEjH,aAAG,CAACQ,QAAQ,CAACyG,IAAI,CAACA,IAAI,EAAE,UAAU,CAAC;;KAEnC,MAAM,IAAI,CAACnB,KAAK,CAAC7E,kBAAkB,CAAC;KAEpC,IAAI,CAAC6F,cAAc,CAACpE,KAAK,EAAE5B,KAAK,CAAC;KAEjCd,aAAG,CAACqI,WAAW,CAACpB,IAAI,CAACA,IAAI,EAAE,UAAU,CAAC;KACtCjH,aAAG,CAACQ,QAAQ,CAACyG,IAAI,CAACA,IAAI,EAAE,SAAS,CAAC;;KAElC,MAAM,IAAI,CAACnB,KAAK,CAAC7E,kBAAkB,CAAC;KAEpCjB,aAAG,CAACqI,WAAW,CAACpB,IAAI,CAACA,IAAI,EAAE,SAAS,CAAC;KACrCjH,aAAG,CAACqI,WAAW,CAACpB,IAAI,CAACA,IAAI,EAAE,yCAAyC,CAAC;;GAGtEmB,4CAA4C,CAACtH,KAAiB,EAAEmG,IAAY,EAAEvE,KAAK,EACnF;KACC,IAAI,CAACoE,cAAc,CAACpE,KAAK,EAAE5B,KAAK,CAAC;;GAGlCgF,KAAK,CAACwC,EAAU,EAChB;KACC,OAAO,IAAI3H,OAAO,CAAEC,OAAO,IAAK;OAC/B0F,UAAU,CAAC1F,OAAO,EAAE0H,EAAE,CAAC;MACvB,CAAC;;GAGH,MAAMC,YAAY,GAClB;KACC,OAAO,IAAI5H,OAAO,CAAEC,OAAO,IAAK;OAC/B0F,UAAU,CAAC,YAAY;SACtBkC,oBAAQ,CAACC,IAAI,CAAC;WACbC,aAAa,EAAE,GAAG;WAClBC,MAAM,EAAE,EAAE;WACVC,MAAM,EAAE;aAACC,CAAC,EAAE;YAAI;WAChBC,MAAM,EAAE;UACR,CAAC;SACF,MAAM,IAAI,CAAChD,KAAK,CAAC7E,kBAAkB,GAAG,CAAC,CAAC;SACxCL,OAAO,EAAE;QACT,EAAE,IAAI,CAAC;MACR,CAAC;;GAGHmI,UAAU,GACV;KACC,IAAI,CAAC,IAAI,CAACzH,YAAY,EACtB;OACC0H,OAAO,CAACC,KAAK,CAAC,+BAA+B,CAAC;OAE9C;;KAGD,MAAMC,kBAAkB,GAAG,IAAI,CAAC5H,YAAY,CAACpB,QAAQ,CAACiJ,aAAa,CAAC,iBAAiB,CAAC;KACtF,IAAI,CAACD,kBAAkB,EACvB;OACCF,OAAO,CAACC,KAAK,CAAC,8CAA8C,CAAC;OAE7D;;KAED,IAAI,CAACG,MAAM,GAAG,IAAI,CAACC,eAAe,EAAE;KACpCrJ,aAAG,CAACC,MAAM,CAAC,IAAI,CAACmJ,MAAM,EAAEF,kBAAkB,CAAC;;GAG5CI,UAAU,GACV;KACC,IAAI,IAAI,CAACF,MAAM,EACf;OACC,IAAI,CAACA,MAAM,CAAC7I,MAAM,EAAE;OACpB,IAAI,CAAC6I,MAAM,GAAG,IAAI;;;GAIpBjH,aAAa,GACb;KACCnC,aAAG,CAACQ,QAAQ,CAAC,IAAI,CAACmB,gBAAgB,EAAE,mBAAmB,CAAC;KACxD,MAAMuH,kBAAkB,GAAG,IAAI,CAAC5H,YAAY,CAACpB,QAAQ,CAACiJ,aAAa,CAAC,iBAAiB,CAAC;KACtF,IAAID,kBAAkB,EACtB;OACClJ,aAAG,CAACQ,QAAQ,CAAC0I,kBAAkB,EAAE,wBAAwB,CAAC;;KAG3D,OAAO,IAAI;;GAGZK,YAAY,GACZ;KACCvJ,aAAG,CAACqI,WAAW,CAAC,IAAI,CAAC1G,gBAAgB,EAAE,mBAAmB,CAAC;KAC3D,MAAMuH,kBAAkB,GAAG,IAAI,CAAC5H,YAAY,CAACpB,QAAQ,CAACiJ,aAAa,CAAC,iBAAiB,CAAC;KACtF,IAAID,kBAAkB,EACtB;OACClJ,aAAG,CAACqI,WAAW,CAACa,kBAAkB,EAAE,wBAAwB,CAAC;;KAG9D,OAAO,IAAI;;GAGZM,WAAW,GACX;KACC,IAAI,CAAChE,KAAK,EAAE,CACViE,IAAI,CAAC,MAAM;OACX,IAAI,CAAC1D,IAAI,EAAE;OAEX,OAAO,IAAI,CAACwC,YAAY,EAAE;MAC1B,CAAC,CACDkB,IAAI,CAAC,MAAM;OACX,IAAI,CAACrG,IAAI,CAAC,cAAc,EAAE;SAAE3B,UAAU,EAAE,IAAI,CAACA;QAAY,CAAC;OAC1D,IAAI,CAAC8H,YAAY,EAAE;MACnB,CAAC,CACDG,KAAK,CAAC,MAAM,EAAE,CAAC;;GAGlBtF,YAAY,CAAC3C,UAAU,EACvB;KACC,IAAI,CAACM,aAAa,CAACN,UAAU,CAAC;KAC9B,MAAMkI,cAAc,GAAG,EAAE;KACzB,MAAMC,UAAU,GAAGrI,6BAAU,CAACgB,SAAS,EAAE;KACzC,KAAK,MAAME,SAAS,IAAI,IAAI,CAAChB,UAAU,EACvC;OACC,MAAMiB,KAAK,GAAGkH,UAAU,CAACjH,GAAG,CAACF,SAAS,CAACG,EAAE,CAAC;OAC1C,IAAIF,KAAK,EACT;SACCiH,cAAc,CAACE,IAAI,CAACnH,KAAK,CAACoH,MAAM,EAAE,CAAC;;;KAIrCnJ,OAAO,CAACoJ,GAAG,CAACJ,cAAc,CAAC,CACzBF,IAAI,CAAC,MAAM;OACXnD,UAAU,CAAC,MAAM;SAChB,IAAI,CAACpE,IAAI,EAAE;SACX,IAAI,CAACoH,UAAU,EAAE;SACjB,IAAI,CAAC9D,KAAK,EAAE,CACViE,IAAI,CAAC,MAAM;WACX,IAAI,CAAC1D,IAAI,EAAE;WAEX,OAAO,IAAI,CAACwC,YAAY,EAAE;UAC1B,CAAC,CACDkB,IAAI,CAAC,MAAM;WACX,IAAI,CAACrG,IAAI,CAAC,eAAe,EAAE;aAAE3B,UAAU,EAAE,IAAI,CAACA;YAAY,CAAC;WAC3D,IAAI,CAAC8H,YAAY,EAAE;UACnB,CAAC,CACDG,KAAK,CAAC,MAAM,EAAE,CAAC;QACjB,EAAEzI,kBAAkB,GAAG,CAAC,CAAC;MAC1B,CAAC,CACDyI,KAAK,CAAET,KAAK,IAAK;OACjBD,OAAO,CAACC,KAAK,CAACA,KAAK,CAAC;MACpB,CAAC;;GAGJI,eAAe,GACf;KACC,MAAMW,WAAW,GAAG5K,aAAG,CAACC,MAAM,oBAAC,uDAAqD,EAAC;KACrF,MAAM4K,QAAQ,GAAG7K,aAAG,CAACC,MAAM,sBAAC;;MAE1B,CAAoD;;GAEtD,GAFIQ,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC,CAEpD;KAEDR,gBAAM,CAACC,aAAa,CAAC;OACpBN,SAAS,EAAE+K,WAAW;OACtBxK,QAAQ,EAAE,KAAK;OACfC,IAAI,EAAE,IAAI;OACVC,QAAQ,EAAE,IAAI;OACdC,aAAa,EAAEC;MACf,CAAC;KAEF,IAAIsK,CAAC,GAAG,CAAC;KACT,MAAMC,IAAI,GAAG,CAAC;KACd,IAAI,CAACC,QAAQ,GAAGC,WAAW,CAAC,MAAM;OACjC,IAAIH,CAAC,GAAGC,IAAI,EACZ;SACCD,CAAC,GAAG,CAAC;;OAGN,IAAII,OAAO,GAAGzK,aAAG,CAACC,UAAU,CAAE,iCAAgCoK,CAAE,EAAC,CAAC;OAElE,IAAI,CAACI,OAAO,EACZ;SACCJ,CAAC,GAAG,CAAC;SACLI,OAAO,GAAGzK,aAAG,CAACC,UAAU,CAAE,iCAAgCoK,CAAE,EAAC,CAAC;;OAG/DD,QAAQ,CAACM,SAAS,GAAGD,OAAO;OAC5BJ,CAAC,EAAE;MACH,EAAE,IAAI,CAAC;KAER,OAAO9K,aAAG,CAACC,MAAM,kBAAC;;MAEhB,CAAc;MACd,CAAW;;GAEb,GAHI2K,WAAW,EACXC,QAAQ;;CAId;;;;;;;;"}