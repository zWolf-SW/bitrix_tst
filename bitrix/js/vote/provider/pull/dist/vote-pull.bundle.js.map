{"version":3,"file":"vote-pull.bundle.js","sources":["../src/vote-pull.js"],"sourcesContent":["import { type Store } from 'ui.vue3.vuex';\n\ntype VotingParams = {\n\tVOTE_ID: number,\n\tAUTHOR_ID: number, // user who voted\n\tCOUNTER: number | string,\n\tQUESTIONS: Questions,\n};\n\ntype Questions = {\n\t[string: questionId]: {\n\t\tANSWERS: {\n\t\t\t[string: answerId]: AnswerData\n\t\t}\n\t},\n};\n\ntype UserVotingParams = {\n\tVOTE_ID: number,\n\tAUTHOR_ID: number,\n\tCOUNTER: number | string,\n\tQUESTIONS: Questions,\n\tuserAnswerMap: userVotes,\n};\n\ntype userVotes = {\n\t[string: questionId]: {\n\t\t[string: answerId]: {\n\t\t\tANSWER_ID: string,\n\t\t\tEVENT_ID: string,\n\t\t\tEVENT_QUESTION_ID: string,\n\t\t\tID: string,\n\t\t\tMESSAGE: string\n\t\t}\n\t},\n};\n\ntype AnswerData = {\n\tPERCENT: number,\n\tUSERS: [], // always empty\n\tCOUNTER: number | string,\n};\n\nexport class VotePullHandler\n{\n\t#store: Store;\n\n\tconstructor(store: Store)\n\t{\n\t\tthis.#store = store;\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'vote';\n\t}\n\n\thandleVoting(params: VotingParams): void\n\t{\n\t\tthis.#updateQuestionTotalCounter(params);\n\t\tthis.#updateAnswer(params);\n\t}\n\n\t#updateQuestionTotalCounter(params: VotingParams): void\n\t{\n\t\tconst { QUESTIONS: questions, COUNTER: totalCounter } = params;\n\n\t\tObject.keys(questions).forEach((questionId) => {\n\t\t\tthis.#store.store.dispatch('vote/updateQuestionTotalCounter', { questionId, totalCounter });\n\t\t});\n\t}\n\n\t#updateAnswer(params: VotingParams): void\n\t{\n\t\tconst { QUESTIONS: questions } = params;\n\n\t\tObject.values(questions).forEach((questionData) => {\n\t\t\tObject.entries(questionData.ANSWERS).forEach(([answerId, answerData]) => {\n\t\t\t\tthis.#store.store.dispatch('vote/updateAnswer', {\n\t\t\t\t\tanswerId,\n\t\t\t\t\tcounter: answerData.COUNTER,\n\t\t\t\t\tpercent: answerData.PERCENT,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\thandleUser_vote(params: UserVotingParams): void\n\t{\n\t\tthis.updateCurrentUserVotes(params);\n\t}\n\n\tupdateCurrentUserVotes(params: UserVotingParams): void\n\t{\n\t\tconst { VOTE_ID: voteId, QUESTIONS: questions, userAnswerMap: currentUserVotes } = params;\n\n\t\tif (Object.keys(currentUserVotes).length === 0)\n\t\t{\n\t\t\tthis.#store.store.dispatch('vote/resetUserVoted', {\n\t\t\t\tvoteId,\n\t\t\t});\n\n\t\t\tObject.keys(questions).forEach((questionId) => {\n\t\t\t\tthis.#store.store.dispatch('vote/clearVotes', {\n\t\t\t\t\tquestionId,\n\t\t\t\t\tvoteId,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tObject.entries(currentUserVotes).forEach(([questionId, answers]) => {\n\t\t\tconst answerIds = Object.keys(answers).map(Number);\n\n\t\t\tthis.#store.store.dispatch('vote/updateCurrentUserVotes', {\n\t\t\t\tquestionId,\n\t\t\t\tanswerIds,\n\t\t\t});\n\t\t});\n\n\t\tthis.#store.store.dispatch('vote/setUserVoted', {\n\t\t\tvoteId,\n\t\t});\n\t}\n\n\thandleStop(params: { voteId: number }): void\n\t{\n\t\tthis.#store.store.dispatch('vote/setVoteCompleted', {\n\t\t\tvoteId: params.voteId,\n\t\t});\n\t}\n}\n"],"names":["VotePullHandler","constructor","store","getModuleId","handleVoting","params","handleUser_vote","updateCurrentUserVotes","VOTE_ID","voteId","QUESTIONS","questions","userAnswerMap","currentUserVotes","Object","keys","length","dispatch","forEach","questionId","entries","answers","answerIds","map","Number","handleStop","COUNTER","totalCounter","values","questionData","ANSWERS","answerId","answerData","counter","percent","PERCENT"],"mappings":";;;;;;;;;AA2CA,CAAO,MAAMA,eAAe,CAC5B;GAGCC,WAAW,CAACC,KAAY,EACxB;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,oBAAUA,KAAK;;GAGpBC,WAAW,GACX;KACC,OAAO,MAAM;;GAGdC,YAAY,CAACC,MAAoB,EACjC;KACC,4CAAI,4DAA6BA,MAAM;KACvC,4CAAI,gCAAeA,MAAM;;GA2B1BC,eAAe,CAACD,MAAwB,EACxC;KACC,IAAI,CAACE,sBAAsB,CAACF,MAAM,CAAC;;GAGpCE,sBAAsB,CAACF,MAAwB,EAC/C;KACC,MAAM;OAAEG,OAAO,EAAEC,MAAM;OAAEC,SAAS,EAAEC,SAAS;OAAEC,aAAa,EAAEC;MAAkB,GAAGR,MAAM;KAEzF,IAAIS,MAAM,CAACC,IAAI,CAACF,gBAAgB,CAAC,CAACG,MAAM,KAAK,CAAC,EAC9C;OACC,4CAAI,kBAAQd,KAAK,CAACe,QAAQ,CAAC,qBAAqB,EAAE;SACjDR;QACA,CAAC;OAEFK,MAAM,CAACC,IAAI,CAACJ,SAAS,CAAC,CAACO,OAAO,CAAEC,UAAU,IAAK;SAC9C,4CAAI,kBAAQjB,KAAK,CAACe,QAAQ,CAAC,iBAAiB,EAAE;WAC7CE,UAAU;WACVV;UACA,CAAC;QACF,CAAC;OAEF;;KAGDK,MAAM,CAACM,OAAO,CAACP,gBAAgB,CAAC,CAACK,OAAO,CAAC,CAAC,CAACC,UAAU,EAAEE,OAAO,CAAC,KAAK;OACnE,MAAMC,SAAS,GAAGR,MAAM,CAACC,IAAI,CAACM,OAAO,CAAC,CAACE,GAAG,CAACC,MAAM,CAAC;OAElD,4CAAI,kBAAQtB,KAAK,CAACe,QAAQ,CAAC,6BAA6B,EAAE;SACzDE,UAAU;SACVG;QACA,CAAC;MACF,CAAC;KAEF,4CAAI,kBAAQpB,KAAK,CAACe,QAAQ,CAAC,mBAAmB,EAAE;OAC/CR;MACA,CAAC;;GAGHgB,UAAU,CAACpB,MAA0B,EACrC;KACC,4CAAI,kBAAQH,KAAK,CAACe,QAAQ,CAAC,uBAAuB,EAAE;OACnDR,MAAM,EAAEJ,MAAM,CAACI;MACf,CAAC;;CAEJ;CAAC,sCArE4BJ,MAAoB,EAChD;GACC,MAAM;KAAEK,SAAS,EAAEC,SAAS;KAAEe,OAAO,EAAEC;IAAc,GAAGtB,MAAM;GAE9DS,MAAM,CAACC,IAAI,CAACJ,SAAS,CAAC,CAACO,OAAO,CAAEC,UAAU,IAAK;KAC9C,4CAAI,kBAAQjB,KAAK,CAACe,QAAQ,CAAC,iCAAiC,EAAE;OAAEE,UAAU;OAAEQ;MAAc,CAAC;IAC3F,CAAC;CACH;CAAC,wBAEatB,MAAoB,EAClC;GACC,MAAM;KAAEK,SAAS,EAAEC;IAAW,GAAGN,MAAM;GAEvCS,MAAM,CAACc,MAAM,CAACjB,SAAS,CAAC,CAACO,OAAO,CAAEW,YAAY,IAAK;KAClDf,MAAM,CAACM,OAAO,CAACS,YAAY,CAACC,OAAO,CAAC,CAACZ,OAAO,CAAC,CAAC,CAACa,QAAQ,EAAEC,UAAU,CAAC,KAAK;OACxE,4CAAI,kBAAQ9B,KAAK,CAACe,QAAQ,CAAC,mBAAmB,EAAE;SAC/Cc,QAAQ;SACRE,OAAO,EAAED,UAAU,CAACN,OAAO;SAC3BQ,OAAO,EAAEF,UAAU,CAACG;QACpB,CAAC;MACF,CAAC;IACF,CAAC;CACH;;;;;;;;"}