this.BX=this.BX||{};(function(e,s,t,a,l,i,r,o){"use strict";const n=50;var c=babelHelpers.classPrivateFieldLooseKey("visibleVotes");var b=babelHelpers.classPrivateFieldLooseKey("shouldLoadVotes");var h=babelHelpers.classPrivateFieldLooseKey("startIndexToLoadVotes");var p=babelHelpers.classPrivateFieldLooseKey("subscribeOnEvents");var d=babelHelpers.classPrivateFieldLooseKey("onMessageIsVisible");var u=babelHelpers.classPrivateFieldLooseKey("prepareToLoadVotes");class v extends t.EventEmitter{static init(){return v.getInstance()}static getInstance(){if(!v.instance){v.instance=new v}return v.instance}constructor(){super();Object.defineProperty(this,u,{value:L});Object.defineProperty(this,d,{value:B});Object.defineProperty(this,p,{value:P});Object.defineProperty(this,c,{writable:true,value:[]});Object.defineProperty(this,b,{writable:true,value:true});Object.defineProperty(this,h,{writable:true,value:0});this.setEventNamespace("BX.VOTE.APPLICATION");this.createStore();this.initPull();babelHelpers.classPrivateFieldLooseBase(this,p)[p]()}handleLoadError(e){babelHelpers.classPrivateFieldLooseBase(this,c)[c]=babelHelpers.classPrivateFieldLooseBase(this,c)[c].filter((s=>!e.includes(s)));babelHelpers.classPrivateFieldLooseBase(this,h)[h]=0}createStore(){this.store=a.createStore({modules:{vote:{namespaced:true,...r.VoteModel}}})}getStore(){return this.store}initPull(){this.pullClient=BX.PULL;if(!this.pullClient){return}this.pullClient.subscribe(new o.VotePullHandler({store:this.store}))}static canCreateVoteInChat(e){const s=[l.ChatType.chat,l.ChatType.open,l.ChatType.general,l.ChatType.call,l.ChatType.crm,l.ChatType.sonetGroup,l.ChatType.calendar,l.ChatType.tasks,l.ChatType.mail,l.ChatType.generalChannel,l.ChatType.channel,l.ChatType.openChannel,l.ChatType.collab];return s.includes(e)}}function P(){t.EventEmitter.subscribe("vote-message-batch",babelHelpers.classPrivateFieldLooseBase(this,d)[d].bind(this))}function B(e){const{messageId:t}=e.getData();if(babelHelpers.classPrivateFieldLooseBase(this,c)[c].includes(t)){return}babelHelpers.classPrivateFieldLooseBase(this,c)[c].push(t);if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){return}s.Runtime.debounce((()=>babelHelpers.classPrivateFieldLooseBase(this,u)[u]()))();babelHelpers.classPrivateFieldLooseBase(this,b)[b]=false}function L(){const e=babelHelpers.classPrivateFieldLooseBase(this,c)[c].slice(babelHelpers.classPrivateFieldLooseBase(this,h)[h],babelHelpers.classPrivateFieldLooseBase(this,c)[c].length);const s=Math.ceil(e.length/n);babelHelpers.classPrivateFieldLooseBase(this,h)[h]=babelHelpers.classPrivateFieldLooseBase(this,c)[c].length;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=true;for(let t=0;t<s;t++){const s=t*n;const a=e.slice(s,Math.min(s+n,e.length));const l=a.map((e=>{const{componentParams:s}=i.Core.getStore().getters["messages/getById"](e);return s.id}));this.emit("loadVotes",{entityIds:a,voteIds:l})}}e.VoteApplication=v})(this.BX.Vote=this.BX.Vote||{},BX,BX.Event,BX.Vue3.Vuex,BX.Messenger.v2.Const,BX.Messenger.v2.Application,BX.Vote.Store,BX.Vote.Service);
//# sourceMappingURL=vote.bundle.map.js