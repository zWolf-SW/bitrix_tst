this.BX=this.BX||{};(function(t,e,s,a,i,n,r){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("signedAttachId");var d=babelHelpers.classPrivateFieldLooseKey("limit");class l{constructor(t,e=10){Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,o)[o]=t;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e}async loadAnswer(t,e=1){var s,a;const i={signedAttachId:babelHelpers.classPrivateFieldLooseBase(this,o)[o],answerId:t};const n={size:babelHelpers.classPrivateFieldLooseBase(this,d)[d],page:e};const r=await BX.ajax.runAction("vote.AttachedVote.getAnswerVoted",{data:i,navigation:n});return(s=r==null?void 0:(a=r.data)==null?void 0:a.items)!=null?s:[]}}const v={name:"VoteAnswerVoted",components:{Popup:s.Popup,BIcon:a.BIcon},props:{count:{type:String,required:true},firstPageVoted:{type:Array,required:true},signedAttachId:{type:String,required:true},answerId:{type:String,required:true},maxVisibleAvatarsCount:{type:Number,required:false,default:3},pageSize:{type:Number,required:true}},data(){return{voted:this.firstPageVoted,page:1,loading:false,expanded:false}},computed:{countNumber(){return parseInt(this.count,10)},votedCountTitle(){return e.Loc.getMessagePlural("VOTE_JS_ATTACHED_RESULT_ANSWER_VOTED_COUNT",this.countNumber,{"#COUNT#":this.countNumber})},firstPageVotedWithAvatars(){return this.firstPageVoted.filter((t=>Boolean(t.IMAGE))).slice(0,this.maxVisibleAvatarsCount)},popupOptions(){return{bindElement:this.$refs.votedLink,borderRadius:"18px",autoHide:true}}},methods:{async popupScrollHandler(t){if(this.loading){return}if(this.countNumber<=this.voted.length){return}if(t.target.scrollHeight-t.target.scrollTop>t.target.clientHeight){return}this.loading=true;const e=this.page+1;const s=new l(this.signedAttachId,this.pageSize);try{const t=await s.loadAnswer(this.answerId,e);this.page=e;this.voted=[...this.voted,...t]}catch(t){console.error(t)}finally{this.loading=false}}},template:`\n\t\t<div class="vote-answer-voted">\n\t\t\t<div v-if="firstPageVotedWithAvatars.length > 0" class="vote-answer-avatars">\n\t\t\t\t<img class="vote-answer-avatar" v-for="(user, index) in firstPageVotedWithAvatars" :key="index" :src="user.IMAGE" :alt="user.NAME" />\n\t\t\t</div>\n\t\t\t<div class="vote-answer-voted-link" @click="expanded = true" ref="votedLink">\n\t\t\t\t<div class="vote-answer-voted-title">{{ votedCountTitle }}</div>\n\t\t\t\t<div class="vote-answer-voted-down"></div>\n\t\t\t</div>\n\t\t\t<Popup v-if="expanded" :options="popupOptions" @close="expanded = false">\n\t\t\t\t<div class="vote-answer-popup-container" @scroll="this.popupScrollHandler($event)">\n\t\t\t\t\t<div v-for="(user, index) in voted" :key="index" class="vote-answer-voted-user">\n\t\t\t\t\t\t<img v-if="user.IMAGE" class="vote-answer-popup-avatar" :src="user.IMAGE" />\n\t\t\t\t\t\t<BIcon v-if="!user.IMAGE"\n\t\t\t\t\t\t\t   class="vote-answer-popup-avatar"\n\t\t\t\t\t\t\t   :name="'person'"\n\t\t\t\t\t\t\t   :size="26"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="vote-answer-voted-user-name">{{ user.NAME }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<BIcon v-if="loading" :name="'loader-wait'" :size="20" />\n\t\t\t\t</div>\n\t\t\t</Popup>\n\t\t</div>\n\t`};const u={name:"VoteResultDisplay",components:{VoteAnswerVoted:v},props:{loadedData:{type:Object,required:true},votedPageSize:{type:Number,required:true}},computed:{anonymityLabel(){var t,e;return((t=this.loadedData)==null?void 0:(e=t.attach)==null?void 0:e.ANONYMITY)>1?this.$Bitrix.Loc.getMessage("VOTE_JS_ATTACHED_RESULT_ANONYMOUS"):this.$Bitrix.Loc.getMessage("VOTE_JS_ATTACHED_RESULT_PUBLIC")}},methods:{getVoted(t){var e,s;return(e=(s=this.loadedData.voted)==null?void 0:s[t])!=null?e:[]},isAnswerSelected(t,e){var s,a,i;return(s=(a=this.loadedData.attach.userAnswerMap)==null?void 0:(i=a[t])==null?void 0:i[e])!=null?s:false},getQuestionVoted(t){return e.Loc.getMessagePlural("VOTE_JS_ATTACHED_RESULT_QUESTION_VOTED_COUNT",parseInt(t,10),{"#COUNT#":t})}},template:`\n\t\t<div class="vote-result-wrapper">\n\t\t\t<div v-if="loadedData">\n\t\t\t\t<div class="ui-text-4">{{ anonymityLabel }}</div>\n\t\t\t\t<div v-for="(question, questionId) in loadedData?.attach?.QUESTIONS" :key="questionId">\n\t\t\t\t\t<div class="ui-title-3">{{ question.QUESTION }}</div>\n\t\t\t\t\t<div class="ui-text-4">{{ this.getQuestionVoted(question.COUNTER) }}</div>\n\t\t\t\t\t<div class="vote-result-answer" v-for="(answer, answerId) in question.ANSWERS" :key="answerId">\n\t\t\t\t\t\t<div class="vote-result-answer-inner" :class="{ 'vote-answer-user': this.isAnswerSelected(questionId, answerId) }">\n\t\t\t\t\t\t\t<div class="vote-answer-message">{{ answer.MESSAGE }}</div>\n\t\t\t\t\t\t\t<div class="vote-answer-percent">\n\t\t\t\t\t\t\t\t<span class="vote-answer-percent-digit">{{ Math.round(answer.PERCENT) }}</span>\n\t\t\t\t\t\t\t\t<span class="vote-answer-percent-symbol">%</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="vote-result-answer-inner-percent"\n\t\t\t\t\t\t\t\t:style="{ width: answer.PERCENT + '%' }"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="this.getVoted(answerId).length > 0">\n\t\t\t\t\t\t\t<VoteAnswerVoted\n\t\t\t\t\t\t\t\t:count="answer.COUNTER"\n\t\t\t\t\t\t\t\t:firstPageVoted="getVoted(answerId)"\n\t\t\t\t\t\t\t\t:signedAttachId="loadedData.attach.signedAttachId"\n\t\t\t\t\t\t\t\t:answerId="answerId"\n\t\t\t\t\t\t\t\t:pageSize="votedPageSize"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="!loadedData">\n\t\t\t\t{{ this.$Bitrix.Loc.getMessage('VOTE_JS_ATTACHED_RESULT_LOAD_ERROR') }}\n\t\t\t</div>\n\t\t</div>\n\t`};var c=babelHelpers.classPrivateFieldLooseKey("application");var p=babelHelpers.classPrivateFieldLooseKey("votedPageSize");class h{constructor(t){Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,p)[p]=t.votedPageSize||10}createApplicationWithResult(t){return r.BitrixVue.createApp({name:"VoteAttachedResultRoot",components:{VoteResultDisplay:u},props:{loaded:{type:Object,required:true},votedPageSize:{type:Number,required:true}},template:'<VoteResultDisplay :loadedData="loaded" :votedPageSize="votedPageSize"/>'},{loaded:t,votedPageSize:babelHelpers.classPrivateFieldLooseBase(this,p)[p]})}renderTo(t,e){babelHelpers.classPrivateFieldLooseBase(this,c)[c]=this.createApplicationWithResult(t);babelHelpers.classPrivateFieldLooseBase(this,c)[c].mount(e)}}t.VoteAttachedResult=h})(this.BX.Vote=this.BX.Vote||{},BX,BX.UI.Vue3.Components,BX.UI.IconSet,BX,BX,BX.Vue3);
//# sourceMappingURL=attached-result.bundle.map.js