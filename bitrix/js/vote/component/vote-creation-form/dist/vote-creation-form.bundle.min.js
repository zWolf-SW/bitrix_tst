this.BX=this.BX||{};this.BX.Vote=this.BX.Vote||{};(function(t,e,n,r,o,i,s,a){"use strict";var c=2;var u={mounted:function t(e){o.Event.bind(e,"input",(function(){o.Dom.style(e,"height",0);o.Dom.style(e,"height","".concat(e.scrollHeight+c,"px"))}))}};var l={name:"voteAnswer",directives:{resize:u},props:{id:{type:String,required:true},removable:{type:Boolean,required:true}},emits:["removeAnswer","changeAnswer","onKeyDownEnter"],data:function t(){return{answerText:""}},methods:{changeAnswer:function t(){this.$emit("changeAnswer",this.answerText)},focus:function t(){this.$refs.answerField.focus()},handleDeleteClick:function t(){if(this.removable){this.$emit("removeAnswer")}else{this.answerText="";this.$emit("changeAnswer",this.answerText)}},handleEnterPress:function t(){this.$emit("onKeyDownEnter")}},template:'\n\t\t<div class="vote-creation-form__answer" :data-id="id">\n\t\t\t<div class="vote-creation-form__answer_dnd-icon ui-icon-set --more-points"></div>\n\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-no-resize">\n\t\t\t\t<textarea\n\t\t\t\t\tmaxlength="100"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t:data-test-id="\'vote_creation_form_\' + id"\n\t\t\t\t\tv-resize\n\t\t\t\t\tv-model.trim="answerText"\n\t\t\t\t\t@input="changeAnswer"\n\t\t\t\t\t@keydown.enter.prevent="handleEnterPress"\n\t\t\t\t\tref="answerField"\n\t\t\t\t></textarea>\n\t\t\t\t<span\n\t\t\t\t\t:data-test-id="\'vote_creation_form_delete_\' + id"\n\t\t\t\t\tclass="vote-creation-form__answer_delete"\n\t\t\t\t\t@click="handleDeleteClick"\n\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t'};var f={methods:{loc:function t(e){return this.$Bitrix.Loc.getMessage(e)}}};var d;var h=function t(e,n){o.Dom.style(e,"transform","translate3d(0, ".concat(n,"px, 0)"))};var v=function t(e,n,r,o){var i=e.offsetTop+o;if(i<0){h(r,0)}else if(i+r.offsetHeight>n.offsetHeight){h(r,n.offsetHeight-r.offsetHeight)}else{h(r,i)}};var p=function t(e){var n=e.cloneNode(true);o.Dom.addClass(n,"vote-creation-form__answer_ghost");h(n,e.offsetTop);o.Dom.prepend(n,e.parentElement);return n};var m=function t(e){var n=o.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div class="vote-creation-form__answer_position-pointer" hidden></div>'])));o.Dom.prepend(n,e);return n};var y=function t(e,n){var r=e.target,i=e.currentTarget;if(!o.Dom.hasClass(r,"vote-creation-form__answer_dnd-icon")){return}var s=0;var a=null;var c=window.scrollY;var u=8;var l=1;var f=r.closest(".vote-creation-form__answer");var d=p(f);var y=m(i);var w=function t(e){var n=e.movementY;o.Dom.style(document.body,"userSelect","none");o.Dom.style(document.body,"cursor","grabbing");o.Dom.addClass(i,"--pointer-events-disabled");s+=n;v(f,i,d,s);o.Dom.removeClass(i,"--pointer-events-disabled");var r=d.getBoundingClientRect(),c=r.x,p=r.y;var m=s>0?p+d.offsetHeight-l:p;var w=document.elementFromPoint(c,m);a=w===null||w===void 0?void 0:w.closest(".vote-creation-form__answer");o.Dom.addClass(i,"--pointer-events-disabled");if(!a||a===f){y.hidden=true;return}var g=a,b=g.offsetTop,_=g.offsetHeight;var E=s>0?b+_+u:b-u;y.hidden=false;h(y,E)};var g=function t(){o.Dom.style(document.body,"userSelect","");o.Dom.style(document.body,"cursor","");o.Dom.removeClass(i,"--pointer-events-disabled");o.Event.unbind(document,"mousemove",w);o.Event.unbind(document,"mouseup",t);o.Event.unbind(document,"scroll",b);o.Dom.remove(d);o.Dom.remove(y);if(a&&a!==f){n(f.dataset.id,a.dataset.id,s>0)}};var b=function t(){var e=window.scrollY-c;c=window.scrollY;s+=e;v(f,i,d,s)};o.Event.bind(document,"mousemove",w);o.Event.bind(document,"mouseup",g);o.Event.bind(document,"scroll",b)};var w={mounted:function t(e,n){o.Event.bind(e,"mousedown",(function(t){y(t,n.value)}))}};function g(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */g=function e(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function t(e,n,r){return e[n]=r}}function u(t,e,n,o){var i=e&&e.prototype instanceof d?e:d,s=Object.create(i.prototype),a=new T(o||[]);return r(s,"_invoke",{value:E(t,n,a)}),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function h(){}function v(){}var p={};c(p,i,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(j([])));y&&y!==e&&n.call(y,i)&&(p=y);var w=v.prototype=d.prototype=Object.create(p);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(r,i,s,a){var c=l(t[r],t,i);if("throw"!==c.type){var u=c.arg,f=u.value;return f&&"object"==babelHelpers["typeof"](f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,s,a)}),(function(t){o("throw",t,s,a)})):e.resolve(f).then((function(t){u.value=t,s(u)}),(function(t){return o("throw",t,s,a)}))}a(c.arg)}var i;r(this,"_invoke",{value:function t(n,r){function s(){return new e((function(t,e){o(n,r,t,e)}))}return i=i?i.then(s,s):s()}})}function E(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return S()}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var a=O(s,n);if(a){if(a===f)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function O(t,e){var n=e.method,r=t.iterator[n];if(undefined===r)return e.delegate=null,"throw"===n&&t.iterator["return"]&&(e.method="return",e.arg=undefined,O(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=l(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=undefined),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function j(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=undefined,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:undefined,done:!0}}return h.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:h,configurable:!0}),h.displayName=c(v,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,a,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},b(_.prototype),c(_.prototype,s,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var s=new _(u(e,n,r,o),i);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},b(w),c(w,a,"Generator"),c(w,i,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=j,T.prototype={constructor:T,reset:function t(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=undefined)},stop:function t(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function t(e){if(this.done)throw e;var r=this;function o(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=undefined),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function t(e,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=r&&r<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=r,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(a)},complete:function t(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),f},finish:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var i=o.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function t(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=undefined),f}},t}function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E={name:"voteQuestion",directives:{dnd:w,resize:u},components:{Answer:l},mixins:[f],props:{id:{type:String,required:true},question:{type:Object,required:true},minAnswersCount:{type:Number,required:true},maxAnswersCount:{type:Number,required:true}},emits:["addAnswer","removeAnswer","changeQuestion","validate"],data:function t(){return{questionText:""}},computed:{answersCount:function t(){return Object.keys(this.question.answers).length},isValid:function t(){var e=Object.values(this.question.answers);var n=e.filter((function(t){return t!==""}));return this.question.questionText!==""&&n.length>=this.minAnswersCount},canAddMoreAnswers:function t(){return this.answersCount<this.maxAnswersCount},removable:function t(){return this.answersCount>this.minAnswersCount}},watch:{isValid:function t(){this.$emit("validate",this.isValid)}},mounted:function t(){var e=this;var n=new i.Switcher({node:this.$refs.multipleAnswersSwitcher,size:i.SwitcherSize.small,checked:false,handlers:{toggled:function t(){e.$emit("changeQuestion",_(_({},e.question),{},{allowMultipleAnswers:n.checked}))}}});o.Dom.attr(n.node,"data-test-id","vote_creation_form_allow_multiple_answers_".concat(this.id))},methods:{changeText:function t(){var e=_(_({},this.question),{},{questionText:this.questionText});this.$emit("changeQuestion",e)},addAnswer:function t(){this.$emit("addAnswer")},removeAnswer:function t(e){this.$emit("removeAnswer",e)},changeAnswer:function t(e,n){var r=this.question.answers;var o=_(_({},this.question),{},{answers:_(_({},r),{},babelHelpers.defineProperty({},e,n))});this.$emit("changeQuestion",o)},orderAnswer:function t(e,n,r){var o=this.question.answers;var i=Object.keys(o).filter((function(t){return t!==e}));var s=i.indexOf(n);var a=r?s+1:s;i.splice(a,0,e);var c=i.reduce((function(t,e){t[e]=o[e];return t}),{});this.$emit("changeQuestion",_(_({},this.question),{},{answers:c}))},focusQuestionField:function t(){var e=this.$refs.questionField;e.focus()},getAnswerRefById:function t(e){var n;return(n=this.$refs["answer_".concat(e)])===null||n===void 0?void 0:n[0]},getAnswerIdByIndex:function t(e){var n;var r=Object.keys(this.question.answers);return(n=r[e])!==null&&n!==void 0?n:null},focusNewAnswer:function t(e){var n=this;return babelHelpers.asyncToGenerator(g().mark((function t(){var r;return g().wrap((function t(o){while(1)switch(o.prev=o.next){case 0:r=n.getAnswerRefById(e);if(!r){o.next=5;break}o.next=4;return n.$nextTick();case 4:r.focus();case 5:case"end":return o.stop()}}),t)})))()},focusNextAnswer:function t(e){var n=Object.keys(this.question.answers);var r=n.indexOf(e);if(r===-1){return}this.focusByIndex(r+1)},handleQuestionEnter:function t(){this.focusByIndex(0)},focusByIndex:function t(e){var n=this.getAnswerIdByIndex(e);var r=this.getAnswerRefById(n);if(r){r.focus()}else if(this.canAddMoreAnswers){this.addAnswer()}}},template:'\n\t\t<div class="vote-creation-form__question" :data-id="id">\n\t\t\t<p class="vote-creation-form__question_label">\n\t\t\t\t{{loc(\'VOTE_QUESTION_LABEL\')}}\n\t\t\t</p>\n\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-no-resize">\n\t\t\t\t<textarea\n\t\t\t\t\tmaxlength="250"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t:data-test-id="\'vote_creation_form_\' + id"\n\t\t\t\t\tv-model.trim="questionText"\n\t\t\t\t\tv-resize\n\t\t\t\t\t@input="changeText"\n\t\t\t\t\t@keydown.enter.prevent="handleQuestionEnter"\n\t\t\t\t\tref="questionField"\n\t\t\t\t></textarea>\n\t\t\t</div>\n\t\t\t<p class="vote-creation-form__question_answer-options">\n\t\t\t\t{{loc(\'VOTE_QUESTION_ANSWER_OPTIONS\')}}\n\t\t\t</p>\n\t\t\t<div\n\t\t\t\tclass="vote-creation-form__answers"\n\t\t\t\t:class="{\'--removable\': removable}"\n\t\t\t\tv-dnd="orderAnswer"\n\t\t\t>\n\t\t\t\t<Answer\n\t\t\t\t\tv-for="(answer, id) in question.answers"\n\t\t\t\t\t:key="id"\n\t\t\t\t\t:id="id"\n\t\t\t\t\t:ref="\'answer_\' + id"\n\t\t\t\t\t:answer="answer"\n\t\t\t\t\t:removable="removable"\n\t\t\t\t\t@removeAnswer="removeAnswer(id)"\n\t\t\t\t\t@changeAnswer="changeAnswer(id, $event)"\n\t\t\t\t\t@onKeyDownEnter="focusNextAnswer(id)"\n\t\t\t\t></Answer>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="canAddMoreAnswers"\n\t\t\t\t:data-test-id="\'vote_creation_form_add_answer_\' + id"\n\t\t\t\tclass="vote-creation-form__question_add-answer"\n\t\t\t\t@click="addAnswer"\n\t\t\t>\n\t\t\t\t<div class="vote-creation-form__question_plus"></div>\n\t\t\t\t<span>{{loc(\'VOTE_QUESTION_ADD_ANSWER\')}}</span>\n\t\t\t</div>\n\t\t\t<div class="vote-creation-form__question_multiple-answers">\n\t\t\t\t<span>{{loc(\'VOTE_QUESTION_MULTIPLE_ANSWERS\')}}</span>\n\t\t\t\t<div ref="multipleAnswersSwitcher"></div>\n\t\t\t</div>\n\t\t</div>\n\t'};function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var A={name:"voteForm",components:{Question:E},mixins:[f],props:{options:{type:Object,required:true}},data:function t(){return{questions:{},validatedQuestions:{}}},computed:{questionsCount:function t(){return Object.keys(this.questions).length},isFormValid:function t(){var e=Object.values(this.validatedQuestions);if(e.length===0){return false}return e.every((function(t){return t}))},canAddMoreQuestions:function t(){return this.questionsCount<this.options.maxQuestionsCount},firstQuestionId:function t(){var e=Object.keys(this.questions),n=babelHelpers.slicedToArray(e,1),t=n[0];return t||null}},watch:{isFormValid:function t(){r.EventEmitter.emit("vote-creation-form-validate")}},created:function t(){this.questionIdCounter=1;this.answerIdCounter=1;this.settingsLabels={anonymousVote:this.loc("VOTE_SETTING_ANONYMOUS"),allowRevoking:this.loc("VOTE_SETTING_ALLOW_REVOTING")};this.settings={anonymousVote:false,allowRevoking:true};this.initQuestions()},mounted:function t(){var e=this;Object.keys(this.settingsLabels).forEach((function(t){var n=new i.Switcher({node:e.$refs[t][0],size:i.SwitcherSize.small,checked:e.settings[t],handlers:{toggled:function r(){e.settings=x(x({},e.settings),{},babelHelpers.defineProperty({},t,n.checked))}}});o.Dom.attr(n.node,"data-test-id","vote_creation_form_setting_".concat(t))}));this.$nextTick((function(){e.focusFirstQuestion()}))},methods:{initQuestions:function t(){var e=this.options,n=e.minQuestionsCount,r=e.minAnswersCount;var o=n*r;var i=1;var s="question_".concat(this.questionIdCounter);for(var a=0;a<o;a++){if(i>r){i=1;s="question_".concat(++this.questionIdCounter)}if(!this.questions[s]){this.validatedQuestions[s]=false;this.questions[s]={questionText:"",answers:{},allowMultipleAnswers:false}}var c="answer_".concat(this.answerIdCounter++);this.questions[s].answers[c]="";i+=1}},addQuestion:function t(){var e={};var n=this.options.minAnswersCount;for(var r=0;r<n;r++){e["answer_".concat(this.answerIdCounter++)]=""}var o="question_".concat(++this.questionIdCounter);this.questions[o]={questionText:"",answers:e,allowMultipleAnswers:false};this.validatedQuestions[o]=false},addAnswer:function t(e){var n=this;var r=this.questions[e];var o=r.answers;var i="answer_".concat(this.answerIdCounter++);o[i]="";this.$nextTick((function(){var t;var r=(t=n.$refs["question_".concat(e)])===null||t===void 0?void 0:t[0];r===null||r===void 0?void 0:r.focusNewAnswer(i)}))},removeAnswer:function t(e,n){var r=this.questions[e];delete r.answers[n]},changeQuestion:function t(e,n){this.questions[e]=n},validate:function t(e,n){this.validatedQuestions[e]=n},focusFirstQuestion:function t(){var e;if(!this.firstQuestionId){return}var n=(e=this.$refs["question_".concat(this.firstQuestionId)])===null||e===void 0?void 0:e[0];n===null||n===void 0?void 0:n.focusQuestionField()}},template:'\n\t\t<div class="vote-creation-form">\n\t\t\t<div class="vote-creation-form__questions">\n\t\t\t\t<Question\n\t\t\t\t\tv-for="(question, id) in questions"\n\t\t\t\t\t:key="id"\n\t\t\t\t\t:id="id"\n\t\t\t\t\t:question="question"\n\t\t\t\t\t:maxAnswersCount="options.maxAnswersCount"\n\t\t\t\t\t:minAnswersCount="options.minAnswersCount"\n\t\t\t\t\t@addAnswer="addAnswer(id)"\n\t\t\t\t\t@removeAnswer="removeAnswer(id, $event)"\n\t\t\t\t\t@changeQuestion="changeQuestion(id, $event)"\n\t\t\t\t\t@validate="validate(id, $event)"\n\t\t\t\t\t:ref="\'question_\' + id"\n\t\t\t\t></Question>\n\t\t\t\t<button\n\t\t\t\t\tv-if="canAddMoreQuestions"\n\t\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-sm ui-btn-no-caps ui-btn-round vote-creation-form__add-question-btn"\n\t\t\t\t\t@click="addQuestion"\n\t\t\t\t>\n\t\t\t\t\t{{loc(\'VOTE_ADD_QUESTION\')}}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class="vote-creation-form__settings">\n\t\t\t\t<p class="vote-creation-form__settings_title">\n\t\t\t\t\t{{loc(\'VOTE_SETTINGS_TITLE\')}}\n\t\t\t\t</p>\n\t\t\t\t<div\n\t\t\t\t\tv-for="(label, id) in settingsLabels"\n\t\t\t\t\tclass="vote-creation-form__settings_setting"\n\t\t\t\t>\n\t\t\t\t\t<span>{{label}}</span>\n\t\t\t\t\t<div :ref="id"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var T=["containerId","chatId"];function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function L(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */L=function e(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function t(e,n,r){return e[n]=r}}function u(t,e,n,o){var i=e&&e.prototype instanceof d?e:d,s=Object.create(i.prototype),a=new A(o||[]);return r(s,"_invoke",{value:_(t,n,a)}),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function h(){}function v(){}var p={};c(p,i,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(T([])));y&&y!==e&&n.call(y,i)&&(p=y);var w=v.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function o(r,i,s,a){var c=l(t[r],t,i);if("throw"!==c.type){var u=c.arg,f=u.value;return f&&"object"==babelHelpers["typeof"](f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,s,a)}),(function(t){o("throw",t,s,a)})):e.resolve(f).then((function(t){u.value=t,s(u)}),(function(t){return o("throw",t,s,a)}))}a(c.arg)}var i;r(this,"_invoke",{value:function t(n,r){function s(){return new e((function(t,e){o(n,r,t,e)}))}return i=i?i.then(s,s):s()}})}function _(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return j()}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var a=E(s,n);if(a){if(a===f)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function E(t,e){var n=e.method,r=t.iterator[n];if(undefined===r)return e.delegate=null,"throw"===n&&t.iterator["return"]&&(e.method="return",e.arg=undefined,E(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=l(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=undefined),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function T(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=undefined,e.done=!0,e};return o.next=o}}return{next:j}}function j(){return{value:undefined,done:!0}}return h.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:h,configurable:!0}),h.displayName=c(v,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,a,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},g(b.prototype),c(b.prototype,s,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var s=new b(u(e,n,r,o),i);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},g(w),c(w,a,"Generator"),c(w,i,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=T,A.prototype={constructor:A,reset:function t(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=undefined)},stop:function t(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function t(e){if(this.done)throw e;var r=this;function o(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=undefined),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function t(e,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=r&&r<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=r,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(a)},complete:function t(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),f},finish:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),f}},catch:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var i=o.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function t(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=undefined),f}},t}var q=10;var I=function t(e){return String(e*q+q)};var P=function t(e){var n=N.voteForm,r=n.questions,o=n.settings;var i=o.anonymousVote,s=o.allowRevoking;var a={chatId:e,"IM_MESSAGE_VOTE_DATA[ANONYMITY]":i?"2":"1","IM_MESSAGE_VOTE_DATA[OPTIONS]":s?"1":"0"};return Object.values(r).reduce((function(t,e,n){var r=e.questionText,o=e.allowMultipleAnswers,i=e.answers;var s="IM_MESSAGE_VOTE_DATA[QUESTIONS][".concat(n,"]");t["".concat(s,"[QUESTION]")]=r;t["".concat(s,"[C_SORT]")]=I(n);t["".concat(s,"[QUESTION_TYPE]")]="text";t["".concat(s,"[FIELD_TYPE]")]=o?"1":"0";Object.values(i).forEach((function(e,n){var r="".concat(s,"[ANSWERS][").concat(n,"]");t["".concat(r,"[MESSAGE]")]=e;t["".concat(r,"[MESSAGE_TYPE]")]="text";t["".concat(r,"[C_SORT]")]=String(n*10+10);t["".concat(r,"[FIELD_TYPE]")]="0"}));return t}),a)};var k=function(){var t=babelHelpers.asyncToGenerator(L().mark((function t(n,r){var i,s,c,u,l,f,d,h,v,p,m,y,w,g,b,_,E,O,x;return L().wrap((function t(A){while(1)switch(A.prev=A.next){case 0:i=P(r);A.prev=1;s=N.voteForm,c=s.settings,u=s.questions;l=c.anonymousVote,f=c.allowRevoking;A.next=6;return o.ajax.runAction("bitrix:vote.Integration.Im.send",{data:i});case 6:d=A.sent;h=d.data;v=h.messageId;a.VoteAnalytics.publishVote(l,v);p=Object.values(u),m=babelHelpers.slicedToArray(p,1),y=m[0],w=y.answers,g=y.allowMultipleAnswers;b=Object.keys(w).length;a.VoteAnalytics.setupVote(b,a.AnalyticsEvents.setOptions,v);a.VoteAnalytics.setupVote(g,a.AnalyticsEvents.isMultipleChoice,v);a.VoteAnalytics.setupVote(f,a.AnalyticsEvents.setCancelVote,v);BX.SidePanel.Instance.close();A.next=24;break;case 18:A.prev=18;A.t0=A["catch"](1);o.Dom.removeClass(n,"ui-btn-wait");E=(_=A.t0===null||A.t0===void 0?void 0:A.t0.errors)!==null&&_!==void 0?_:[];O=babelHelpers.slicedToArray(E,1),x=O[0];if(x){e.UI.Notification.Center.notify({content:x.message})}case 24:case"end":return A.stop()}}),t,null,[[1,18]])})));return function e(n,r){return t.apply(this,arguments)}}();var C=function t(e){o.Dom.toggleClass(e,"ui-btn-disabled")};var D=function t(e){var n=document.getElementById("vote-im-edit-slider-button-create");C(n);o.Event.bind(n,"click",(function(){return k(n,e)}));var i=function t(){return C(n)};r.EventEmitter.subscribe("vote-creation-form-validate",i);r.EventEmitter.subscribeOnce("SidePanel.Slider:onDestroy",(function(){r.EventEmitter.unsubscribe("vote-creation-form-validate",i)}))};var N=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"mount",value:function e(r){var i=r.containerId,s=r.chatId,a=babelHelpers.objectWithoutProperties(r,T);var c=document.getElementById(i);var u=n.BitrixVue.createApp(A,{options:S(S({},a),{},{minQuestionsCount:1})});t.voteForm=u.mount(c);o.ready((function(){return D(s)}))}}]);return t}();t.App=N})(this.BX.Vote.Component=this.BX.Vote.Component||{},BX,BX.Vue3,BX.Event,BX,BX.UI,BX,BX.Vote);
//# sourceMappingURL=vote-creation-form.bundle.map.js