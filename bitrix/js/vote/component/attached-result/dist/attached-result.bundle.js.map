{"version":3,"file":"attached-result.bundle.js","sources":["../src/classes/service.js","../src/components/voted-users/voted-users.js","../src/components/result-display/result-display.js","../src/index.js"],"sourcesContent":["import { BackendVotedUser } from '../types';\n\nexport class VoteResultService\n{\n\t#signedAttachId: number;\n\t#limit: number;\n\n\tconstructor(signedAttachId: string, limit: number = 10)\n\t{\n\t\tthis.#signedAttachId = signedAttachId;\n\t\tthis.#limit = limit;\n\t}\n\n\tasync loadAnswer(answerId: number, page: number = 1): Promise<BackendVotedUser[]>\n\t{\n\t\tconst data = {\n\t\t\tsignedAttachId: this.#signedAttachId,\n\t\t\tanswerId,\n\t\t};\n\n\t\tconst navigation = {\n\t\t\tsize: this.#limit,\n\t\t\tpage,\n\t\t};\n\n\t\tconst response = await BX.ajax.runAction('vote.AttachedVote.getAnswerVoted', { data, navigation });\n\n\t\treturn response?.data?.items ?? [];\n\t}\n}\n","import { Loc } from 'main.core';\nimport type { PopupOptions } from 'main.popup';\nimport { Popup } from 'ui.vue3.components.popup';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.animated';\n\nimport { VoteResultService } from '../../classes/service';\nimport type { BackendVotedUser } from '../../types';\n\nimport './style.css';\n\nexport const VotedUsersList = {\n\tname: 'VotedUsersList',\n\tcomponents: { Popup, BIcon },\n\tprops: {\n\t\tcount: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tvotedUsers: {\n\t\t\t/** @type BackendVotedUser[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tsignedAttachId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tanswerId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmaxVisibleAvatarsCount:\t{\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t\tdefault: 3,\n\t\t},\n\t\tpageSize: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tshowUsers: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): { users: BackendVotedUser[], page: number, loading: boolean, isShowPopup: boolean }\n\t{\n\t\treturn {\n\t\t\tusers: this.votedUsers,\n\t\t\tpage: 1,\n\t\t\tloading: false,\n\t\t\tisShowPopup: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tsummaryText(): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural('VOTE_JS_ATTACHED_RESULT_ANSWER_VOTED_COUNT', this.count, {\n\t\t\t\t'#COUNT#': this.count,\n\t\t\t});\n\t\t},\n\t\tvisibleVotedUsers(): BackendVotedUser[]\n\t\t{\n\t\t\treturn this.votedUsers.slice(0, this.maxVisibleAvatarsCount);\n\t\t},\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tbindElement: this.$refs.showPopupBtn,\n\t\t\t\tborderRadius: '18px',\n\t\t\t\tautoHide: true,\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tasync popupScrollHandler(event): Promise<void>\n\t\t{\n\t\t\tif (this.loading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.count <= this.users.length)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.target.scrollHeight - event.target.scrollTop > event.target.clientHeight)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loading = true;\n\t\t\tconst nextPage = this.page + 1;\n\t\t\tconst service = new VoteResultService(this.signedAttachId, this.pageSize);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst nextPageUsers: BackendVotedUser[] = await service.loadAnswer(this.answerId, nextPage);\n\t\t\t\tthis.page = nextPage;\n\t\t\t\tthis.users = [...this.users, ...nextPageUsers];\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.loading = false;\n\t\t\t}\n\t\t},\n\t\tgetUserImage(user: BackendVotedUser): string\n\t\t{\n\t\t\treturn `background-image: url('${encodeURI(user.IMAGE)}')`;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"vote-result__users\">\n\t\t\t<div class=\"vote-result__avatars\" v-if=\"showUsers\">\n\t\t\t\t<span class=\"vote-result__avatar\" v-for=\"user in visibleVotedUsers\" :key=\"user.INDEX\" >\n\t\t\t\t\t<i v-if=\"user.IMAGE\" :style=\"getUserImage(user)\" :title=\"user.NAME\" class=\"vote-result__avatar-img\"/>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div @click=\"isShowPopup = true\" ref=\"showPopupBtn\" class=\"vote-result__users-more\" :class = \"{ '--disable': !showUsers }\">\n\t\t\t\t{{ summaryText }}\n\t\t\t</div>\n\t\t\t<Popup v-if=\"isShowPopup\" :options=\"popupOptions\" @close=\"isShowPopup = false\">\n\t\t\t\t<div class=\"vote-result__users-popup\" @scroll=\"this.popupScrollHandler($event)\">\n\t\t\t\t\t<div v-for=\"(user, index) in users\" :key=\"index\" class=\"vote-result__users-popup-item\">\n\t\t\t\t\t\t<img v-if=\"user.IMAGE\" class=\"vote-result__users-popup-avatar\" :src=\"user.IMAGE\" alt=\"\"/>\n\t\t\t\t\t\t<BIcon v-else\n\t\t\t\t\t\t   class=\"vote-result__users-popup-avatar\"\n\t\t\t\t\t\t   :name=\"'person'\"\n\t\t\t\t\t\t   :size=\"26\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"vote-result__users-popup-name\">{{ user.NAME }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<BIcon v-if=\"loading\" :name=\"'loader-wait'\" :size=\"20\" />\n\t\t\t\t</div>\n\t\t\t</Popup>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { VotedUsersList } from '../voted-users/voted-users';\nimport type { BackendVotedUser, CurrentVoteType, QuestionsType, CurrentUserVotesType } from '../../types';\n\nimport './style.css';\n\nconst ANONYMOUS_VOTE = 2;\n\n// @vue/component\nexport const VoteResultDisplay = {\n\tname: 'VoteResultDisplay',\n\tcomponents: { VotedUsersList },\n\tprops:\n\t{\n\t\tloadedData: {\n\t\t\t/** @type {BackendResultAll} */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tvotedPageSize: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tcurrentVote(): CurrentVoteType\n\t\t{\n\t\t\tconst {\n\t\t\t\tVOTE_ID,\n\t\t\t\tisVoted,\n\t\t\t\tsignedAttachId,\n\t\t\t\tdownloadUrl,\n\t\t\t\tcanRevote,\n\t\t\t\tisFinished,\n\t\t\t} = this.loadedData.attach;\n\n\t\t\treturn {\n\t\t\t\tid: VOTE_ID,\n\t\t\t\tisAnonymousVote: this.isAnonymousVote,\n\t\t\t\tisVoted,\n\t\t\t\tsignedAttachId,\n\t\t\t\tdownloadUrl,\n\t\t\t\tcanRevoke: canRevote,\n\t\t\t\tisFinished,\n\t\t\t};\n\t\t},\n\t\tquestions(): QuestionsType\n\t\t{\n\t\t\tconst questionsData = this.loadedData.attach?.QUESTIONS;\n\t\t\tconst calculatedPercentages = this.calculatePercentages(questionsData);\n\n\t\t\tconst questions = {};\n\t\t\tObject.keys(questionsData).forEach((questionId) => {\n\t\t\t\tconst question = questionsData[questionId];\n\t\t\t\tconst answers = {};\n\t\t\t\tconst isMultiple = question.FIELD_TYPE === '1';\n\n\t\t\t\tObject.keys(question.ANSWERS).forEach((answerId, index) => {\n\t\t\t\t\tconst answer = question.ANSWERS[answerId];\n\t\t\t\t\tanswers[answerId] = {\n\t\t\t\t\t\tid: Number(answer.ID),\n\t\t\t\t\t\tpercent: isMultiple ? Math.round(answer.PERCENT) : calculatedPercentages[questionId][index],\n\t\t\t\t\t\ttext: answer.MESSAGE,\n\t\t\t\t\t\tcounter: Number(answer.COUNTER),\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tquestions[questionId] = {\n\t\t\t\t\tid: Number(question.ID),\n\t\t\t\t\tcounter: Number(question.COUNTER),\n\t\t\t\t\ttext: question.QUESTION,\n\t\t\t\t\tanswers,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\treturn questions;\n\t\t},\n\t\tcurrentUserVotes(): CurrentUserVotesType\n\t\t{\n\t\t\tconst currentUserVotes = {};\n\t\t\tconst userAnswerMap = this.loadedData.attach?.userAnswerMap;\n\t\t\tObject.entries(userAnswerMap).forEach(([questionId, answers]) => {\n\t\t\t\tcurrentUserVotes[questionId] = Object.keys(answers)\n\t\t\t\t\t.map((answerId) => Number(answerId));\n\t\t\t});\n\n\t\t\treturn currentUserVotes;\n\t\t},\n\t\tisAnonymousVote(): boolean\n\t\t{\n\t\t\treturn this.loadedData.attach?.ANONYMITY === ANONYMOUS_VOTE;\n\t\t},\n\t\tvoteTypeText(): string\n\t\t{\n\t\t\treturn this.isAnonymousVote\n\t\t\t\t? Loc.getMessage('VOTE_JS_ATTACHED_RESULT_ANONYMOUS')\n\t\t\t\t: Loc.getMessage('VOTE_JS_ATTACHED_RESULT_PUBLIC')\n\t\t\t;\n\t\t},\n\t\tisFinishedVote(): boolean\n\t\t{\n\t\t\treturn this.currentVote.isFinished;\n\t\t},\n\t\tcanRevoke(): boolean\n\t\t{\n\t\t\tif (this.currentVote.isFinished)\n\t\t\t{\n\t\t\t\treturn this.currentVote.isFinished;\n\t\t\t}\n\n\t\t\treturn this.currentVote.canRevoke;\n\t\t},\n\t},\n\tmethods: {\n\t\thasCurrentUserVote(questionId: number, answerId: number): boolean\n\t\t{\n\t\t\treturn this.currentUserVotes[questionId] && this.currentUserVotes[questionId].includes(answerId);\n\t\t},\n\t\tgetSummaryText(count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural('VOTE_JS_ATTACHED_RESULT_QUESTION_VOTED_COUNT', count, {\n\t\t\t\t'#COUNT#': count,\n\t\t\t});\n\t\t},\n\t\tgetVotedUsers(answerId: number): BackendVotedUser[]\n\t\t{\n\t\t\treturn this.loadedData.voted?.[answerId] ?? [];\n\t\t},\n\t\thasVotes(counter: number): boolean\n\t\t{\n\t\t\treturn counter > 0;\n\t\t},\n\t\tgetSelectedClass(questionId, answerId): string\n\t\t{\n\t\t\treturn this.hasCurrentUserVote(questionId, answerId) ? '--selected' : '';\n\t\t},\n\t\tcalculatePercentages(questions): CurrentUserVotesType\n\t\t{\n\t\t\tconst percentages = {};\n\n\t\t\tObject.values(questions).forEach((question) => {\n\t\t\t\tconst answers = question.ANSWERS;\n\n\t\t\t\tconst answerVotes = Object.values(answers).map((answer) => Number(answer.COUNTER));\n\t\t\t\tconst totalVotes = answerVotes.reduce((sum, count) => sum + count, 0);\n\n\t\t\t\tif (totalVotes === 0)\n\t\t\t\t{\n\t\t\t\t\tpercentages[question.ID] = answerVotes.map(() => 0);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst calculatedPercents = answerVotes.map((vote) => (vote / totalVotes) * 100);\n\t\t\t\tconst roundedPercents = calculatedPercents.map((percent) => Math.floor(percent));\n\t\t\t\tconst remainder = 100 - roundedPercents.reduce((sum, p) => sum + p, 0);\n\n\t\t\t\tconst fractionalParts = calculatedPercents\n\t\t\t\t\t.map((percent, index) => ({ index, fraction: percent % 1 }))\n\t\t\t\t\t.sort((a, b) => b.fraction - a.fraction);\n\n\t\t\t\tfor (let i = 0; i < remainder; i++)\n\t\t\t\t{\n\t\t\t\t\troundedPercents[fractionalParts[i].index] += 1;\n\t\t\t\t}\n\n\t\t\t\tpercentages[question.ID] = roundedPercents;\n\t\t\t});\n\n\t\t\treturn percentages;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"vote-result__wrapper\">\n\t\t\t<div class=\"vote-result__info\">\n\t\t\t  <span>{{ voteTypeText }}</span>\n\t\t\t  <span v-if=\"!canRevoke\">{{ $Bitrix.Loc.getMessage('VOTE_JS_ATTACHED_RESULT_REVOKE_IS_NOT_AVAILABLE') }} </span>\n\t\t\t  <span v-if=\"isFinishedVote\">{{ $Bitrix.Loc.getMessage('VOTE_JS_ATTACHED_RESULT_VOTE_IS_FINISHED') }}</span>\n\t\t\t</div>\n\t\t\t<div v-for=\"question in questions\" :key=\"question.id\">\n\t\t\t\t<div class=\"vote-result__title\">{{ question.text }}</div>\n\t\t\t\t<div class=\"vote-result__summary\">{{ getSummaryText(question.counter) }}</div>\n\t\t\t\t<div class=\"vote-result__answers\">\n\t\t\t\t\t<div class=\"vote-result__answer\" v-for=\"answer in question.answers\" :key=\"answer.id\">\n\t\t\t\t\t\t<div class=\"vote-result__answer-inner\" :class=\"getSelectedClass(question.id, answer.id)\">\n\t\t\t\t\t\t\t<div class=\"vote-result__answer-text\">{{ answer.text }}</div>\n\t\t\t\t\t\t\t<div class=\"vote-result__answer-percent\">\n\t\t\t\t\t\t\t\t<span>{{ answer.percent }}</span>\n\t\t\t\t\t\t\t\t%\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"vote-result__answer-fill\"\n\t\t\t\t\t\t\t\t:style=\"{ width: answer.percent + '%' }\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<VotedUsersList\n\t\t\t\t\t\t\tv-if=\"hasVotes(answer.counter)\"\n\t\t\t\t\t\t\t:count=\"answer.counter\"\n\t\t\t\t\t\t\t:votedUsers=\"getVotedUsers(answer.id)\"\n\t\t\t\t\t\t\t:signedAttachId=\"currentVote.signedAttachId\"\n\t\t\t\t\t\t\t:answerId=\"answer.id\"\n\t\t\t\t\t\t\t:pageSize=\"votedPageSize\"\n\t\t\t\t\t\t\t:showUsers=\"!isAnonymousVote\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { VoteResultDisplay } from './components/result-display/result-display';\nimport type { BackendResultAll, VoteAttachedResultOptions } from './types';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\n\nexport class VoteAttachedResult\n{\n\t#application: VueCreateAppResult;\n\t#votedPageSize: number;\n\n\tconstructor(options: VoteAttachedResultOptions)\n\t{\n\t\tthis.#votedPageSize = options.votedPageSize || 10;\n\t}\n\n\tcreateApplicationWithResult(backendResult: BackendResultAll): VueCreateAppResult\n\t{\n\t\treturn BitrixVue.createApp({\n\t\t\tname: 'VoteAttachedResultRoot',\n\t\t\tcomponents: { VoteResultDisplay },\n\t\t\tprops: {\n\t\t\t\tloaded: {\n\t\t\t\t\ttype: Object,\n\t\t\t\t\trequired: true,\n\t\t\t\t},\n\t\t\t\tvotedPageSize: {\n\t\t\t\t\ttype: Number,\n\t\t\t\t\trequired: true,\n\t\t\t\t},\n\t\t\t},\n\t\t\ttemplate: '<VoteResultDisplay :loadedData=\"loaded\" :votedPageSize=\"votedPageSize\"/>',\n\t\t}, {\n\t\t\tloaded: backendResult,\n\t\t\tvotedPageSize: this.#votedPageSize,\n\t\t});\n\t}\n\n\trenderTo(backendResult: BackendResultAll, container: HTMLElement): void\n\t{\n\t\tthis.#application = this.createApplicationWithResult(backendResult);\n\t\tthis.#application.mount(container);\n\t}\n}\n"],"names":["VoteResultService","constructor","signedAttachId","limit","loadAnswer","answerId","page","data","navigation","size","response","BX","ajax","runAction","items","VotedUsersList","name","components","Popup","BIcon","props","count","type","Number","required","votedUsers","Array","String","maxVisibleAvatarsCount","default","pageSize","showUsers","Boolean","users","loading","isShowPopup","computed","summaryText","Loc","getMessagePlural","visibleVotedUsers","slice","popupOptions","bindElement","$refs","showPopupBtn","borderRadius","autoHide","methods","popupScrollHandler","event","length","target","scrollHeight","scrollTop","clientHeight","nextPage","service","nextPageUsers","error","console","getUserImage","user","encodeURI","IMAGE","template","ANONYMOUS_VOTE","VoteResultDisplay","loadedData","Object","votedPageSize","currentVote","VOTE_ID","isVoted","downloadUrl","canRevote","isFinished","attach","id","isAnonymousVote","canRevoke","questions","questionsData","QUESTIONS","calculatedPercentages","calculatePercentages","keys","forEach","questionId","question","answers","isMultiple","FIELD_TYPE","ANSWERS","index","answer","ID","percent","Math","round","PERCENT","text","MESSAGE","counter","COUNTER","QUESTION","currentUserVotes","userAnswerMap","entries","map","ANONYMITY","voteTypeText","getMessage","isFinishedVote","hasCurrentUserVote","includes","getSummaryText","getVotedUsers","voted","hasVotes","getSelectedClass","percentages","values","answerVotes","totalVotes","reduce","sum","calculatedPercents","vote","roundedPercents","floor","remainder","p","fractionalParts","fraction","sort","a","b","i","VoteAttachedResult","options","createApplicationWithResult","backendResult","BitrixVue","createApp","loaded","renderTo","container","mount"],"mappings":"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"}